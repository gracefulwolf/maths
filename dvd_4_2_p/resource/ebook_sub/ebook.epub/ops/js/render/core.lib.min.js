!function(){window.debugMode=void 0!==window.nodeDebugMode?window.nodeDebugMode:!0,window.nodeDebugMode&&window.console.log("# nodeDebugMode : ",window.nodeDebugMode),window.debugMode&&window.console.warn("TODO : // 디버깅용으로 노출된 속성 비활성화 시킬것 (window.debugMode=false)")}(),function(){function e(){function e(t,n){var r="",a=n||0;n=++a;for(var i=o>=a,s="";--n>0;)s+="    ";try{if(t instanceof Array||Array.isArray(t)){r+="\n"+s+"<Array>";for(var c=0;c<t.length;++c)r+=i?"\n"+s+"    ["+c+"] : "+e(t[c],a):"\n"+s+"    ["+c+"] : "+t[c];r+="\n"+s+"</Array>\n"}else if("string"==typeof t||null===t||void 0===t)r+=t;else if(t.toString().indexOf("[object HTML")>-1||t.toString().indexOf("[object XML")>-1)r+=t;else if(t.toString().indexOf("[object")>-1){r+="\n"+s+"<Object>";for(var u in t)"function"!=typeof t[u]&&(r+=i?"\n"+s+"    ["+u+"] : "+e(t[u],a):"\n"+s+"    ["+u+"] : "+t[u]);r+="\n"+s+"</Object>\n"}else r+=t}catch(l){r="\n# log error : "+l}return r}if(arguments&&!(arguments.length<1)){var o=2;if(n){for(var r="",a=0;a<arguments.length;++a)r+=e(arguments[a]);return void t.apply(console,[r])}}}var t=console.log,n=/android/i.test(navigator.userAgent);n&&(console.error=console.debug=console.log=function(){e.apply(null,arguments)})}(),window.VERSION={project:"Jik-Ji",number:"0.15.1000",company:"vulcan",developer:"ⓒ Dong-il Park",email:"pdi1066@naver.com",web:"https://github.com/vulcan9/jik-ji",auth:window.$$_auth,demo:window.$$_demo},window.$$__isEditTool&&window.VERSION.number.indexOf("_VERSION_")>-1&&window.$$_developVersion&&(window.VERSION.number=window.$$_developVersion,window.VERSION.development=!0),console.log("%c# "+VERSION.project+" "+VERSION.number+" "+VERSION.developer,"color:#44D1FF;font-size:2em;font-weight:bold;"),console.log("%c("+VERSION.email+")","color:#1F85FF;font-size:1.2em;font-weight:bold;"),console.log("VERSION : ",window.VERSION),function(){function e(e){void 0!=e.preventDefault&&e.preventDefault(),void 0!=e.stopPropagation&&e.stopPropagation()}document.oncontextmenu=function(t){e(t)}}(),window.requestAnimationFrame=function(){var e=window.requestAnimationFrame||function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();return e}(),window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame,console.log("\n\n"),console.warn("TODO : 아래 부분 바이너리 코드화 할것 (시작)"),window.MODULE=function(e){function t(e,t,n){return{key:e,name:t+"."+e,instance:null,project:n}}var n=["core","tool"];e&&e.length>0&&(n=n.concat(e));var o="jikji",r="vulcan."+o;console.debug("(주의) namespace 를 바꾸려면 gulp 코드에서 global.NS 를 함께 바꿔야 합니다."),console.debug("# NS : ",r);var a={$get:function(e){return angular.module(e)},$set:function(e,t){console.log("	- MODULE CREATE : ",e.name);var n=angular.module(e.name,t);return e.instance=n,n},$add:function(e){window.MODULE[e]=t(e,r,o)}};for(var i in n){var s=n[i];a[s]=t(s,r,o)}return a}(window.moduleNameArray),console.log("MODULE 객체 생성 : ",MODULE),console.warn("TODO : 바이너리 코드화 (종료)"),function(){console.log("\n\n"),console.log("# core module 시작");var e=["ngRoute","ngAnimate","ngMessages","ngMaterial","ngSanitize"],t=MODULE.$set(MODULE.core,e);console.log("	- MODULE CORE : ",MODULE.$get(MODULE.core.name)==MODULE.core.instance),console.log("# core module 끝"),console.log("\n\n"),t.run(function(){})}(),function(){var e=MODULE.core.instance;e.config(["$qProvider","$rootScopeProvider","$compileProvider","$httpProvider",function(e,t,n,o){t.digestTtl(200),console.debug("(참고) ng-inspector for AngularJS를 사용하려면 $compileProvider.debugInfoEnabled(true)로 설정해야 합니다."),console.debug("(참고) false로 설정 되었다면 다시 참조할 수 있도록 console 에서 다음 코드를 실행 합니다 : angular.reloadWithDebugInfo()"),n.debugInfoEnabled(!0),o.useApplyAsync(!0);var r="application/x-www-form-urlencoded;charset=utf-8";o.defaults.headers.post["Content-Type"]=r,o.useApplyAsync(!0)}])}(),function(){var e=MODULE.core.instance;e.constant("Version",window.VERSION),e.constant("UIDType",{APPLICATION:"application",PROJECT:"project",DOCUMENT:"document",ELEMENT:"element",HISTORY:"history",SELECT:"select",ASSET:"asset",GROUP:"group",TOOL:"tool",COMPONENT:"component",TEMPLATE:"template"}),e.constant("ElementType",{PROJECT:"project",DOCUMENT:"document",GROUP:"group",TEXT:"text",IMAGE:"image",VIDEO:"video",AUDIO:"audio",BUTTON:"button",INPUT:"input",MASK:"mask",HTML:"html",WEB:"web",MASTER:"master",TEMPLATE:"template",COMPONENT:"component"}),e.constant("State",{ERROR:"Error",CLOSED:"Closed",READY:"Ready",EDITED:"Edited",SAVED:"Saved"}),e.value("MessageType",{ALERT:"ALERT",WARN:"WARN",ERROR:"ERROR",INFO:"INFO"}),e.value("StatusIcon",{NORMAL:"NORMAL",WAIT:"WAIT",SUCCESS:"SUCCESS",FAIL:"FAIL",PROCESS:"PROCESS"}),e.value("AnimationSpeed",{NONE:0,HIGH:300,MEDIUM:400,LOW:500})}(),function(){var e=MODULE.core.instance;e.value("Default",{busyDelayTime:50,captureDelayTime:1e3,backupDelayTime:2e3,processTimeLimit:18e4,paperWidth:1024,paperHeight:768,thumbnailSizeRange:200,thumbnailQuality:50,thumbnailWidth:120,thumbnailHeight:100,thumbnailLimitWidth:118,thumbnailLimitHeight:98,animate:{duration:.3,timeFunction:"ease",delay:0},animateEnable:!0,screenPadding:3e3,zoom:{min:25,max:500,unit:25,dragSensitive:3},layout:{left:!0,center:!1,right:!1,width:!0,top:!0,middle:!1,bottom:!1,height:!0},toolButtonDelay:1e3,element:{minWidth:1,minHeight:1,width:100,height:100},exitEditElementByClick:!0,treeTabWidth:12,codeEditor:{commonSetting:{lineNumbers:!0,fixedGutter:!0,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Tab":"autoFormatSelection","Alt-F":"findPersistent"},readOnly:!1,styleActiveLine:!0,autoCloseTags:!0,autoCloseBrackets:!0},htmlmixed:{matchClosing:!0,htmlMode:!0,allowDropFileTypes:["application/xml","text/html"],mode:"htmlmixed"},html:{matchClosing:!0,htmlMode:!0,allowDropFileTypes:["application/xml","text/html"],mode:"text/html"},css:{allowDropFileTypes:["text/css"],mode:"text/css"},js:{matchBrackets:!0,continueComments:"Enter",allowDropFileTypes:["text/javascript","application/javascript","application/json","application/ld+json"],mode:"text/javascript"},etc:{allowDropFileTypes:["text/plain"],mode:"text/plain"}}})}(),function(){function e(e,t){function n(){var t=e.pathToActual(e.USER_DATA_ROOT_MARKER);return t=t+"/"+e.appConfigFile,console.log("# App 설정 파일 : ",t),t}function o(e){var o=n();t.exist(o,function(n){if(!n)return a=angular.merge({},i),e(a);var r={encoding:"utf8"};t.readFile(o,r,function(t,n){t&&console.error("* App 설정 파일 읽기 에러 : ",t);try{console.log("# App 설정 파일 읽기 : ",o),console.log("	- App 설정 파일 내용 : ",n),n=n?JSON.parse(n):{}}catch(r){n={}}return a=angular.merge({},i,n),e(a)})})}function r(e){var o;try{console.log("# App 설정 파일 쓰기 : ",a),o=JSON.stringify(a,null,4)}catch(r){o=null}if(!o)return e();var i=n(),s={encoding:"utf8"};t.outputFile(i,o,s,function(t){t&&console.error("* App 설정 파일 쓰기 에러 : ",t),e(a)})}var a,i={updater:{hideUpdateAlarm:!1}};return{getData:function(e,t){return a&&!t?e(a):void o(e)},setData:function(e,t){return a?(a=angular.merge({},a,e),void r(t)):void o(function(n){a=angular.merge({},n,e),r(t)})}}}var t=MODULE.core.instance;t.service("__$appConfiguration",e),e.$inject=["FileSystem","$externalAPI"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f){function v(){}return v.prototype={define:function(n,o,r,a){(void 0===o||null===o)&&(o=new t),console.log("\n# [ ",n," ] 명령 정의 : ",o),o.args&&o.args.debug&&console.debug("* debug : ",o.args.debug);var i=e.get(n),s=new i;return o.name=n,s.setProcess(o,r,a),s._process.useTimeCheck=!0,s},_useCallStackProcess:!0,_callStack:[],_runningProcess:null,_allowStatus:!1,execute:function(e,t,c,d){if(e){if(e.params&&e.params.name!==n.PROJECT_BACKUP&&(this._allowStatus||m.setMessage("")),this._allowStatus||m.enable(!1),this._useCallStackProcess&&e.useCommandStackCheck===!0){if(this._runningProcess){if(d)return console.warn("\n # ",e.params.name,"실행 무시됨 (다른 process가 진행중)"),void(d.content&&u.message(d.content));if(console.debug("\n # command 실행 대기 (process가 실행중) : ",this._runningProcess.params.name),this._callStack.push([e,t,c]),this._callStack.length>1){var p="이전 작업 처리중...";i.open({message:p,delay:500})}return}this._runningProcess=e,e.useSafetyCheck&&(s.isBusy(!0),s.freeze()),e.params.name!==n.PROJECT_SAVE||e.params.name!==n.PROJECT_SAVEAS||e.params.name!==n.PROJECT_OPEN?a.start(e,3*f.processTimeLimit):a.start(e)}var v=e instanceof o,g=this;e.execute(function(o){a.end();var u=e.status;e.ignoreHistory||v&&1===u&&r.get().add(e),1===u?console.log("%c# $command Process 정상 처리됨","color:green"):0===u?console.log("%c# $command Process 중지(취소)됨","color:magenta"):(console.log("%c# Command 처리 실패 하였습니다.","color:darkorange"),console.log("%c	result : %O","color:darkorange",o)),console.log("\n"),console.group("Process 콜백 함수 실행");try{m.enable(),t&&t.apply(c,[o])}catch(d){l.error("%c# 에러 발생 : %s","color:darkorange",d.stack||d),i.close()}console.groupEnd(),console.log("\n\n"),s.flush(),g._runningProcess=null,s.isBusy(!1);var p;if(g._callStack.length>0){var h=g._callStack.shift();p=h[0].params&&h[0].params.name?h[0].params.name:"",console.debug("\n# 대기중인 다음 command 호출 시작 : ",p),g.execute.apply(g,h)}else p=e.params&&e.params.name?e.params.name:"",console.log("\n# command 종료",p),i.close();e.params&&e.params.name===n.PROJECT_RESTORE&&i.close(f.busyDelayTime)},this)}}},new v}var t=MODULE.core.instance;t.service("$command",e),e.$inject=["$injector","CommandParam","CommandName","HistoryProcess","$history","$commandTimer","$busy","$applications","$timeout","$toast","$externalAPI","$projects","$key","$status","Default"]}(),function(){function e(e){function t(){}return t.prototype={_executeTimeRestart:!1,_lastProcess:null,_ignoreTimeCheck:function(){return this._lastProcess&&!this._lastProcess.useTimeCheck},_timeNum:e.processTimeLimit,__counter:0,counter:function(e){void 0===e&&(e=1),this.__counter=this.__counter+e},_hasInstance:function(){return this.__counter>0},start:function(t,n){t&&(this._timeNum=n||e.processTimeLimit,this._lastProcess=t,this._ignoreTimeCheck()||(this._executeTimeID&&clearTimeout(this._executeTimeID),this._hasInstance()||(this._time(),this._executeTimeRestart=!1)))},_time:function(){var e=this;this._executeTimeID=setTimeout(function(){return e._hasInstance()?void e.pause():void(e._lastProcess&&(console.error("_lastProcess : ",e._lastProcess),e._lastProcess._error("응답이 없어 프로세스를 취소합니다.")))},this._timeNum)},end:function(){this._ignoreTimeCheck()||(this._timeNum=e.processTimeLimit,this._executeTimeID&&clearTimeout(this._executeTimeID),this._executeTimeRestart=!1,this._lastProcess=null)},pause:function(){this._lastProcess&&(this._ignoreTimeCheck()||(this._executeTimeID&&clearTimeout(this._executeTimeID),this._executeTimeRestart=!0))},resume:function(){this._lastProcess&&(this._ignoreTimeCheck()||this._hasInstance()||this._executeTimeRestart&&(this._time(),this._executeTimeRestart=!1))}},new t}var t=MODULE.core.instance;t.service("$commandTimer",e),e.$inject=["Default"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){var d=e.create("CommandBase",{_process:null,getProcess:function(){return this._process},setProcess:function(e,o,r){if(e){var a=e instanceof n;if(0==a)throw new Error("["+this.className+"] parameter 형식이 CommandParam 이 아닙니다.")}return this._process=o||new t(e),this._checkProcess(r,this._process,this._processReady),this},_checkProcess:function(e,t,o){try{if(t.params){if(t.params instanceof n==0)throw new Error("["+this.className+"] param은 CommandParam의 instance 여야 합니다.")}else t.params=new n;this._addProcess(e,t,o)}catch(r){this._error(r)}},_addProcess:function(e,t,n){e=e||t._ignoreID,t.add(e,n,this)},_processReady:function(e,t,n){c.setIcon(l.WAIT);var o=this;s.commandReady(this.className,function(r){r&&console.log("# 캡쳐 선 처리 후 Command 실행 필요 : ",o.className),o._run(e,t,n)})},_run:function(e,t,n){console.warn("TODO : CommandBase 오버라이딩 구현 안됨");var o=this._process.params;this._success(o,e,t)},_error:function(e,t,n){r.setState(this.className,e),c.setMessage(e,u.ERROR),c.setIcon(l.FAIL),n&&n(e)},_success:function(e,t,n){r.setState(this.className),c.setIcon(l.SUCCESS),t&&t(e);var o=this._process.params.getParam("ignoreBackup");if(!o){var a,s=this._process.params.getParam("ignoreCapture");"boolean"==typeof s&&s&&(a={ignoreCapture:s}),i.commandAfter(this.className,a)}}});return d}var t=MODULE.core.instance;t.factory("CommandBase",e),e.$inject=["$superClass","Process","CommandParam","Default","$applications","$timeout","$autoBackup","$capture","$status","MessageType","StatusIcon"]}(),function(){function e(){var e={APPLICATION_NEW:"NewApplicationCommand",APPLICATION_MODIFY:"ModifyApplicationCommand",APPLICATION_EXIT:"ExitApplicationCommand",APPLICATION_UPDATE:"UpdateApplicationCommand",PROJECT_NEW:"NewProjectCommand",PROJECT_OPEN:"OpenProjectCommand",PROJECT_SAVE:"SaveProjectCommand",PROJECT_SAVEAS:"SaveAsProjectCommand",PROJECT_CLOSE:"CloseProjectCommand",PROJECT_MODIFY:"ModifyProjectCommand",PROJECT_PUBLISH:"PublishProjectCommand",PROJECT_PREVIEW:"PreviewProjectCommand",PROJECT_RESTORE:"RestoreProjectCommand",PROJECT_BACKUP:"BackupProjectCommand",DOCUMENT_ADD:"AddDocumentCommand",DOCUMENT_REMOVE:"RemoveDocumentCommand",DOCUMENT_SELECT:"SelectDocumentCommand",DOCUMENT_MODIFY:"ModifyDocumentCommand",DOCUMENT_INDEX:"IndexDocumentCommand",ELEMENT_ADD:"AddElementCommand",ELEMENT_REMOVE:"RemoveElementCommand",ELEMENT_SELECT:"SelectElementCommand",ELEMENT_MODIFY:"ModifyElementCommand",ELEMENT_INDEX:"IndexElementCommand",ELEMENT_BOUNDARY_MASK:"MaskElementBoundaryCommand",GROUP_EDITABLE:"EditableGroupCommand",INDEXED_POSITION:"indexedPositionCommand",ASSET_ADD:"AddAssetCommand",ASSET_REMOVE:"RemoveAssetCommand",ASSET_MODIFY:"ModifyAssetCommand",GROUP_ADD:"AddGroupCommand",GROUP_REMOVE:"RemoveGroupCommand",GROUP_MODIFY:"ModifyGroupCommand",ELEMENT_COPY:"CopyElementCommand",ELEMENT_CUT:"CutElementCommand",ELEMENT_PASTE:"PasteElementCommand",COMPONENT_IMPORT:"ImportComponentCommand",COMPONENT_EXPORT:"ExportComponentCommand",COMPONENT_INSTALL:"InstallComponentCommand",COMPONENT_CREATE:"CreateComponentCommand",COMPONENT_DELETE:"DeleteComponentCommand",COMPONENT_INSERT:"InsertComponentCommand",COMPONENT_MODIFY:"ModifyComponentCommand",TEMPLATE_INSTALL:"InstallTemplateCommand",TEMPLATE_EXPORT:"ExportTemplateCommand",TEMPLATE_IMPORT:"ImportTemplateCommand",TEMPLATE_DELETE:"DeleteTemplateCommand",TEMPLATE_INSERT:"InsertTemplateCommand",TEMPLATE_MODIFY:"ModifyTemplateCommand"};return e}var t=MODULE.core.instance;t.constant("CommandName",e())}(),function(){function e(){function e(e){this._args=e}return e.prototype={isHistoryProcess:!1,name:void 0,_args:null,getParam:function(e){return this._args&&e in this._args?this._args[e]:null},setParam:function(e,t,n){this._args||(this._args={}),this._args[e]=t,n&&delete this._args[e]},_response:void 0,getResponse:function(){return this._response},setResponse:function(e){this._response=this._response||{},angular.extend(this._response,e)}},e}var t=MODULE.core.instance;t.factory("CommandParam",e)}(),function(){function e(e,t,n,o){var r=e.extend("HistoryCommandBase",{_originalParam:void 0,_resultParam:void 0,setProcess:function(e,t,o){if(t){var r=t instanceof n;if(0==r)throw new Error("["+this.className+"] process 형식이 HistoryProcess 이 아닙니다.")}0==e.isHistoryProcess&&(this._originalParam=angular.copy(e)),this._process=t||new n(e,this),this._checkProcess(o,this._process,this._run);var a=e.getParam("ignoreHistory");return a&&(this._process.ignoreHistory=!0),this},_error:function(e,t,n){this._super(e,t,n)},_success:function(e,t,n){this._resultParam=angular.copy(e),this._super(e,t,n)},getUndoProcess:function(){this._undoParam=this._setUndoParam(this._process.params),this._undoParam.isHistoryProcess=!0;var e=this._getUndoCommand().getProcess();return e},getRedoProcess:function(){this._redoParam=this._setRedoParam(this._originalParam,this._resultParam),this._redoParam.isHistoryProcess=!0;var e=this._getRedoCommand().getProcess();return e},_getUndoCommand:function(){console.warn("%O %s 메서드를 Override 하지 않았습니다.",this,"_getUndoCommand");var e=o.define("HistoryCommandBase",this._undoParam);return e},_getRedoCommand:function(){console.warn("%O %s 메서드를 Override 하지 않았습니다.",this,"_getRedoCommand");var e=o.define("HistoryCommandBase",this._redoParam);return e},_undoParam:void 0,_redoParam:void 0,_setUndoParam:function(e){var n=new t({debug:"UNDO 기능을 위해 작성한 Param 값"});return console.warn("TODO : Undo Param : ",n),n},_setRedoParam:function(e){var n=new t;return angular.extend(n,e),n}});return r}var t=MODULE.core.instance;t.factory("HistoryCommandBase",e),e.$inject=["CommandBase","CommandParam","HistoryProcess","$command"]}(),function(){function e(e,t,n,o,r){function a(){}return a.prototype={_disable:!1,parentSelector:void 0,_getParent:function(e){this.parentSelector=this.parentSelector||document.body;var t=e.parent||angular.element(this.parentSelector);return t},_domInstance:null,_domInstanceScope:null,_openID:null,_openTime:0,_openConfig:null,applyAsync:function(e){e&&(this._domInstanceScope?n(function(){e()},100):this._domInstanceScope.$applyAsync(function(){e()}))},open:function(r,a){function i(){this._openID=null,this._openTime=0;var n=angular.element('<div jj-busy-indicator config="config">'),r=e.$new(!0);r.config=angular.copy(this._openConfig),r.message=o.trustAsHtml(r.config.message||""),r.progress=null,r.isOpened=!0,t(n)(r);var i=this._getParent(r.config);this._domInstance=n,this._domInstanceScope=r,angular.element(i).append(this._domInstance),this._domInstanceScope.isOpened=!0,r.$applyAsync(function(){a&&a()})}if(!this._disable){if(r=r||{},r.delay=r.delay||0,this._closeID&&(n.cancel(this._closeID),this._closeID=null),this._domInstance&&this._domInstanceScope.isOpened)return this._openConfig=r,void this.message(this._openConfig.message,a);if(this._openID){var s=(new Date).getTime()-this._openTime,c=Math.min(this._openConfig.delay,r.delay);r.delay=c>s?c-s:0,n.cancel(this._openID),this._openID=null}else this._openTime=(new Date).getTime();this._openConfig=r;var u=this;this._openID=n(function(){i.apply(u)},r.delay)}},_closeID:null,close:function(e){function t(){a._closeID=null,a._domInstanceScope.isOpened=!1,a._domInstanceScope.$destroy(),a._domInstance.remove(),a._domInstance=null,a._domInstanceScope=null,a._openConfig=null,this._openTime=0}if(!this._disable){this._openID&&(n.cancel(this._openID),this._openID=null);var o=this._domInstanceScope;o&&o.$applyAsync(),this._closeID&&(n.cancel(this._closeID),this._closeID=null);var a=this;this._closeID=n(function(){a._disable||(a._closeID=n(function(){a._domInstance&&t()},500))},e||r.busyDelayTime)}},message:function(){if(!this._disable){var e=angular.noop,t=[].slice.call(arguments);"function"==typeof t[t.length-1]&&(e=t.length>0?t.pop():angular.noop);var r="";if(t.length>0&&(r=t.join(" ")),!this._domInstance||!this._domInstanceScope.isOpened)return void this.open({message:r},e);this._closeID&&(n.cancel(this._closeID),this._closeID=null);var a=this._domInstanceScope;a.progress=null,r&&(a.message=o.trustAsHtml(r)),a.$applyAsync(function(){e&&e()})}},progress:function(){if(!this._disable&&this._domInstance){var e=this._domInstanceScope;if(arguments.length<3)return void(e.progress=null);var t,n=[].slice.call(arguments),r=n.shift(),a=n.shift(),i="",s="",c=angular.noop;if(arguments.length>0)if("function"==typeof n[n.length-1]&&(c=n.length>0?n.pop():angular.noop),"object"==typeof n[0]){var u=n.shift();i=u.message||"",s=u.unit||"",u.cancel&&(t=u.cancel)}else i=n.join(" ");e.progress={message:o.trustAsHtml(i),current:r,total:a,unit:s,cancel:t?"취소":null},e.$applyAsync(function(){c&&c()}),e.cancel=function(){t&&t()}}}},new a}function t(e){function t(){return function(e,t,n){e.$watchCollection(function(){return e.progress},function(t,n){if(t){var o=e.progress.current/e.progress.total*100;e.percent=Math.floor(o)}else e.percent=0})}}return{restrict:"EA",templateUrl:"jj-busy-indicator.html",replace:!0,scope:!1,compile:t}}var n=MODULE.core.instance;n.service("$busy",e);var n=MODULE.core.instance;n.directive("jjBusyIndicator",t),e.$inject=["$rootScope","$compile","$timeout","$sce","Default"],t.$inject=["$interval"]}(),function(){function e(e,t,n,o,r,a){function i(e){++u;var t="import_"+u;r.currentContext(t),r.customKeyup("esc",t,function(t){return e.config.protectEscKey?void 0:e.escKey?e.escKey():void console.error("# esc 단축키 : scope.escKey 메서드가 구현되지 않았습니다.")}),r.customKeyup("enter",t,function(t){return e.config.protectEnterKey?void 0:e.enterKey?e.enterKey():void console.error("# enter 단축키 : scope.enterKey 메서드가 구현되지 않았습니다.")}),1===u&&a.disable()}function s(){var e="import_"+u;r.currentContext(r.CONTEXT_LAST),r.customKeyup("esc",e),r.customKeyup("enter",e),--u,0===u&&a.enable()}function c(){}var u=0;return c.prototype={counter:function(){return u},parentSelector:void 0,_getParent:function(e){this.parentSelector=this.parentSelector||document.body;var t=e.parent||angular.element(this.parentSelector);return t},open:function(r,a){document.activeElement.blur();var r=r||{};void 0===r.pauseCommandTimer&&(r.pauseCommandTimer=!0);var s=e.$new(!0);s.config=angular.copy(r);var c=angular.element(r.template),u=this;s.callback=function(){var e=arguments;n.leave(c).then(function(){u._close(s),c&&c.remove(),s.$destroy(),a&&a.apply(null,e),s=null,c=null})},t(c)(s);var l=this._getParent(r),d=angular.element(l).find("[popup-dialog]").last()[0];n.enter(c,l,d).then(function(){}),i(s),!s||s.config&&!s.config.pauseCommandTimer||(o.counter(1),o.pause())},_close:function(e){s(),!e||e.config&&!e.config.pauseCommandTimer||(o.counter(-1),o.resume())}},new c}var t=MODULE.core.instance;t.service("$import",e),e.$inject=["$rootScope","$compile","$animate","$commandTimer","$key","$fileDrop"]}(),function(){function e(e,t,n,o,r,a,i){function s(e){++d,n.counter(1),n.pause();var t="notice_"+d;o.currentContext(t),o.customKeyup("esc",t,function(t){return e&&e.escKey?e.escKey():void console.log("# esc 단축키 : scope.escKey 메서드가 구현되지 않았습니다.")}),o.customKeyup("enter",t,function(t){return e&&e.enterKey?e.enterKey():void console.log("# enter 단축키 : scope.enterKey 메서드가 구현되지 않았습니다.")}),1===d&&a.disable()}function c(){l&&(l=!1),n.counter(-1),n.resume();var e="notice_"+d;o.currentContext(o.CONTEXT_LAST),o.customKeyup("esc",e),o.customKeyup("enter",e),--d,0===d&&a.enable(),0>d&&console.error("close _counter : ",d)}function u(){}var l=!1,d=0;return u.prototype={counter:function(){return d},parentSelector:void 0,_getParent:function(e,t){e=e||{},this.parentSelector=this.parentSelector||document.body;var n=e.parent||angular.element(this.parentSelector);return n},alert:function(n){var n=n||{};if(void 0===n.focusOnOpen&&document.activeElement.blur(),!l){l=Boolean(n.modal);var o=n.title||"알림",r=n.ok||"ok",a=n.isTop||!1,u=void 0===n.closeButton?!0:n.closeButton,d=n.popupClass||{};n.contentUrl&&(n.content=i.get(n.contentUrl)),angular.merge(n,{isTop:a,templateUrl:"popup/alert.html",controller:["$scope","$notice",function(e,a){e.close=function(e){a.close(e)},e.config={popupClass:d,modal:l,title:o,yes:r,content:t.trustAsHtml(n.content),closeButton:u},e.$on("$destroy",function(){e.config=null}),s(e)}]}),n.parent=this._getParent(n),a&&angular.element(n.parent).addClass("md-dialog-top-index");var p=e.show(n)["finally"](function(){c()});return p}},confirm:function(n){var n=n||{};if(void 0===n.focusOnOpen&&document.activeElement.blur(),!l){l=Boolean(n.modal);var o=n.title||"알림",r=n.ok||"ok",a=n.cancel||"cancel",u=void 0===n.isTop?!1:n.isTop,d=void 0===n.closeButton?!0:n.closeButton,p=void 0===n.optionButton?!1:n.optionButton,m=n.popupClass||{};n.contentUrl&&(n.content=i.get(n.contentUrl)),angular.merge(n,{isTop:u,templateUrl:"popup/confirm.html",controller:["$scope","$notice",function(e,i){e.close=function(e){i.close(e)},e.config={popupClass:m,modal:l,title:o,yes:r,no:a,content:t.trustAsHtml(n.content),optionButton:p,closeButton:d},e.$on("$destroy",function(){e.config=null}),s(e)}]}),n.parent=this._getParent(n),u&&angular.element(n.parent).addClass("md-dialog-top-index");var f=e.show(n)["finally"](function(){c()});return f}},open:function(t){if(!t||!t.controller)throw new Error("controller를 통해 close()를 구현해 주어야 합니다.");if(void 0===t.focusOnOpen&&document.activeElement.blur(),!l){l=Boolean(t.modal),t.parent=this._getParent(t);var n=void 0===t.isTop?!1:t.isTop;n&&angular.element(t.parent).addClass("md-dialog-top-index"),s(t._scope||t.scope);var o=e.show(t)["finally"](function(){c()});return o}},close:function(t){e.hide(t),angular.element(".md-dialog-top-index").removeClass("md-dialog-top-index")},versionLimitMessage:function(e){var t=r.companyLimit();return t&&this.alert({modal:!0,title:e||"알림",content:"해당 기능은 지원되지 않습니다.",ok:"확인",isTop:!0,closeButton:!1}),t}},new u}var t=MODULE.core.instance;t.service("$notice",e),e.$inject=["$mdDialog","$sce","$commandTimer","$key","$version","$fileDrop","$templateCache"]}(),function(){function provider(){function $superClass(){}function inheritance(e,t){for(var n in t){var o=function(t,o){if(isFn(t)&&isFn(o))e[n]=function(){return this._super=o,t.apply(this,arguments)};else{if(angular.isArray(o)||angular.isObject(o))for(var r in o)void 0===t[r]&&(t[r]=o[r]);e[n]=t}};o(t[n],e[n])}}var isFn=function(e){return"function"==typeof e};return $superClass.create=function(className,proto){if("string"!=typeof className)throw new Error("Class 이름은 문자열 형식으로 전달해야 합니다.");proto=proto||{},proto.className=className;var funcString="(function(){    return function "+className+"(magic) {        if (magic != isFn && isFn(this.init)){            this.init.apply(this, arguments);        }    };})();",k=eval(funcString);return k.prototype=new this(isFn),inheritance(k.prototype,proto),k.prototype.constructor=k,k.extend=this.extend||this.create,k},$superClass}var application=MODULE.core.instance;application.service("$superClass",provider)}(),function(){function e(e){function t(){}var n="bottom",o=2e3,r=5e3,a=1e4;return t.prototype={SHORTEST:o,SHORT:r,LONG:a,parentSelector:void 0,_getParent:function(e){this.parentSelector=this.parentSelector||document.body;var t=e?e.parent:null;return t||angular.element(this.parentSelector)},message:function(t,o){var o=o||{};o.isSimple=!0;var r=isNaN(o.delay)?this.SHORT:o.delay;return o.parent=this._getParent(o),o.templateUrl="toast-simple.html",o.hideDelay=r,o.position=o.position||n,o.controller=["$scope","$sce",function(e,n){e.config=o,e.content=n.trustAsHtml(t)}],e.show(o)},open:function(t,o){var o=o||{};void 0===o.isSimple&&(o.isSimple=!0);var r=o.isSimple?"toast-simple.html":"toast-custom.html",a=isNaN(o.delay)?this.SHORT:o.delay;o.isSimple||(a=0),o.parent=this._getParent(o),o.templateUrl=o.template||r,o.hideDelay=a,o.position=o.position||n;var i=this;return o.controller=["$scope","$sce",function s(e,n){var s=i._getController(t,o);s(e,n)}],e.show(o)},_getController:function(t,n){var o=this;return function(r,a){r.config=n,r.content=a.trustAsHtml(t),r.close=function(t){o._removBackdrop(),e.hide(t)},r.$on("$destroy",function(){r.config=null,r.content=null,o._removBackdrop()}),n.hasBackdrop&&o._addBackdrop(n.clickBackdropToClose)}},close:function(t){e.hide(t)},cancel:function(t){e.cancel(t)},_addBackdrop:function(e){var t=this._getParent(),n=angular.element('<md-backdrop class="md-dialog-backdrop toast-backdrop">');e&&n.on("click",this._backdropClick),angular.element(t).prepend(n)},_removBackdrop:function(){var e=this._getParent(),t=e.find("md-backdrop.toast-backdrop")[0];angular.element(t).off("click",this._backdropClick),angular.element(t).remove()},_backdropClick:function(){e.hide()}},new t}var t=MODULE.core.instance;t.service("$toast",e),e.$inject=["$mdToast"]}(),function(){function e(e){return{htmlToString:function(e){var t=e.outerHTML;return t},stringToHtml:function(e){var t=angular.element(e);return t[0]},createUID:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";return e=e.replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},isUID:function(e){var t=/^([a-z]+)-.{8}-.{4}-4.{3}-.{4}-.{12}$/,n=e.match(t);return n?{uid:n[0],type:n[1]}:null},weblink:function(e,t){var n;return window.nwDispatcher&&window.nwDispatcher.nwGui?n=window.nwDispatcher.nwGui:window.nw&&window.nw.Shell&&(n=window.nw),n&&n.Shell?void n.Shell.openExternal(e):void window.open(e,t||"_blank")},urlParameter:function(){var e={},t=window.top.window,n=t.location.search.substring(1);return n.split("&").forEach(function(t){var n=t.split("=");e[n[0]]=n[1]}),e},isPreviewer:function(){var e=this.urlParameter();return console.debug("# Previewer 전달값 : ",e),"jikji-editor"===e.jjpreviewer},textSelection:function(){var e;if(window.getSelection){var t=window.getSelection();e=t.toString()}else if(document.selection){var n=document.selection.createRange();e=n.text}return e},clearSelection:function(){var e={};return window.getSelection?e=window.getSelection():document.selection&&(e=document.selection.createRange()),e.rangeCount?void e.removeAllRanges():e.text>""?void document.selection.empty():void 0},caretToSelectEnd:function(){var t=e.browser(),n="Edge"==t.name||"IETablet"==t.name,o="IE"==t.name||n;if(window.getSelection)if(o);else{var r=window.getSelection();r.rangeCount>0&&r.collapseToEnd()}else{var a=document.selection.createRange();a.collapse(!1),a.select()}},selectAllContents:function(t){var n=angular.element(t);t=n[0];var o=t.nodeName.toUpperCase();if("INPUT"===o||"TEXTAREA"===o)return void t.select();if(window.getSelection){var r=e.browser(),a="Edge"==r.name||"IETablet"==r.name,i="IE"===r.name||a,s=window.getSelection();if(i){var c=a?"div":"p",u=n.find(c),l=u.length>0?u[u.length-1]:t,d=angular.element(l).text(),p=d.length;l=p>0?l.firstChild:l,s.collapse(l,p)}else s.selectAllChildren(t)}else{var s=document.body.createTextRange();s.moveToElementText(t),s.select()}},parseUnit:function(e,t){var n=typeof e;if("number"==n)return{num:e,unit:""};if("undefined"==n)return{num:void 0,unit:""};var o="(([-+]?\\d+\\.?\\d*)|NaN|undefined|null)\\W*("+t+")",r=new RegExp(o),a=this.toNumber(e.replace(r,"$1")),i=e.replace(r,"$3");return t.indexOf(i)<0&&(i=""),{num:a,unit:i}},toNumber:function(e,t){var n=parseFloat(e);return isNaN(n)?t||0:n},toArray:function(e){return Array.prototype.slice.apply(e)},isEmpty:function(e){return angular.isUndefined(e)||""===e||null===e||e!==e},deleteUndefined:function(e){for(var t in e)void 0===e[t]&&delete e[t];return e},toCamelCase:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},toSnakeCase:function(e){return e.replace(/(\w)?([A-Z])/g,function(e,t,n){var o=t?t+"-":"";return o+n.toLowerCase()})},toCaption:function(e){return e.replace(/^(\w)/g,function(e,t){return t.toUpperCase()})},pattern:{positiveNumber:/^[+]?\d+\.?\d*$/,negativeNumber:/^-?\d+\.?\d*$/,decimal:/^[-+]?\d+\.?\d*$/,integer:/^[-+]?\d+$/,email:/^((\w[\-\.])+)@((\w[\-\.])+)\.([A-Za-z]+)$/,hex:/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,cssColor:/#(?:[a-f\d]{3}){1,2}\b|rgb\((?:(?:\s*0*(?:25[0-5]|2[0-4]\d|1?\d?\d)\s*,){2}\s*0*(?:25[0-5]|2[0-4]\d|1?\d?\d)|\s*0*(?:100(?:\.0+)?|\d?\d(?:\.\d+)?)%(?:\s*,\s*0*(?:100(?:\.0+)?|\d?\d(?:\.\d+)?)%){2})\s*\)|hsl\(\s*0*(?:360|3[0-5]\d|[12]?\d?\d)\s*(?:,\s*0*(?:100(?:\.0+)?|\d?\d(?:\.\d+)?)%\s*){2}\)|(?:rgba\((?:(?:\s*0*(?:25[0-5]|2[0-4]\d|1?\d?\d)\s*,){3}|(?:\s*0*(?:100(?:\.0+)?|\d?\d(?:\.\d+)?)%\s*,){3})|hsla\(\s*0*(?:360|3[0-5]\d|[12]?\d?\d)\s*(?:,\s*0*(?:100(?:\.0+)?|\d?\d(?:\.\d+)?)%\s*){2},)\s*0*(?:1|0(?:\.\d+)?)\s*\)/,url:/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=\-\$\^\&\*,\.\?\[\]\{\}'";`|!\\]{2,256}\.[a-zA-Z0-9]{2,256}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/,http:/(http(s)?):\/\/[(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-zA-Z0-9]{2,256}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/,source:/((data:image.+;base64,.+)|((http(s)?):\/\/[(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-zA-Z0-9]{2,256}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)))/,map:/^((&?\w+=[^&]+)+(&?)$)/m,pubName:/((\s?)+\((binder|web|binder_web)\))$/,appid:/^[a-z0-9-_.]+$/,appname:/^[^\\\/:*?"<>|]+$/,folderName:/^[^\\\/:*?"<>|]+$/},toLogString:function(){function e(n,o){
var r="",a=o||0;o=++a;for(var i=t>=a,s="";--o>0;)s+="    ";try{if(n instanceof Array||Array.isArray(n)){r+="\n"+s+"<Array>";for(var c=0;c<n.length;++c)r+=i?"\n"+s+"    ["+c+"] : "+e(n[c],a):"\n"+s+"    ["+c+"] : "+n[c];r+="\n"+s+"</Array>\n"}else if("string"==typeof n||null===n||void 0===n)r+=n;else if(n.toString().indexOf("[object HTML")>-1||n.toString().indexOf("[object XML")>-1)r+=n;else if(n.toString().indexOf("[object")>-1){r+="\n"+s+"<Object>";for(var u in n)"function"!=typeof n[u]&&(r+=i?"\n"+s+"    ["+u+"] : "+e(n[u],a):"\n"+s+"    ["+u+"] : "+n[u]);r+="\n"+s+"</Object>\n"}else r+=n}catch(l){r="\n# log error : "+l}return r}if(arguments&&!(arguments.length<1)){for(var t=2,n="",o=0;o<arguments.length;++o)n+=e(arguments[o]);return n}},time2String:function(e){var t=Math.floor(e/3600)%24,n=Math.floor(e/60)%60,o=Math.floor(e%60),r="";return r+=10>t?"0"+t+":":t+":",r+=r&&10>n?"0"+n+":":n+":",r+=10>o?"0"+o:o},string2Time:function(e){if(e.indexOf(":")<0)return isNaN(e)?0/0:parseInt(e);var t=e.split(":");t.reverse();var n=parseInt(t[0],10),o=0;void 0!==t[2]&&(o=parseInt(t[1],10),o=60*o);var r=0;void 0!==t[2]&&(r=parseInt(t[2],10),r=3600*r);var a=r+o+n;return a},position:function(e,t){function n(e,t,n){var o=e.width(),r=angular.element(window.document).width();return o>r?t:n>t?n:r>t+o+n?t:t=r-(o+n)}function o(e,t,n){var o=e.height(),r=angular.element(window.document).height();return o>r?t:n>t?n:r>t+o+n?t:t=r-(o+n)}var r={};return t=t||{},e=angular.element(e),void 0===t.margin&&(t.margin=0),void 0!==t.left&&(r.left=n(e,t.left,t.margin)),void 0!==t.top&&(r.top=o(e,t.top,t.margin)),r}}}var t=MODULE.core.instance;t.service("$util",e),e.$inject=["$device"]}(),function(){function e(e){return{toString:function(){return this.version()+"\n"+this.copyright()+"\n"+e.web},project:function(){return e.project},email:function(){return e.email},copyright:function(){return e.company+" "+e.developer+" ( "+e.email+" )"},isDemoVersion:function(){return e.demo},isDevelopVersion:function(e){return e=e||this.version(),e.indexOf("(Dev)")>-1},version:function(){var t=e.development?"(Dev)":"(Beta)",n=e.auth&&e.auth.com?"("+e.auth.com+")":t;return e.project+" "+e.number+" "+n},versionName:function(){return e.project},versionNumber:function(){return e.number},parse:function(e){var t,n=999;void 0===e&&(e=this.version());var o=/(.+)\s((\d+)\.(\d+)\.(\d+)|#_VERSION_#)(\s\((.+)\))?/g;return e.replace(o,function(e,o,r,a,i,s,c,u,l,d){return e!==d&&alert("버전 표기 분석이 불완전합니다.\n"+d),t={name:o,major:void 0===a?n:Number(a),minor:void 0===i?n:Number(i),build:void 0===s?n:Number(s),auth:u},d}),t||alert("버전 표기법이 잘못되었습니다.\n"+e),t},getLast:function(t,n){return void 0===n&&(n=this.version()),t=this.parse(t),n=this.parse(n),t.major>n.major?1:t.major<n.major?-1:t.minor>n.minor?1:t.minor<n.minor?-1:t.build>n.build?1:t.build<n.build?-1:e.development?-2:0},companyLimit:function(){return!1},toObject:function(e){var t=e.split("."),n=Number(t[0]),o=Number(t[1]),r=Number(t[2]);return{major:isNaN(n)?0:n,minor:isNaN(n)?0:o,build:isNaN(n)?0:r}},toVersion:function(e){var t=Number(e.major||0),n=Number(e.minor||0),o=Number(e.build||0),r=isNaN(t)?0:t,a=isNaN(n)?0:n,i=isNaN(o)?0:o,s=r+"."+a+"."+i;return s}}}var t=MODULE.core.instance;t.service("$version",e),e.$inject=["Version"]}(),function(){function e(e,t,n){function o(){return function(o,r,a){function i(){var e=o.config;if(e.id=e.id||"FileDialogBox",e.isDirectory){if(a.$set("nwdirectory",""),void 0!==e.directoryDesc&&r.attr("nwdirectorydesc",e.directoryDesc),void 0!==e.workingDir){var t="win32"===n._platform;t&&(e.workingDir=e.workingDir.replace(/\//g,"\\")),r.attr("nwworkingdir",e.workingDir)}}else e.multiple&&a.$set("multiple",""),e.saveMode&&a.$set("nwsaveas",e.defaultSaveName||""),void 0!==e.accept&&r.attr("accept",e.accept);e.show&&o.show()}function s(t){if("focus"==t.type&&(console.log("# File Dialog Box 에서 change 이벤트가 발생하는지 기다린다."),u=e(function(){l=r.val(),console.log("# 취소 처리됨 : ",l),c()},1e3)),"change"==t.type){var n,a=$(this)[0].files;if(o.config.multiple){n=[];for(var i=0;i<a.length;++i){var s=a[i];n.push({type:s.type,name:s.name,size:s.size,path:s.path})}}else n=a[0];l=n,console.log("# File Dialog Box 에서 change 이벤트가 발생"),console.log("# 경로 선택 : ",l),c(),u&&e.cancel(u)}}function c(){t.resume(),o.callback(l),o.config.autoRemove&&r.remove(),o.$destroy()}o.show=function(){e(function(){t.pause(),r.trigger("click")},0)},o.onClick=function(e){e.stopPropagation(),document.body.onfocus=s,r.on("change",s)},i();var u,l;o.$on("$destroy",function(){r.off("change",s),document.body.onfocus=null,o.config=null,u&&e.cancel(u),u=null,l=null})}}return{restrict:"EA",templateUrl:"external/jj-file-dialog-box.html",replace:!0,scope:!1,compile:o}}var t=MODULE.core.instance;t.directive("jjFileDialogBox",e),e.$inject=["$timeout","$commandTimer","FileSystem"]}(),function(){function e(e){function t(e,t){var n=e.html();return e.html('<div class="jj-slider-content">'+n+"</div>"),e.css({overflow:"hidden"}),function(e,t,n){o(e,t,n)}}function n(e,t,n){this.sliderResize=function(){e.sliderResize()}}function o(e,t,n){function o(o){var r="true"===n.jjSlider,a=n.sliderH;if(r&&(void 0===a||o))return void e.$applyAsync(function(){i&&i.css("border",0);var e=i?i.outerHeight():0;n.sliderH=e,t.attr("slider-h",e),t.height(e),t.addClass("sliderOn")});var s;s=r?"auto"===a?"auto":parseInt(n.sliderH,10)||0:0,i.css("border",0),t.height(s),e.$applyAsync(function(){t.addClass("sliderOn")})}var r=n.$observe("jjSlider",function(e){o()}),a=e.$on("jjSliderResize",function(t){e.sliderResize()}),i=t.find(".jj-slider-content"),s=n.$observe("sliderH",function(e){t.removeClass("sliderOn"),o()});e.sliderResize=function(){t.removeClass("sliderOn"),o(!0)},e.$on("$destroy",function(){r(),s(),i=null,t.removeClass("sliderOn"),a()})}return n.$inject=["$scope","$element","$attrs"],{restrict:"A",compile:t,controller:n}}var t=MODULE.core.instance;t.directive("jjSlider",e),e.$inject=["$timeout"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){function m(){}var f,v,g=o,h=function(){};return m.prototype={init:function(){console.log("# External API 생성됨 : ")},error:function(){console.error.apply(console,arguments)},signup:function(e,t){},signout:function(e,t){},login:function(e,t){},configuration:function(n,o){if(!n)return void o(!1);n=n||{};var r=this;g.api.configuration(n,function(n,a){if(console.log("FS config 정보 받아오기"),n||!a)throw new Error("초기 설정값을 받지 못했습니다.");var i=e;i._platform=a.platform,i._nativeType=a.nativeType,i._appRoot=a.appRoot,i._tempRoot=a.tempRoot,i._tempRootURL=a.tempRootURL,i._userDataRoot=a.userDataRoot,i._userDataRootURL=a.userDataRootURL;var s=window.$$_auth&&window.$$_auth.com?window.$$_auth.com:"devUser";window.$$_auth&&(window.$$_auth.address=a.macAddress),a.workFolder&&(i.workspacePrefix="/"+a.workFolder),i.WORK_SPACE=i.workspacePrefix+"/"+s,f=i.TEMP_ROOT_MARKER+i.WORK_SPACE_MARKER,v=f+i.PROJECT_SPACE_MARKER,t.set(i,v),console.log("# FileSystem 값 재설정 : ",t),r.setTitle(),o&&o()})},component:function(e,t){g.api.component(e,function(e,n){t&&t(e,n)})},template:function(e,t){g.api.template(e,function(e,n){t&&t(e,n)})},setTitle:function(e,t){e=e||"",g.api.setTitle(e,t)},exit:function(){g.api.exit()},explorer:function(e,t){g.api.explorer(e,t)},getSaveAsInformation:function(e,n){e=e||{};var o=e.old||"",r=g.path.parse(o);e.defaultSaveName=(r.name?r.name:t.defaultName)+t.ext,e.saveMode=!0,e.accept=t.ext,g.dialog.getSaveAsInformation(e,function(e){n(e.path)})},getOpenInformation:function(e,n){e=e||{},e.accept=e.accept||t.ext,g.dialog.getOpenInformation(e,function(t){var o=e.multiple?t:t.path;n(o)})},getPublishInformation:function(e,n){e=e||{};var o=e.ext||"",r=e.old||"",a=g.path.parse(r),i=a.name?a.name:t.defaultName;i=i.replace(c.pattern.pubName,""),e.defaultSaveName=i+o,e.saveMode=!0,e.accept||(e.accept=o),g.dialog.getPublishInformation(e,function(e){n(e.path)})},_getFileExplorer:function(e,t){console.debug("TODO : Native로 분리 시킬것 (_getFileExplorer)");var e=e||{},n=angular.element('<div jj-file-dialog-box config="config">'),o=u.$new(!0);o.config=angular.copy(e),o.config.show=!0,o.config.autoRemove=!0,o.callback=function(e){t&&t(e.path)},l(n)(o),angular.element("body").append(n)},newData:function(e,t){e&&this._initData(e);var n={path:v,copyResource:!0};this.createFolder(n,t)},_initData:function(e){t.PROJECT_SPACE="/"+g.path.join(t.saveRootFolder,e)},closeData:function(e,t){var n={path:f};i.message("작업 폴더 초기화");var o=this;setTimeout(function(){o.remove(n,null,function(t,n){console.log("# 이전 작업 폴더를 제거 하였습니다."),t&&alert("remove API 에러 : "+t),i.message("작업 폴더 초기화 완료"),o._zip=new r,e()})},500)},_zip:new r,setMetaData:function(e,t,n){var o=e.meta;this._setMetaData(e,o),t(!0)},_setMetaData:function(e,n){var o=e.project;n?n.project=o:n={project:o};var r=g.path.join(f,t.saveManifestFile);r=t.pathToActual(r),this._zip.creater(t.saveManifestFile,r,angular.toJson(n))},saveData:function(e,n,o){var r=this._getFilePath(e.uid),a=t.pathToActual(r),i=e.task;if("delete"==i)return this._zip.remover(r,a),void n(i);if("json"==e.type){var s=angular.toJson(e.data,t.jsonPretty)||"";this._zip.creater(r,a,s)}n(!0)},_getFileUID:function(e){var t=g.path.parse(e),n=t.base;return n},_getFilePath:function(e){var n=g.path.join(v,e);return t.normalize(n)},saveFiles:function(e,t,n){t(e.task)},saveBackup:function(e,n,o){var r=this,r=this,a="_onProgressName_saveBackup";window[a]=e.onProcess||function(e,t,n){};var i={archiveDesc:e.archiveDesc||"",onProgress:a,base:t.pathToActual(f),tasks:this._zip.generate()};g.archive.backup(i,function(e,t){delete window[a],r._zip.clean(),e?o(e):n(t)})},saveZip:function(e,n,o){function r(e){var n=v;console.log("# zip 내에 폴더 복사 위치 : ",n);var o=t.pathToActual(f);console.log("# 실제 폴더 복사 위치 : ",o),this._zip.importer({isFolder:!0,name:n,origin:o,ignore:["**/temp","**/temp/**/*"]})}var a=e.path;if(!a)return console.error("경로가 지정되지 않았습니다."),void o();console.log("# Zip 파일 경로 : ",a),console.debug("\n"),console.debug("######################################"),console.debug("# 변경된 파일 목록만 전달하여 처리한다.",e),console.debug("######################################"),console.debug("\n"),r.apply(this,[e.project]),this._zip.remover(t.PREVIEW_FOLDER,t.pathToActual(t.PREVIEW_FOLDER)),this._zip.remover(t.EPUB_FOLDER,t.pathToActual(t.EPUB_FOLDER));var i="_onProgressName_saveZip";window[i]=e.onProcess||function(e,t,n){};var s={archiveDesc:e.archiveDesc||"",onProgress:i,dest:t.pathToActual(a),base:t.pathToActual(f),tasks:this._zip.generate()};e.project&&(s.project=e.project),e.title&&(s.title=e.title),e.legacy&&(s.legacy=e.legacy);var c=this;g.archive.save(s,function(e,t){delete window[i],c._zip.clean(),e?o(e):n(t)})},restoreData:function(e,n,o){function r(e){var n=g.path.join(f,t.saveManifestFile);console.log("폴더 복구 : ",n),c.exist(n,function(t){t?c.readFile(n,{encoding:"utf8"},function(t,n){return t?void e("manifest 파일을 읽는중 에러가 발생하여 복구를 취소합니다."):void e(null,n)}):e("한번도 저장하지 않은 프로젝트는 복구할 수 없습니다.\n복구를 취소합니다.")})}function a(e,t){c._zip.clean(),t()}function s(e){function n(e,t,n){arguments.length<2?i.message(e):500>t?i.message(n):i.progress(e,t,n)}var o="_openDecompressProcess";window[o]=n;var r={onProgress:o,dest:t.pathToActual(f),dataFolderName:t.saveRootFolder,isRestore:!0};g.archive.open(r,function(t,n){delete window[o],e(t,n)})}var c=this,u=[];u.push(r),u.push(a),u.push(s),u.push(function(){c.__openReadData.apply(c,arguments)}),async.waterfall(u,function(e,r){i.message("프로젝트 복구 중입니다."),c._initWorkspace(r,function(a){a&&console.error("OPS 폴더 카피 실패 : ",a),console.log("# 복구 프로젝트 경로 : ",t.pathToActual(v)),console.log("Restore : ",r),setTimeout(function(){e?o(e):n(r)})})})},__openReadData:function(e,t){console.log("# Open 데이터 : ",e);var o=angular.fromJson(e.meta);this._initData(o.project);var r=e.files,a={meta:o};for(var i in r){var s,c=r[i],u=angular.fromJson(c),l=this._getFileUID(i);0==l.indexOf(n.APPLICATION)?s=n.APPLICATION:0==l.indexOf(n.PROJECT)?s=n.PROJECT:0==l.indexOf(n.DOCUMENT)?s=n.DOCUMENT:0==l.indexOf(n.ELEMENT)?s=n.ELEMENT:0==l.indexOf(n.SELECT)?s=n.SELECT:0==l.indexOf(n.ASSET)?s=n.ASSET:0==l.indexOf(n.GROUP)?s=n.GROUP:0==l.indexOf(n.TOOL)&&(s=n.TOOL),a[s]||(a[s]={}),a[s][l]=u}t(null,a)},openData:function(e,n,o){function r(e){c._zip.clean();var t={path:v,copyResource:!1};c.createFolder(t,function(t){e(t)})}function a(e){function n(e,t,n){arguments.length<2?i.message(e):500>t?i.message(n):i.progress(e,t,n)}var o="_openDecompressProcess";window[o]=n;var r={onProgress:o,source:s,dest:t.pathToActual(f),dataFolderName:t.saveRootFolder};g.archive.open(r,function(t,n){delete window[o],e(t,n)})}var s=e.path;if(!s)return console.error("경로가 지정되지 않았습니다."),void o();console.log("파일 읽기 : ",e.path);var c=this,u=[];u.push(r),u.push(a),u.push(function(){c.__openReadData.apply(c,arguments)}),async.waterfall(u,function(e,t){i.message("파일 복사 중입니다."),c._initWorkspace(t,function(r){r&&console.error("OPS 폴더 카피 실패 : ",r),console.log("Open : ",t),setTimeout(function(){e?o(e):n(t)})})})},saveEpub:function(e,n){var o=e.base;e.archive={base:{isFolder:!0,name:o,origin:t.pathToActual(o)}};var r;"epub"===e.publishType?r=o:"web"===e.publishType?(r=o+t.PREVIEW_EPUB,e.webInfo={epubFolder:"."+t.PREVIEW_EPUB,setting:{name:"epub/"+t.ebook_viewer_epub_setting,origin:t.pathToActual(t.BUNDLE_BINDER+"/"+t.ebook_viewer_epub_setting)},index:{name:"index.html",origin:t.pathToActual(t.BUNDLE_VIEWER_EBOOK+"/index.html")}},e.archive.base.ignore=["index.html"]):"binder"===e.publishType||"binder_web"===e.publishType,e.epubRoot=r,this.savePackaging(e,n)},savePackaging:function(e,n){var o="_onProgressName_savePackaging";window[o]=e.onProcess||function(e,t,n){};var r=this.getSaveParameter(e),a=e.savePath,i=t.pathToActual(e.base),s={archiveDesc:e.archiveDesc||"",onProgress:o,dest:a,base:i,tasks:r.generate()};e.project&&(s.project=e.project),e.title&&(s.title=e.title),e.webInfo&&(s.webInfo=e.webInfo),e.binderInfo&&(s.binderInfo=e.binderInfo),e.binderWebInfo&&(s.binderWebInfo=e.binderWebInfo),g.archive.save(s,function(e,t){delete window[o],r.clean(),n&&n(e,t)})},getSaveParameter:function(e){var n=e.epubRoot,o=new r,a=[t.opfTemplate,t.pageTemplate,t.jsTemplate,t.ncxTemplate,t.navTemplate];for(var i in a){var s=a[i],c=g.path.join(n,s),u=t.pathToActual(c);o.remover(c,u)}if(e.archive)for(var l in e.archive){var d=e.archive[l];o.importer(d)}return o},less:function(e,t){return void 0===e.content&&void 0===e.source?void t("파일 소스가 지정되지 않았습니다."):e.dest?void g.api.less(e,function(e,n){return e?(console.log(e),void t(e,n)):void t(e,n)}):void t("경로가 지정되지 않았습니다.")},getPdfInfomation:function(e,t){var n=e.path;return n?void g.pdf.getPdfInfomation(e,function(e,n){return e?(console.log(e),void t(e,n)):void t(e,n)}):void t("경로가 지정되지 않았습니다.")},convert:function(e,n,o){return e?(n.destFolder=t.pathToActual(n.destFolder),n.thumbnailFolder=t.pathToActual(n.thumbnailFolder),n.ext=t.EXT_MASTER,void g.pdf.convert(e,n,function(e,t){return e?(console.log(e),void(o&&o(e,t))):t&&t.success?void(o&&o(e,t)):(e="Something went wrong: "+t.error,void(o&&o(e,t)))})):void o("경로가 지정되지 않았습니다.")},convertCancel:function(){g.pdf.convertCancel()},getPdfText:function(e,n,o){return e?(e=t.pathToActual(e),void g.pdf.getText(e,n,function(e,t){e&&console.log(e),o&&o(e,t)})):void o("경로가 지정되지 않았습니다.")},getImageInfomation:function(e,t){var n="string"==typeof e;n&&(e=[e]),g.image.size(e,function(o,r){if(o&&1===o.length&&(console.log("# IMAGE 사이즈 정보 얻지 못함 : ",e),a.message("이미지를 찾을 수 없습니다. 경로를 다시 확인 하세요.")),n){var i=Array.isArray(o)?o[0]:void 0;t(i,r[0])}else t(o,r)})},thumbnail:function(e,n){e.destFolder=t.pathToActual(e.destFolder),g.image.thumbnail(e,function(e,t){return e?void(n&&n(e,t)):t&&t.success?void(n&&n(e,t)):(e="Something went wrong: "+t.error,void(n&&n(e,t)))})},toThumbnail:function(e,n){return e&&e.pages?(e.destFolder=t.pathToActual(e.destFolder),void g.image.resize(e,function(e,t){return e?void(n&&n(e,t)):t&&t.success?void(n&&n(e,t)):(e="Something went wrong: "+t.error,void(n&&n(e,t)))})):void n("이미지(page) 정보가 지정되지 않았습니다.")},toCapture:function(e,n){return e&&e.input?(e.option=e.option||{},e.isData||(e.input=t.pathToActual(e.input)),e.base&&(e.base=t.pathToActual(e.base)),e.output=e.output?t.pathToActual(e.output):e.input,void g.image.capture(e,function(e,t){return e?void(n&&n(e,t)):t&&t.success?void(n&&n(e,t)):(e="Something went wrong: "+t.error,void(n&&n(e,t)))})):void n("이미지(input) 정보가 지정되지 않았습니다.")},getTree:function(e,n){return e.pathString?(e.pathString=t.pathToActual(e.pathString),void g.fs.getTree(e,function(e,t){n(t)})):void console.error("# getTree : 경로가 지정되지 않았습니다.")},getFiles:function(e,n){e=t.pathToActual(e),g.fs.getFiles(e,function(e,t){n(t)})},exist:function(e,n){e=t.pathToActual(e),g.fs.exists(e,function(e,t){n(Boolean(t))})},remove:function(e,n,o){var r,a=e.path;"string"==typeof a?r=[t.pathToActual(a)]:Array.isArray(a)&&(r=a.map(function(e){var n=t.pathToActual(e);return n})),g.fs.remove(r,n,function(e,t){e&&alert("remove API 에러 : ",e),o&&o(e,t)})},copy:function(){function e(e,n,o){var r=[{src:t.pathToActual(e),dest:t.pathToActual(n)}];return r}function n(e,n){var o=e.map(function(e){return{src:t.pathToActual(e.src),dest:t.pathToActual(e.dest)}});return o}var o,r,a={overwrite:!0};"string"==typeof arguments[0]?(o=e.apply(this,arguments),r=arguments[2]):Array.isArray(arguments[0])&&(o=n.apply(this,arguments),r=arguments[1]),g.fs.copy(o,a,function(e,t){r&&r(e,t)})},move:function(){function e(e,n,o){var r=[{src:t.pathToActual(e),dest:t.pathToActual(n)}];return r}function n(e,n){var o=e.map(function(e){return e.src=t.pathToActual(e.src),e.dest=t.pathToActual(e.dest),e});return o}var o,r;"string"==typeof arguments[0]?(o=e.apply(this,arguments),r=arguments[2]):Array.isArray(arguments[0])&&(o=n.apply(this,arguments),r=arguments[1]),g.fs.move(o,function(e,t){r&&r(e,t)})},createFolder:function(e,n){n=n||h;var o=t.pathToActual(e.path),r=this;g.fs.mkdirs(o,function(t,o){e.copyResource?r._initWorkspace(null,n):n&&n(t)})},_initWorkspace:function(e,n){var o=t.pathToActual(t.BUNDLE_EPUB+t.OPS),r=t.pathToActual(t.WORK_OPS_FOLDER),a=this;g.fs.mkdirs(r,function(i,s){a.copy(o,r,function(o){if(!e)return void(n&&n(o));var r=function(){var n=new d,o=e.project[e.meta.project].version,r=n.isSubversion(o,"0.7.17");return console.log("# VERSION : ",e.project[e.meta.project].version,r),r?[t.WORK_OPS_FOLDER+"/js/lib/angular-spectrum-colorpicker",t.WORK_OPS_FOLDER+"/js/lib/spectrum",t.WORK_OPS_FOLDER+"/js/lib/ng-file-upload"]:[]}(),i=t.WORK_OPS_FOLDER+"/_capture_*.html",s=[i,t.TEMP_FOLDER,t.PREVIEW_FOLDER,t.EPUB_FOLDER].concat(r);a.remove({path:s},null,function(e){n&&n(o)})})})},readFile:function(e,n,o){n=n||{encoding:"utf8"},e=t.pathToActual(e),g.fs.readFile(e,n,function(e,t){o&&o(e,t)})},outputFile:function(e,n,o,r){e=t.pathToActual(e),g.fs.outputFile(e,n,o,function(e,t){r&&r(e,t)})},gc:function(){window.global&&window.global.gc&&(window.global.gc(),console.warn("# GC 실행됨"))},updateDownload:function(e,n){return e.src&&e.dest?(e.dest&&(e.dest=t.pathToActual(e.dest)),void g.update.download(e,function(e,t){n&&n(e,t)})):void(n&&n("업데이트 다운로드에 필요한 정보가 전달되지 않았습니다."))},updateDownloadCancel:function(e,t){g.update.downloadCancel()},updateInstall:function(e,n){return e.installFile&&e.installFolder?(e.installFile&&(e.installFile=t.pathToActual(e.installFile)),e.installFolder&&(e.installFolder=t.pathToActual(e.installFolder)),void g.update.install(e,function(e,t){n&&n(e,t)})):void(n&&n("업데이트 설치에 필요한 정보가 전달되지 않았습니다."))},exec:function(e,t){g.api.exec(e,function(e,n){t&&t(e,n)})}},new m}var t=MODULE.core.instance;t.service("$externalAPI",e),e.$inject=["FileSystemConfiguration","FileSystem","UIDType","$nativeInterface","Zip","$toast","$busy","$notice","$util","$rootScope","$compile","SupportBase","$timeout"]}(),function(){function e(e,t,n){var o=1,r=[],a=!1,i=e.create("Communication",{toNative:function(e,t,n,o,i){if(i);else{if(a)return console.debug("# 이전 Native 작업(통신) 종료 안되어 기다림 (",e,") : ",e,t),void r.push([e,t,n]);a=!0}console.log("\n"),console.log("# Native 호출 : ",e);var s=this.getCallURL(e,t,n,o,i),c=this._callAPI(s);return c},getCallURL:function(e,n,o,r,a){void 0===r&&(r=!1);var i={project:t.uid()||"",api:e,parameters:n||{}};r||(i.callBack=this.getCallbackMethod(o,e,a));var s=angular.toJson(i);s=encodeURIComponent(s);var c="noteProtocol://"+e+"?data="+s;return c},_callAPI:function(e){return e},getCallbackMethod:function(e,t,i){var s="callback_"+o++,c=this;return window[s]=function(o){o||alert("응답값이 없습니다.");try{o=decodeURIComponent(o);var u=angular.fromJson(o),l=u.error||null,d=u.response||"";if("registExitHandler"!=t&&delete window[s],l){console.error("# API 응답 에러 [",t,"] : ",u);var p=l.message||l;0===p.indexOf("ENOSPC:")?alert("하드웨어 공간이 부족합니다.\n하드웨어 용량을 확인하신 후 다시 시도해 주세요."):n.message("# Native API 에러 : "+p)}else console.log("# API 응답값 [",t,"] : ",u);console.log("\n")}catch(m){alert("실행중 에러 : "+m)}if(e(l,d,u),!i&&(a=!1,r.length>0)){var f=r.shift();console.debug("\n# Delay된 API 다음 호출 시작 : ",f[0]),c.toNative.apply(c,f)}},s}});return i}var t=MODULE.core.instance;t.factory("Communication",e),e.$inject=["$superClass","$projects","$toast"]}(),function(){var e=MODULE.core.instance;e.value("FileSystem",{_description:"이 값은 런타임에 속성이 추가 됩니다. node는 NodeJS API 참조값입니다.",set:function(e,t){angular.merge(this,e),this.BUNDLE_EPUB=this.APP_ROOT_MARKER+this.BIN_EPUB,this.BUNDLE_BINDER=this.APP_ROOT_MARKER+this.BIN_BINDER,this.BUNDLE_BINDER_SOURCE=this.BUNDLE_BINDER+"/"+this.binder_source,this.BUNDLE_BINDER_WEB_SOURCE=this.BUNDLE_BINDER+"/"+this.binder_web_source,this.TEMP_FOLDER=t+this.TEMP,this.WORK_FOLDER=t+this.WORK,this.WORK_OPS_FOLDER=this.WORK_FOLDER+this.OPS,this.WORK_COMPONENT_FOLDER=this.WORK_OPS_FOLDER+"/component",this.EPUB_FOLDER=t+this.EPUB,this.EPUB_OPS_FOLDER=this.EPUB_FOLDER+this.OPS,this.JS_FOLDER=this.EPUB_OPS_FOLDER+this.JS,this.OPF_SAMPLE=this.EPUB_FOLDER+"/"+this.opfTemplate,this.PAGE_SAMPLE=this.EPUB_FOLDER+"/"+this.pageTemplate,this.JS_SAMPLE=this.EPUB_FOLDER+"/"+this.jsTemplate,this.NCX_SAMPLE=this.EPUB_FOLDER+"/"+this.ncxTemplate,this.NAV_SAMPLE=this.EPUB_FOLDER+"/"+this.navTemplate,this.BUNDLE_VIEWER_EBOOK=this.BUNDLE_BINDER_SOURCE+this.BIN_VIEWER_EBOOK,this.PREVIEW_FOLDER=t+this.PREVIEW,this.PREVIEW_EPUB_FOLDER=this.PREVIEW_FOLDER+this.PREVIEW_EPUB,this.BUNDLE_RESOURCE=this.APP_ROOT_MARKER+this.BIN_RESOURCE,this.BUNDLE_CONTENT_EDITOR=this.APP_ROOT_MARKER+this.BIN_CONTENT_EDITOR,this.BUNDLE_FILE_LIST_EDITOR=this.APP_ROOT_MARKER+this.BIN_FILE_LIST_EDITOR,this.USER_DATA_TEMPLATE=this._userDataRoot+"/template",this.USER_DATA_COMPONENT=this._userDataRoot+"/component",this.BUNDLE_COMPONENT=this.pathToActual(this.BUNDLE_RESOURCE,!0)+"/component"},EXT_MASTER:".jpg",EXT_THUMBNAIL:".jpg",EXT_THUMBNAIL_MASTER:".png",EXT_CAPTURE:".png",ACCEPT_IMAGES:".png,.jpg,.gif,.svg",BUNDLE_EPUB:void 0,BUNDLE_BINDER:void 0,BUNDLE_BINDER_SOURCE:void 0,BUNDLE_BINDER_WEB_SOURCE:void 0,BUNDLE_BINDER_WEB_EBOOK:"web/viewer/ebook",HTML_ELEMENT_PATH:"template/html-element-render-page.html",WORK_FOLDER:void 0,WORK_OPS_FOLDER:void 0,EPUB_FOLDER:void 0,EPUB_OPS_FOLDER:void 0,JS_FOLDER:void 0,OPF_SAMPLE:void 0,PAGE_SAMPLE:void 0,JS_SAMPLE:void 0,NCX_SAMPLE:void 0,NAV_SAMPLE:void 0,BUNDLE_VIEWER_EBOOK:void 0,PREVIEW_FOLDER:void 0,PREVIEW_EPUB_FOLDER:void 0,BUNDLE_RESOURCE:void 0,BUNDLE_CONTENT_EDITOR:void 0,BUNDLE_FILE_LIST_EDITOR:void 0,MASTER_DELETE_FILE_NAME:"_delete_master_empty_file.png",USER_DATA_TEMPLATE:void 0,USER_DATA_COMPONENT:void 0,BUNDLE_COMPONENT:void 0,pathMarkerInfo:function(){var e=this.TEMP_ROOT_MARKER+this.WORK_SPACE_MARKER+this.PROJECT_SPACE_MARKER,t={virtual:{original:e,template:this.USER_DATA_TEMPLATE_MARKER,component_user:this.USER_DATA_COMPONENT_MARKER,component_bundle:this.BUNDLE_COMPONENT_MARKER},actual:{original:this.pathToActual(e),template:this.USER_DATA_TEMPLATE,component_user:this.USER_DATA_COMPONENT,component_bundle:this.BUNDLE_COMPONENT}};return t},normalize:function(e){return e?e=e.replace(/\\/g,"/"):""},pathToActual:function(e,t){if(e=this.normalize(e),e.indexOf(this.APP_ROOT_MARKER)>-1){var n="web"===this._nativeType&&t?this._appRootURL:this._appRoot;e=e.replace(this.APP_ROOT_MARKER,n||"")}if(e.indexOf(this.USER_DATA_COMPONENT_MARKER)>-1&&(e=e.replace(this.USER_DATA_COMPONENT_MARKER,this.USER_DATA_COMPONENT||"")),e.indexOf(this.USER_DATA_TEMPLATE_MARKER)>-1&&(e=e.replace(this.USER_DATA_TEMPLATE_MARKER,this.USER_DATA_TEMPLATE||"")),e.indexOf(this.USER_DATA_ROOT_MARKER)>-1){var o="web"===this._nativeType&&t?this._userDataRootURL:this._userDataRoot;e=e.replace(this.USER_DATA_ROOT_MARKER,o||"")}if(e.indexOf(this.BUNDLE_COMPONENT_MARKER)>-1&&(e=e.replace(this.BUNDLE_COMPONENT_MARKER,this.BUNDLE_COMPONENT||"")),e.indexOf(this.TEMP_ROOT_MARKER)>-1){var r="web"===this._nativeType&&t?this._tempRootURL:this._tempRoot;e=e.replace(this.TEMP_ROOT_MARKER,r||"")}return e.indexOf(this.WORK_SPACE_MARKER)>-1&&(e=e.replace(this.WORK_SPACE_MARKER,this.WORK_SPACE||"")),e.indexOf(this.PROJECT_SPACE_MARKER)>-1&&(e=e.replace(this.PROJECT_SPACE_MARKER,this.PROJECT_SPACE||"")),e=this.normalize(e),"web"===this._nativeType&&t&&console.debug("* url로 리턴 : ",e),e},pathToVirtual:function(e){return e=this.normalize(e),e.indexOf(this._appRoot)>-1&&(e=e.replace(this._appRoot,this.APP_ROOT_MARKER)),e.indexOf(this.USER_DATA_COMPONENT)>-1&&(e=e.replace(this.USER_DATA_COMPONENT,this.USER_DATA_COMPONENT_MARKER||"")),e.indexOf(this.USER_DATA_TEMPLATE)>-1&&(e=e.replace(this.USER_DATA_TEMPLATE,this.USER_DATA_TEMPLATE_MARKER||"")),e.indexOf(this._userDataRoot)>-1&&(e=e.replace(this._userDataRoot,this.USER_DATA_ROOT_MARKER)),e.indexOf(this.BUNDLE_COMPONENT)>-1&&(e=e.replace(this.BUNDLE_COMPONENT,this.BUNDLE_COMPONENT_MARKER||"")),e.indexOf(this._tempRoot)>-1&&(e=e.replace(this._tempRoot,this.TEMP_ROOT_MARKER)),e.indexOf(this.WORK_SPACE)>-1&&(e=e.replace(this.WORK_SPACE,this.WORK_SPACE_MARKER)),e.indexOf(this.PROJECT_SPACE)>-1&&(e=e.replace(this.PROJECT_SPACE,this.PROJECT_SPACE_MARKER)),e=this.normalize(e)},getAvailablePath:function(e){return e},getRelativePath:function(e){return e?(e=e.replace(/\\/g,"/"),0===e.indexOf(this.WORK_OPS_FOLDER)&&(e=e.substring(this.WORK_OPS_FOLDER.length+1)),e):e},parsePath:function(e){e=e.replace(/\\/g,"/");var t=e.lastIndexOf("/"),n=0>t?e:e.substr(0,t),o=0>t?e:e.substr(t+1),r=n?n.substring(n.lastIndexOf("/")+1):"",a=o.lastIndexOf("."),i=o.lastIndexOf("?");0>i&&(i=void 0);var s=0>a?o:o.substring(0,a),c=0>a?"":o.substr(a+1,i);return{original:e,folder:n,folderName:r,file:o,fileName:s,ext:c}},noneCachePath:function(e){if(!e)return e;var t="_cachetime=";if(t=e.indexOf("?")<0?"?"+t:"&"+t,e.indexOf(t)>-1)return e;var n=e+t+(new Date).getTime();return n},shortPathString:function(e,t){if(!e)return"";var n=[this.WORK+this.OPS,this.WORK,this.EPUB+this.OPS,this.EPUB,this.PREVIEW+this.PREVIEW_EPUB,this.PREVIEW,this.TEMP].join("|"),o="\\{.+\\}("+n+")?\\/",r=new RegExp(o);return e.replace(r,t+"/")}})}(),function(){var e=MODULE.core.instance;e.value("FileSystemConfiguration",{_platform:void 0,_nativeType:void 0,_tempRoot:"임시 AppData 폴더 경로 (설정안됨)",_tempRootURL:"tempRoot에 대한 서버 URL 접근 경로 (/루트 또는 http://풀경로~)",_appRoot:"App이 실행되는 (bin 폴더가 위치한) 폴더 경로 (설정안됨)",_appRootURL:".",_userDataRoot:"Chromium이 사용하는 User Data 폴더가 위치한 폴더 경로. App이 종료되도 유지해야 하는 데이터를 저장 (설정안됨)",_userDataRootURL:"_appDataRoot에 대한 서버 URL 접근 경로 (/루트 또는 http://풀경로~)",workspacePrefix:"임시폴더로 사용(생성)할 폴더 경로 (설정안됨)",APP_ROOT_MARKER:"{appRoot}",TEMP_ROOT_MARKER:"{tempRoot}",WORK_SPACE_MARKER:"{workSpace}",PROJECT_SPACE_MARKER:"{projectSpace}",USER_DATA_ROOT_MARKER:"{userDataRoot}",USER_DATA_TEMPLATE_MARKER:"{userDataRoot}{template}",USER_DATA_COMPONENT_MARKER:"{userDataRoot}{component}",BUNDLE_COMPONENT_MARKER:"{bundleRoot}{component}",ext_template:".jjt",ext_component:".jjc",appConfigFile:"appConfiguration.json",executeFile:"jik-ji.exe",BIN:"/bin",BIN_RESOURCE:"/bin/bundle/resource",BIN_EPUB:"/bin/bundle/epub",BIN_CONTENT_EDITOR:"/bin/bundle/contentEditor",contentEditor_html:"index.html",BIN_FILE_LIST_EDITOR:"/bin/bundle/fileListEditor",fileListEditor_html:"index.html",BIN_BINDER:"/bin/bundle/binder",binder_source:"Jik-ji-Binder_0.6.1_cdbook_cd_appid",binder_web_source:"Jik-ji-Binder_0.6.1_cdbook_web",binder_modify_package:"app/package.json",binder_modify_inject_start:"app/js/inject_start.min.js",binder_modify_inject_end:"app/js/inject_end.min.js",binder_modify_ebook_viewer_index:"app/viewer/ebook/index.html",ebook_viewer_epub_setting:"ebook_viewer_epub_setting.js",binder_ebook_viewer_epub_setting:"binder_ebook_viewer.js",BINDER_EPUB:"/app/resource/epub/",BINDER_WEB_EPUB:"/web/resource/epub/",BIN_VIEWER_EBOOK:"/app/viewer/ebook",WORK_SPACE:"",PROJECT_SPACE:"",TEMP:"/temp",UPDATER:"/_temporary_updater",WORK:"/work",EPUB:"/epub",PREVIEW:"/preview",PREVIEW_EPUB:"/epub/",CSS:"/css",FONT:"/font",MEDIA:"/media",JS:"/js",CUSTOM:"/custom",IMAGES:"/images",IMAGES_MASTER:"/images/master",IMAGES_COVER:"/images/cover",PAGE_THUMBNAIL:"/page_thumbnails",_CONVERT:"/_convert",IMAGES_CAPTURE:"/images/capture",IMAGES_MASTER_THUMB:"/images/master_thumbnail",mimetype:"/mimetype",META_INF:"/META-INF",container_xml:"/META-INF/container.xml",OPS:"/OPS",content_opf:"content.opf",toc_ncx:"toc.ncx",nav_xhtml:"toc.xhtml",info_json:"page-info.json",ext:".jik",defaultName:"default",jsonPretty:4,saveRootFolder:"_save",saveManifestFile:"manifest.json",pageType:"html",pageNamePrefix:"page-",dataJsPrefix:"render-",opfTemplate:"opf-sample",pageTemplate:"page-sample",jsTemplate:"render-sample",ncxTemplate:"ncx-sample",navTemplate:"nav-sample",publishExt:".epub",compressExt:".zip",index_html:"index.html"})}(),function(){function e(e,t,n){var o=e.create("NativeInterface",{dialog:{getOpenInformation:function(e,n){var o={_pobj:"dialog",config:e},r=t.toNative("getOpenInformation",o,function(e,t,o){n(t)});return r},getSaveAsInformation:function(e,n){var o={_pobj:"dialog",config:e},r=t.toNative("getSaveAsInformation",o,function(e,t,o){n(t)});return r},getPublishInformation:function(e,n){var o={_pobj:"dialog",config:e},r=t.toNative("getPublishInformation",o,function(e,t,o){n(t)});return r}},fs:{getTree:function(e,n){var o={_pobj:"fs",config:e},r=t.toNative("getTree",o,function(e,t,o){n(e,t)});return r},getFiles:function(e,n){var o={_pobj:"fs",pathString:e},r=t.toNative("getFiles",o,function(e,t,o){n(e,t)});return r},exists:function(e,n){var o={_pobj:"fs",pathString:e},r=t.toNative("exists",o,function(e,t,o){n(e,t)});return r},mkdirs:function(e,n){var o={_pobj:"fs",pathString:e},r=t.toNative("mkdirs",o,function(e,t,o){n(e,t)});return r},copy:function(e,n,o){var r={_pobj:"fs",pathArray:e,option:n||{clobber:!0}},a=t.toNative("copy",r,function(e,t,n){o(e,t)});return a},move:function(e,n){var o={_pobj:"fs",pathArray:e},r=t.toNative("move",o,function(e,t,o){n(e,t)});return r},remove:function(e,n,o){var r={_pobj:"fs",pathArray:e,option:n||{}},a=t.toNative("remove",r,function(e,t,n){o(e,t)});return a},readFile:function(e,n,o){var r={_pobj:"fs",pathString:e,option:n},a=t.toNative("readFile",r,function(e,t,n){o(e,t)});return a},outputFile:function(e,n,o,r){var a={_pobj:"fs",dest:e,content:n,option:o},i=t.toNative("outputFile",a,function(e,t,n){r(e,t)});return i}},archive:{compress:function(e,n){var o={_pobj:"archive",config:e},r=t.toNative("compress",o,function(e,t,o){n(e,t)});return r},save:function(e,n){var o={_pobj:"archive",config:e},r=t.toNative("save",o,function(e,t,o){n(e,t)});return r},backup:function(e,n){var o={_pobj:"archive",config:e},r=t.toNative("backup",o,function(e,t,o){n(e,t)});return r},open:function(e,n){var o={_pobj:"archive",config:e},r=t.toNative("open",o,function(e,t,o){n(e,t)});return r}},api:{configuration:function(e,n){var o={_pobj:"api",config:e||""},r=t.toNative("configuration",o,function(e,t,o){n(e,t)});return r},setTitle:function(e,n){var o={_pobj:"api",title:e},r=t.toNative("setTitle",o,function(e,t,o){n&&n(e,t)});return r},explorer:function(e,n){var o={_pobj:"api",path:e},r=t.toNative("explorer",o,function(e,t,o){n(e,t)});return r},exit:function(){var e={_pobj:"api"},n=t.toNative("exit",e,function(e,t,n){});return n},component:function(e,n){var o={_pobj:"api",tasks:e
},r=t.toNative("component",o,function(e,t,o){n(e,t)});return r},less:function(e,n){var o={_pobj:"api",config:e},r=t.toNative("less",o,function(e,t,o){n(e,t)});return r},template:function(e,n){var o={_pobj:"api",tasks:e},r=t.toNative("template",o,function(e,t,o){n(e,t)});return r},exec:function(e,n){var o={_pobj:"api",config:e||{}},r=t.toNative("exec",o,function(e,t,o){n(e,t)});return r}},update:{download:function(e,n){var o={_pobj:"update",config:e||{}},r=t.toNative("download",o,function(e,t,o){n(e,t)});return r},downloadCancel:function(){var e={_pobj:"update"},n=t.toNative("downloadCancel",e,null,!0,!0);return n},install:function(e,n){var o={_pobj:"update",config:e||{}},r=t.toNative("install",o,function(e,t,o){n(e,t)});return r}},path:{parse:function(e){function t(e){var t=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,n=t.exec(e),o=(n[1]||"")+(n[2]||""),r=n[3]||"",a=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,i=a.exec(r),s=i[1],c=i[2],u=i[3],l=[o,s,c,u];if(!l||4!==l.length)throw new TypeError("Invalid path '"+e+"'");return{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}}function o(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,n=t.exec(e).slice(1);return n[1]=n[1]||"",n[2]=n[2]||"",n[3]=n[3]||"",{root:n[0],dir:n[0]+n[1].slice(0,-1),base:n[2],ext:n[3],name:n[2].slice(0,n[2].length-n[3].length)}}return n._nativeType.indexOf("windows")<0?(e=e.replace(/\\/g,"/"),o(e)):(e=e.replace(/\//g,"\\"),t(e))},join:function(){for(var e=Array.prototype.slice.apply(arguments),t=0;t<e.length;++t)for(var n=e[t];n.length>0;){var o=n.length-1;if(n.lastIndexOf("/")!=o)break;n=n.substring(0,o)}var r=e.join("/");return r=r.replace("//","/")}},image:{size:function(e,t){function o(e,t){var o=new Image;o.onload=function(){t(null,{width:this.width,height:this.height})},o.onerror=function(){t("Image Load Error")},e=n.getAvailablePath(e),console.log("# 이미지 로딩(사이즈) 테스트 (NativeInterface) : ",e),o.src=e}var r,a=0,i=e.length,s=[];e.forEach(function(e,n){o(e,function(e,o){e&&(r||(r=[]),r[n]=e),s&&(s[n]=o||{width:100,height:100}),++a,a===i&&t(r,s)})})},resize:function(e,n){var o={_pobj:"image",option:e},r=t.toNative("resize",o,function(e,t,o){n&&n(e,t)});return r},capture:function(e,n){var o={_pobj:"image",option:e},r=t.toNative("capture",o,function(e,t,o){n&&n(e,t)},!1,!0);return r},thumbnail:function(e,n){var o={_pobj:"image",option:e},r=t.toNative("thumbnail",o,function(e,t,o){n&&n(e,t)});return r}},pdf:{getPdfInfomation:function(e,n){var o={_pobj:"pdf",path:e.path},r=t.toNative("getPdfInfomation",o,function(e,t,o){n(e,t)});return r},convert:function(e,n,o){var r={_pobj:"pdf",path:e,option:n},a=t.toNative("convert",r,function(e,t,n){o&&o(e,t)});return a},convertCancel:function(){var e={_pobj:"pdf"},n=t.toNative("convertCancel",e,null,!0,!0);return n},getText:function(e,n,o){var r={_pobj:"pdf",path:e,option:n},a=t.toNative("getText",r,function(e,t,n){o&&o(e,t)});return a}}});return o}var t=MODULE.core.instance;t.factory("NativeInterface",e),e.$inject=["$superClass","$communication","FileSystem"]}(),function(){function e(){function e(){this.clean()}return e.prototype={_archive:void 0,_list:{create:{},remove:{}},clean:function(){this._archive={},this._list={create:{},remove:{}},console.log("# 저장 파일 task 리스트를 초기화함")},generate:function(){return angular.extend(this._list,{archive:this._archive})},addArchive:function(e){void 0===e.isFolder&&(e.isFolder=!1),this._archive[e.name]=e},removeArchive:function(e){delete this._archive[e.name]},creater:function(e,t,n){var o=e,r={task:"create",isFolder:!1,encoding:"utf8",name:o,data:n,origin:t};this._list.create[o]=r},remover:function(e,t){var n=e,o={task:"remove",name:n,origin:t};this._list.remove[n]=o},importer:function(e){this.addArchive(e)}},e}var t=MODULE.core.instance;t.factory("Zip",e)}(),function(){function e(e){var t=e.extend("HistoryProcess",{commandName:void 0,command:void 0,callStep:"call",init:function(e,t){this._super(e),this.command=t,this.commandName=e.name}});return t}var t=MODULE.core.instance;t.factory("HistoryProcess",e),e.$inject=["Process"]}(),function(){function e(e,t,i){var s=e.create("Process",{init:function(e){this.params=e},params:void 0,useTimeCheck:!1,useSafetyCheck:!0,ignoreHistory:!1,useCommandStackCheck:!0,_inProgress:!1,_total:0,onProgress:function(e,t){},status:-2,ignoreStoppedProcess:!1,_ignoreID:"$$process",_sequence:void 0,_list:void 0,_result:void 0,_callback:void 0,_registed:!1,_next:function(e){if(!this._list||this._list.length<1)return void this._destroy(1);this.onProgress(this._total-this._list.length,this._total);var t=this._list.shift();console.log("\n"),console.log("%c%s    * 다음 Task 실행 : %s",n,r,t.id),console.log("%c%s    - prevReturnValue : %O",n,r,e),console.log("\n"),t.defer.resolve(e)},_stop:function(){if(!this._list)return void this._destroy(0);for(;this._list.length>0;){var e=this._list.shift();console.log("\n"),console.warn("%c%s    * 다음 Task 취소 : %s",n,r,e.id),console.log("\n")}this.onProgress(this._total-this._list.length,this._total),this._destroy(0)},_error:function(e){e&&(i.error("%c%s# sequence 실행 Failed! : %s","color:darkorange",r,e.stack||e),alert("Process 처리 도중 오류가 발생 하였습니다.\n"+e)),this._list=null,this._destroy(-1)},_destroy:function(e){this.status=e,this._inProgress=!1,a(-1),console.log("\n"),console.log("%c%s# [ Process 실행 종료 ] ( %s ) %O",n,r,o,this._result),console.groupEnd(),this._callback&&this._callback.func&&(console.log("%c%s# [ 콜백 status : %d ] ( %s ) ",n,r,this.status,o),console.log("\n"),this._callback.func.apply(this._callback.context,[this._result]),this._callback=null),this._result=null,this._sequence=null},_newPromiseResolver:function(e,t,a,i){var c=this;i=i||window,e.promise.then(function(e){if(a instanceof s)console.log("\n\n"),console.group("%c%s[ %s ] 서브 Process 시작 (%s)",n,r,t,o),console.log("%c%s* ignoreStoppedProcess : %s",n,r,c.ignoreStoppedProcess),a.execute(function(e){console.log("%c%s* process 실행 결과 : %O",n,r,e),console.log("%c%s[ %s ] 서브 Process 종료 (%s) ( status : %s)",n,r,t,o,a.status),console.groupEnd(),console.log("\n\n"),c.ignoreStoppedProcess?c._success(c,t)(e):1===a.status?c._success(c,t)(e):c._fail(c,t)(e)});else if(a)try{a.apply(i,[c._success(c,t),c._fail(c,t),e])}catch(u){c._error(u)}else c._success(c,t)()})["catch"](function(e){c._error(e)}),this._list.push({id:t,defer:e})},_success:function(e,t){return function(n){t===e._ignoreID?e._result=n:e._result&&(e._result[t]=n),e._next(n)}},_fail:function(e,t){var n=this;return function(o){e._result&&(e._result[t]=o),n.ignoreStoppedProcess?e._next.apply(e,[o]):e._stop.apply(e,[o])}},execute:function(e,t){this._inProgress=!0,this._callback={func:e,context:t},this._checkStart(),this._checkEnd(),this._sequence.resolve()},_checkStart:function(){this._sequence&&this._list||(this._total=0,this._list=[],this._result={},this._sequence=t.defer())},_checkEnd:function(){if(!this._registed){var e=this._sequence,t=this;e.promise["finally"](function(){if(t._list<1)return console.error("["+this.className+"] 최소 add 메서드는 등록해야 합니다."),void t._next();console.log("\n");var e=t._list[0].id;"backupProject"===e?console.groupCollapsed("%c%s# [ %s Process 실행 ] ( %s )",n,r,e,o):console.groupCollapsed("%c%s# [ %s Process 실행 ] ( %s )",n,r,e,o),a(1),t._total=t._list.length,t._next()}),this._registed=!0}},add:function(e,n,o){if("string"!=typeof e)throw new Error("["+this.className+"] processID는 문자열로 지정해야 합니다.");this._checkStart();var r=this._sequence,a=this,i=t.defer();return r.promise.then(function(){a._newPromiseResolver(i,e,n,o)}),i.promise}});return s}var t=MODULE.core.instance;t.factory("Process",e);var n="color: rgba(0,127,0,0.5);",o=0,r="",a=function(e){o+=e,r="";for(var t=0;o>t;)r+="    ",t++};e.$inject=["$superClass","$q","$externalAPI"]}(),function(){function e(e,t,n){var o=e.create("MacroBase",{getProcess:function(e,t){if(e){var o=e instanceof n;if(0==o)throw new Error("["+this.className+"] parameter 형식이 CommandParam 이 아닙니다.")}return e=this.$$getCommandParam(e),t=t||this.$$createProcess(e),this.$$getProcess(e,t)},$$createProcess:function(e){return new t(e)},$$getCommandParam:function(e){return e},$$getProcess:function(e,t){return t}});return o}var t=MODULE.core.instance;t.factory("MacroBase",e),e.$inject=["$superClass","Process","CommandParam"]}(),function(){function e(e,t){function n(){var t=e.pathToActual(e.USER_DATA_ROOT_MARKER);return t=t+"/"+e.appConfigFile,console.log("# App 설정 파일 : ",t),t}function o(e){function o(){a=angular.copy(i)}function r(e){a=angular.extend({},i,JSON.parse(e))}var s=n();t.exist(s,function(n){if(!n)return o(),void e(a);var i={encoding:"utf8"};t.readFile(s,i,function(t,n){t&&console.error("* App 설정 파일 읽기 에러 : ",t);try{console.log("# App 설정 파일 읽기 : ",s),r(n||"{}")}catch(i){o()}e(a)})})}function r(e){a||(a=angular.copy(i)),e=e||angular.noop;var o;try{console.log("# App 설정 파일 쓰기 : ",a),o=JSON.stringify(a,null,4)}catch(r){o=null}if(!o)return e();var s=n(),c={encoding:"utf8"};t.outputFile(s,o,c,function(t){t&&console.error("* App 설정 파일 쓰기 에러 : ",t),e(a)})}var a,i={application:{colorTheme:"blue"},updater:{hideUpdateAlarm:!1}},s={ready:function(e){if(a){if(!e)return;return void setTimeout(function(){e(a)})}o(function(){setTimeout(function(){r(function(){e&&e(a)})})})},save:function(e){r(e)},data:function(e,t,n){if(a){var o=a[e]||(a[e]={});return 1===arguments.length?o:2===arguments.length?o[t]:void(this.has(e,t)&&(o[t]=n))}},has:function(e,t){return t in i[e]}};return s}var t=MODULE.core.instance;t.service("$store",e),e.$inject=["FileSystem","$externalAPI"]}(),function(){function e(e,t){var n=e.create("DataBase",{init:function(e){this.$$_original=angular.extend({version:void 0,versionRecord:[],uid:void 0,name:void 0},this.$$define()),this.$$addReadOnly("version",t.version()),this.$$addReadOnly("uid",e),this.$$setDefault.apply(this,arguments),this.saved()},$_replaceOnly:void 0,$$addReplaceOnly:function(e){if(void 0===this.$_replaceOnly){var t=this.constructor;void 0===t.$_replaceOnly&&(t.$_replaceOnly=[]),this.$_replaceOnly=t.$_replaceOnly}this.$_replaceOnly.indexOf(e)<0&&this.$_replaceOnly.push(e)},isReplaceOnly:function(e){return this.$_replaceOnly&&this.$_replaceOnly.indexOf(e)>-1},$_readOnly:void 0,$$addReadOnly:function(e,t){if(void 0===this.$_readOnly){var n=this.constructor;void 0===n.$_readOnly&&(n.$_readOnly=[]),this.$_readOnly=n.$_readOnly}this.$_readOnly.indexOf(e)<0&&this.$_readOnly.push(e),arguments.length>1&&(this.$$_original[e]=t)},$$_original:void 0,$$define:function(){return{}},$$setDefault:function(e){},$$_dataService:void 0,setDataService:function(e,t){this.$$_dataService=e,this.isChanged(t)},dataType:function(){return this.$$_dataService?this.$$_dataService.type:void 0},$$_dataChanged:!1,isChanged:function(){return arguments.length<1?this.$$_dataChanged:(this.$$_dataChanged=Boolean(arguments[0]),void(this.$$_dataService&&this.$$_dataService.dataChanged(this)))},saved:function(){this.isChanged(!1)},destroy:function(){this.isChanged(!1),this.$$_original=null},$$_checkName:function(){var e=this.$$_original;e.name||(e.name=e.uid)},value:function(e,t,n){if(!e||"string"!=typeof e)return void console.error(e+" 속성 이름 형식이 잘못되었습니다.");var o=this.$$_original;if(!(e in o))return void console.error(e+" 속성이 정의되지 않았습니다.");if(this.$$_checkName(),1==arguments.length){var r=o[e];return this.$$_getter(r)}if(this.$_readOnly.indexOf(e)>-1&&!n)throw new Error(e+"은 읽기 전용 속성입니다.");"name"!==e||t||(t=o.name);var a;return this.isReplaceOnly(e)?(a=!angular.equals(this.$$_original[e],t),void(a&&(this.$$_original[e]=t,this.isChanged(!0)))):(a=this.$$_setter(e,t),void(a&&this.isChanged(!0)))},$$_getter:function(e){return e&&"object"==typeof e?angular.copy(e):e},$$_setter:function(e,t,n){var o=!1;n=n||this.$$_original;var r=n[e],a=!1;if(t&&angular.isArray(t)){r&&angular.isArray(r)||(n[e]=[],r=n[e]);for(var i=0;i<t.length;i++)a=this.$$_setter(i,t[i],r),a&&(o=!0);r.length>t.length&&(n[e]=r.splice(0,t.length),o=!0)}else if(t&&angular.isObject(t)){r&&angular.isObject(r)||(n[e]={},r=n[e]);var s=0;for(var c in t)++s,a=this.$$_setter(c,t[c],r),a&&(o=!0);if(0==s){for(var u in n[e]){o=!0;break}n[e]={}}}else{if("$$__force_delete"===t)return delete n[e],!0;!t&&angular.isArray(r)?(n[e]=[],o=!0):!t&&angular.isObject(r)?(n[e]={},o=!0):(o=n[e]!==t,void 0===t?delete n[e]:n[e]=t)}return o},getNoneCopyValue:function(e){var t=this.$$_original;if(!(e in t))throw new Error(e+" 속성이 정의되지 않았습니다.");return t[e]},uid:function(){return this.value("uid")},name:function(){return this.value("name")},version:function(){return this.value("version")},copy:function(e){if(!e)return angular.copy(this.$$_original);var t=angular.copy(this.$$_original);for(var n in this.$_readOnly){var o=this.$_readOnly[n];delete t[o]}return t},publish:function(){return this.$$_original}});return n}var t=MODULE.core.instance;t.factory("DataBase",e),e.$inject=["$superClass","$version"]}(),function(){function e(e,t){var n=e.create("DataService",{init:function(){this.$$_data={},this.$$_current=null,this.$$_length=0,this.$$_saveQueue=[],this.$$_deleteQueue={},this.$$_backupQueue=[],this.$$_deleteBackupQueue={}},$$_data:void 0,$$_current:void 0,$$_length:0,getDatas:function(){return this.$$_data},getLength:function(){return this.$$_length},$$get:function(e,t){var n;if(t){if(n=this.$$_data[e],!n)throw new Error("데이터가 없습니다.("+e+")");return n}if(void 0===e){if(!this.$$_current)return null;e=this.$$_current}return n=this.$$_data[e],n||(n=this.$$new(e),this.$$_data[e]=n,++this.$$_length),this.$$_current=e,n},$$createUID:function(e){return e?(e+="-",e+t.createUID()):t.createUID()},createUID:function(){return this.$$createUID()},$$new:function(e){console.error("Override 하여 사용해야 하는 메서드 입니다.")},$$destroy:function(e){if(void 0===e){if(!this.$$_current)return;e=this.$$_current}this.$$addDeleteQueue(e);var t=this.$$_data[e];t||console.error(this.className+".$$destroy -데이터를 찾을 수 없습니다. : "+e),t&&"destroy"in t&&t.destroy(),e==this.$$_current&&(this.$$_current=null),this.$$_data[e]=null,delete this.$$_data[e],--this.$$_length},$$_saveQueue:void 0,$$_backupQueue:void 0,$$addSaveQueue:function(e){this.$$_saveQueue.indexOf(e)<0&&this.$$_saveQueue.push(e),this.$$_backupQueue.indexOf(e)<0&&this.$$_backupQueue.push(e)},$$removeSaveQueue:function(e){var t=this.$$_saveQueue.indexOf(e);t>-1&&this.$$_saveQueue.splice(t,1),this.$$removeBackupQueue(e)},$$removeBackupQueue:function(e){var t=this.$$_backupQueue.indexOf(e);t>-1&&this.$$_backupQueue.splice(t,1)},dataChanged:function(e){var t=e.uid();e.isChanged()?this.$$addSaveQueue(t):this.$$removeSaveQueue(t)},getSaveQueue:function(e){return e?this.$$_backupQueue:this.$$_saveQueue},$$_deleteQueue:void 0,$$_deleteBackupQueue:void 0,$$addDeleteQueue:function(e){var t=this.$$get(e,!0).copy();console.log("삭제 대상 : ",t),this.$$_deleteQueue[t.uid]=t;var n=this.$$get(e,!0).copy();this.$$_deleteBackupQueue[n.uid]=n},$$removeDeleteQueue:function(e){this.$$_deleteQueue[e]=null,delete this.$$_deleteQueue[e],this.$$removeDeleteBackupQueue(e)},$$removeDeleteBackupQueue:function(e){this.$$_deleteBackupQueue[e]=null,delete this.$$_deleteBackupQueue[e]},getDeleteQueue:function(e){return e?this.$$_deleteBackupQueue:this.$$_deleteQueue}});return n}var t=MODULE.core.instance;t.factory("DataService",e),e.$inject=["$superClass","$util"]}(),function(){function e(){return{back:function(e,t){return this._sort(e),t.sort(function(t,n){var o=e.indexOf(t)>=0,r=e.indexOf(n)>=0;return o&&r?t-n:o?-1:r?1:t-n}),t},front:function(e,t){return this._sort(e),t.sort(function(t,n){var o=e.indexOf(t)>=0,r=e.indexOf(n)>=0;return o&&r?t-n:o?1:r?-1:t-n}),t},backward:function(e,t){this._sort(e);var n=!1;return t.sort(function(t,o){var r=e.indexOf(t)>=0,a=e.indexOf(o)>=0;return r&&a?t-o:r?-1:a?n?-1:(n=!0,1):t-o}),t},forward:function(e,t){this._sort(e);var n=!1;return t.sort(function(t,o){var r=e.indexOf(t)>=0,a=e.indexOf(o)>=0;return r&&a?t-o:r?n?-1:(n=!0,1):a?-1:t-o}),t},indexChange:function(e,t,n){return isNaN(n)?t:(this._sort(e),t.sort(function(t,o){var r=e.indexOf(t)>=0,a=e.indexOf(o)>=0;return r&&a?t-o:r?t>n?o>n?o>t?-1:1:o==n?1:-1:n>t&&n>o&&o>t?1:-1:a?o>n?t>n?o>t?1:-1:t==n?1:-1:n>o&&n>t?o>t?-1:1:-1:t-o}),t)},itemToIndex:function(e){var t=e.map(function(e,t){return t});return t},indexToItem:function(e,t){var n=e.map(function(e,n,o){return t[e]});return console.log("# 순서 변경 후 : ",e),console.log("\n"),n},_sort:function(e){e.sort(function(e,t){return e-t})},checkEnable:function(e,t){this._sort(e);var n=!angular.equals(e,t),o={back:n,backward:n,forward:n,front:n},r=t[0],a=t[t.length-1],i=this._isContinuously(e,!1);return i?(e[0]==r&&(o.back=!1,o.backward=!1),e[e.length-1]==a&&(o.forward=!1,o.front=!1)):(e[0]==r&&(o.back=!1),e[e.length-1]==a&&(o.front=!1)),o},_isContinuously:function(e,t){var n=t?angular.copy(e):e,o=n.every(function(e,t,n){if(0===t)return!0;var o=e-n[t-1];return 1==o});return o}}}var t=MODULE.core.instance;t.service("$arrange",e),t.constant("ArrangePosition",{BACK:"back",BACKWARD:"backward",FORWARD:"forward",FRONT:"front",_REPLACE:"replace"})}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m){function f(){}return f.prototype={getRemoveParam:function(e,t,n){if(!e||!t||t.length<1)throw new Error("parameter가 지정되지 않았습니다.");n||(n=[]);for(var o=0;o<t.length;o++){var r=t[o],a={asset:r,data:void 0};n.push(a)}var i={document:e,assets:n};return i},getAddParam:function(e,t,n){if(!e||!t||t.length<1)throw new Error("parameter가 지정되지 않았습니다.");n||(n=[]),n=n.concat(t);var o={document:e,assets:n};return o},toRemoveParam:function(t){if(t){var n=angular.copy(t),o=[];if(n.assets&&n.assets.length>0)for(var r in n.assets){var a=t.assets[r];if(!a._replaceElementAsset){var i=a.asset;i||(i=e.createUID(),a.asset=i);var s=n.assets[r];s.asset=i,o.push({asset:i,data:void 0})}}var c={document:t.document,assets:o};return c}},toAddParam:function(t){if(t){var n=angular.copy(t),o=[];if(n.assets&&n.assets.length>0)for(var r in n.assets){var a=n.assets[r];if(!a._replaceElementAsset){var i=a.asset,s=e.get(i);o.push({asset:i,data:s.copy(!0)})}}var c={document:t.document,assets:o};return c}},removeAssetProcess:function(e,r,a){if(e&&e.assets&&!(e.assets.length<1)){var i=e.document;for(var s in e.assets){var c=e.assets[s];c.document=i,console.log("# Asset 변경사항 적용 (제거)",c);var u=new n(c),l=o.define(t.ASSET_REMOVE,u).getProcess();if(r.add("removeProcess_"+s,l),a){var d=c.asset,p=a.indexOf(d);p>-1&&a.splice(p,1)}}}},addAssetProcess:function(e,r,a,i){if(!(e&&e.assets&&e.assets.length<1)){var s=e.document;for(var c in e.assets){var u=e.assets[c];u.document=s;var l=u.asset;l||console.error("Asset UID는 필수 항목입니다."),u.useTempFile=i,console.log("# Asset 경로 (useTempFile) : ",u.useTempFile);var d=new n(u),p=o.define(t.ASSET_ADD,d).getProcess();r.add("addProcess_"+c,p),a&&a.indexOf(l)<0&&a.push(l)}}},_getImageAssetParam:function(e,t,n,o){function a(o){var r=d.type(e),a=l.pattern.source.test(e),s=a?e:n,u=i.getAddParam(c,[{asset:t,needToCopy:!0,data:{type:r,path:s,original:e,property:{width:o.width,height:o.height}}}]);return u}var i=this,c=r.uid();n=n||"WORK_ASSET_IMAGES_FOLDER",s.getImageInfomation(e,function(e,n){if(console.log("# IMAGE 정보 : %o",n),t&&n)var r={width:n.width,height:n.height};var i=a(r);o(i)})},removeMaster:function(e,t){function n(){var t={document:e,assets:[]},n=o.value("master");n&&t.assets.push({asset:n,data:void 0});var r=o.value("thumbnail");return r&&t.assets.push({asset:r,data:void 0}),t.assets.length<1?void 0:t}var o=r.get(e),a={document:e,data:{master:"",thumbnail:""},asset:{remove:n()}};p.modifyDocument(a,t)},insertMaster:function(t,n,o){function l(e,t){var n={path:v};s.remove(n,null,function(){t&&t(e)})}function d(e,n){var o=[],r={document:_,assets:[]};o.push(function(e){h._getImageAssetParam(t,y,"WORK_ASSET_MASTER_FOLDER",function(t){r.assets=r.assets.concat(t.assets),e()})}),o.push(function(e){var n=i.thumbnailSizeRange,o=a.EXT_THUMBNAIL_MASTER,r={pages:[{num:"thumbnail",image:t,ext:o,fileName:P}],destFolder:g,quality:i.thumbnailQuality,density:100,thumbnail:n+"x"+n};s.toThumbnail(r,function(t,n){if(t)return console.error(t),e(t);if(n.warn){var o=n.warn;o=o.replace(/\n/g,"<br>"),c.open(o,{isSimple:!1})}console.log("[ 썸네일 : 종료 ]",n);var r=n.data;e(null,r)})}),o.push(function(e,t){var n=e.thumbnail,o=0==n.ext.indexOf(".")?n.ext.substring(1):n.ext,a={asset:P,needToCopy:!0,data:{type:o,path:"WORK_ASSET_MASTER_THUMBNAIL_FOLDER",original:n.path,property:{width:n.width,height:n.height}}};r.assets.push(a),t()}),async.waterfall(o,function(t){return t?n(t):void e(r)})}function m(){var e={document:_,assets:[]},t=$.value("master");t&&e.assets.push({asset:t,data:void 0});var n=$.value("thumbnail");return n&&e.assets.push({asset:n,data:void 0}),e.assets.length<1?void 0:e}var f=a.TEMP_ROOT_MARKER+a.WORK_SPACE_MARKER+a.PROJECT_SPACE_MARKER,v=f+a.TEMP+a._CONVERT,g=v+a.IMAGES_MASTER_THUMB,h=this,_=r.uid(),$=r.get(_),E=n.uid||e.createUID(),y=E.replace(u.ASSET,"master"),P=E.replace(u.ASSET,"thumb"),w={document:_,data:{master:y,thumbnail:P},asset:{add:void 0,remove:m()}};d(function(e){w.asset.add=e,p.modifyDocument(w,function(){l(null,o)})},function(e){l(e,o)})},insertImage:function(t,n,o){function r(e){var t=e.document,r=angular.merge({},n.style,{backgroundImage:a}),i={document:t,elements:[{data:{type:m.IMAGE,state:{normal:{css:n.css,option:n.option,style:r}}},asset:{add:e}}]};p.addElement(i,o)}var a=n.uid||e.createUID();this._getImageAssetParam(t,a,"WORK_ASSET_IMAGES_FOLDER",function(e){r(e)})}},new f}var t=MODULE.core.instance;t.factory("$assetManager",e),e.$inject=["$assets","CommandName","CommandParam","$command","$documents","FileSystem","Default","$externalAPI","$toast","UIDType","$util","$mime","$commandController","ElementType"]}(),function(){function e(e,t,n){function o(){}function r(e,t){var n=e.nodeType,o=e.nodeName.toUpperCase();if(n==Node.ELEMENT_NODE){if("A"==o)return void(e=c(e));var a=angular.element(e).contents();if(a.length>0)for(var i,u=0;i=a[u];u++)r(i,t+1)}else if(n==Node.TEXT_NODE){var l=e.nodeValue;l=l.replace(/&/g,"&amp;"),l=l.replace(/</g,"&lt;"),l=l.replace(/>/g,"&gt;");var d=s(l);angular.element(e).before(d),angular.element(e).remove()}}function a(e){var t=$("<div>"+e+"</div>");return t}function i(e){var t=/<\s*a([^<>]*\s+)(_autolink_)+(=[^<>]*)?(\s+[^<>]*)*>(.*)<\s*\/\s*a([^<>]*)>/gim,n=e.replace(t,"$5");return n}function s(e){function t(e,t,n,o){var r;r=0==e.indexOf("http")?e:0==e.indexOf(".")?e:"http://"+e;var a='<a href="'+r+'" target="_blank" _autolink_>'+e+"</a>";return a=c(a)}var n=/([(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+~#?&\/\/=]|.[\w\d])*)/gim,o=e.replace(n,t);return o}function c(o){var r=typeof o,a=angular.element(o);if(a.attr("target","_blank"),a.css({zIndex:8,cursor:"pointer"}),e._nativeType&&"web"!=e._nativeType&&"node"!=e._nativeType){var i=a.attr("href"),s=a.attr("target"),c={_pobj:"api",href:i,target:s},u=t.getCallURL("link",c,null,!0);if("windows"===e._nativeType){window.$$noteAppLinkAPI||(window.$$noteAppLinkAPI=function(e){n.note.link(e)}),a.attr("href","#");var l='window.$$noteAppLinkAPI("'+u+'"); return false;';a.attr("onclick",l)}else{a.attr("href","#");var l='window.location.assign("'+u+'"); return false;';a.attr("onclick",l)}}return"string"===r?a[0].outerHTML:a[0]}return o.prototype={create:function(e){var t=a(e);r(t[0],0);var n=t[0].innerHTML;return n},remove:function(e){return i(e)}},new o}var t=MODULE.core.instance;t.service("$autolink",e),e.$inject=["FileSystem","$communication","$nativeInterface"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u){function l(){}function d(e){var t=n.TEMP_ROOT_MARKER+n.WORK_SPACE_MARKER+n.PROJECT_SPACE_MARKER,o=t+n.WORK+n.OPS+n.IMAGES_CAPTURE,r=o+"/"+e+n.EXT_CAPTURE;return r}function p(e){this._uid=e}var m={},f=!1,v="worker";l.prototype={_disable:!1,enable:function(){this._disable=!1,g._startMouseMoniter()},disable:function(){this._disable=!0,g._endMouseMoniter()},_create:function(e){var t=m[e];return t?t:(console.debug("* 캡쳐모듈 생성 : ",e),m[e]=new p(e),m[e])},_destroy:function(e){var t=m[e];t&&(console.debug("* 캡쳐모듈 삭제 : ",e),m[e]=null,delete m[e])},_get:function(e,t){e||(e=s.uid());var n=m[e];return!n&&t&&(n=this._create(e)),n},isRunning:function(){var e=this._get();return e?!(!e._delayID&&!e._isRunning):!1},add:function(e,o){if(!this._disable){this._create(e);var r=n.APP_ROOT_MARKER+"/client/image/capture/blank.png",a=d(e);t.copy(r,a,function(e,t){e&&console.error(e),o&&o()})}},update:function(e){if(!this._disable){var t=this._get(e,!0);t.update()}},remove:function(e){if(!this._disable){var t=this._get(e);t&&t.remove(),this._destroy(e)}},clear:function(e){if(!this._disable){var t=this._get(e,!0);t.clear()}},commandReady:function(e,t){if(!this._disable){var n=!1,o=!1;switch(e){case i.PROJECT_PUBLISH:case i.PROJECT_PREVIEW:case i.PROJECT_SAVE:case i.PROJECT_SAVEAS:case i.PROJECT_CLOSE:n=!0;break;case i.DOCUMENT_ADD:case i.DOCUMENT_SELECT:n=Boolean(s.get());break;case i.PROJECT_BACKUP:n=!1;break;default:n=!1}if(!n)return t(!1);var r=this._get(null,!0);if(o)return console.debug("\n\n[ 캡쳐 시작 ] ####",e),c.message("데이터를 임시 백업중입니다."),void r.noDelayCapture(function(){console.debug("# 업데이트할 이미지 생성됨(render)"),t(!0)});console.debug("\n\n[ 캡쳐 시작 ] #### - no delay"),r.noDelayCapture(function(){console.debug("# 업데이트할 이미지 생성됨(render) - no delay callback")}),t(!0)}},finishImmediately:function(e){if(!this._disable){var t=this._get();t.noDelayCapture(e)}},_startMouseMoniter:function(){"worker"!==v&&(f=!1,r.on(a.EVENT_MOUSE_DOWN,angular.bind(this,this._onMousedown)),r.on(a.EVENT_MOUSE_UP,angular.bind(this,this._onMouseup)))},_endMouseMoniter:function(){"worker"!==v&&(f=!1,r.off(a.EVENT_MOUSE_DOWN,angular.bind(this,this._onMousedown)),r.off(a.EVENT_MOUSE_UP,angular.bind(this,this._onMouseup)))},_onMousedown:function(){f=!0},_onMouseup:function(){f=!1;var e=this._get();e&&e._delayID&&e._delayTime()}},p.prototype={_uid:void 0,_isRunning:!1,_reTry:!1,_taskCode:0,remove:function(){return this._taskCode=-1,this._isRunning?void(this._reTry=!0):(console.debug("# 캡쳐 제거 : ",this._uid),void this._delayTime())},update:function(){return this._taskCode=1,this._isRunning?void(this._reTry=!0):(console.debug("# 캡쳐 : ",this._uid),void this._delayTime())},clear:function(){this._closedCallbackListeners=null,this._isRunning=!1,this._reTry=!1,this._delayID&&(clearTimeout(this._delayID),this._delayID=null),this._taskCode=0},noDelayCapture:function(e){return this._delayID||this._isRunning?(this._closedCallbackListeners||(this._closedCallbackListeners=[]),this._closedCallbackListeners.push(e),this._isRunning?void(this._reTry=!0):(this._delayID&&clearTimeout(this._delayID),void this._run())):e()},_delayID:void 0,_closedCallbackListeners:null,_closedMoniter:null,_delayTime:function(){this._delayID&&clearTimeout(this._delayID);var t=this;this._delayID=setTimeout(function(){f||t._run()},e.captureDelayTime)},_run:function(){function e(){if(this._isRunning=!1,this._reTry)return console.debug("#### [ 캡쳐 다시 실행 ]\n\n"),this._reTry=!1,void this._run();if(console.debug("#### [ 캡쳐 종료 ]\n\n"),this._closedCallbackListeners){for(var e=this._closedCallbackListeners.length,t=0;e>t;++t){var n=this._closedCallbackListeners[t];n()}this._closedCallbackListeners=null}}this._delayID=null,this._isRunning=!0;var t=this;1===this._taskCode?this._capture(function(n,o){t._render(o),e.apply(t)}):-1===this._taskCode?this._removeCapture(function(){e.apply(t)}):e.apply(this),this._taskCode=0},_capture:function(r){function a(e,t){return e?(console.debug("# 캡쳐 에러 : ",e),void(r&&r(e,null))):(t.data&&(t.data.path=n.pathToVirtual(t.data.path)),this._updateToolData(t.data),console.debug("# 캡쳐 완료 : ",t),void(r&&r(null,t.data)))}var i=d(this._uid);console.debug("# 캡쳐 process : ",this._uid);var s=this;try{var c={documentUID:this._uid,projectUID:o.uid()},l=u._getPageJS(c),p=e.thumbnailSizeRange;t.toCapture({isData:!0,option:{render:v},input:l,output:i,base:n.WORK_OPS_FOLDER,quality:10,thumbnail:{width:p,height:p},paper:o.get().getNoneCopyValue("paper")},function(e,t){a.apply(s,[e,t])})}catch(m){console.error("[Capture 에러] ",m)}},_removeCapture:function(e){var n={path:d(this._uid)};this._updateToolData(),t.remove(n,null,function(t,n){e&&e()})},_render:function(e){var t=angular.element("[jj-tree-item] [jj-thumbnail]"),n=t.find('[jj-tree-paper][uid="'+this._uid+'"]'),o=n.scope();o&&o.$$childHead.render(e)},_updateToolData:function(e){var t=o.get();if(t){var n=t.tooldata("capture");n||(n={}),arguments.length<1||!e?delete n[this._uid]:n[this._uid]=e,t.tooldata("capture",n),console.debug("# capture 데이터 기록 결과 : ",n)}}};var g=new l;return g}var t=MODULE.core.instance;t.service("$capture",e),e.$inject=["Default","$externalAPI","FileSystem","$projects","$document","$device","CommandName","$documents","$busy","$epub"]}(),function(){function provider($superClass){function stringify(e){return void 0===e||null===e?"":angular.toJson(e)}var Service=$superClass.create("Casting",{encoding:function(e,t){return t="array"===e&&"string"==typeof t?t.split(this.SEP_TEXT).map(function(e){return encodeURIComponent(e)}).join(this.SEP_ARRAY):encodeURIComponent(t)},decoding:function(e,t){return t="array"===e&&"string"==typeof t?t.split(this.SEP_ARRAY).map(function(e){return decodeURIComponent(e)}).join(this.SEP_TEXT):decodeURIComponent(t)},SEP_ARRAY:";",SEP_TEXT:";",inputboxToValue:function(e,t){return e=this.valueToInputbox(e,t)},valueToInputbox:function(e,t){e=this._nomalize(e);var n="";if("number"===t){var o=Number(e);return n=isNaN(o)?0:o}return n="checkbox"===t?Boolean(e):angular.isString(e)?e:angular.isArray(e)?e.toString():angular.isObject(e)?angular.toJson(e):e.toString()},_nomalize:function(e){var t=typeof e;if(null===e||void 0===e)e="";else if("number"===t)e=isNaN(e)?"":e;else if("boolean"===t);else if("string"===t){var n=e?e.toLowerCase().trim():"";e="null"===n||"nan"===n||"undefined"===n?"":"infinity"===n?1/0:"-infinity"===n?-(1/0):"0"===n?0:"1"===n?1:"false"===n?!1:"true"===n?!0:n}return e},toDataType:function(e,t){var n,o=this,r=Array.isArray(e);n=r?e.map(function(e){return o._textDecoding(e)}):this._textDecoding(e);var a,i=this._toObject(n),s=typeof i,c=Array.isArray(i);if("number"===t){var u=Number(c&&1===i.length?i[0]:i);a=isNaN(u)?0:u}if("boolean"===t&&(a=Boolean(c&&1===i.length?i[0]:i)),"string"===t)if(c){var l=1===i.length?i[0]:i;a=""===l?l:stringify(l)}else a="object"===s?stringify(i):i.toString();return"object"===t&&(a=""===i?r?[null]:null:r?c?i:[i]:i),"array"===t&&(a=""===i?r?[]:null:c?i:[i]),a},_textDecoding:function(e){var t=this._nomalize(e),n=typeof t;if("string"!==n)return e;var o;return o=t.indexOf(this.SEP_ARRAY)<0?decodeURIComponent(t):t.split(this.SEP_ARRAY).map(function(e){return decodeURIComponent(e)})},_toObject:function(exp){var value=this._nomalize(exp),type=Array.isArray(value)?"array":typeof value;if("array"===type&&(value=function(e,t){var n=[];for(var o in e)n[o]=t._toObject(e[o]);return n}(value,this)),"object"===type&&(value=function(e,t){var n={};for(var o in e)n[o]=t._toObject(e[o]);return n}(value,this)),"string"===type){var arrayString=0===value.indexOf("[")&&value.lastIndexOf("]")===value.length-1,objectString=0===value.indexOf("{")&&value.lastIndexOf("}")===value.length-1;if(arrayString||objectString){var expItem=eval("("+value+")");value=this._toObject(expItem)}}return value}}),service=new Service;return service}var application=MODULE.core.instance;application.service("$casting",provider),provider.$inject=["$superClass"]}(),function(){function e(){function e(){}return e.prototype={copyTo:function(e){if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(n){return console.warn("Copy to clipboard failed.",n),!1}finally{document.body.removeChild(t)}}}},new e}var t=MODULE.core.instance;t.service("$clipboard",e);

}(),function(){function e(e){var t=e,n=t.extend("BaseCommandController",{});return new n}var t=MODULE.core.instance;t.service("$commandController",e),e.$inject=["CommandControllerService"]}(),function(){function e(e,t,n){function o(){}function r(e,t,n,o,r){if(o){if("function"==typeof o)return void a(e,n,o,r,t);r=o,o=null}i(e,n,r,t)}function a(e,t,n,o,r){if(n){o=o||v;var a=r?m:p;a[o]||(a[o]={}),a[o][t]=n,Mousetrap.bind(t,s(t,o,a),e)}}function i(e,t,n,o){Mousetrap.unbind(t,e);var r=o?m:p;if(n=n||v,r&&r[n]){delete r[n][t];for(var a in r[n])return;delete r[n]}}function s(e,n,o){return function(r){if(f)return void console.log("# ",e," : ",n,"( paused )");if(g!==n)return void console.log("# ",e," : ",n,"( !=",g,")");if(!c(document.activeElement)){var a=!1,i=o[n][e];if(i){var s=i(r);a=void 0===s?!1:"boolean"==typeof s?s:r.defaultPrevented,t.$apply()}a&&(r.preventDefault?r.preventDefault():r.returnValue=!1)}}}function c(e){var t=e.attributes.contenteditable&&"true"===e.attributes.contenteditable,o="INPUT"===e.nodeName.toUpperCase(),r="TEXTAREA"===e.nodeName.toUpperCase(),a="SELECT"===e.nodeName.toUpperCase(),i=(n.textSelection()||"").length>0;return e&&t||o||r||a||i}function u(e){var n,o,r;d.pressedKey?n=o=r=!1:e.ctrlKey&&!e.shiftKey&&!e.altKey||!e.ctrlKey&&e.shiftKey&&!e.altKey||!e.ctrlKey&&!e.shiftKey&&e.altKey?(n=e.ctrlKey,o=e.shiftKey,r=e.altKey):n=o=r=!1,(d.ctrl!=n||d.shift!==o||d.alt!==r)&&(d.ctrl=n,d.shift=o,d.alt=r,t.$apply())}function l(e){var n="";d.pressedKey||!d.pressedSpace||e.shiftKey||(e.ctrlKey&&e.altKey?n="ctrlAltSpace":e.ctrlKey?n="ctrlSpace":e.altKey||(n="space")),d.spaceFlag!==n&&(d.spaceFlag=n,t.$apply())}var d,p={},m={},f=!1,v="application default",g=v,h=[];return o.prototype={ctrl:!1,alt:!1,shift:!1,spaceFlag:"",pressedKey:!1,pressedSpace:!1,reset:function(){Mousetrap.reset(),p={},m={}},addKeycodes:function(e){Mousetrap.addKeycodes(e)},keyup:function(e,t,n){var o="keyup",a=!1;r(o,a,e,t,n)},keydown:function(e,t,n){var o="keydown",a=!1;r(o,a,e,t,n)},customKeyup:function(e,t,n){if(!t)return void console.error("key context id가 지정되지 않았습니다. (custom 단축키 지정 id)");var o="keyup",a=!0;r(o,a,e,n,t)},customKeydown:function(e,t,n){if(!t)return void console.error("key context id가 지정되지 않았습니다. (custom 단축키 지정 id)");var o="keydown",a=!0;r(o,a,e,n,t)},CONTEXT_LAST:"Context 변경 전 마지막 지정됬던 contextName",CONTEXT_DEFAULT:"기본 contextName",currentContext:function(e){return arguments.length<1?g:(e||console.error("유효한 Key contextName 값이 아닙니다. : ",e),e===this.CONTEXT_LAST?e=h.pop()||v:e===this.CONTEXT_DEFAULT?(e=v,h.push(g)):h.push(g),g=e,void console.debug("# key Context : ",h," : ",g))},pause:function(){f=!0},resume:function(){f=!1},isPaused:function(){return f},checkInputbox:c},e.on("keydown",function(e){if(!f&&!c(document.activeElement)){e.preventDefault();var t=e.keyCode||e.which;16===t||17===t||18===t?u(e):(32===t?d.pressedSpace=!0:d.pressedKey=!0,u(e)),l(e)}}),e.on("keyup",function(e){if(!f&&!c(document.activeElement)){var t=e.keyCode||e.which;16===t||17===t||18===t?u(e):32===t?d.pressedSpace=!1:d.pressedKey=!1,l(e)}}),d=new o}var t=MODULE.core.instance;t.service("$key",e),e.$inject=["$document","$rootScope","$util"]}(),function(){function e(){function e(e){if(e!==v)throw new Error(v)}function t(t,o,r,a,i){this.mediaType=t,this.setInit(i),e.log("AVideo 인스턴스 생성 : ",o);var s=$(this.container).find(t);if(s.length<1)throw new Error(t+" element를 찾을 수 없습니다.");if(s.length>1)throw new TypeError(t+" element가 두개 이상 발견되었습니다.");if(this.player=s[0],this.id=this.player.id,this.config=r,"video"==t){n.apply(this,[$(this.container)]);var c=d.apply(this);if(!c)return null}return this._onReadyCallback=a,this.initialize(),this}function n(e){var t=e;return t.addClass("player_container"),t.css({"min-width":this.minWidth,"min-height":this.minHeight,"background-color":"#000000","font-size":0}),t}function o(){a.apply(this),this._onReadyCallback&&(this._onReadyCallback.apply(this),this._onReadyCallback=null),this._playerReady=!0,this.trigger("ready"),this._tempCurrentTime>0&&(this.set("currentTime",this._tempCurrentTime),this._tempCurrentTime=-1),this.autoplay()&&this.play()}function r(e,t){this._queue||(this._queue=[]),this._queue.push({funcName:e,arg:t})}function a(){if(this._queue){var t=this._queue.shift();if(!t)return void(this._queue=null);var n=t.funcName,o=t.arg;e.log("------> ",n," : ",o),this[n].apply(this,o),a.apply(this)}}function i(t){var n=this.player.src;if(n.length>0&&t&&t.length>0){var o=n.lastIndexOf(t);if(o>=0){var r=n.substr(o);if(r===t)return}}e.log("[src] ",t),this._playerReady=!1,this.player.src=t,m.apply(this)}function s(e){this.trigger(e.type,e)}function c(e){e=e.charAt(0).toUpperCase()+e.slice(1);var t="on"+e;return t}function u(e,t,n,o){var r=t.readyState(),a=t.networkState();return console.log("[MEDIA][",e,"] : state(",r,"), network(",a,")"),"Error"===e?void p.apply(t,[n,o]):void 0}function l(){function e(e){switch(E){case"none":return!1;case"all":return!0;case"notOgg":return"ogg"!=e;case"notMP4":return"mp4"!=e;default:return!1}}if(void 0!==E)return e(E);try{var t=document.createElement("video"),n=!!t.canPlayType;if(!n)return E="none",e(E);var o=document.createElement("video"),r=o.canPlayType('video/ogg; codecs="theora, vorbis"');if(r)E="probably"==r?"all":"notOgg";else{var a=o.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');E=a?"probably"==a?"all":"notMP4":"none"}}catch(i){E="none"}return e(E)}function d(){var e=l();if(e)return!0;{var t="HTML5 VIDEO가 지원되지 않습니다.";f.apply(this,[t])}return!1}function p(e,t){"audio"===this.mediaType?t&&(e=t):t&&(e=t+"<br>"+e);f.apply(this,[e])}function m(){$(this.container).attr("title","");var e=$(this.container).find("#textDisplay");e.remove()}function f(e){$(this.container).attr("title",e),m.apply(this);var t=$("<div>"+e+"</div>");return t.attr("id","textDisplay"),$(this.player).after(t),t}var v="인스턴스를 생성하지 않습니다.\n AVideo.create 함수를 이용하세요.";e.enable=!0,e.allowLog=!1,e.log=function(){e.allowLog&&console.log.apply(window.console,arguments)};var g={0:"HAVE_NOTHING",1:"HAVE_METADATA",2:"HAVE_CURRENT_DATA",3:"HAVE_FUTURE_DATA",4:"HAVE_ENOUGH_DATA"},h={0:"NETWORK_EMPTY",1:"NETWORK_IDLE",2:"NETWORK_LOADING",3:"NETWORK_NO_SOURCE"},_="loadstart, progress,suspend, abort,error, emptied,play, pause,loadedmetadata, loadeddata,waiting, playing,canplay, canplaythrough,seeking, seeked, timeupdate, ended,ratechange,durationchange, volumechange";e.prototype={mediaType:void 0,_playerReady:!1,isReady:function(){return this._playerReady},_onReadyCallback:null,player:null,config:null,_queue:null,setInit:function(e){if(this.minWidth=50,this.minHeight=50,e)for(var t in e)t in this&&(this[t]=e[t]);this.currentTimeChangedByCode=!1},initialize:function(){this.initializeEvent(),this.initializeConfig(),this.initializeFunction()},initializeConfig:function(){e.log("AVideo 설정");for(var t in this.config)this.set(t,this.config[t])},clearConfig:function(){e.log("AVideo 설정 리셋");for(var t in this.config)this.set(t,null)},get:function(t){if(e.enable){if(!(t in this.player))throw new Error("요청한 ["+t+"]속성이 존재하지 않습니다.");var n;if("duration"==t){var o=this.player.duration;if(isNaN(o))return n=0}else if("currentTime"==t){var r=this.player.currentTime;return isNaN(r)&&(r=0),n=Math.min(this.player.duration,r)}return n=this.player[t]}},_tempCurrentTime:-1,set:function(t,n){if(e.enable){if(!this.player)throw console.log("# player : ",this.player),new Error("player가 존재하지 않습니다.");if(!(t in this.player))throw new Error("요청한 속성이 존재하지 않습니다. ("+t+" : "+n+")");if("src"===t)return i.call(this,n),void this._checkNull(t,n);if("currentTime"==t){if(this.isReady()===!1)return this._tempCurrentTime=n,void this._checkNull(t,n);this.currentTimeChangedByCode=!0}else"width"==t?(isNaN(n)&&(n=this.minWidth),n=Math.max(n,this.minWidth)):"height"==t&&(isNaN(n)&&(n=this.minHeight),n=Math.max(n,this.minHeight));if(e.log("	 * player set : ",t,"(",n,")"),!this._checkNull(t,n))try{if(this.player[t]==n)return;this.player[t]=n}catch(o){console.trace("[ERROR] ",o),r.call(this,t,[n])}}},_checkNull:function(e,t){return null===t||void 0===t?($(this.player).removeAttr(e),!0):"src"===e&&""===t?($(this.player).removeAttr(e),!0):!1},_propertyProxy:function(e,t){return void 0===t?this.get(e):void this.set(e,t)},_propertyNotSupport:function(e){throw new Error('The "'+e+'" method is not available API')},src:function(e){return this._propertyProxy("src",e)},height:function(e){return this._propertyProxy("height",e)},width:function(e){return this._propertyProxy("width",e)},controls:function(e){return this._propertyProxy("controls",e)},muted:function(e){return this._propertyProxy("muted",e)},loop:function(e){return this._propertyProxy("loop",e)},autoplay:function(e){return this._propertyProxy("autoplay",e)},preload:function(e){return this._propertyProxy("preload",e)},poster:function(e){return this._propertyProxy("poster",e)},mediagroup:function(e){return this._propertyProxy("mediagroup",e)},defaultPlaybackRate:function(e){return this._propertyProxy("defaultPlaybackRate",e)},playbackRate:function(e){return this._propertyProxy("playbackRate",e)},currentTime:function(e){return this._propertyProxy("currentTime",e)},volume:function(e){return this._propertyProxy("volume",e)},videoWidth:function(){return this._propertyProxy("videoWidth")},videoHeight:function(){return this._propertyProxy("videoHeight")},duration:function(){return this._propertyProxy("duration")},buffered:function(){return this._propertyProxy("buffered")},paused:function(){return this._propertyProxy("paused")},remainTime:function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},readyState:function(){var e=this.get("readyState");return void 0!==e?g[e]:"not ready"},networkState:function(){var e=this.get("networkState");return void 0!==e?h[e]:"not ready"},formatTime:function(t,n){var o=e.formatTime(t,n);return o},parseTime:function(t){var n=e.parseTime(t);return n},initializeEvent:function(){e.log("AVideo 이벤트 등록"),this._createEventProxy(),this._addEvent(),this._addFullscreenEvent()},clearEvent:function(){this._removeEvent(),this._clearEventProxy(),this._removeFullscreenEvent()},_createEventProxy:function(){var e=_.split(",");for(var t in e){var n=e[t].trim(),o=$.proxy(s,this);$(this.player).on(n,o)}},_clearEventProxy:function(){var e=_.split(",");for(var t in e){var n=e[t].trim(),o=$.proxy(s,this);$(this.player).off(n,o)}},_addEvent:function(){var e=_.split(",");for(var t in e){var n=e[t].trim(),o=c(n);if(o in this){var r=$.proxy(this[o],this);this.on(n,r)}}},_removeEvent:function(){var e=_.split(",");for(var t in e){var n=e[t].trim(),o=c(n);if(o in this){var r=$.proxy(this[o],this);this.off(n,r)}}},on:function(e,t){try{$(this.container).on(e,$.proxy(t,this))}catch(n){alert("디버깅 임시 코드 : "+n)}},off:function(e,t){$(this.container).off(e,$.proxy(t,this))},one:function(e,t){$(this.container).one(e,$.proxy(t,this))},trigger:function(e,t){$(this.container).triggerHandler(e,[t])},onLoadstart:function(t){e.log("onLoadstart autoplay:",this.autoplay())},onProgress:function(e){u("Progress",this)},onSuspend:function(e){u("Suspend",this)},onAbort:function(e){u("Abort",this)},onEmptied:function(e){u("Emptied",this)},onError:function(t){e.log("onError : ",t);var n,o,r=this.player;switch(r.error.code){case r.error.MEDIA_ERR_ABORTED:o="MEDIA_ERR_ABORTED",n="You aborted the media playback.";break;case r.error.MEDIA_ERR_NETWORK:o="MEDIA_ERR_NETWORK",n="A network error caused the media download to fail part-way.";break;case r.error.MEDIA_ERR_DECODE:o="MEDIA_ERR_DECODE",n="The media playback was aborted due to a corruption problem or because the media used features your browser did not support.";break;case r.error.MEDIA_ERR_SRC_NOT_SUPPORTED:var a=$(this.player).attr("src");a&&""!==a&&(o="MEDIA_ERR_SRC_NOT_SUPPORTED",n="The media could not be loaded, either because the server or network failed or because the format is not supported.");break;default:n="An unknown error occurred."}n&&u("Error",this,n,o),this.pause()},onPlay:function(t){return this.get("src")?void e.log("onPlay"):void this.stop()},onPause:function(t){e.log("onPause")},onLoadedmetadata:function(t){e.log("onLoadedmetadata")},onLoadeddata:function(t){e.log("onLoadeddata"),o.apply(this)},onWaiting:function(e){u("Waiting",this)},onPlaying:function(t){e.log("onPlaying"),m.apply(this)},onCanplay:function(t){e.log("onCanplay")},onCanplaythrough:function(t){e.log("onCanplaythrough")},onSeeking:function(t){e.log("onSeeking : ",this.currentTime())},onSeeked:function(t){e.log("onSeeked : ",this.currentTime())},onTimeupdate:function(t){var n=e.formatTime(this.currentTime(),this.duration());e.log("onTimeupdate : ",this.currentTime(),"(",n,")"),this.currentTimeChangedByCode=!1},onEnded:function(e){u("Ended",this);var t=this.player.paused;t||this.player.pause()},onRatechange:function(e){},onDurationchange:function(t){e.log("onDurationchange : ",this.duration())},onVolumechange:function(t){e.log("onVolumechange : ",this.volume(),this.muted())},initializeFunction:function(){},load:function(){this.player&&this.player.load()},canPlayType:function(e){return this.player?this.player.canPlayType(e):void 0},play:function(){if(this.player){var e=this.player.paused;if(e){var t=this;setTimeout(function(){var e=t.player.play();void 0!==e&&e.then(function(){console.log("# 미디어 재생")})["catch"](function(e){console.log("#108 issue 미디어 재생 중지됨 : ",e)})},100)}}},pause:function(){if(this.player){var e=!this.player.paused;e&&this.player.pause()}},stop:function(){this.player&&(this.pause(),this.currentTime(0))},togglePlay:function(e){if(this.player){var t=this.player.paused;t?this.player.play():(this.player.pause(),"stop"===e&&this.currentTime(0))}},dispose:function(){this.container&&(this.stop(),this.src(null),this.src(""),this.clearConfig(),this.clearEvent(),this.container=null,this.player=null,this.id=null,this.config=null,this._tempCurrentTime=-1,this._playerReady=!1,this._onReadyCallback=null)},isPaused:function(){if(!this.player)return!0;var e=this.player.paused;return e},isFullscreen:function(){var e=document.fullscreen||document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.webkitIsFullScreen;return e},_lastControlState:!1,toggleFullScreen:function(){var e=this.isFullscreen();if(e)document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else if(this._lastControlState=this.player.controls,this._lastControlState||(console.log("* requestFullscreen - controls 속성 기록 (false)"),this.player.controls=!0),this.player.requestFullscreen)this.player.requestFullscreen();else if(this.player.msRequestFullscreen)this.player.msRequestFullscreen();else if(this.player.mozRequestFullScreen)this.player.mozRequestFullScreen();else if(this.player.webkitRequestFullscreen)this.player.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else{if(!this.player.webkitEnterFullScreen)return alert("Fullscreen disabled");this.player.webkitEnterFullScreen()}},_addFullscreenEvent:function(){var e=$.proxy(this._fullscreenHandler,this);document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1)},_removeFullscreenEvent:function(){var e=$.proxy(this._fullscreenHandler,this);document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1)},_fullscreenHandler:function(e){function t(){this.trigger("fullscreen",!0)}function n(){this._lastControlState||(console.log("* canceledFullScreen - controls 속성 되돌리기 (false)"),this.player&&(this.player.controls=this._lastControlState)),this.trigger("fullscreen",!1)}var o=this.isFullscreen();o?t.apply(this):n.apply(this),this.player&&this.player.focus()}},e.plugin=function(t,n){e.prototype[t]=n},e.create=function(n,o,r,a,i){if(n=n.toLowerCase(),"video"!=n&&"audio"!=n)throw new TypeError("mediaType은 video 또는 audio를 설정합니다.");var s=new e(v);e.log("document.readyState : ",document.readyState),e.log("$container",o),e.log("instance",s);var c;if(c="string"==typeof o?$(o):o,!c.has(n))throw new TypeError("The element or ID supplied is not valid.");return s.container=c[0],"interactive"!==document.readyState&&"complete"!==document.readyState?(e.log("주의) AVideo 인스턴스는 콜백함수에서 반환됩니다."),$(function(){t.apply(s,[n,o,r,a,i])})):t.apply(s,[n,o,r,a,i]),s};var E;return e.formatTime=function(e,t){t=t||e;var n=Math.floor(e%60),o=Math.floor(e/60%60),r=Math.floor(e/3600),a=(Math.floor(t/60),Math.floor(t/60%60)),i=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=o=n="-"),r=r>0||i>0?r+":":"",o=((r||a>=10)&&10>o?"0"+o:o)+":",n=10>n?"0"+n:n,r+o+n},e.parseTime=function(e){var t,n,o,r,a,i=e.split(":"),s=0;return 3==i.length?(t=i[0],n=i[1],o=i[2]):(t=0,n=i[0],o=i[1]),o=o.split(/\s+/),r=o.splice(0,1)[0],r=r.split(/\.|,/),a=parseFloat(r[1]),r=r[0],s+=3600*parseFloat(t),s+=60*parseFloat(n),s+=parseFloat(r),a&&(s+=a/1e3),s},e}var t=MODULE.core.instance;t.service("$media",e)}(),function(){function e(){function e(e){if(e=e.replace(/[\n\r\s]/g,""),0==e.search(/data:.+\/(.+);base64,.+/g)){var t=e.replace(/data:image\/(.+);base64,.+/g,"$1");return t}e=e.replace(/\\/g,"/"),e=e.toLowerCase().trim();var o=e.lastIndexOf("/");return o>=0&&(e=e.substr(o+1)),o=e.lastIndexOf("."),o>=0&&(e=e.substr(o+1)),n[e]?e:void 0}function t(t){var r=e(t);return r?n[r]:o}var n,o="application/octet-stream";n={"3gp":"video/3gpp",a:"application/octet-stream",ai:"application/postscript",aif:"audio/x-aiff",aiff:"audio/x-aiff",asc:"application/pgp-signature",asf:"video/x-ms-asf",asm:"text/x-asm",asx:"video/x-ms-asf",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bat:"application/x-msdownload",bin:"application/octet-stream",bmp:"image/bmp",bz2:"application/x-bzip2",c:"text/x-csrc",cab:"application/vnd.ms-cab-compressed",can:"application/candor",cc:"text/x-c++src",chm:"application/vnd.ms-htmlhelp","class":"application/octet-stream",com:"application/x-msdownload",conf:"text/plain",cpp:"text/x-c",crt:"application/x-x509-ca-cert",css:"text/css",csv:"text/csv",cxx:"text/x-c",deb:"application/x-debian-package",der:"application/x-x509-ca-cert",diff:"text/x-diff",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/x-msdownload",dmg:"application/octet-stream",doc:"application/msword",dot:"application/msword",dtd:"application/xml-dtd",dvi:"application/x-dvi",ear:"application/java-archive",eml:"message/rfc822",eps:"application/postscript",exe:"application/x-msdownload",f:"text/x-fortran",f77:"text/x-fortran",f90:"text/x-fortran",flv:"video/x-flv","for":"text/x-fortran",gem:"application/octet-stream",gemspec:"text/x-script.ruby",gif:"image/gif",gyp:"text/x-script.python",gypi:"text/x-script.python",gz:"application/x-gzip",h:"text/x-chdr",hh:"text/x-c++hdr",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",ifb:"text/calendar",iso:"application/octet-stream",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",less:"text/css",log:"text/plain",lua:"text/x-script.lua",luac:"application/x-bytecode.lua",makefile:"text/x-makefile",m3u:"audio/x-mpegurl",m4v:"video/mp4",man:"text/troff",manifest:"text/cache-manifest",markdown:"text/x-markdown",mathml:"application/mathml+xml",mbox:"application/mbox",mdoc:"text/troff",md:"text/x-markdown",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mime:"message/rfc822",mml:"application/mathml+xml",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ms:"text/troff",msi:"application/x-msdownload",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",p:"text/x-pascal",pas:"text/x-pascal",pbm:"image/x-portable-bitmap",pdf:"application/pdf",pem:"application/x-x509-ca-cert",pgm:"image/x-portable-graymap",pgp:"application/pgp-encrypted",pkg:"application/octet-stream",pl:"text/x-script.perl",pm:"text/x-script.perl-module",png:"image/png",pnm:"image/x-portable-anymap",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",py:"text/x-script.python",qt:"video/quicktime",ra:"audio/x-pn-realaudio",rake:"text/x-script.ruby",ram:"audio/x-pn-realaudio",rar:"application/x-rar-compressed",rb:"text/x-script.ruby",rdf:"application/rdf+xml",roff:"text/troff",rpm:"application/x-redhat-package-manager",rss:"application/rss+xml",rtf:"application/rtf",ru:"text/x-script.ruby",s:"text/x-asm",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",sig:"application/pgp-signature",snd:"audio/basic",so:"application/octet-stream",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tbz:"application/x-bzip-compressed-tar",tci:"application/x-topcloud",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",torrent:"application/x-bittorrent",tr:"text/troff",ttf:"application/x-font-ttf",txt:"text/plain",vcf:"text/x-vcard",vcs:"text/x-vcalendar",vrml:"model/vrml",war:"application/java-archive",wav:"audio/x-wav",webapp:"application/x-web-app-manifest+json",webm:"video/webm",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wrl:"model/vrml",wsdl:"application/wsdl+xml",xbm:"image/x-xbitmap",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",yaml:"text/yaml",yml:"text/yaml",zip:"application/zip"};var r=["audio/mp3","audio/mpeg","audio/wav","video/mp4","video/webm","application/ogg","image/svg+xml","image/jpeg","image/png","image/gif","text/plain","text/css","text/html",".js","application/javascript","application/json",".ttf",".woff",".eot",".otf"],a={AUDIO:["audio","mp3","mpeg","wav","ogg"],VIDEO:["video","mp4","webm","ogv"],IMAGE:["image","svg","jpeg","png","gif"],TEXT:["text","txt","css","html","js","json","xml"],FONT:["font","ttf","woff","eot","otf"]};return{get:t,type:e,typeCategory:function(e){e=e.toLowerCase();var t;for(var n in a)if(a[n].indexOf(e)>-1){t=n;break}return t||e},allowTypes:function(){return r}}}var t=MODULE.core.instance;t.service("$mime",e)}(),function(){function e(){function e(e){function t(e,t){for(var n=[],o=0;o<e.length;o++){var r=e[o];r&&"."!==r&&(".."===r?n.length&&".."!==n[n.length-1]?n.pop():t&&n.push(".."):n.push(r))}return n}function o(e){for(var t=e.length-1,n=0;t>=n&&!e[n];n++);for(var o=t;o>=0&&!e[o];o--);return 0===n&&o===t?e:n>o?[]:e.slice(n,o+1)}function r(e){var t=u.exec(e),n=(t[1]||"")+(t[2]||""),o=t[3]||"",r=l.exec(o),a=r[1],i=r[2],s=r[3];return[n,a,i,s]}function a(e){var t=u.exec(e),n=t[1]||"",o=!!n&&":"!==n[1];return{device:n,isUnc:o,isAbsolute:o||!!t[2],tail:t[3]}}function i(e){return"\\\\"+e.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}function s(e){return p.exec(e).slice(1)}var c={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e}},u=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,l=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,d={};d.resolve=function(){for(var e="",o="",r=!1,s=arguments.length-1;s>=-1;s--){var u;if(s>=0?u=arguments[s]:e?(u=void 0,u&&u.substr(0,3).toLowerCase()===e.toLowerCase()+"\\"||(u=e+"\\")):u=n,!c.isString(u))throw new TypeError("Arguments to path.resolve must be strings");if(u){var l=a(u),d=l.device,p=l.isUnc,m=l.isAbsolute,f=l.tail;if((!d||!e||d.toLowerCase()===e.toLowerCase())&&(e||(e=d),r||(o=f+"\\"+o,r=m),e&&r))break}}return p&&(e=i(e)),o=t(o.split(/[\\\/]+/),!r).join("\\"),e+(r?"\\":"")+o||"."},d.normalize=function(e){var n=a(e),o=n.device,r=n.isUnc,s=n.isAbsolute,c=n.tail,u=/[\\\/]$/.test(c);return c=t(c.split(/[\\\/]+/),!s).join("\\"),c||s||(c="."),c&&u&&(c+="\\"),r&&(o=i(o)),o+(s?"\\":"")+c},d.isAbsolute=function(e){return a(e).isAbsolute},d.join=function(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(!c.isString(n))throw new TypeError("Arguments to path.join must be strings");n&&e.push(n)}var o=e.join("\\");return/^[\\\/]{2}[^\\\/]/.test(e[0])||(o=o.replace(/^[\\\/]{2,}/,"\\")),d.normalize(o)},d.relative=function(e,t){e=d.resolve(e),t=d.resolve(t);for(var n=e.toLowerCase(),r=t.toLowerCase(),a=o(t.split("\\")),i=o(n.split("\\")),s=o(r.split("\\")),c=Math.min(i.length,s.length),u=c,l=0;c>l;l++)if(i[l]!==s[l]){u=l;break}if(0==u)return t;for(var p=[],l=u;l<i.length;l++)p.push("..");return p=p.concat(a.slice(u)),p.join("\\")},d._makeLong=function(e){if(!c.isString(e))return e;if(!e)return"";var t=d.resolve(e);return/^[a-zA-Z]\:\\/.test(t)?"\\\\?\\"+t:/^\\\\[^?.]/.test(t)?"\\\\?\\UNC\\"+t.substring(2):e},d.dirname=function(e){var t=r(e),n=t[0],o=t[1];return n||o?(o&&(o=o.substr(0,o.length-1)),n+o):"."},d.basename=function(e,t){var n=r(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},d.extname=function(e){return r(e)[3]},d.format=function(e){if(!c.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!c.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);var n=e.dir,o=e.base||"";return n?n[n.length-1]===d.sep?n+o:n+d.sep+o:o},d.parse=function(e){if(!c.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=r(e);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}},d.sep="\\",d.delimiter=";";var p=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,m={};m.resolve=function(){for(var e="",o=!1,r=arguments.length-1;r>=-1&&!o;r--){var a=r>=0?arguments[r]:n;if(!c.isString(a))throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,o="/"===a[0])}return e=t(e.split("/"),!o).join("/"),(o?"/":"")+e||"."},m.normalize=function(e){var n=m.isAbsolute(e),o=e&&"/"===e[e.length-1];return e=t(e.split("/"),!n).join("/"),e||n||(e="."),e&&o&&(e+="/"),(n?"/":"")+e},m.isAbsolute=function(e){return"/"===e.charAt(0)},m.join=function(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];if(!c.isString(n))throw new TypeError("Arguments to path.join must be strings");n&&(e+=e?"/"+n:n)}return m.normalize(e)},m.relative=function(e,t){e=m.resolve(e).substr(1),t=m.resolve(t).substr(1);for(var n=o(e.split("/")),r=o(t.split("/")),a=Math.min(n.length,r.length),i=a,s=0;a>s;s++)if(n[s]!==r[s]){i=s;break}for(var c=[],s=i;s<n.length;s++)c.push("..");return c=c.concat(r.slice(i)),c.join("/")},m._makeLong=function(e){return e},m.dirname=function(e){var t=s(e),n=t[0],o=t[1];return n||o?(o&&(o=o.substr(0,o.length-1)),n+o):"."},m.basename=function(e,t){var n=s(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},m.extname=function(e){return s(e)[3]},m.format=function(e){if(!c.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!c.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);var n=e.dir?e.dir+m.sep:"",o=e.base||"";return n+o},m.parse=function(e){if(!c.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=s(e);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return t[1]=t[1]||"",t[2]=t[2]||"",t[3]=t[3]||"",{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}},m.sep="/",m.delimiter=":";var f=!0;return window.process&&window.process.platform?f="win32"===window.process.platform:console.warn("실행되는 (platform) 환경을 확인할 수 없습니다.",window.process),e.exports=f?d:m,e.exports.posix=m,e.exports.win32=d,e.exports}return e({})}var t=MODULE.core.instance;t.service("$node_path",e);var n=function(){if(window.process&&window.process.cwd)return window.process.cwd();var e=window.document.baseURI;if(e){var t=window.location.origin;e=e.substring(t.length);var n=e.indexOf("?");n>-1&&(e=e.substring(0,n))}else{var o=window.document.getElementsByTagName("base");if(o.length>0){e=o[0].href;var t=window.location.origin;e=e.substring(t.length)}e||(e=window.location.pathname)}return e}()}(),function(){function e(){function e(){function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function t(t,n,o){if(t&&l.isObject(t)&&t instanceof e)return t;var r=new e;return r.parse(t,n,o),r}function n(n){return l.isString(n)&&(n=t(n)),n instanceof e?n.format():e.prototype.format.call(n)}function o(e,n){return t(e,!1,!0).resolve(n)}function r(e,n){return e?t(e,!1,!0).resolveObject(n):n}var a={},i={exports:a},s=function(){"use strict";var e=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},t=function(t,n,o,r){return n=n||"&",o=o||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map(function(r){var a=encodeURIComponent(e(r))+o;return Array.isArray(t[r])?t[r].map(function(t){return a+encodeURIComponent(e(t))}).join(n):a+encodeURIComponent(e(t[r]))}).join(n):r?encodeURIComponent(e(r))+o+encodeURIComponent(e(t)):""};return t}(),c=function(){"use strict";function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var t=function(t,n,o,r){n=n||"&",o=o||"=";var a={};if("string"!=typeof t||0===t.length)return a;var i=/\+/g;t=t.split(n);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var c=t.length;s>0&&c>s&&(c=s);for(var u=0;c>u;++u){var l,d,p,m,f=t[u].replace(i,"%20"),v=f.indexOf(o);v>=0?(l=f.substr(0,v),d=f.substr(v+1)):(l=f,d=""),p=decodeURIComponent(l),m=decodeURIComponent(d),e(a,p)?Array.isArray(a[p])?a[p].push(m):a[p]=[a[p],m]:a[p]=m}return a};return t}(),u=function(){return function(e){function t(e){throw RangeError(S[e])}function n(e,t){for(var n=e.length,o=[];n--;)o[n]=t(e[n]);return o}function o(e,t){var o=e.split("@"),r="";o.length>1&&(r=o[0]+"@",e=o[1]),e=e.replace(A,".");var a=e.split("."),i=n(a,t).join(".");return r+i}function r(e){for(var t,n,o=[],r=0,a=e.length;a>r;)t=e.charCodeAt(r++),t>=55296&&56319>=t&&a>r?(n=e.charCodeAt(r++),56320==(64512&n)?o.push(((1023&t)<<10)+(1023&n)+65536):(o.push(t),r--)):o.push(t);return o}function s(e){return n(e,function(e){var t="";return e>65535&&(e-=65536,t+=N(e>>>10&1023|55296),e=56320|1023&e),t+=N(e)}).join("")}function c(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:y}function u(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function l(e,t,n){var o=0;for(e=n?I(e/C):e>>1,e+=I(e/t);e>M*w>>1;o+=y)e=I(e/M);return I(o+(M+1)*e/(e+b))}function d(e){var n,o,r,a,i,u,d,p,m,f,v=[],g=e.length,h=0,_=T,$=O;for(o=e.lastIndexOf(D),0>o&&(o=0),r=0;o>r;++r)e.charCodeAt(r)>=128&&t("not-basic"),v.push(e.charCodeAt(r));for(a=o>0?o+1:0;g>a;){for(i=h,u=1,d=y;a>=g&&t("invalid-input"),p=c(e.charCodeAt(a++)),(p>=y||p>I((E-h)/u))&&t("overflow"),h+=p*u,m=$>=d?P:d>=$+w?w:d-$,!(m>p);d+=y)f=y-m,u>I(E/f)&&t("overflow"),u*=f;n=v.length+1,$=l(h-i,n,0==i),I(h/n)>E-_&&t("overflow"),_+=I(h/n),h%=n,v.splice(h++,0,_)}return s(v)}function p(e){var n,o,a,i,s,c,d,p,m,f,v,g,h,_,$,b=[];for(e=r(e),g=e.length,n=T,o=0,s=O,c=0;g>c;++c)v=e[c],128>v&&b.push(N(v));for(a=i=b.length,i&&b.push(D);g>a;){for(d=E,c=0;g>c;++c)v=e[c],v>=n&&d>v&&(d=v);for(h=a+1,d-n>I((E-o)/h)&&t("overflow"),o+=(d-n)*h,n=d,c=0;g>c;++c)if(v=e[c],n>v&&++o>E&&t("overflow"),
v==n){for(p=o,m=y;f=s>=m?P:m>=s+w?w:m-s,!(f>p);m+=y)$=p-f,_=y-f,b.push(N(u(f+$%_,0))),p=I($/_);b.push(N(u(p,0))),s=l(o,h,a==i),o=0,++a}++o,++n}return b.join("")}function m(e){return o(e,function(e){return R.test(e)?d(e.slice(4).toLowerCase()):e})}function f(e){return o(e,function(e){return x.test(e)?"xn--"+p(e):e})}var v="object"==typeof a&&a&&!a.nodeType&&a,g="object"==typeof i&&i&&!i.nodeType&&i,h="object"==typeof global&&global;(h.global===h||h.window===h||h.self===h)&&(e=h);var _,$,E=2147483647,y=36,P=1,w=26,b=38,C=700,O=72,T=128,D="-",R=/^xn--/,x=/[^\x20-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},M=y-P,I=Math.floor,N=String.fromCharCode;if(_={version:"1.3.2",ucs2:{decode:r,encode:s},decode:d,encode:p,toASCII:f,toUnicode:m},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return _});else if(v&&g)if(i.exports==v)g.exports=_;else for($ in _)_.hasOwnProperty($)&&(v[$]=_[$]);else e.punycode=_;return i.exports}(this)}(),l={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}};a.parse=t,a.resolve=o,a.resolveObject=r,a.format=n,a.Url=e;var d=/^([a-z0-9.+-]+:)/i,p=/:[0-9]*$/,m=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,f=["<",">",'"',"`"," ","\r","\n","	"],v=["{","}","|","\\","^","`"].concat(f),g=["'"].concat(v),h=["%","/","?",";","#"].concat(g),_=["/","?","#"],$=255,E=/^[+a-z0-9A-Z_-]{0,63}$/,y=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,P={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},C={decode:c,parse:c,encode:s,stringify:s};return e.prototype.parse=function(e,t,n){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),r=-1!==o&&o<e.indexOf("#")?"?":"#",a=e.split(r),i=/\\/g;a[0]=a[0].replace(i,"/"),e=a.join(r);var s=e;if(s=s.trim(),!n&&1===e.split("#").length){var c=m.exec(s);if(c)return this.path=s,this.href=s,this.pathname=c[1],c[2]?(this.search=c[2],this.query=t?C.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=d.exec(s);if(p){p=p[0];var f=p.toLowerCase();this.protocol=f,s=s.substr(p.length)}if(n||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var v="//"===s.substr(0,2);!v||p&&w[p]||(s=s.substr(2),this.slashes=!0)}if(!w[p]&&(v||p&&!b[p])){for(var O=-1,T=0;T<_.length;T++){var D=s.indexOf(_[T]);-1!==D&&(-1===O||O>D)&&(O=D)}var R,x;x=-1===O?s.lastIndexOf("@"):s.lastIndexOf("@",O),-1!==x&&(R=s.slice(0,x),s=s.slice(x+1),this.auth=decodeURIComponent(R)),O=-1;for(var T=0;T<h.length;T++){var D=s.indexOf(h[T]);-1!==D&&(-1===O||O>D)&&(O=D)}-1===O&&(O=s.length),this.host=s.slice(0,O),s=s.slice(O),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var S=this.hostname.split(/\./),T=0,M=S.length;M>T;T++){var I=S[T];if(I&&!I.match(E)){for(var N="",j=0,L=I.length;L>j;j++)N+=I.charCodeAt(j)>127?"x":I[j];if(!N.match(E)){var U=S.slice(0,T),k=S.slice(T+1),F=I.match(y);F&&(U.push(F[1]),k.unshift(F[2])),k.length&&(s="/"+k.join(".")+s),this.hostname=U.join(".");break}}}this.hostname=this.hostname.length>$?"":this.hostname.toLowerCase(),A||(this.hostname=u.toASCII(this.hostname));var B=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+B,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!P[f])for(var T=0,M=g.length;M>T;T++){var G=g[T];if(-1!==s.indexOf(G)){var K=encodeURIComponent(G);K===G&&(K=escape(G)),s=s.split(G).join(K)}}var H=s.indexOf("#");-1!==H&&(this.hash=s.substr(H),s=s.slice(0,H));var W=s.indexOf("?");if(-1!==W?(this.search=s.substr(W),this.query=s.substr(W+1),t&&(this.query=C.parse(this.query)),s=s.slice(0,W)):t&&(this.search="",this.query={}),s&&(this.pathname=s),b[f]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",J=this.search||"";this.path=B+J}return this.href=this.format(),this},e.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",o=this.hash||"",r=!1,a="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(a=C.stringify(this.query));var i=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||b[t])&&r!==!1?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r||(r=""),o&&"#"!==o.charAt(0)&&(o="#"+o),i&&"?"!==i.charAt(0)&&(i="?"+i),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),i=i.replace("#","%23"),t+r+n+i+o},e.prototype.resolve=function(e){return this.resolveObject(t(e,!1,!0)).format()},e.prototype.resolveObject=function(t){if(l.isString(t)){var n=new e;n.parse(t,!1,!0),t=n}for(var o=new e,r=Object.keys(this),a=0;a<r.length;a++){var i=r[a];o[i]=this[i]}if(o.hash=t.hash,""===t.href)return o.href=o.format(),o;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),c=0;c<s.length;c++){var u=s[c];"protocol"!==u&&(o[u]=t[u])}return b[o.protocol]&&o.hostname&&!o.pathname&&(o.path=o.pathname="/"),o.href=o.format(),o}if(t.protocol&&t.protocol!==o.protocol){if(!b[t.protocol]){for(var d=Object.keys(t),p=0;p<d.length;p++){var m=d[p];o[m]=t[m]}return o.href=o.format(),o}if(o.protocol=t.protocol,t.host||w[t.protocol])o.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),o.pathname=f.join("/")}if(o.search=t.search,o.query=t.query,o.host=t.host||"",o.auth=t.auth,o.hostname=t.hostname||t.host,o.port=t.port,o.pathname||o.search){var v=o.pathname||"",g=o.search||"";o.path=v+g}return o.slashes=o.slashes||t.slashes,o.href=o.format(),o}var h=o.pathname&&"/"===o.pathname.charAt(0),_=t.host||t.pathname&&"/"===t.pathname.charAt(0),$=_||h||o.host&&t.pathname,E=$,y=o.pathname&&o.pathname.split("/")||[],f=t.pathname&&t.pathname.split("/")||[],P=o.protocol&&!b[o.protocol];if(P&&(o.hostname="",o.port=null,o.host&&(""===y[0]?y[0]=o.host:y.unshift(o.host)),o.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),$=$&&(""===f[0]||""===y[0])),_)o.host=t.host||""===t.host?t.host:o.host,o.hostname=t.hostname||""===t.hostname?t.hostname:o.hostname,o.search=t.search,o.query=t.query,y=f;else if(f.length)y||(y=[]),y.pop(),y=y.concat(f),o.search=t.search,o.query=t.query;else if(!l.isNullOrUndefined(t.search)){if(P){o.hostname=o.host=y.shift();var C=o.host&&o.host.indexOf("@")>0?o.host.split("@"):!1;C&&(o.auth=C.shift(),o.host=o.hostname=C.shift())}return o.search=t.search,o.query=t.query,l.isNull(o.pathname)&&l.isNull(o.search)||(o.path=(o.pathname?o.pathname:"")+(o.search?o.search:"")),o.href=o.format(),o}if(!y.length)return o.pathname=null,o.path=o.search?"/"+o.search:null,o.href=o.format(),o;for(var O=y.slice(-1)[0],T=(o.host||t.host||y.length>1)&&("."===O||".."===O)||""===O,D=0,R=y.length;R>=0;R--)O=y[R],"."===O?y.splice(R,1):".."===O?(y.splice(R,1),D++):D&&(y.splice(R,1),D--);if(!$&&!E)for(;D--;D)y.unshift("..");!$||""===y[0]||y[0]&&"/"===y[0].charAt(0)||y.unshift(""),T&&"/"!==y.join("/").substr(-1)&&y.push("");var x=""===y[0]||y[0]&&"/"===y[0].charAt(0);if(P){o.hostname=o.host=x?"":y.length?y.shift():"";var C=o.host&&o.host.indexOf("@")>0?o.host.split("@"):!1;C&&(o.auth=C.shift(),o.host=o.hostname=C.shift())}return $=$||o.host&&y.length,$&&!x&&y.unshift(""),y.length?o.pathname=y.join("/"):(o.pathname=null,o.path=null),l.isNull(o.pathname)&&l.isNull(o.search)||(o.path=(o.pathname?o.pathname:"")+(o.search?o.search:"")),o.auth=t.auth||o.auth,o.slashes=o.slashes||t.slashes,o.href=o.format(),o},e.prototype.parseHost=function(){var e=this.host,t=p.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},a}return e()}var t=MODULE.core.instance;t.service("$node_url",e)}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){function d(){}return d.prototype={_focus:!1,inputFocused:function(e){return arguments.length<1?this._focus:void(this._focus!==e&&(this._focus=e))},_map:{},_getScope:function(e){return this._map[e]},setEditorConfig:function(e){return{isPopup:e.isPopup,editor:e.uid}},unregist:function(e){e in this._map&&delete this._map[e]},regist:function(e,t){this._map[e]=t},enable:function(e,t){var n=this._getScope(e);n&&(n.config.enable=t,n.config.update=t,n.$applyAsync())},update:function(e){var t=this._getScope(e);t&&(t.config.update=!0,t.$applyAsync())},isTextEditor:function(e){return Boolean(this._map[e])},parentSelector:void 0,_getParent:function(e){e=e||{},this.parentSelector=this.parentSelector||document.body;var t=e.parent||this.parentSelector;return angular.element(t)},_map_popup:void 0,_getDom_popup:function(e){return this._map_popup[e]},_getScope_popup:function(e){var t=this._getDom_popup(e);if(t)return t.scope()},_isMenuOpened:!1,isMenuOpened:function(){return this._isMenuOpened},update_popup:function(e,t){var n=this._getScope_popup(e);if(n){var o=this._getDom_popup(e);o&&(t=t||{},n.editorConfig.update=!0,t.position&&n.$applyAsync(function(){var e=a.position(o,t.position);n.config.style.left=e.left,n.config.style.top=e.top+10}))}},closeMenu:function(e,t,n){var o=this._getScope_popup(e);o&&(o.callback(t,n),this._isMenuOpened=!1)},openMenu:function(t,n,o){function r(e){var t,n;void 0===e||-1===e?t={isCancel:!0}:n={},o&&o(t,n)}this._isMenuOpened=!0;var a=e.defer();return this._createPopup(t,n,function(e,t){e?a.reject(e):a.resolve(t)}),a.promise.then(function(e){r(e)},function(e){r(-1)},function(e){}),a.promise},_createPopup:function(e,a,i){var a=a||{},s=!1,c=a.position||{},u=a.style||{};(void 0!==c.left||void 0!==c.top)&&(void 0===u.position&&(u.position="absolute"),void 0!==c.left&&(u.left=c.left),void 0!==c.top&&(u.top=c.top+10),s=!0),a.style=u,a.parent=this._getParent(a);var d,p;if(a.templateUrl&&(p=r.get(a.templateUrl)),a.template&&(p=a.template),!p)return i("DOM template이 설정되지 않았습니다.");d=angular.element(p);var m=void 0===a.isTop?!1:a.isTop;m&&d.addClass("mini-popup-top-index"),d.attr("tool-popup",""),a.uid=e,a.isPopup=!0;var f=a.handler||{},v=f.onOpen||function(e){},g=f.onClose||function(e){};delete a.handler;var h=t.$new(!0);h.config=angular.copy(a),h.editorConfig=this.setEditorConfig(a);var _=this;h.callback=function(){var t=arguments;i&&i.apply(null,t),g(h),_._close(e),h.$applyAsync(),d&&d.remove(),h&&h.$destroy(),h=null,d=null},o(d)(h),v(h);var $=a.parent.find("[tool-popup]").last()[0];n.enter(d,a.parent,$).then(function(){d.show()}),this._map_popup||(this._map_popup={}),this._map_popup[e]=d,s&&(d.hide(),this.update_popup(e,h.config),l(function(){_.update_popup(e,h.config)}))},_close:function(e){var t=this._getDom_popup(e);t&&delete this._map_popup[e]},getEditor:function(e){var t='[jj-rich-text-editor][uid="'+e+'"]',n=angular.element(t);return n},call:function(e,t,n){switch(t){case"fontName":n&&(n=n.trim().replace(/['"]+/g,""))}var o=arguments.length<3,r=this.getEditor(e);if(o){var a=r.summernote(t);return"currentStyle"===t?a["font-family"]=i.normalize(a["font-family"]):"fontName"===t&&(a=i.normalize(a)),a}r.summernote("restoreRange"),r.summernote(t,n),r.summernote("saveRange")},getCurrentEditor:function(){var e=s.get(),t=e?e.value("editingUID"):"";if(t){var n=c.get(t),o=n?n.type()===u.TEXT:!1;if(o)return t}},isInputbox:function(e){var t=e.attributes.contenteditable&&"true"===e.attributes.contenteditable,n="INPUT"===e.nodeName.toUpperCase(),o="TEXTAREA"===e.nodeName.toUpperCase();return e&&t||n||o}},new d}var t=MODULE.core.instance;t.service("$richEditor",e),e.$inject=["$q","$rootScope","$animate","$compile","$templateCache","$util","$fontList","$selects","$elements","ElementType","$timeout"]}(),function(){function e(e,t,n,o){var r={message:"Application 준비중 입니다.",messageType:e.INFO,icon:t.NORMAL,task:"",taskObject:null,state:""},a=!0;return{get:function(){return r},setMessage:function(t,n,o){if(a){if(arguments.length<1)return r.message="",void(r.messageType="");r.message=t,r.messageType=n||e.INFO,console.log("# message : [",r.messageType,"]",r.message),this.setIcon(o)}},setTask:function(e,t){if(a){if(arguments.length<1)return r.task="",void(r.taskObject=null);r.task=e,r.taskObject=t,console.log("# task : [",r.task,"]",r.taskObject)}},setState:function(e){a&&(r.state=e||"none")},setIcon:function(e){a&&(e=e||t.NORMAL,r.icon==t.WAIT||r.icon==t.PROCESS?n(function(){r.icon=e},o.busyDelayTime):r.icon=e)},_enable:!0,enable:function(e){void 0===e&&(e=!0),a=e}}}var t=MODULE.core.instance;t.service("$status",e),e.$inject=["MessageType","StatusIcon","$timeout","Default"]}(),function(){function e(e,t,n,o,r,a,i,s){function c(){}return c.prototype={getParameter:function(t,r,a){var s,c,u=i.get(t),l=u.value("backgroundColor"),d=u.value("master"),p=d?this.getMasterAssetSize(d):null,m=u.value("thumbnail"),f=m?this.getMasterAssetSize(m):null,v=o.$$checkThumbnail_master(p,f,!0),g={path:v.MT.url,width:v.M.width*v.MTs.x,height:v.M.height*v.MTs.y},h=o.get(),_=h.tooldata("capture");if(_&&_[t]){var $=_[t];s=o.$$checkThumbnail_capture($.width,$.height,t,!0),c=n.pathToActual($.path)}else s=o.$$checkThumbnail_capture(0,0,t,!0),c="";var E={path:c,width:s.C.width*s.CTs.x,height:s.C.height*s.CTs.y},y=o.$$checkThumbnail_paper(!0),P={pageNum:a,filename:r,master:g,capture:E,paper:{width:y.width,height:y.height,bgcolor:l,size:e.thumbnailSizeRange}};return P},getMasterAssetSize:function(e){var t=a.get(e),n=t.value("property"),r=t.type(),i=r&&"svg"===r.toLowerCase(),s=1;if(i){var c=o.get(),u=c.getNoneCopyValue("paper"),l=u.width/n.width,d=u.height/n.height;(l>1||d>1)&&(s=Math.min(l,d))}var p={width:n.width*s,height:n.height*s,url:t.path()};return p},create:function(e,n){t.thumbnail(e,function(e){return e?n(e):void n()})}},new c}var t=MODULE.core.instance;t.service("$thumbnail",e),e.$inject=["Default","$externalAPI","FileSystem","$projects","$document","$assets","$documents","$busy"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f,v,g,h,_,$,E,y,P,w,b,C,O,T,D,R,x,A,S,M,I,N,j,L,U,k,F,B,V,G,K,H,W,J,z,Q,q,X,Y,Z,ee,te,ne,oe,re,ae,ie,se,ce,ue,le,de,pe,me){var fe=e.create("CommandControllerService",{modifyApplication:function(e,n,r){if(void 0===r&&(r=!0),e.data){e=new o(e);var a=P.getProcess(e);t.execute(a,function(e){e&&e.modifyApplication&&(console.log("# Application을 수정함 : ",e),J.setMessage("Application 상태를 저장하였습니다."),n&&n(e))},null,r)}},newProject:function(e){var n=h.getProcess();t.execute(n,function(t){return t&&t.newProject?(console.log("# 프로젝트 생성 : ",t),J.setMessage("새로운 프로젝트가 생성되었습니다.",i.INFO,s.SUCCESS),e&&e(t),void Q.close(pe.busyDelayTime)):void J.setMessage("새로운 프로젝트가 생성이 취소되었습니다.",i.ERROR,s.FAIL)})},openProject:function(e,n){var r=new o(e),a=_.getProcess(r);t.execute(a,function(e){if(!e||!e.openProject)return void J.setMessage("프로젝트 불러오기가 취소되었습니다.",i.ALERT,s.FAIL);var t=e.openProject.getResponse().project;return t?(console.log("# 프로젝트를 열기 : ",e),J.setMessage("새로운 프로젝트를 열었습니다.",i.INFO,s.SUCCESS),n&&n(e),void Q.close(pe.busyDelayTime)):void J.setMessage("프로젝트 불러오기가 취소되었습니다.",i.ALERT,s.FAIL)})},saveProject:function(e,n){var r=u.uid(),a=u.get(),c=a.value("savePath");e=angular.extend({path:c,project:r},e||{});var l=new o(e),d=E.getProcess(l);t.execute(d,function(e){return Q.close(),e&&e.saveProject?(console.log("# 프로젝트를 저장함 : ",e),J.setMessage("저장이 완료되었습니다.",i.INFO,s.SUCCESS),void(n&&n(e))):void J.setMessage("저장이 취소되었습니다.",i.ALERT,s.FAIL)})},saveAsProject:function(e,n){var r=u.uid();e=angular.extend({project:r},e||{});var a=new o(e),c=y.getProcess(a);t.execute(c,function(e){return Q.close(),e&&e.saveProject?(console.log("# 프로젝트를 새로 저장함 : ",e),J.setMessage("새 이름으로 저장이 완료되었습니다.",i.INFO,s.SUCCESS),void(n&&n(e))):void J.setMessage("새 이름으로 저장이 취소되었습니다.",i.ALERT,s.FAIL)})},closeProject:function(e){var n=u.uid(),r=new o({project:n}),a=$.getProcess(r);t.execute(a,function(t){return t&&t.closeProject?(console.log("# 프로젝트를 종료함 : ",t),J.setMessage("프로젝트를 종료하였습니다.",i.INFO,s.SUCCESS),e&&e(t),void Q.close(pe.busyDelayTime)):void J.setMessage("프로젝트 종료를 취소합니다.",i.ERROR,s.FAIL)},null,!0)},modifyProject:function(e,n,r){if(void 0===r&&(r=!0),e.data||e.assets){var a=u.uid();e.project||(e.project=a),e=new o(e);var c=C.getProcess(e);t.execute(c,function(e){return e&&e.modifyProject?(console.log("# 프로젝트를 수정함 : ",e),J.setMessage("프로젝트를 수정 하였습니다.",i.INFO,s.SUCCESS),void(n&&n(e))):void J.setMessage("프로젝트를 수정할 수 없습니다.",i.ERROR,s.FAIL)},null,r)}},addDocument:function(e,n){var r=new o(e),a=O.getProcess(r);t.execute(a,function(e){J.setMessage("새로운 문서가 생성되었습니다.",i.INFO,s.SUCCESS),n&&n(e),Q.close(pe.busyDelayTime)})},removeDocument:function(e,n){var r=!0,a=new o({document:e}),c=D.getProcess(a);t.execute(c,function(e){J.setMessage("문서가 삭제되었습니다.",i.INFO,s.SUCCESS),n&&n(e)},null,r)},selectDocument:function(e,n){var r=new o({document:e}),a=R.getProcess(r);t.execute(a,function(e){J.setMessage("문서가 선택되었습니다."),n&&n(e),Q.close(pe.busyDelayTime)})},moveDocument:function(e,n,r){var a=new o({document:e,position:n}),i=x.getProcess(a);t.execute(i,function(e){var t="페이지 순서가 변경되었습니다.";J.setMessage(t),r&&r(e)})},modifyDocument:function(e,n){var r=new o(e),a=T.getProcess(r);return a?void t.execute(a,function(e){if(!e||!e.modifyDocument)return void J.setMessage("문서 수정이 취소되었습니다.",i.ERROR,s.FAIL);var t=e.modifyDocument.getResponse().document;console.log("#  속성 : ",t),J.setMessage("문서 속성이 변경되었습니다."),n&&n(e)}):void(e._nothing&&e._nothing())},undo:function(e){var n=p.get().undo();t.execute(n,function(t){var n="UNDO 기능이 실행되었습니다.";J.setMessage(n),e&&e(t)})},redo:function(e){var n=p.get().redo();t.execute(n,function(t){var n="REDO 기능이 실행되었습니다.";J.setMessage(n),e&&e(t)})},getCopyList:function(){var e=m.get();if(!(e.getLength()<1)){var t=e.get();return t.forEach(function(e,n){t[n]={element:e}}),t}},copy:function(e){if(!c.isBusy()){var n=this.getCopyList();if(n){var r=new o({document:l.uid(),elements:n}),a=K.getProcess(r);t.execute(a,function(t){q.message("복사되었습니다.",{delay:q.SHORTEST}),e&&e(t)})}}},cut:function(e){if(!c.isBusy()){var n=this.getCopyList();if(n){var r=new o({document:l.uid(),elements:n}),a=H.getProcess(r);t.execute(a,function(t){q.message("복사되었습니다.",{delay:q.SHORTEST}),e&&e(t)})}}},paste:function(e,n){if(!c.isBusy()){var r=u.get();if(r){var a=r.copyPasteData();if(a){var i=new o({document:l.uid(),config:e}),s=W.getProcess(i);t.execute(s,function(e){J.setMessage("붙여넣기 적용되었습니다."),n&&n(e),Q.close(pe.busyDelayTime)})}}}},installTemplate:function(e){t._useCallStackProcess=!1;var n=new o({ignoreBackup:!0}),r=ae.getProcess(n);t.execute(r,function(n){t._useCallStackProcess=!0,e&&e(n)})},exportTemplate:function(e,n){if(!a.versionLimitMessage("템플릿 만들기")){e=e||{},e.document=e.document||l.uid();var r=new o(e),c=ie.getProcess(r);t.execute(c,function(e){var t,o,r=e.exportTemplate;r?r.error?(t="템플릿 내보내기(Export) 작업이 취소되었습니다.",o=r.error,a.alert({modal:!0,title:"내보내기 취소",content:o,ok:"확인"}),J.setMessage(t,i.ERROR,s.FAIL)):(t="템플릿이 Export 되었습니다.",o=e.exportTemplate.getResponse(),J.setMessage(t,i.INFO,s.SUCCESS),q.message(t)):(t="템플릿 내보내기(Export) 작업이 취소되었습니다.",J.setMessage(t,i.ALERT,s.SUCCESS)),console.debug("exportTemplate 실행 종료 : ",o),n&&n(o),Q.close(pe.busyDelayTime)})}},importTemplate:function(e,n){if(!a.versionLimitMessage("템플릿 불러오기")){e=e||{};var r=new o(e),c=se.getProcess(r);t.execute(c,function(e){var t,o,r=e.importTemplate;r?r.error?(t="템플릿 불러오기(Import) 작업이 취소되었습니다.",o=r.error,a.alert({modal:!0,title:"불러오기 취소",content:o,ok:"확인"}),J.setMessage(t,i.ERROR,s.FAIL)):(t="템플릿이 등록되었습니다.",o=r.getResponse(),J.setMessage(t,i.INFO,s.SUCCESS),q.message(t)):(t="템플릿 불러오기(Import) 작업이 취소되었습니다.",J.setMessage(t,i.ALERT,s.SUCCESS)),console.log("# importTemplate 실행 종료 : ",o),n&&n(o),Q.close(pe.busyDelayTime)})}},insertTemplate:function(e,n){if(!a.versionLimitMessage("템플릿 삽입하기")){e=e||{};var r=new o(e),c=le.getProcess(r);t.execute(c,function(e){var t,o,r=e.insertTemplate;r?r.error?(t="템플릿이 페이지에 적용되지 않았습니다.",J.setMessage(t,i.ERROR,s.FAIL),q.message(t)):r.getResponse?(t="템플릿이 적용된 새로운 페이지가 추가되었습니다.",o=r.getResponse(),J.setMessage(t,i.INFO,s.SUCCESS)):(t="템플릿 적용이 취소되었습니다.",J.setMessage(t,i.ERROR,s.FAIL),q.message(t)):(t="템플릿 적용이 취소되었습니다.",J.setMessage(t,i.ALERT,s.SUCCESS)),n&&n(o),Q.close(pe.busyDelayTime)})}},deleteTemplate:function(e,n){if(!a.versionLimitMessage("템플릿 삭제")){e=e||{};var r=new o(e),c=ce.getProcess(r);t.execute(c,function(e){var t,o,r=e.deleteTemplate;r?r.error?(t="템플릿 페이지가 정상적으로 삭제되지 않았습니다.",J.setMessage(t,i.ERROR,s.FAIL),q.message(t)):r.getResponse?(t="템플릿이 삭제되었습니다.",o=r.getResponse(),J.setMessage(t,i.INFO,s.SUCCESS)):(t="템플릿 페이지가 정상적으로 삭제되지 않았습니다.",J.setMessage(t,i.ERROR,s.FAIL),q.message(t)):(t="템플릿 삭제 작업이 취소되었습니다.",J.setMessage(t,i.ALERT,s.SUCCESS)),n&&n(o),Q.close(pe.busyDelayTime)})}},installComponent:function(e){t._useCallStackProcess=!1;var n=new o({ignoreBackup:!0}),r=ne.getProcess(n);t.execute(r,function(n){t._useCallStackProcess=!0,e&&e(n)})},exportComponent:function(e,n){function r(e,r){if(e)return console.log("편집 취소 (or 에러) : ",e),J.setMessage("컴포넌트 내보내기(Export) 작업이 취소되었습니다.",i.ALERT,s.SUCCESS),void(n&&n(e));console.log("# 편집 결과 : ",r);var c=new o(r),u=oe.getProcess(c);t.execute(u,function(e){var t,o,r=e.exportComponent;r?r.error?(t="컴포넌트 내보내기(Export) 작업이 취소되었습니다.",o=r.error,a.alert({modal:!0,title:"내보내기 취소",content:o,ok:"확인"}),J.setMessage(t,i.ERROR,s.FAIL)):(t="컴포넌트가 Export 되었습니다.",o=e.exportComponent.getResponse(),J.setMessage(t,i.INFO,s.SUCCESS)):(t="컴포넌트 내보내기(Export) 작업이 취소되었습니다.",J.setMessage(t,i.ALERT,s.SUCCESS)),console.debug("exportComponent 실행 종료 : ",o),n&&n(o),Q.close(pe.busyDelayTime)})}a.versionLimitMessage("컴포넌트 내보내기")||(e=e||{},!e.components||e.components.length<1?z.open({template:'<div jj-export-component-dialog-box popup-dialog config="config">'},r):r(null,e))},importComponent:function(e,n){if(!a.versionLimitMessage("컴포넌트 불러오기")){e=e||{};var r=new o(e),c=re.getProcess(r);t.execute(c,function(e){var t,o,r=e.importComponent;r?r.error?(t="컴포넌트 불러오기(Import) 작업이 취소되었습니다.",o=r.error,J.setMessage(t,i.ERROR,s.FAIL),a.alert({modal:!0,content:o,title:"불러오기 취소",ok:"예"})):(o=r.getResponse(),t=o.component&&o.component.length>0?"컴포넌트가 등록되었습니다.":"등록할 컴포넌트가 없습니다.",J.setMessage(t,i.INFO,s.SUCCESS)):(t="컴포넌트 불러오기(Import) 작업이 취소되었습니다.",J.setMessage(t,i.ALERT,s.SUCCESS)),console.log("# importComponent 실행 종료 : ",o),n&&n(o),Q.close(pe.busyDelayTime)})}},createComponent:function(e,n){if(!a.versionLimitMessage("컴포넌트 만들기")){var r=this.getCopyList();if(!r)return void(n&&n("선택된 아이템이 없습니다.<br>화면에서 등록할 아이템을 먼저 선택해 주세요"));e.elements=r;var c=new o(e),u=Y.getProcess(c);t.execute(u,function(e){var t;if(!e||!e.createComponent||!e.createComponent.getResponse){var o="컴포넌트가 등록되지 않았습니다.";return void J.setMessage(o,i.ERROR,s.FAIL)}var o="컴포넌트가 등록되었습니다.";J.setMessage(o,i.INFO,s.SUCCESS),t=e.createComponent.getResponse(),n&&n(null,t)})}},modifyComponent:function(e,n){if(!a.versionLimitMessage("컴포넌트 이름 변경")&&e){console.log("# modifyComponent : ",e);var r=new o(e),c=te.getProcess(r);t.execute(c,function(e){var t;if(!e||!e.modifyComponent||!e.modifyComponent.getResponse){var o="컴포넌트가 정상적으로 수정되지 않았습니다.";return void J.setMessage(o,i.ERROR,s.FAIL)}var o="컴포넌트가 수정되었습니다.";J.setMessage(o,i.INFO,s.SUCCESS),t=e.modifyComponent.getResponse(),n&&n(null,t)})}},insertComponent:function(e,n){if(e&&e.document&&e.component){console.log("# insertComponent : ",e);var r=new o(e),a=ee.getProcess(r);t.execute(a,function(e){var t,o;e.insertComponent&&e.insertComponent.getResponse?(t="컴포넌트가 페이지에 추가되었습니다.",o=e.insertComponent.getResponse(),J.setMessage(t,i.INFO,s.SUCCESS)):(t="컴포넌트 삽입 작업이 취소되었습니다.",J.setMessage(t,i.ALERT,s.SUCCESS)),n&&n(null,o),Q.close(pe.busyDelayTime)})}},deleteComponent:function(e,n){if(!a.versionLimitMessage("컴포넌트 삭제")&&e&&e.remove&&!(e.remove.length<1)){console.log("# deleteComponent : ",e);var r=new o(e),c=Z.getProcess(r);t.execute(c,function(e){var t,o,r=e.deleteComponent;r&&r.getResponse?(t="컴포넌트가 삭제되었습니다.",o=r.getResponse(),J.setMessage(t,i.INFO,s.SUCCESS)):(t="컴포넌트 삭제 작업이 취소되었습니다.",J.setMessage(t,i.ALERT,s.SUCCESS)),q.message(t),n&&n(null,o)})}},addElement:function(e,n){var r=new o(e),a=A.getProcess(r);t.execute(a,function(e){J.setMessage("새로운 요소가 추가되었습니다."),n&&n(e)})},selectElement:function(e,n){e.document=e.document||l.uid();var r=e.document,a=m.get(r),i=a.compare(e.selects);if(!i){var s=new o(e),c=I.getProcess(s);t.execute(c,function(e){if(e&&e.selectElement){var t=e.selectElement.getResponse().selects;J.setMessage(t&&t.length>0?"새로운 요소가 선택되었습니다.":"선택된 요소가 없습니다."),n&&n(e)}})}},modifyElement:function(e,n){var r=new o(e),a=S.getProcess(r);return a?void t.execute(a,function(e){if(e&&e.modifyElement){var t=e.modifyElement.getResponse().elements;console.log("#  속성 : ",t),J.setMessage("요소 속성이 변경되었습니다.")}n&&n(e)}):void(e._nothing&&e._nothing())},removeElement:function(e,n){var r=new o(e),a=M.getProcess(r);t.execute(a,function(e){if(e&&e.removeElement){var t=e.removeElement.getResponse().elements;console.log("#  속성 : ",t),J.setMessage("요소 속성이 변경되었습니다.")}n&&n(e)})},indexElement:function(e,n){var r=new o(e),a=N.getProcess(r);t.execute(a,function(e){if(e&&e.indexElement){var t=e.indexElement.getResponse().elements;console.log("#  속성 : ",t),J.setMessage("요소 속성이 변경되었습니다.")}n&&n(e)})},openEditElement:function(e,n){var r=new o(e),a=U.getProcess(r);t.execute(a,function(e){J.setMessage("ESC 키 또는 배경을 클릭하여 요소 편집을 종료 할수 있습니다."),n&&n(e)})},closeEditElement:function(e,n){if(me.inputFocused())return void me.inputFocused(!1);if(me.isMenuOpened()){var r=me.getCurrentEditor();return void me.closeMenu(r)}var a=new o(e),i=U.getProcess(a);t.execute(i,function(e){J.setMessage("요소 편집을 종료합니다."),n&&n(e)})},maskElementBoundary:function(e,n){var r=new o(e),a=k.getProcess(r);t.execute(a,function(e){J.setMessage("내용물 기준으로 위치, 크기를 재설정 하였습니다."),n&&n(e)})},preview:function(e){var n=u.uid(),r=new o({project:n,publishType:{preview:!0}});J.setMessage("미리보기",i.ALERT,s.PROCESS),t._allowStatus=!0;var a=w.getProcess(r);t.execute(a,function(n){t._allowStatus=!1,console.log(n);var o="미리보기가 종료되었습니다.";J.setMessage(o),e&&e(n)})},publish_viewer:function(e){var n=u.uid(),r=new o({project:n,publishType:{web:!0}});J.setMessage("출판하기",i.ALERT,s.PROCESS),t._allowStatus=!0;var a=w.getProcess(r);t.execute(a,function(n){t._allowStatus=!1,console.log(n);var o=n.publishPath?"미리보기가 실행되었습니다.":"미리보기가 취소되었습니다.";J.setMessage(o),Q.close(),e&&e(n)})},publish:function(e,n){var r=u.uid();e=angular.extend({project:r},e||{}),J.setMessage("출판하기",i.ALERT,s.PROCESS),t._allowStatus=!0;var c=this,l=new o(e),d=b.getProcess(l);t.execute(d,function(e){t._allowStatus=!1;var o=l.getParam("publishType");if("publishSetting"===o)return void c.publishSetting();console.log("result: ",e);var r=e.publishPath?"출판이 완료되었습니다.":"출판이 취소되었습니다.";return J.setMessage(r),Q.close(),e.publishPath?void a.open({isTop:!0,templateUrl:"popup/publish-result.html",controller:["$scope","$notice",function(t,n){t.close=function(e){n.close()},t.config={isTop:!0,title:"출판 결과",yes:"확인",result:e.publishType},t.explorer=function(e){de.explorer(e,function(e,t){})},t.$on("$destroy",function(){t.config=null})}]}).then(function(t){n&&n(e)},function(){n&&n(e)}):void(n&&n(e))})},modifyAsset:function(e,n){var r=new o(e),a=j.getProcess(r);t.execute(a,function(e){console.log(e),n&&n(e)})},createGroup:function(e,n){var r=new o(e),a=B.getProcess(r);t.execute(a,function(e){console.log(e),n&&n(e)})},removeGroup:function(e,n){var r=new o(e),a=V.getProcess(r);t.execute(a,function(e){console.log(e),n&&n(e)})},modifyGroup:function(e,n){var r=new o(e),a=G.getProcess(r);return a?void t.execute(a,function(e){if(e&&e.modifyGroup){var t=e.modifyGroup.getResponse().groups;console.log("#  속성 : ",t),J.setMessage("Group 속성이 변경되었습니다.")}n&&n(e)}):void(e._nothing&&e._nothing())},moveEditGroup:function(e,n){var r=new o(e),a=L.getProcess(r);t.execute(a,function(e){J.setMessage("그룹 편집을 종료합니다."),n&&n(e)})},changeIndexedPosition:function(e,n){var r=new o(e),a=F.getProcess(r);t.execute(a,function(e){J.setMessage("index 위치가  변경되었습니다.",i.INFO,s.SUCCESS),n&&n(e)})},exit:function(e){v.onExit(null,e)},importDocuments:function(e){function n(e){z.open({pageImportType:e,template:'<div jj-import-pages popup-dialog config="config">'},r)}function r(n,r){if(!n)return void Q.close();var a=new o({pages:n,paper:r.paper}),c=g.getProcess(a);t.execute(c,function(t){J.setMessage("변환된 문서가 추가되었습니다.",i.INFO,s.SUCCESS),Q.close(pe.busyDelayTime),e&&e(t)})}var c={escKey:function(){},enterKey:function(){}};a.open({isTop:!0,templateUrl:"popup/import-confirm.html",controller:["$scope","$notice",function(e,t){e.close=function(e){t.close(e),e&&n(e)},e.config={title:"페이지 유형 선택",closeButton:!0},e.$on("$destroy",function(){e.config=null}),c.escKey=function(){console.error("취소: escKey")},c.enterKey=function(){console.error("취소: enter")}}],_scope:c})},publishSetting:function(e){function t(t,o){return t?void console.log("편집 결과 : ",t):(console.log("# 편집 결과 : ",o),void n.modifyProject(o,function(t){console.log("# 출판 정보를 수정함 : ",t),J.setMessage("출판 정보를 수정 하였습니다."),e&&e(t)}))}var n=this;z.open({template:'<div jj-publish-setting-dialog-box popup-dialog config="config">'},t)},contentEditor:function(e){function t(t,o){if(t)return void console.log("편집 결과 : ",t);console.log("# 결과 : ",o);var r={data:{navigation:o}};n.modifyProject(r,function(t){console.log("# 목차를 수정함 : ",t),J.setMessage("목차를 수정 하였습니다."),e&&e(t)})}var n=this;z.open({template:'<div jj-content-editor-dialog-box popup-dialog config="config">'},t)}});return fe}var t=MODULE.core.instance;t.factory("CommandControllerService",e),e.$inject=["$superClass","$command","CommandName","CommandParam","$timeout","$notice","MessageType","StatusIcon","$applications","$projects","$documents","$elements","$history","$selects","$newApplicationMacro","$exitApplicationMacro","$importDocumentMacro","$newProjectMacro","$openProjectMacro","$closeProjectMacro","$saveProjectMacro","$saveAsProjectMacro","$modifyApplicationMacro","$previewProjectMacro","$publishProjectMacro","$modifyProjectMacro","$addDocumentMacro","$modifyDocumentMacro","$removeDocumentMacro","$selectDocumentMacro","$indexDocumentMacro","$addElementMacro","$modifyElementMacro","$removeElementMacro","$selectElementMacro","$indexElementMacro","$modifyAssetMacro","$groupEditableMacro","$elementEditableMacro","$maskElementBoundaryMacro","$indexedPositionMacro","$addGroupMacro","$removeGroupMacro","$modifyGroupMacro","$copyElementMacro","$cutElementMacro","$pasteElementMacro","$status","$import","$busy","$toast","$capture","$createComponentMacro","$deleteComponentMacro","$insertComponentMacro","$modifyComponentMacro","$installComponentMacro","$exportComponentMacro","$importComponentMacro","$installTemplateMacro","$exportTemplateMacro","$importTemplateMacro","$deleteTemplateMacro","$modifyTemplateMacro","$insertTemplateMacro","$externalAPI","Default","$richEditor"]}(),function(){function e(e,t){var n=e.extend("ExitApplicationCommand",{_run:function(e,n){var o=this._process.params,r=o.getParam("application")||t.uid();o.setResponse({application:r}),console.log("# Application 데이터 삭제됨 : ",o),this._success(o,e,n)}});return n}var t=MODULE.core.instance;t.factory("ExitApplicationCommand",e),e.$inject=["CommandBase","$applications"]}(),function(){function e(e,t){var n=e.extend("ModifyApplicationCommand",{_run:function(e,n){{var o=this._process.params,r=o.getParam("data");t.modify(r)}o.setResponse({}),console.log("# Application 데이터 수정 : ",o),this._success(o,e,n)}});return n}var t=MODULE.core.instance;t.factory("ModifyApplicationCommand",e),e.$inject=["CommandBase","$applications"]}(),function(){function e(e,t){var n=e.extend("NewApplicationCommand",{_run:function(e,n){
var o=this._process.params,r=o.getParam("application"),a=o.getParam("data"),i=t.create(r,a),s=i.uid();o.setResponse({application:s}),console.log("# 새로운 Application 데이터 생성 : ",s),this._success(o,e,n)}});return n}var t=MODULE.core.instance;t.factory("NewApplicationCommand",e),e.$inject=["CommandBase","$applications"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){var m=e.extend("UpdateApplicationCommand",{_run:function(e,m,f){function v(e){function o(o){if(!o)return console.log("# 경로가 지정되지 않았습니다."),void e({message:"설치 경로가 지정되지 않았습니다. 작업을 취소합니다."});C=n.normalize(o);var r=c.path.parse(_).name;P=c.path.join(C,r);var a=n.TEMP_ROOT_MARKER+n.workspacePrefix+n.UPDATER;w=n.pathToActual(a)+"/_"+r,T=function(){var e=C.charAt($.length),t=0===C.indexOf($);return t=t&&(C.length===$.length||"/"===e||"\\"===e)}(),t.exist(P,function(t){O=t,e(null,C)})}var r=C||n.pathToActual(n.APP_ROOT_MARKER);r=d.resolve(r,"../"),t.getSaveAsInformation({workingDir:r,directoryDesc:b+" 버전을 설치할 폴더를 선택하세요.",isDirectory:!0},o)}var g=this._process.params,h=g.getParam("uninstallFolder"),_=g.getParam("installFile"),$=n.pathToActual(n.APP_ROOT_MARKER),E=this,y=[];l.exitHack("업데이트 설치를 완료한 후 종료하시기 바랍니다.");var P,w,b=g.getParam("versionName"),C=g.getParam("installFolder"),O=!1,T=!1;y.push(function(e){return C?e():void v(function(t){return t?void e({message:t.message,error:t.error}):void e()})}),y.push(function(e){function t(e){return T?void n(e):c?void e():void r(e)}function n(e){var n="선택한 폴더는 현재 실행중인 버전의 폴더입니다.",r="선택한 폴더에 새 버전을 설치할 수 없습니다.<br>다른 폴더를 선택해 주시기 바랍니다.";o.open({templateUrl:"updater/path-confirm.html",isTop:!0,controller:["$scope","$notice",function(e,t){e.uiSet={modal:!0,closeButton:!1,title:"실행중인 폴더",content1:p.trustAsHtml(n),pathString:P,content2:p.trustAsHtml(r),cancel:"취소",pathButton:"다시 선택"},e.getFolder=function(){c=!1,v(function(t){e.uiSet.pathString=P,t||e.close(1)})},e.close=function(e){t.close(e)},e.$on("$destroy",function(){e.uiSet=null})}]}).then(function(n){n>0?t(e):i(e)},function(t){a(t,e)})}function r(e){var n,r,u;O?(n="중복 설치 폴더",r="선택한 폴더에 설치할 업데이트 버전의 이름을 가진 폴더가 있습니다.",u="설치를 계속할 경우 폴더내 모든 파일이 지워집니다.<br>설치를 계속하시겠습니까?"):(n="설치 폴더 확인",r="다음 위치에 새로운 버전을 설치합니다.",u="설치를 계속하시겠습니까?"),o.open({templateUrl:"updater/path-confirm.html",isTop:!0,controller:["$scope","$notice",function(e,t){e.uiSet={modal:O,closeButton:!1,title:n,content1:p.trustAsHtml(r),pathString:P,content2:p.trustAsHtml(u),cancel:"아니오",ok:"예",pathButton:"다시 선택"},e.getFolder=function(){c=!1,v(function(t){e.uiSet.pathString=P,t||e.close(0)})},e.close=function(e){t.close(e)},e.$on("$destroy",function(){e.uiSet=null})}]}).then(function(n){n>0?(c=!0,s(function(){t(e)})):0===n?s(function(){t(e)}):i(e)},function(t){a(t,e)})}function a(e,t){i(t)}function i(e){var t="업데이트 작업이 취소되었습니다.";e({message:t,error:t})}var c=!1;t(function(t){return t?e(t):void e()})}),y.push(function(e){r.setMessage("업데이트 파일을 압축 해지합니다.",a.WARN,i.WAIT);var n="_updateDecompressProcess";window[n]=function(e,t,n){1===arguments.length?u.message("업데이트 설치 시작"):u.progress(e,t,"업데이트 파일 설치중...")};var o={uninstallFolder:h,onProgress:n,installFile:_,installFolder:P,tempInstallFolder:w};t.updateInstall(o,function(t,o){delete window[n],u.message("잠시만 기다려 주세요."),r.setMessage("업데이트 작업을 종료합니다.",a.WARN,i.PROCESS),e(t,o)})}),async.waterfall(y,function(t,n){return u.close(),l.exitHack(),console.log("# 업데이트 설치 요청 결과 : ",n),t?E._error(t,e,m):(g.setResponse(n),void s(function(){E._success(g,e,m)},1e3))})}});return m}var t=MODULE.core.instance;t.factory("UpdateApplicationCommand",e),e.$inject=["CommandBase","$externalAPI","FileSystem","$notice","$status","MessageType","StatusIcon","$timeout","$nativeInterface","$busy","$exitApplicationMacro","$node_path","$sce"]}(),function(){function e(e,t,n,o,r,a){var i=a.TEMP_ROOT_MARKER+a.WORK_SPACE_MARKER+a.PROJECT_SPACE_MARKER,s=i+a.TEMP,c=i+a.WORK,u={WORK_ASSET_IMAGES_FOLDER:c+a.OPS+a.IMAGES,WORK_ASSET_MEDIA_FOLDER:c+a.OPS+a.MEDIA,WORK_ASSET_MASTER_THUMBNAIL_FOLDER:c+a.OPS+a.IMAGES_MASTER_THUMB,WORK_ASSET_MASTER_FOLDER:c+a.OPS+a.IMAGES_MASTER,WORK_ASSET_COVER_FOLDER:c+a.OPS+a.IMAGES_COVER,WORK_ASSET_CUSTOM_FOLDER:c+a.OPS+a.CUSTOM},l=e.extend("AddAssetCommand",{_run:function(e,a){function i(){l.setResponse({asset:m}),console.log("# 새로운 Asset 데이터 추가 : ",m,l),O._success(l,e,a)}var l=this._process.params,d=l.getParam("project"),p=l.getParam("document");if(!d&&!p)throw new Error("document (또는 project) uid가 지정되지 않았습니다.");var m=l.getParam("asset"),f=l.getParam("data")||{},v=l.getParam("_ignoreAssetCounter")||!1,g=l.getParam("_replaceAssetFile")||!1,h=l.getParam("useTempFile"),_=l.getParam("_copyedElementAsset")||!1,$=l.getParam("_replaceElementAsset")||!1,E=l.getParam("_movedElementAsset");delete f._counter;var y=l.getParam("needToCopy");y!==!1&&(y=!0);var P=n.add(m);$&&P.counter(-1),m=P.uid();var w=f.path,b=P.isURL(w);if(w&&!b)if(w in u)w=f.path=u[w]+"/"+m+"."+f.type;else for(var C in u)0===w.indexOf(C)&&(w=f.path=w.replace(C,u[C]));n.modify(m,f,!0),console.info("# Asset 등록 : ",m,f),console.info("# Asset 복사 : ",y);var O=this;if(v||$||(d&&o.get(d).addAsset(m),p&&r.get(p).addAsset(m)),g||$);else{var T=n.get(m).counter();if(T>1)return i()}if(w&&!b&&y){var D=f.original;if(!D||!w)throw new Error("등록할 Asset의 파일을 복사할 수 없습니다.");if(h){var R=w;if(console.log("# 파일 예상 현위치(asset) : ",R),$)console.log("# 파일 이동 없음"),i();else{if(0!==R.indexOf(c))throw new Error("삭제할 파일 경로가 WORK_FOLDER로 시작되지 않습니다.");D=R.replace(c,s),console.log("# 파일 현위치(asset) : ",D),console.log("# 파일 복사(asset) : ",w),t.move([{src:D,dest:w}],function(e){e&&console.error(e),i()})}}else D===w?i():_?(console.log("# 파일 원본(asset) : ",D),console.log("# 이미 파일이 카피된 상태임 : ",w),i()):E?(console.log("# 파일 원본(asset) : ",E),console.log("# 파일 이동(asset) : ",w),t.move([{src:E,dest:w}],function(e){e&&console.error(e),i()})):(console.log("# 파일 원본(asset) : ",D),console.log("# 파일 복사(asset) : ",w),t.copy(D,w,function(e){e&&console.error(e),i()}))}else i()}});return l}var t=MODULE.core.instance;t.factory("AddAssetCommand",e),e.$inject=["CommandBase","$externalAPI","$assets","$projects","$documents","FileSystem"]}(),function(){function e(e,t){var n=e.extend("ModifyAssetCommand",{_run:function(e,n){var o=this._process.params,r=o.getParam("asset"),a=o.getParam("data"),i=t.modify(r,a),s=i.uid();o.setResponse({asset:s}),console.log("# Asset 데이터 수정 : ",o),this._success(o,e,n)}});return n}var t=MODULE.core.instance;t.factory("ModifyAssetCommand",e),e.$inject=["CommandBase","$assets"]}(),function(){function e(e,t,n,o,r,a){var i=a.TEMP_ROOT_MARKER+a.WORK_SPACE_MARKER+a.PROJECT_SPACE_MARKER,s={TEMP_FOLDER:i+a.TEMP,WORK_FOLDER:i+a.WORK},c=e.extend("RemoveAssetCommand",{_run:function(e,a){function i(){c.setResponse({asset:d}),console.log("# Asset 데이터 삭제됨 : ",d,c),_._success(c,e,a)}var c=this._process.params,u=c.getParam("project"),l=c.getParam("document");if(!u&&!l)throw new Error("document uid가 지정되지 않았습니다.");var d=c.getParam("asset"),p=c.getParam("isClear")||!1,m=c.getParam("_ignoreAssetCounter")||!1,f=c.getParam("_counter");isNaN(f)&&(f=1);var v,g,h=t.get(d);h&&(v=h.getNoneCopyValue("path"),g=h.isURL(v),console.log("# Asset 제거 : ",d,h));var _=this;if(m||(u&&o.get(u).removeAsset(d),l&&r.get(l).removeAsset(d)),f>1&&h.counter(1-f),h){var $=h.counter()-1;if($>0)return console.log("# 아직 사용중인 Asset 입니다. 파일 삭제하지 않습니다."),t.remove(d),i()}if(t.remove(d),!v)return console.error("삭제할 Asset 파일을 찾을 수 없습니다.(asset 카운팅이 지원되지 않은 이전 버전에 작성된 jik 파일일 가능성이 있습니다.)"),i();if(g)return i();if(console.debug("# 파일 위치(asset) : ",v),0!=v.indexOf(s.WORK_FOLDER))throw new Error("삭제할 파일 경로가 WORK_FOLDER로 시작되지 않습니다.");if(p)console.debug("# 파일 완전히 삭제(asset) : ",v),n.remove({path:v},null,function(e){e&&console.error(e),i()});else{var E=v.replace(s.WORK_FOLDER,s.TEMP_FOLDER);console.debug("# 파일 이동(asset) : ",E),n.move([{src:v,dest:E}],function(e){e&&console.error(e),i()})}}});return c}var t=MODULE.core.instance;t.factory("RemoveAssetCommand",e),e.$inject=["CommandBase","$assets","$externalAPI","$projects","$documents","FileSystem"]}(),function(){function e(e,t,n,o,r,a){function i(e,t){var n=t.getParam("name"),o=t.getParam("schemaLock"),r=t.getParam("groupLock"),a=t.getParam("userVersion"),i=t.getParam("creator");e.name=n,e.userVersion=a,e.creator=i;for(var s in e.groups){var c=e.groups[s];c.capsule||(c.capsule={schema:[],values:{},schemaLock:!1,groupLock:!1});var u=c.capsule;u.schema&&u.schema.length>0&&(u.schemaLock||(u.schemaLock=o),u.groupLock||(u.groupLock=r))}}function s(e){if(e)for(var t in e)a.add(t)}var c=e.extend("CreateComponentCommand",{_run:function(e,a){function c(t){u.setResponse(t.add),console.log("# 등록 응답 : ",t),h._success(u,e,a)}var u=this._process.params,l=u.getParam("elements"),d=t.createUID(),p=n.get(l,d);i(p,u);var m=t.add(d,p);console.debug("# 컴포넌트 데이터 : ",m.$$_original);var f={};f[d]=m.$$_original;var v=r.pathMarkerInfo(),g={pathInfo:v,add:[{dataName:"component",folder:r.USER_DATA_COMPONENT_MARKER,content:f}]},h=this;o.component(g,function(e,t){if(e&&console.error("# user data 쓰기 에러 : ",e),t.add&&t.add.length>0)for(var n in t.add){var o=t.add[n];if("component"===o.dataName){var r=o.content;s(r)}}c(t)})}});return c}var t=MODULE.core.instance;t.factory("CreateComponentCommand",e),e.$inject=["CommandBase","$components","$copyData","$externalAPI","FileSystem","$contentComponentSetting"]}(),function(){function e(e,t,n,o){var r=e.extend("DeleteComponentCommand",{_run:function(e,r){function a(e){!e||e.length<1||e.forEach(function(e){var n=e.files?e.files[0]:"";if(n)o.remove(n);else{var r=e.folder.replace(t.USER_DATA_COMPONENT_MARKER,""),a=o.getSetting();for(var i in a){var s=a[i],c=o.compareCategory(r,s.categoryPath);c>=0&&o.remove(i)}}})}function i(t){s.setResponse(t.remove),console.log("# 등록 응답 : ",t),p._success(s,e,r)}var s=this._process.params,c=s.getParam("remove"),u=t.pathMarkerInfo(),l=function(){var e=t.USER_DATA_COMPONENT_MARKER,n=c.map(function(t){var n,r,a=t.uid;if(a){var i=o.getSetting(a);r=i.categoryPath,n={folder:e+r,files:[a,"asset-"+a]}}else r=t.category,n={folder:e+r};return n});return n}(),d={pathInfo:u,remove:[{dataName:"component",folder:t.USER_DATA_COMPONENT_MARKER,content:l}]};a(l);var p=this;n.component(d,function(e,t){if(e&&console.error("# user data 쓰기 에러 : ",e),t.remove&&t.remove.length>0)for(var n in t.remove){var o=t.remove[n];"component"===o.dataName}i(t)})}});return r}var t=MODULE.core.instance;t.factory("DeleteComponentCommand",e),e.$inject=["CommandBase","FileSystem","$externalAPI","$contentComponentSetting"]}(),function(){function e(e,t,n,o,r,a,i,s,c){var u=e.extend("ExportComponentCommand",{_run:function(e,t){var n=this._process.params,o=n.getParam("components"),i=n.getParam("category"),c=n.getParam("path");if(!c)throw new Error("저장할 경로가 지정되지 않았습니다.");var u,l=[],d=this;l.push(function(e){s.message("컴포넌트 내보내는 중..."),u={category:i,components:o},e()}),l.push(function(e){var t=r.pathMarkerInfo(),n={pathInfo:t,exporter:[{dataName:"component",folder:r.USER_DATA_COMPONENT_MARKER,content:u,compress:c}]};a.component(n,function(t,n){t&&console.error("# 컴포넌트 Export 에러 : ",t);var o=n.exporter;console.log("# 컴포넌트 데이터 (== exportData) : ",o[0].content),e()}),e()}),async.waterfall(l,function(o){n.setResponse({data:u}),console.log("# Export 응답 : ",u),d._success(n,e,t)})}});return u}var t=MODULE.core.instance;t.factory("ExportComponentCommand",e),e.$inject=["CommandBase","$projects","$exportTemplateData","Process","FileSystem","$externalAPI","$thumbnail","$busy","$verification"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f){var v=e.extend("ImportComponentCommand",{_run:function(e,o){function p(e){var t={path:r.USER_DATA_COMPONENT_MARKER+"/.temp"};a.remove(t,null,function(t){t&&console.error("임시 폴더 삭제 : ",t),e()})}var v=this._process.params,g=v.getParam("path");if(!g)throw new Error("불러올 대상(경로)이 지정되지 않았습니다.");var h,_=[],$=this,E=!1,y=!1;i.message("컴포넌트 불러오는 중..."),_.push(function(e){var t=r.pathMarkerInfo(),n={pathInfo:t,importer:[{dataName:"component",folder:t.virtual.component_user+"/.temp",decompress:g,content:void 0}]};a.component(n,function(t,n){var o=n.importer;if(o){var r=o[0].content;console.debug("# 컴포넌트 import 파일 : ",r)}e(null,r)})}),_.push(function(e,o){i.close(l.busyDelayTime);var r=c.userImport(e);if(!r){var a="컴포넌트를 불러올 수 없습니다.<br>데이터가 없거나 잘못된 파일 형식입니다.";return void o(a,null)}var s={conflict:[],add:[]};return r.forEach(function(e){var o=t.get(e.uid);if(o){var r=n.getSetting(e.uid),a=o.$$_original,i=e,c=JSON.parse(e.data);s.conflict.push({oldData:{name:a.name,version:n.parseVersionString(a.version),path:r.categoryPath},newData:{name:c.name,version:n.parseVersionString(c.version),path:i.categoryPath},item:e})}else s.add.push(e)}),s.conflict.length<1?o(null,s):void u.open({isTop:!0,templateUrl:"popup/componentConflict.html",controller:["$scope","$notice",function(e,t){e.close=function(e){t.close(e)},e.config={modal:!0,content:s.conflict,title:"컴포넌트 교체 알림",description:"이미 설치된 컴포넌트가 있습니다.<br>기존 설치된 컴포넌트를 삭제한 후 설치합니다. 아래 목록을 다시 설치하시겠습니까?",cancel:"취소",no:"건너뛰기",yes:"다시설치",closeButton:!1},e.$on("$destroy",function(){e.config=null})}]}).then(function(e){E=Boolean(e>0),y=0>e,s.conflict=s.conflict.map(function(e){return e.item}),o(null,s)},function(){o(null,s)})}),_.push(function(e,t){if(y)return t(null,e);if(i.message("컴포넌트를 설치합니다."),!E)return t(null,e);var n=new m({remove:e.conflict.map(function(e){return{uid:e.uid}})}),o=d.getProcess(n);o.useCommandStackCheck=!1,f.execute(o,function(n){console.log("충돌 컴포넌트 uninstall : ",n.deleteComponent._response[0].content),t(null,e)})}),_.push(function(e,t){if(y)return t(null,e);if(!e)return t(null,e);if(E&&(e.add=e.add.concat(e.conflict)),!e.add||e.add.length<1)return t(null,e);var n=e.add,o=n.map(function(e){var t={isCopy:!1,source:"/.temp"+e.categoryPath,dest:e.categoryPath,files:[e.uid,"asset-"+e.uid]};return t}),i=r.pathMarkerInfo(),s={pathInfo:i,move:[{dataName:"component",folder:r.USER_DATA_COMPONENT_MARKER,content:o}]};a.component(s,function(n,o){n&&console.error("# 컴포넌트 Move 에러 : ",n);var r=o.move;if(r){var a=r[0].content;console.debug("# 컴포넌트 Move 파일 : ",a)}t(null,e)})}),_.push(function(e,t){return y?t():!e.add||e.add.length<1?t():(i.message("컴포넌트를 등록합니다."),void s(function(){var n=e.add;n.forEach(function(e){c.setComponent(e)}),h=n,t()},100))}),async.waterfall(_,function(t){p(function(){return t?void $._error({error:t},e,o):y?void $._success(null,e,o):(v.setResponse({component:h}),void $._success(v,e,o))})})}});return v}var t=MODULE.core.instance;t.factory("ImportComponentCommand",e),e.$inject=["CommandBase","$components","$contentComponentSetting","Process","FileSystem","$externalAPI","$busy","$timeout","$componentLoader","$notice","Default","$deleteComponentMacro","CommandName","CommandParam","$command"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f,v,g,h,_,$,E){function y(e){!function(e){for(var t in e){var n=e[t];if(m.isSubversion(n.version)){var o=new l(t);m.convert(n,o.$$_original),e[t]=o.$$_original}}}(e.elements),function(e){for(var t in e){var n=e[t];if(f.isSubversion(n.version)){var o=new d(t);if(f.convert(n,o.$$_original),"delete"==n._correct){delete e[t];continue}e[t]=o.$$_original}}}(e.groups),function(e){for(var t in e){var n=e[t];if(v.isSubversion(n.version)){var o=new p(t);v.convert(n,o.$$_original),e[t]=o.$$_original}}}(e.assets),console.debug("	* 데이터 버전 업데이트 : ",e,"\n")}var P=e.extend("InsertComponentCommand",{_run:function(e,l){function d(){h.message("컴포넌트 삽입...");var t=new u,n=new c(angular.copy(O)),o=s.define(i.ELEMENT_ADD,n).getProcess();t.add("insert",function(e,t){o.execute(function(t){e(t)})}),p(t,O),_(function(){t.execute(function(){T._success(m,e,l)})},0)}function p(e,t){e.add("responseProcess",function(e,n,o){var r=o.getResponse();r.addParam=t,m.setResponse(r),console.warn("# 데이터 붙여넣기 : ",m),e()})}var m=this._process.params,f=m.getParam("document"),v=m.getParam("component"),P=m.getParam("css");P={left:0,top:0,offsetX:P.left,offsetY:P.top};var w=t.get(v),b={indexes:w.value("indexes"),elements:w.value("elements"),groups:w.value("groups"),assets:w.value("assets"),boundary:w.value("boundary")};!function(){var e=$.getSetting(v),t=e.categoryPath,n=E.USER_DATA_COMPONENT_MARKER;for(var o in b.assets){var r=b.assets[o];if(0===r.path.indexOf(n)){var a=n+t;r.path=r.path.replace(n,a)}}}(),console.debug("\n\n# 컴포넌트 데이터 버전 호환성 체크.\n"),y(b);var C=n.get(b);C.document=f,C.component=v;var O=n.getElementParams(C,P);!function(e){var t=r.get().currentEditGroup(),n=t?a.get(t):o.get(),i=n.getNoneCopyValue("indexes").length;e.forEach(function(e,t){e.index=i+t})}(O.elements);var T=this,D=w.version();g.upgradabilityMessage(D,function(t){return t?void d():void T._error(null,e,l)})},_getRedoCommand:function(){var e=s.define(i.ELEMENT_ADD,this._redoParam);return e},_setRedoParam:function(e,t){var n=t.getResponse(),o=new c(n.addParam);return o},_getUndoCommand:function(){var e=s.define(i.ELEMENT_REMOVE,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),n=t.document,o=new c({document:n,elements:angular.copy(t.elements).reverse(),selects:t.oldSelectArray});return o}});return P}var t=MODULE.core.instance;t.factory("InsertComponentCommand",e),e.$inject=["HistoryCommandBase","$components","$pasteData","$documents","$selects","$groups","CommandName","$command","CommandParam","Process","ElementData","GroupData","AssetData","$subversion_element","$subversion_group","$subversion_asset","$openParser","$busy","$timeout","$contentComponentSetting","FileSystem"]}(),function(){function e(e,t,n,o,r){var a=e.extend("InstallComponentCommand",{_run:function(e,t){var a=this._process.params,i=this,s=new o,c=r.installed();s.add("bundleComponent",function(e,t){return c.bundle?void e():void r.bundle(function(){n(function(){r.installed("bundle",!0),e()},50)})}),s.add("userComponent",function(e,t){return c.user?void e():void r.user(function(){n(function(){r.installed("user",!0),e()},50)})}),s.execute(function(){i._success(a,e,t)})}});return a}var t=MODULE.core.instance;t.factory("InstallComponentCommand",e),e.$inject=["CommandBase","$templates","$timeout","Process","$componentLoader"]}(),function(){function e(e,t,n,o,r){var a=e.extend("ModifyComponentCommand",{_run:function(e,a){function i(e){!e||e.length<1||e.forEach(function(e){n.modify(e.uid,e.data)})}function s(e){!e||e.length<1||e.forEach(function(e){var t=e.files?e.files[0]:"";if(t){var o=e.dest,a=n.getSetting();a[t].categoryPath=o}else{var i=e.source.replace(r.USER_DATA_COMPONENT_MARKER,""),s=new RegExp("^("+i+")(/|/.+)?$"),c=e.dest,a=n.getSetting();for(var u in a){var l=a[u],d=n.compareCategory(i,l.categoryPath);if(d>=0){var p=l.categoryPath.replace(s,function(e,t,n,o,r){return void 0===n?c:c+n});l.categoryPath=p}}}})}function c(t){u.setResponse(t),console.log("# 등록 응답 : ",t),m._success(u,e,a)}var u=this._process.params,l=u.getParam("edit"),d=u.getParam("move"),p=r.pathMarkerInfo(),m=this,f=[],v={};f.push(function(e){if(!l||l.length<1)return e();var a=l.map(function(e){var o=e.uid,r=e.data;t.modify(o,r),console.log("# component 수정 : ",o,r);var a=n.getSetting(o),i=a.categoryPath;return{uid:o,category:i,data:r}}),s={pathInfo:p,modify:[{dataName:"component",folder:r.USER_DATA_COMPONENT_MARKER,content:a}]};a&&i(a),o.component(s,function(t,n){if(t&&console.error("# user data 수정 에러 : ",t),n.modify&&n.modify.length>0)for(var o in n.modify){var r=n.modify[o];"component"===r.dataName&&(v.modify=r.content)}e(t)})}),f.push(function(e){if(!d||d.length<1)return e();var t=d.map(function(e){var t={isCopy:!1,source:e.source.category,dest:e.dest.category},n=e.source.uid;return n&&(t.files=[n,"asset-"+n]),t}),n={pathInfo:p,move:[{dataName:"component",folder:r.USER_DATA_COMPONENT_MARKER,content:t}]};t&&s(t),o.component(n,function(t,n){if(t&&console.error("# user data 이동 에러 : ",t),n.move&&n.move.length>0)for(var o in n.move){var r=n.move[o];"component"===r.dataName&&(v.move=r.content)}e(t)})}),async.waterfall(f,function(e){c(v)})}});return a}var t=MODULE.core.instance;t.factory("ModifyComponentCommand",e),e.$inject=["CommandBase","$components","$contentComponentSetting","$externalAPI","FileSystem"]}(),function(){function e(e,t,n){var o=e.extend("CopyElementCommand",{_run:function(e,o){var r=this._process.params,a=r.getParam("document"),i=r.getParam("elements"),s=n.get(i);s.document=a;var c=t.get();c.copyPasteData(s),console.log("# 복사된 데이터 : ",s),r.setResponse(s),console.log("# Element 복사 : ",r),this._success(r,e,o)}});return o}var t=MODULE.core.instance;t.factory("CopyElementCommand",e),e.$inject=["CommandBase","$projects","$copyData"]}(),function(){function e(e,t,n,o,r,a){var i=e.extend("CutElementCommand",{_run:function(e,r){function a(e){e.add("responseProcess",function(e,t,n){var o=n.getResponse();i.setResponse(o),console.warn("# 데이터 잘라내기 : ",i),e()})}var i=this._process.params,s=new n,c=t.define(o.ELEMENT_COPY,i).getProcess();s.add("copyElement",c);var u=this.__getRemoveParam(i),l=t.define(o.ELEMENT_REMOVE,u).getProcess();s.add("removeElement",function(e,t){l.execute(function(t){e(t)})}),a(s);var d=this;s.execute(function(){d._success(i,e,r)})},_getRedoCommand:function(){var e=t.define(o.ELEMENT_REMOVE,this._redoParam);return e},_setRedoParam:function(e){return this.__getRemoveParam(e)},__getRemoveParam:function(e){for(var t=e.getParam("document"),n=e.getParam("elements"),o=[],a=n.length,i=0;a>i;++i){var s=n[i];o.push(s.element)}var c=new r({document:t,elements:o});return c},_getUndoCommand:function(){var e=t.define(o.ELEMENT_ADD,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),n=t.document,o=new r({document:n,elements:angular.copy(t.elements).reverse(),selects:t.oldSelectArray,oldInGroupArray:t.oldInGroupArray,groups:t.oldGroup});return o}});return i}var t=MODULE.core.instance;t.factory("CutElementCommand",e),e.$inject=["HistoryCommandBase","$command","Process","CommandName","CommandParam","$applications"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d){var p=e.extend("PasteElementCommand",{_run:function(e,p){function m(e,t){e.add("responseProcess",function(e,n,o){var r=o.getResponse();r.addParam=t,v.setResponse(r),console.warn("# 데이터 붙여넣기 : ",v),e()})}var f,v=this._process.params,g=v.getParam("document"),h=v.getParam("config")||{},_=t.get(),$=_.copyPasteData(),E={indexes:$.indexes,elements:$.elements,groups:$.groups,assets:$.assets,boundary:$.boundary};void 0===h.offset&&(h.offset=!0);var y=0;h.offset&&(_.pasteCounter(1),y=_.getPasteOffset()),f={left:E.boundary.x,top:E.boundary.y,offsetX:y,offsetY:y},l.message("복사된 데이터 적용중...");var P=n.get(E);P.document=g;var w=new u,b=n.getElementParams(P,f);!function(e){var t=r.get().currentEditGroup(),n=t?a.get(t):o.get(),i=n.getNoneCopyValue("indexes").length;e.forEach(function(e,t){e.index=i+t})}(b.elements);var C=new c(angular.copy(b)),O=s.define(i.ELEMENT_ADD,C).getProcess();w.add("paste",function(e,t){O.execute(function(t){e(t)})}),m(w,b);var T=this;d(function(){w.execute(function(){T._success(v,e,p)})},0)},_getRedoCommand:function(){var e=s.define(i.ELEMENT_ADD,this._redoParam);return e},_setRedoParam:function(e,t){var n=t.getResponse(),o=new c(n.addParam);return o},_getUndoCommand:function(){var e=s.define(i.ELEMENT_REMOVE,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),n=t.document,o=new c({document:n,elements:angular.copy(t.elements).reverse(),selects:t.oldSelectArray});return o}});return p}var t=MODULE.core.instance;t.factory("PasteElementCommand",e),e.$inject=["HistoryCommandBase","$projects","$pasteData","$documents","$selects","$groups","CommandName","$command","CommandParam","Process","$busy","$timeout"]}(),function(){function e(e,t,n,o,r,a){var i=e.extend("AddDocumentCommand",{_run:function(e,i){var s=this._process.params,c=s.getParam("document"),u=s.getParam("position"),l=s.getParam("data"),d=t.add(c,l),p=d.uid();t.select(p),n.add(p),n.select(p),r.add(p),r.select(p),o.get().addDocument(p,u),s.setResponse({document:p}),console.log("# 새로운 Document 데이터 생성 : ",s);var m=this;a.add(p,function(){m._success(s,e,i)})}});return i}var t=MODULE.core.instance;t.factory("AddDocumentCommand",e),e.$inject=["CommandBase","$documents","$selects","$projects","$history","$capture"]}(),function(){function e(e,t){var n=e.extend("IndexDocumentCommand",{_run:function(e,n){var o=this._process.params,r=o.getParam("document"),a=o.getParam("position"),i=t.get(),s="string"==typeof r?[r]:r,c=s.map(function(e){return i.getIndex(e)});i.moveDocument(s,a);var u=s.map(function(e){return i.getIndex(e)});o.setResponse({document:s,old_indexes:c,new_indexes:u}),console.log("# Document 데이터 페이지 순서 수정 : ",o),this._success(o,e,n)}});return n}var t=MODULE.core.instance;t.factory("IndexDocumentCommand",e),e.$inject=["CommandBase","$projects"]}(),function(){function e(e,t,n,o,r,a,i,s){function c(e,t,n,o){if(e&&angular.isArray(e)){n[t]=n[t]||[];for(var r in e)c(e[r],r,n[t],(o||[])[r])}else if(e&&angular.isObject(e)){n[t]=n[t]||{};for(var r in e)c(e[r],r,n[t],(o||{})[r])}else n[t]=o}var u=e.extend("ModifyDocumentCommand",{_run:function(e,t){function n(e,t,n){var o="dataProcess";e.add(o,function(e,o){n&&r.modify(t,n),e()})}function o(e,t){e.add("responseProcess",function(e,n){u.setResponse(t),console.log("# Document 데이터 수정 : ",u),e()})}var u=this._process.params,l=u.getParam("document"),d=u.getParam("data"),p=u.getParam("asset"),m=new i;u.isHistoryProcess&&"undo"==this._process.callStep;var f;if(d){var v=r.get(l);f=angular.copy(d);for(var g in d)v.isReplaceOnly(g)?f[g]=v.value(g):c(d[g],g,f,v.value(g));console.log("* 변경되기 이전값 기록 (Data) : ",f)}var h={};if(p&&(h.remove=a.toRemoveParam(p.add),h.add=a.toAddParam(p.remove),console.log("* 변경되기 이전값 기록 (Asset) : ",h)),p&&(p.remove&&a.removeAssetProcess(p.remove,m),p.add)){var _="undo"==this._process.callStep||"redo"==this._process.callStep;a.addAssetProcess(p.add,m,null,_)}n(m,l,d);var $={document:l,data:d,oldData:f,oldAsset:h};o(m,$);var E=this;m.execute(function(){E._success(u,e,t);var n=u.getParam("ignoreCapture");n||s.update(l)})},_getRedoCommand:function(){var e=o.define(n.DOCUMENT_MODIFY,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(n.DOCUMENT_MODIFY,this._undoParam);return e},_setUndoParam:function(e){var n=e.getResponse(),o=n.document,r=new t({document:o,data:n.oldData,asset:n.oldAsset});return r}});return u}var t=MODULE.core.instance;t.factory("ModifyDocumentCommand",e),e.$inject=["HistoryCommandBase","CommandParam","CommandName","$command","$documents","$assetManager","Process","$capture"]}(),function(){function e(e,t,n,o,r,a,i,s){var c=e.extend("RemoveDocumentCommand",{_run:function(e,c){var u=this._process.params,l=u.getParam("document"),d=t.get(l);n.remove(l),o.remove(l),function(){var e=d.value("elements");for(var t in e){var n=e[t];r.remove(n)}}(),function(){var e=d.value("groups");for(var t in e){var n=e[t];s.remove(n)}}(),t.remove(l),a.get().removeDocument(l),i.remove(l),u.setResponse({document:l}),console.warn("# Document 데이터 삭제됨 : ",u),this._success(u,e,c)}});return c}var t=MODULE.core.instance;t.factory("RemoveDocumentCommand",e),e.$inject=["CommandBase","$documents","$history","$selects","$elements","$projects","$capture","$groups"]}(),function(){function e(e,t,n,o){var r=e.extend("SelectDocumentCommand",{_run:function(e,r){var a=this._process.params,i=a.getParam("document"),s=t.uid();t.select(i);var c=t.uid();o.select(c),n.select(c),a.setResponse({old_uid:s,new_uid:c}),console.warn("# Document 데이터 SELECT : ",a),this._success(a,e,r)}});return r}var t=MODULE.core.instance;t.factory("SelectDocumentCommand",e),e.$inject=["CommandBase","$documents","$history","$selects"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){var m=e.extend("AddElementCommand",{_run:function(e,t){function n(e){return D?e.oldData:e.data}function o(e){e.forEach(function(e,t){var o=D?e.oldAsset:e.asset||{};if(o.add){var r="undo"==T._process.callStep||"redo"==T._process.callStep,a=n(e),i=a.assets||[];d.addAssetProcess(o.add,O,i,r),a.assets=i}})}function c(e){e.forEach(function(e,t){var o=e.element,r=n(e),a=r.group||"",c=i.get().currentEditGroup();if(D){if(!a)return;O.add("groupProcess_"+t,function(t,n){console.info("그룹에 추가 : ",a," : ",o);var r=s.get(a);r.addElement(o,e.index),t()})}else{if(a)return;if(!c)return;O.add("groupProcess_"+t,function(e,t){console.info("그룹에 추가 : ",c," : ",o),r.group=c;var n=s.get(c);n.addElement(o),e()})}})}function m(e){e.forEach(function(e,t){var o=e.element,r=i.get().currentEditGroup();O.add("elementProcess_"+t,function(t,i){var s=n(e),c=s.group||"";console.info("Element 생성 : ",o," : ",s),a.add(o,s);var u=Boolean(c);P.addElement(o,e.index,u),y||r!=c||C.push(o),t()})})}function f(e,t){var n="layoutProcess";e.add(n,function(e,t){p.refresh(C),e()})}function v(e,t){var n="selectProcess";e.add(n,function(e,t){w.clear(),y&&(C=y),w.select(C),a.unselect(b),a.select(C);var n=s.isMaskElement(C);w.value("currentGroup",n),e()})}function g(e){e.add("responseProcess",function(e,t){h.setResponse({document:_,elements:C,oldSelectArray:b,selects:w.get()}),console.log("# 새로운 Element 데이터 생성 : ",h),e()})}var h=this._process.params,_=h.getParam("document"),$=h.getParam("elements"),E=h.getParam("groups"),y=h.getParam("selects");if(!_)throw new Error("document uid가 지정되지 않았습니다.");var P=r.get(_),w=i.get(_),b=w.get(),C=[];!function(e){if(e)for(var t in e){var n=e[t];s.add(t,n),P.addGroup(t),console.debug("* Group 추가 : ",t)}}(E);var O=new l;$=$||[],$.length<1&&($[0]={}),$.sort(function(e,t){return void 0===t.index?1:e.index===t.index?0:e.index<t.index?-1:1}),function(e){e.forEach(function(e,t){e.element=e.element||a.createUID()})}($);var T=this,D=h.isHistoryProcess&&"undo"==this._process.callStep,R=angular.copy($);o(R),c(R),m(R),f(O,D),v(O,D),g(O),O.execute(function(){T._success(h,e,t);var n=h.getParam("ignoreCapture");n||u.update(_)})},_getRedoCommand:function(){var e=o.define(t.ELEMENT_ADD,this._redoParam);return e},_setRedoParam:function(e){var t=new n;angular.extend(t,e);for(var o=angular.copy(this._undoParam.getParam("elements")).reverse(),r=angular.copy(t.getParam("elements")),a=0;a<r.length;++a)r[a].element=o[a];return t.setParam("elements",r),t},_getUndoCommand:function(){var e=o.define(t.ELEMENT_REMOVE,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=new n({document:o,elements:angular.copy(t.elements),selects:t.oldSelectArray});return r}});return m}var t=MODULE.core.instance;t.factory("AddElementCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$documents","$elements","$selects","$groups","$applications","$capture","Process","$assetManager","$layout"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){var d=e.extend("IndexElementCommand",{_run:function(e,t){function n(e){var t=u.get().currentEditGroup(),n=t?l.get(t):r.get();n.value("indexes",e)}function o(){d.setResponse({document:p,position:f,elements:m,oldArrange:h,newArrange:v}),console.log("# Element 데이터 페이지 순서 수정 : ",d),this._success(d,e,t);var n=d.getParam("ignoreCapture");n||s.update(p)}var d=this._process.params,p=d.getParam("document"),m=d.getParam("elements"),f=d.getParam("position");if(!m||m.length<1)throw new Error("element uid가 지정되지 않았습니다.");if(f==a._REPLACE)return n(m),void o.apply(this);var v,g=c.toIndexes(m),h=c.getChildElements(),_=i.itemToIndex(h);switch(f){case a.BACK:i.back(g,_);break;case a.BACKWARD:i.backward(g,_);break;case a.FORWARD:i.forward(g,_);break;case a.FRONT:i.front(g,_);break;default:i.indexChange(g,_,f)}v=i.indexToItem(_,h),n(v),o.apply(this)},_getRedoCommand:function(){var e=o.define(n.ELEMENT_INDEX,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(n.ELEMENT_INDEX,this._undoParam);return e},_setUndoParam:function(e){var n=e.getResponse(),o=n.document,r=new t({document:o,elements:n.oldArrange,position:a._REPLACE});return r}});return d}var t=MODULE.core.instance;t.factory("IndexElementCommand",e),e.$inject=["HistoryCommandBase","CommandParam","CommandName","$command","$documents","ArrangePosition","$arrange","$capture","$mask","$selects","$groups"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d){var p=e.extend("MaskElementBoundaryCommand",{
_run:function(e,t){function n(e,t,n){var o={left:t.left,top:t.top,width:t.width,height:t.height},r=e.option(n);l(e,o,n,r)}function o(e,t){var n=d.get(e),o=n.getNoneCopyValue("indexes");o&&o.forEach(function(e){var n="normal",o=s.get(e),r=o.css(n),a={left:r.left-t.x,top:r.top-t.y};l(o,a,n)})}function a(e,t,n){var o=e.getNoneCopyValue("state").normal.css,r=o.transform.angle||0,a=e.isGroupContainer(),i=u.getGroupOffset(a,n),c=angular.copy(t);if(c.left=c.left+i.left,c.top=c.top+i.top,isNaN(r)||0===r)return c;var l={x:0,y:0};l.x=o.width/2+o.left,l.y=o.height/2+o.top;var d=s.getRotatedPoints(c,r,l),p=u._getOutlineFromPoint(d),m={x:(p.right+p.left)/2,y:(p.bottom+p.top)/2},f={x:c.left+c.width/2,y:c.top+c.height/2},v={x:m.x-f.x,y:m.y-f.y};return c.left=c.left+v.x,c.top=c.top+v.y,c}function l(e,t,n,o){h||o&&(o.overflowX||o.overflowY)&&(g||(g=[]),g.push(e.uid()),e.tempdata("scrollRefresh",!0));var r={};t&&(r.css=t);var a={};a[n]=r,e.value("state",a)}function p(){m.setResponse({document:f,masks:v,oldMasks:_}),console.log("# Mask Element 위치, 크기 리셋 : ",m),this._success(m,e,t);var n=m.getParam("ignoreCapture");n||c.update(f)}var m=this._process.params,f=m.getParam("document"),v=m.getParam("masks");if(!v||v.length<1)throw new Error("element uid가 지정되지 않았습니다.");for(var g,h=m.isHistoryProcess&&"undo"==this._process.callStep,_=angular.copy(v),$=0;$<v.length;++$){var E=_[$],y=v[$],P=y.boundary,w=y.element,b=s.get(w),C=y.currentState||b.value("currentState");"normal"!==C&&console.error("현재 유효한 mask state는 normal 뿐입니다.");var O=b.getNoneCopyValue("state")[C].css,T={left:O.left,top:O.top,width:O.width,height:O.height};E.boundary=T;var D,R;h?(D={x:-1*y.childOffset.x,y:-1*y.childOffset.y},R=P):(D={x:P.left,y:P.top},R=a(b,P,1)),n(b,R,C),function(){var e=b.css(C),t=b.layout(C);r.resetCssByLayoutOption(w,e,t)}();var x=b.isGroupContainer();o(x,D),E.childOffset=D,r.groupSizeChange(w)}!h&&g&&i(function(){g.forEach(function(e){var t=s.get(e);t.tempdata("scrollRefresh",!1)})},200),p.apply(this)},_getRedoCommand:function(){var e=o.define(n.ELEMENT_BOUNDARY_MASK,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(n.ELEMENT_BOUNDARY_MASK,this._undoParam);return e},_setUndoParam:function(e){var n=e.getResponse(),o=n.document,r=new t({document:o,masks:n.oldMasks});return r}});return p}var t=MODULE.core.instance;t.factory("MaskElementBoundaryCommand",e),e.$inject=["HistoryCommandBase","CommandParam","CommandName","$command","$layout","$documents","$timeout","$elements","$capture","$mask","$selects","$groups"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){function m(e,t,n,o){if(e&&angular.isArray(e)){n[t]=n[t]||[];for(var r in e)m(e[r],r,n[t],(o||[])[r])}else if(e&&angular.isObject(e)){n[t]=n[t]||{};for(var r in e)m(e[r],r,n[t],(o||{})[r])}else n[t]=o}var f=e.extend("ModifyElementCommand",{_run:function(e,i){function l(e){if($){var r=new n({document:h,selects:$}),a=o.define(t.ELEMENT_SELECT,r).getProcess();e.add("selectProcess",a)}}function f(e,t,n,o,a,i){var s="dataProcess_"+t;e.add(s,function(e,s){o&&(n=r.modify(n,o).uid());var c=r.get(n);c.assets(a),w[t]=i,i.layoutUpdate&&p.groupSizeChange(n),e()})}function v(e){e.add("responseProcess",function(e,t){g.setResponse({document:h,elements:w,oldSelectArray:E,selects:c.get(h).get()}),console.log("# Element 데이터 수정 : ",g),e()})}var g=this._process.params,h=g.getParam("document"),_=g.getParam("elements"),$=g.getParam("selects");if(!_||_.length<1)throw new Error("element uid가 지정되지 않았습니다.");var E;!function(){if($){var e=c.get(h);E=e.get()}}();for(var y=new a,P=!1,w=[],b=0;b<_.length;++b){var C=_[b],O=C.element,T=C.data,D=C.asset||{},R=C.layoutUpdate;g.isHistoryProcess&&"undo"==this._process.callStep&&(T=C.oldData,D=C.oldAsset);var x=r.get(O);if(T.currentState=T.currentState||x.value("currentState"),R&&g.isHistoryProcess){var A=u.get(h).getNoneCopyValue("indexes"),S=A.indexOf(O)>-1;if(S){var M=T.currentState||x.value("currentState"),I=T.state[M],N=r.mergeCSS(I.css,M,x.css(M)),j=function(){var e=I.option||x.option(M),t=e.layout,n=x.layout(M);for(var o in n)(null===t[o]||void 0===t[o])&&(t[o]=n[o]);return t}();I.css=p.resetCssByLayoutOption(O,N,j)}}var L;if(T){L=angular.copy(T);for(var U in T)x.isReplaceOnly(U)?L[U]=x.value(U):m(T[U],U,L,x.value(U));console.log("* 변경되기 이전값 기록 (Data) : ",L),(T.state&&T.state.normal||"normal"===T.currentState)&&(P=!0)}var k={};D&&(k.remove=d.toRemoveParam(D.add),k.add=d.toAddParam(D.remove),console.log("* 변경되기 이전값 기록 (Asset) : ",k));var F=x.assets()||[];if(D){if(D.remove&&d.removeAssetProcess(D.remove,y,F),D.add){var B="undo"==this._process.callStep||"redo"==this._process.callStep;d.addAssetProcess(D.add,y,F,B)}x.assets(F)}console.log("assetList : ",F);var V={element:O,data:T,oldData:L,oldAsset:k,layoutUpdate:R};f(y,b,O,T,F,V)}l(y),v(y);var G=this;y.execute(function(){if(G._success(g,e,i),P){var t=g.getParam("ignoreCapture");t||s.update(h)}})},_getRedoCommand:function(){var e=o.define(t.ELEMENT_MODIFY,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(t.ELEMENT_MODIFY,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=new n({document:o,elements:t.elements,selects:t.oldSelectArray});return r}});return f}var t=MODULE.core.instance;t.factory("ModifyElementCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$elements","Process","$busy","$capture","$selects","$documents","$assets","$assetManager","$layout"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){var m=e.extend("RemoveElementCommand",{_run:function(e,t){function n(e,t,n,o,r){var i="dataProcess_"+n;e.add(i,function(e,t){!function(){var e=a.get(o),t=e.parentGroup();if(t){var n=s.get(t);n&&n.removeElement(o)}}(),function(){g.removeElement(o),a.unselect([o]),a.remove(o),w[n]=r}(),e()})}function o(e,t){var n="selectProcess";e.add(n,function(e,n){var o="";if(t){var r=p.getParam("selects");h.clear(),h.select(r),a.select(r),o=s.isMaskElement(r)}else h.unselect(f),o="",console.log("# 선택 상태 수정(remove) : ",h.get());h.value("currentGroup",o),e()})}function c(e){e.add("responseProcess",function(e,t){p.setResponse({document:m,elements:w,selects:h.get(),oldSelectArray:_,oldGroup:v}),console.log("# Element 데이터 삭제됨 : ",p),e()})}var p=this._process.params,m=p.getParam("document"),f=p.getParam("elements");if(!m)throw new Error("document uid가 지정되지 않았습니다.");var v,g=r.get(m),h=i.get(m),_=h.get(),$=[],E=[];!function(){function e(t){for(var n=[],o=0;o<t.length;++o){var r=t[o],i=a.get(r),c=i.isGroupContainer();if(c){var u=s.get(c),l=u.indexes();n=n.concat(l);var d=e(l);n=n.concat(d),v||(v={}),v[c]=u.copy(),$.push(c)}}return n}E=f.concat(e(f))}();var y=p.isHistoryProcess&&"undo"==this._process.callStep,P=new l,w=[],b={};!function(){for(var e=0;e<E.length;++e){var t=E[e],n=a.get(t).parentGroup(),o=n?s.get(n):g,r=o.getIndex(t);b[t]=r}}(),function(e){for(var t=0;t<e.length;++t){var o=e[t],r=a.get(o),i=r.copy();console.log("# 변경되기 이전값 기록 (Data) : ",i);var s=r.assets(),c={};if(s&&s.length>0){var u=d.getRemoveParam(m,s);c.add=d.toAddParam(u),console.log("# 변경되기 이전값 기록 (Asset) : ",c)}if(s&&s.length>0){var l=d.getRemoveParam(m,s);d.removeAssetProcess(l,P),r.assets(s)}var p={index:b[o],element:o,oldData:i,oldAsset:c};n(P,y,t,o,p),console.debug("* Element 삭제 : ",o)}}(E),function(e){for(var t=0;t<e.length;++t){var n=e[t];s.remove(n),g.removeGroup(n),console.debug("* Group 삭제 : ",n)}}($),o(P,y),c(P);var C=this;P.execute(function(){C._success(p,e,t);var n=p.getParam("ignoreCapture");n||u.update(m)})},_getRedoCommand:function(){var e=o.define(t.ELEMENT_REMOVE,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(t.ELEMENT_ADD,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=new n({document:o,elements:angular.copy(t.elements),selects:t.oldSelectArray,groups:t.oldGroup});return r}});return m}var t=MODULE.core.instance;t.factory("RemoveElementCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$documents","$elements","$selects","$groups","$applications","$capture","Process","$assetManager","$toast"]}(),function(){function e(e,t,n,o,r,a,i){function s(e,t,n,o){if(e&&angular.isArray(e)){n[t]=n[t]||[];for(var r in e)s(e[r],r,n[t],(o||[])[r])}else if(e&&angular.isObject(e)){n[t]=n[t]||{};for(var r in e)s(e[r],r,n[t],(o||{})[r])}else n[t]=o}var c=e.extend("SelectElementCommand",{_run:function(e,t){var n=this._process.params,o=n.getParam("document"),c=n.getParam("selects"),u=n.getParam("data");if(c&&u)return console.error("# selects와 data는 동시에 수정할 수 없습니다."),void this._error(n,e,t);var l=r.get(o),d=!1;n.isHistoryProcess&&"undo"==this._process.callStep&&(d=!0),function(){if(c){var e=l.get(),t=l.value("inGroup");l.clear(),l.select(c),a.unselect(e),a.select(c);var r=i.isMaskElement(c);l.value("currentGroup",r);var s=function(){if(d)return n.getParam("oldInGroup");if(1===c.length){var e=a.get(c[0]),t=e.value("group"),o=l.currentEditGroup();if(t!==o){console.log("# 편집 그룹내 이동 : ",o," --> ",t);for(var r=[];t;){r.push(t);var s=i.get(t),u=s.value("owner"),e=a.get(u);t=e.parentGroup()}return r}}}();s&&l.editInGroup(s),n.setResponse({document:o,oldSelectArray:e,oldInGroup:t,selects:l.get()}),console.warn("# Element 데이터 SELECT : ",n)}}(),function(){if(u){var e=angular.copy(u);for(var t in u)l.isReplaceOnly(t)?e[t]=l.value(t):s(u[t],t,e,l.value(t));console.log("* 변경되기 이전값 기록 (Data) : ",e),console.log("* 값 기록 (Data) : ",u);var a=angular.copy(u);r.modify(o,a),n.setResponse({document:o,data:u,oldData:e})}}(),this._success(n,e,t)},_getRedoCommand:function(){var e=o.define(t.ELEMENT_SELECT,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(t.ELEMENT_SELECT,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=new n({document:o,selects:t.oldSelectArray,oldInGroup:t.oldInGroup,data:t.oldData});return r}});return c}var t=MODULE.core.instance;t.factory("SelectElementCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$selects","$elements","$groups"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){var d=e.extend("AddGroupCommand",{_run:function(e,t){var n=this._process.params,o=n.getParam("document"),d=n.getParam("group"),p=n.getParam("data");if(!o)throw new Error("document uid가 지정되지 않았습니다.");var m=r.get(o),f=n.getParam("maskData"),v=s.get().currentEditGroup(),g=p.owner||"";!function(){var e=i.add(d,p);d=e.uid(),m.addGroup(d),console.debug("* Group 추가 : ",d)}(),function(e){function t(e){var t=c.getRotatedBoundary(e),n=u.getSetting(l.MASK),o=angular.extend({},n.css,{left:t.left,top:t.top,width:t.width,height:t.height}),r={normal:{css:o,option:n.option,style:n.style}};return r}var n;f?(n=a.add(g),n.$$_original=f):n=a.add(g,{type:l.MASK,state:t(e),group:v||"",childGroup:d}),g=n.uid(),i.get(d).value("owner",g)}(p.indexes);var h,_={};!function(e){var t=v?i.get(v):m,n=t.indexes();if(!e||e.length<1)return void(h=n.length);for(var o=a.get(e[0]).parentGroup(),r=o?i.get(o):m,s=0;s<e.length;++s){var c=e[s],u=r.getIndex(c);_[c]=u}var l=e[e.length-1];h=r.getIndex(l)}(p.indexes),function(){if(v){var e=i.get(v);e.addElement(g,h)}m.addElement(g,h,Boolean(v))}(),function(e){var t=v?i.get(v):m,n=t.indexes();for(var o in e){var r=n.indexOf(e[o]);if(0>r)throw new Error("현재 편집 그룹에 포함되지 않는 요소를 그룹화하려고 합니다.("+uid+")");n.splice(r,1)}t.value("indexes",n);var a=i.get(d);a.value("indexes",e)}(p.indexes),function(e){function t(e,t,n){var o=e[t].css;isNaN(o.left)||(o.left=o.left-n.left),isNaN(o.top)||(o.top=o.top-n.top)}var n=c.getGroupOffset(d,1);for(var o in e){var r=e[o],i=a.get(r);i.parentGroup(d);var s=i.getNoneCopyValue("state");t(s,"normal",n),t(s,"over",n),t(s,"down",n)}}(p.indexes);var $=s.get(o),E=$.get();!function(){var e=[g];$.clear(),$.select(e),a.unselect(E),a.select(e),$.value("currentGroup",d)}(),function(){p.owner=g,n.setResponse({document:o,group:d,data:p,oldElementIndexes:_}),console.log("# 새로운 Group 데이터 생성 : ",n)}(),this._success(n,e,t)},_getRedoCommand:function(){var e=o.define(t.GROUP_ADD,this._redoParam);return e},_setRedoParam:function(e){var t=new n;angular.merge(t,e);var o=this._undoParam.getParam("group");t.setParam("group",o);var r=this._undoParam.getParam("data");return t.setParam("data",r),t},_getUndoCommand:function(){var e=o.define(t.GROUP_REMOVE,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=new n({document:o,group:t.group,elementIndexes:t.oldElementIndexes,data:t.data});return r}});return d}var t=MODULE.core.instance;t.factory("AddGroupCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$documents","$elements","$groups","$selects","$mask","$contentItemSetting","ElementType"]}(),function(){function e(e,t,n,o,r,a){function i(e,t,n,o){if(e&&angular.isArray(e)){n[t]=n[t]||[];for(var r in e)i(e[r],r,n[t],(o||[])[r])}else if(e&&angular.isObject(e)){n[t]=n[t]||{};for(var r in e)i(e[r],r,n[t],(o||{})[r])}else n[t]=o}var s=e.extend("ModifyGroupCommand",{_run:function(e,t){function n(e,t,n,o,a){var i="dataProcess_"+t;e.add(i,function(e,i){o&&(n=r.modify(n,o).uid()),d[t]=a,e()})}function o(e){e.add("responseProcess",function(e,t){s.setResponse({document:c,groups:d}),console.log("# Group 데이터 수정 : ",s),e()})}var s=this._process.params,c=s.getParam("document"),u=s.getParam("groups");if(!u||u.length<1)throw new Error("group uid가 지정되지 않았습니다.");for(var l=new a,d=[],p=0;p<u.length;++p){var m=u[p],f=m.group,v=m.data;s.isHistoryProcess&&"undo"==this._process.callStep&&(v=m.oldData);var g,h=r.get(f);if(v){g=angular.copy(v);for(var _ in v)h.isReplaceOnly(_)?g[_]=h.value(_):i(v[_],_,g,h.value(_));console.log("* 변경되기 이전값 기록 (Data) : ",g)}var $={group:f,data:v,oldData:g};n(l,p,f,v,$)}o(l);var E=this;l.execute(function(){E._success(s,e,t)})},_getRedoCommand:function(){var e=o.define(t.GROUP_MODIFY,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(t.GROUP_MODIFY,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=new n({document:o,groups:t.groups});return r}});return s}var t=MODULE.core.instance;t.factory("ModifyGroupCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$groups","Process"]}(),function(){function e(e,t,n,o,r,a,i,s,c){var u=e.extend("RemoveGroupCommand",{_run:function(e,t){var n=this._process.params,o=n.getParam("document"),u=n.getParam("group");if(!o)throw new Error("document uid가 지정되지 않았습니다.");var l,d,p=r.get(o),m=n.getParam("elementIndexes"),f=n.isHistoryProcess&&"undo"==this._process.callStep,v=s.get().currentEditGroup(),g=i.get(u),h=g.indexes(),_=g.value("owner");!function(){l=g.copy();var e=a.get(_);d=e.copy(),console.log("* 변경되기 이전값 기록 (Data) : ",l)}(),function(e){var t=v?i.get(v):p;t.removeElement(_);var n=t.indexes();if(f)e.forEach(function(e){var t=m[e];n.splice(t,0,e)});else{var o=t.getIndex(_),r=[o,0].concat(e);n.splice.apply(n,r)}t.value("indexes",n)}(h),function(e){function t(e,t,n){var o=e[t].css;isNaN(o.left)||(o.left=o.left+n.left),isNaN(o.top)||(o.top=o.top+n.top)}var n=c.getGroupOffset(u,1);e.forEach(function(e){var o=a.get(e);o.parentGroup(v);var r=o.getNoneCopyValue("state");t(r,"normal",n),t(r,"over",n),t(r,"down",n)})}(h),function(e){a.unselect([e]),a.remove(e),p.removeElement(e)}(_),function(){i.remove(u),p.removeGroup(u)}(),function(e){var t=e,n=s.get(),o=n.get();n.clear(),n.select(t),o.splice(o.indexOf(_),1),a.unselect(o),a.select(t);var r=i.isMaskElement(t);n.value("currentGroup",r)}(h),function(){n.setResponse({document:o,group:u,oldData:l,oldMaskData:d}),console.log("# Group 데이터 삭제됨 : ",n)}(),this._success(n,e,t)},_getRedoCommand:function(){var e=o.define(t.GROUP_REMOVE,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(t.GROUP_ADD,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=t.group,a=new n({document:o,group:r,data:t.oldData,maskData:t.oldMaskData});return a}});return u}var t=MODULE.core.instance;t.factory("RemoveGroupCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$documents","$elements","$groups","$selects","$mask"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d){function p(e,t,n){w.push(arguments)}function m(e){function t(){++r;var c=w[r];if(c){var d=c[0],p=c[1];if(!C){var m=void 0===c[2]?!0:c[2];m?s?u.message(d):u.progress(r+1,a,i+d):u.message(d)}p(function(){++o,o===O?(o=0,n=window.requestAnimationFrame(t)):t()})}else window.cancelAnimationFrame&&window.cancelAnimationFrame(n),l(function(){e()})}var n,o=0,r=-1,a=w.length,i="변경된 내용 추출 ",s=3*O>a;C?t():(u.open({message:"변경(보정)된 데이터 개수 : "+b+" 개",delay:500}),l(function(){t()},100*d.animate.duration))}function f(e,t){for(var n in e){var o="(추가) "+n;p(o,v(e,t,n))}}function v(e,n,o){var r=e[o];return function(e){n.uid=o,n.data=r,n.type="json",t.saveData(n,e,e)}}function g(e,t){var n=e.getDeleteQueue(!0);for(var o in n){var r="(제거) "+o;p(r,h(e,t,o))}}function h(e,n,o){function r(t){return e.$$removeDeleteBackupQueue(o),t}return function(e){n.uid=o,n.type="json",t.saveData(n,r(e),r(e))}}function _(e){var o=e.project,r=o.replace(n.PROJECT,n.TOOL);p(r,function(n){var o=a.get(),i=o.tooldata();e.uid=r,e.data=i,e.type="json",t.saveData(e,n,n)})}function $(e,t){for(var n in e){var o=e[n].path,r="(File Copy) "+n;p(r,E(o,t,n))}}function E(e,n,o){return function(o){n.file=e,t.saveFiles(n,o,o)}}function y(e,t){for(var n in e){var o=e[n].path,r="(File Delete) "+n;p(r,P(o,t,n))}}function P(e,n,o){function r(e){return c.$$removeDeleteBackupQueue(o),e}return function(o){n.file=e,t.saveFiles(n,r(o),r(o))}}var w=[],b=0,C=!1,O=5,T=e.extend("BackupProjectCommand",{_run:function(e,a,l){function v(e){var n={onProcess:function(e,t,n){C||(1===arguments.length?u.message(arguments[0]):3*O>t?u.message("데이터를 보정 중입니다."):u.progress(e,t,n))},oneTimeLimit:O,project:P};t.saveBackup(n,e,e)}var h=this._process.params;console.log("	# param : ",h);var E=h.getParam("saveAll"),P=h.getParam("project");w=[],C=r.projectIsOpen();var T=r.get(),D=T?T.needToBackup():!1,R=o.saveApplication(!0,E),x=o.saveProject(!0),A=o.saveDocuments(!0),S=o.saveElements(!0),M=o.saveSelects(P,!0,E),I=o.saveGroups(P,!0,E),N=o.saveAssets(P,!0,E);b=R.length+x.length+A.length+S.length+M.length+I.length+N.length+N.filesCounter,console.log("# 총 데이터 파일 개수 : ",b),E&&p("meta data",function(e){t.setMetaData({project:P},e,e)}),f(R.data,{project:P,category:n.APPLICATION}),f(x.data,{project:P,category:n.PROJECT}),f(A.data,{project:P,category:n.DOCUMENT,task:"add"}),g(i,{project:P,category:n.DOCUMENT,task:"delete"}),f(S.data,{project:P,category:n.ELEMENT,task:"add"}),g(s,{project:P,category:n.ELEMENT,task:"delete"}),f(M.data,{project:P,category:n.SELECT}),f(I.data,{project:P,category:n.GROUP}),f(N.data,{project:P,category:n.ASSET}),_({project:P}),console.log("폴더 (파일) 저장/ 삭제 : ",N.files),$(N.files,{project:P,task:"add"}),y(c.getDeleteQueue(!0),{project:P,task:"delete"});var j=this;m(function(){v(function(t){console.log("파일 백업 결과 : ",t),h.setResponse({project:P,changed:D,result:t}),j._success(h,e,a),C||(u.message("잠시만 기다려 주세요."),u.close(d.busyDelayTime),r.projectIsOpen(!0))})})}});return T}var t=MODULE.core.instance;t.factory("BackupProjectCommand",e),e.$inject=["CommandBase","$externalAPI","UIDType","$extractSaveData","$applications","$projects","$documents","$elements","$assets","$busy","$timeout","Default"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f){var v=e.extend("CloseProjectCommand",{_run:function(e,v,g){var h=this._process.params,_=h.getParam("project"),$=new l;$.ignoreStoppedProcess=!0,$.add("dataClose",function(e,l){p.message("프로젝트를 닫습니다."),m(function(){t.deactivate(null),n.close(_),a.refresh(),o.init(),r.init(),i.init(),s.init(),c.init(),u.init(),e()},f.busyDelayTime)});var E=this;$.add("memoryClose",function(e,t){d.closeData(function(){a.projectIsOpen(!1),e()})}),$.execute(function(t){h.setResponse({project:_}),console.log("# 프로젝트 데이터 삭제됨 : ",h),E._success(h,e,v),m(function(){d.gc()})})}});return v}var t=MODULE.core.instance;t.factory("CloseProjectCommand",e),e.$inject=["CommandBase","$autoBackup","$projects","$documents","$elements","$applications","$history","$selects","$assets","$groups","Process","$externalAPI","$busy","$timeout","Default"]}(),function(){function e(e,t,n,o,r,a,i){var s=e.extend("ModifyProjectCommand",{_run:function(e,s,c){function u(e,r){if(e&&e.assets&&!(e.assets.length<1)){var a=e.project;for(var i in e.assets){var s=e.assets[i];s.project=a,console.log("# Asset 변경사항 적용 (제거)",s);var c=new t(s),u=o.define(n.ASSET_REMOVE,c).getProcess();r.add("removeProcess_"+i,u)}}}function l(e,r){if(!(e&&e.assets&&e.assets.length<1)){var a=e.project;for(var i in e.assets){var s=e.assets[i];s.project=a;var c=s.asset;c||console.error("Asset UID는 필수 항목입니다."),s.useTempFile=!1;var u=new t(s),l=o.define(n.ASSET_ADD,u).getProcess();r.add("addProcess_"+i,l)}}}function d(e,t,n){function o(e){if(e&&e.paper){var n=r.get(t).value("paper");if(n.width!==e.paper.width||n.height!==e.paper.height)return!0}}var a="dataProcess";e.add(a,function(e,a){var s=o(n);n&&r.modify(t,n),s&&i.paperSizeChange(),e()})}function p(e,t){e.add("responseProcess",function(e,n){m.setResponse(t),console.log("# Project 데이터 수정 : ",m),e()})}var m=this._process.params,f=m.getParam("project"),v=m.getParam("data"),g=m.getParam("asset"),h=new a;g&&(g.remove&&(console.debug("# 에셋 제거 : ",g.remove),u(g.remove,h)),g.add&&(console.debug("# 에셋 추가 : ",g.add),l(g.add,h))),d(h,f,v),p(h,{project:f});var _=this;h.execute(function(){_._success(m,e,s)})}});return s}var t=MODULE.core.instance;t.factory("ModifyProjectCommand",e),e.$inject=["CommandBase","CommandParam","CommandName","$command","$projects","Process","$layout"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){var d=e.extend("NewProjectCommand",{_run:function(e,d){u.message("새 프로젝트 생성...");var p=this._process.params,m=p.getParam("project"),f=p.getParam("data"),v=n.create(m,f),g=v.uid();o.init(),r.init(),a.init(),i.init(),s.init(),c.init();var h=this;l.newData(g,function(n){return n?void h._error(n,e,d):(t.activate(g),p.setResponse({project:g}),console.log("# 새로운 Project 데이터 생성 : ",p),void h._success(p,e,d))})}});return d}var t=MODULE.core.instance;t.factory("NewProjectCommand",e),e.$inject=["CommandBase","$autoBackup","$projects","$documents","$elements","$history","$selects","$assets","$groups","$busy","$externalAPI"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){var m=e.extend("OpenProjectCommand",{_run:function(e,m,f){function v(e){return function(){var t=arguments;e&&l(function(){e.apply(null,t)})}}function g(e){e&&l(function(){e()})}function h(e,t,n,o){arguments.length<2?u.message(n):t&&u.progress(e,t,n),g(o)}var _=this._process.params,$=_.getParam("path");if(!$)throw new Error("불러올 대상(경로)이 지정되지 않았습니다.");var E=new t;E.ignoreStoppedProcess=!0;var y=!1;E.add("open",function(e,t){u.message("데이터를 불러오는 중입니다.",function(){var o={path:$};n.openData(o,v(e),v(t))})}),E.add("upgradability",function(e,t,n){if(!n)return y=!0,void e();u.message("버전 호환성 검사");var r,a=n;for(var i in a[p.APPLICATION])if(r=a[p.APPLICATION][i].version)break;o.upgradabilityMessage(r,function(o){return o?void g(function(){e(n)}):void u.message("작업을 취소합니다.",function(){t()})})}),E.add("parse",function(e,t,n){if(!n||y)return y=!0,void g(e);var r=n;u.message("데이터 유효성 검사"),o.run(r,function(t){g(function(){e(t)})},h)}),E.add("verification",function(e,t){if(y)return void e();var n=i.uid(),o=c.project(n);return o?void d.open({isTop:!0,templateUrl:"popup/verificationResult.html",controller:["$scope","$notice",function(e,t){e.close=function(e){t.close(e)},e.config={modal:!0,content:o,title:"데이터 보정 알림",ok:"확인",closeButton:!1},e.$on("$destroy",function(){e.config=null})}]}).then(function(t){e()},function(){e()}):void e()}),E.add("selectDocument",function(e,t){o.selectDocument(function(){e()})});var P=this;E.execute(function(t){var n=t.parse;return void 0===n?(console.warn("# 열기 도중 취소됨"),a.get().$$_resetChangedFlag(),void P._error("",e,m)):(n?(console.warn("TODO : 버전이 맞지 않아 호환되지 않는 데이터가 있습니다. 저장하면 이전 버전에서는 열수없습니다."),console.debug("# 아래 코드를 주석처리하면 저장하더라도 데이터 변경되지 않음 (수정된 페이지만 변경됨)"),console.debug("$applications.get().$$_resetChangedFlag()"),u.message("보정된 데이터가 있습니다. 자동 백업 준비 중입니다.")):(a.get().$$_resetChangedFlag(),u.message("프로젝트 열기 작업을 완료합니다.")),void g(function(){var t=i.uid();r.activate(t),i.get().$$_original.savePath=s.normalize($),_.setResponse({project:t}),P._success(_,e,m)}))})}});return m}var t=MODULE.core.instance;t.factory("OpenProjectCommand",e),e.$inject=["CommandBase","Process","$externalAPI","$openParser","$autoBackup","$applications","$projects","FileSystem","$verification","$busy","$timeout","$notice","UIDType"]}(),function(){function e(e,t,n,o,r,a,i){var s=e.extend("PreviewProjectCommand",{_run:function(e,r,i){var s=this._process.params,c=s.getParam("project"),u=s.getParam("publishType");if(!u)throw new Error("출판 유형이 지정되지 않았습니다.");var l=s.getParam("path");if(!l)throw new Error("미리보기 대상(경로)이 지정되지 않았습니다.");console.warn("# preview path 정보 : ",l);var d=new a;d.ignoreStoppedProcess=!0,d.onProgress=function(e,t){console.log("# 진행률 : ",e,"/",t)};var p=new n({project:c,path:l,publishType:u}),m=o.define(t.PROJECT_PUBLISH,p).getProcess();d.add("publish",m);var f=this;d.execute(function(t){console.log("파일 출판 결과 : ",t),s.setResponse({project:c,path:l,publishType:u,result:t}),f._success(s,e,r)})}});return s}var t=MODULE.core.instance;t.factory("PreviewProjectCommand",e),e.$inject=["CommandBase","CommandName","CommandParam","$command","$preview","Process","$busy"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){function m(e,t){function n(n){var r="페이지 : "+e.documentUID;c.progress(e.pageNum,t,r),o.createJS(e,function(e){n(e)})}return n}function f(e){function t(t){o.createHTML(e,function(e){t(e)})}return t}function v(e,t){for(var n,o=e.getNoneCopyValue("documents"),r=[],i=[],s=e.uid(),c=[],u=0;u<o.length;++u){var l=o[u];n=u+1,console.log("*page : ",n," - ",l);var d=a.pageNamePrefix+n,p=g(d,a.pageType,!0);r.push(p);var m=h(d);i.push(m);var f=a.dataJsPrefix+d+".js",v={pageNum:n,pageName:d,jsName:f,path:p.href,documentUID:l,projectUID:s};c.push(v)}var _={manifest:r,spine:i,pageHTML:c};t(_)}function g(e,t,n){var o={id:e,href:e+"."+t,mediaType:r.get(t)};return o}function h(e){var t={id:e};return t}function _(e){function t(t){o.createNAV(e,function(e){t(e)})}return t}var $=e.extend("PublishProjectCommand",{_run:function(e,r,g){var h=this._process.params,$=h.getParam("project"),E=s.get($),y=new t;y.ignoreStoppedProcess=!0,y.onProgress=function(e,t){console.log("# 진행률 : ",e,"/",t)};var P=h.getParam("publishType");P.preview||d.projectIsOpen(!1),y.add("build",function(e,t){c.message("Publish 폴더 초기화..."),o.build(function(){e()})},this),y.add("copyFiles",function(e,t){c.message("리소스 파일 복사..."),o.resourceCopy(function(){e()})},this),y.add("thumbnailCaptureClose",function(e,t){return u.isRunning()?(c.message("썸네일 이미지 확인중..."),void u.finishImmediately(function(){e()})):e()}),y.add("thumbnail",function(e,t){function n(e,t,n){console.log("	 썸네일 : "," : ",e,"/",t,n);var o=n.pageNum+" 페이지 썸네일 이미지 생성";c.progress(e,t,o)}for(var r=E.getNoneCopyValue("documents"),s=[],u=[],l=r.length,d=0;l>d;++d){var p=r[d],m=d+1,f="",v=i.getParameter(p,f,m);u.push(v)}u&&u.length&&s.push(function(e){var t=a.EPUB_OPS_FOLDER+a.PAGE_THUMBNAIL,o={ext:a.EXT_THUMBNAIL,destFolder:t,tasks:u};if(u.length<10)c.message("썸네일 이미지 생성...");else{var r="$$publish.thumbnail..onProgress";window[r]=n,o.onProgress=r}i.create(o,function(){window[r]&&delete window[r],e()})}),s.push(function(e){var t=a.EPUB_OPS_FOLDER+a.IMAGES_CAPTURE;o.delete_thumbnail(t,function(t){e(t)})}),s.push(function(e){var t=a.EPUB_OPS_FOLDER+a.IMAGES_MASTER_THUMB;o.delete_thumbnail(t,function(t){e(t)})}),async.waterfall(s,function(n){return n?t(n):void setTimeout(function(){e()},500)})},this),y.add("cerateOPF",function(e,t){c.message("OPF 파일 생성...");var r=n.PROJECT+"-",a=$.replace(r,""),i={metadata:{uid:a,title:E.value("subject"),description:E.value("description"),creator:E.value("creator"),publisher:E.value("publisher"),contributor:E.value("contributor"),language:E.value("language"),cover:E.value("cover")},manifest:void 0,spine:void 0,navigation:void 0};v(E,function(t){i.manifest=t.manifest,i.spine=t.spine,i.pageHTML=t.pageHTML,o.cerateOPF(i,function(){e(i)})})},this),y.add("createHTML",function(e,t,n){var o=n.pageHTML,r="페이지 생성 : "+o.length+" pages";c.progress(0,o.length,r);for(var a=[],i=0;i<o.length;++i){var s=o[i];a.push(m(s,o.length)),a.push(f(s))}async.waterfall(a,function(o){return o?t(o):void setTimeout(function(){e(n)},1e3)})},this),y.add("cerateNavition",function(e,t,n){var o=E.value("navigation");!o||o.length<1||(n.navigation=o,console.log("# 목차 구성 : ",n.navigation));var r=[];r.push(_(n)),async.waterfall(r,function(o){return o?t(o):void e(n)})},this),y.add("cerateMasterList",function(e,t,n){function r(e){function t(t){o.createMasterList(e,function(e){t(e)})}return t}var a=[];a.push(r(n)),async.waterfall(a,function(o){return o?t(o):void e(n)})},this),y.add("compress",function(e,t){l.run(h,function(n){d.projectIsOpen(!0),n?e(n):t()})});var w=this;y.execute(function(t){console.log("파일 출판 결과 : ",t),p(function(){h.setResponse({project:$,path:E.value("publishPath"),result:t}),w._success(h,e,r)},500)})}});return $}var t=MODULE.core.instance;t.factory("PublishProjectCommand",e),e.$inject=["CommandBase","Process","UIDType","$epub","$mime","FileSystem","$thumbnail","$projects","$busy","$capture","$publish","$applications","$timeout"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){var m=e.extend("RestoreProjectCommand",{_run:function(e,p,m){function f(e){return function(){var t=arguments;e&&u(function(){e.apply(null,t)})}}function v(e){e&&u(function(){e()})}function g(e,t,n,o){arguments.length<2?c.message(n):t&&c.progress(e,t,n),v(o)}var h=this._process.params,_=new t;_.ignoreStoppedProcess=!0;var $=!1;_.add("open",function(e,t){c.message("복구된 데이터를 불러오는 중입니다.",function(){var o={};n.restoreData(o,f(e),f(t))})}),_.add("upgradability",function(e,t,n){if(!n)return $=!0,void e();c.message("버전 호환성 검사");var r,a=n;for(var i in a[d.APPLICATION])r=a[d.APPLICATION][i].version;o.upgradabilityMessage(r,function(o){return o?void v(function(){e(n)}):void c.message("작업을 취소합니다.",function(){t()})})}),_.add("parse",function(e,t,n){if(!n||$)return $=!0,void v(e);var r=n;c.message("데이터 유효성 검사"),o.run(r,function(t){v(function(){e(t)})},g)}),_.add("verification",function(e,t){if($)return void e();var n=a.uid(),o=s.project(n);return o?void l.open({isTop:!0,templateUrl:"popup/verificationResult.html",controller:["$scope","$notice",function(e,t){e.close=function(e){t.close(e)},e.config={modal:!0,content:o,title:"데이터 보정 알림",ok:"확인",closeButton:!1},e.$on("$destroy",function(){e.config=null})}]}).then(function(t){e()},function(){e()}):void e()}),_.add("selectDocument",function(e,t){o.selectDocument(function(){e()})});var E=this;_.execute(function(t){var n=t.parse;return void 0===n?(console.warn("# 복구 도중 취소됨"),r.get().$$_resetChangedFlag(),void E._error("",e,p)):(n?(console.warn("TODO : 버전이 맞지 않아 호환되지 않는 데이터가 있습니다. 저장하면 이전 버전에서는 열수없습니다."),console.debug("# 아래 코드를 주석처리하면 저장하더라도 데이터 변경되지 않음 (수정된 페이지만 변경됨)"),console.debug("$applications.get().$$_resetChangedFlag()"),c.message("보정된 데이터가 있습니다. 자동 백업 준비 중입니다.")):(r.get().$$_resetBackupChangedFlag(),c.message("프로젝트 복구 작업을 완료합니다.")),void v(function(){var t=a.uid(),n=a.get(t);n&&n.$$_restoreOpenFlag(!0),i.activate(t),h.setResponse({project:t}),E._success(h,e,p)}))})}});return m}var t=MODULE.core.instance;t.factory("RestoreProjectCommand",e),e.$inject=["CommandBase","Process","$externalAPI","$openParser","$applications","$projects","$autoBackup","$verification","$busy","$timeout","$notice","UIDType","Default"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f,v,g){function h(e,t,n){function o(e,t,n){if(Array.isArray(e)){var o=e.indexOf(t);o>-1&&(e[o]=n)}else e[t]&&(e[n]=e[t],e[t]=null,delete e[t])}i.$$_data[n]=e,i.$$_current=n,i.$$_data[t]=null,delete i.$$_data[t],o(i.$$_saveQueue,t,n),o(i.$$_deleteQueue,t,n),
o(i.$$_backupQueue,t,n),o(i.$$_deleteBackupQueue,t,n),e=i.get(n),e.$$_original.uid=n,e.$$_original.name=n,m.activate(n),e.isChanged(!0)}function _(e,n,o){e.add("rename",function(e,r){console.warn("# Project 폴더 변경 : ",n,"-->",o);var a=p.TEMP_ROOT_MARKER+p.WORK_SPACE_MARKER+p.PROJECT_SPACE_MARKER,i=p.pathToActual(a);t._initData(o);var s=p.pathToActual(a);console.log("	- 변경전 :",i),console.log("	- 변경후 :",s),t.move([{src:i,dest:s}],function(t){t&&console.error("# Project 폴더 변경 실패 : ",t),e()})})}function $(e,t){var n=[o.ASSET,o.GROUP,o.PROJECT,o.SELECT,o.TOOL];for(var r in n)E(e,{project:t,category:n[r],task:"delete"})}function E(e,n){var r=n.project,a=r.replace(o.PROJECT,n.category);e.add(a,function(e,o){console.warn("# 이전 Project 파일들 제거 : ",a),n.uid=a,t.saveData(n,e,o)})}var y=e.extend("SaveAsProjectCommand",{_run:function(e,t,o){function r(e,t){var n=new g(t),o=f.define(v.PROJECT_SAVE,n).getProcess();e.add("saveProject",function(e,t){o.execute(function(t){e(t)})})}var a=this._process.params;console.log("	# param : ",a);var s=a.getParam("path");if(!s)throw new Error("저장할 대상(경로)이 지정되지 않았습니다.");l.message("프로젝트 저장...");var c=a.getParam("project"),u=i.get(c);s=s.replace(/\\/g,"/"),u.value("savePath",s),console.log("# save path 정보 : ",s);var d=u.$$_restoreOpenFlag();u.$$_restoreOpenFlag(!1);var p=new n;p.ignoreStoppedProcess=!0,p.onProgress=function(e,t){console.log("# 진행률 : ",e,"/",t)};var m,E,y=!1;d||(y=!0,E=i.createUID(),m=c,h(u,m,E),_(p,m,E),$(p,m)),E||(E=c),r(p,{saveAll:y,project:E,path:s});var P=this;p.execute(function(n){console.log("새이름으로 파일 저장 결과 : ",n),a.setResponse(n),P._success(a,e,t)})}});return y}var t=MODULE.core.instance;t.factory("SaveAsProjectCommand",e),e.$inject=["CommandBase","$externalAPI","Process","UIDType","$extractSaveData","$applications","$projects","$documents","$elements","$assets","$busy","$capture","FileSystem","$autoBackup","$command","CommandName","CommandParam"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m){function f(e,t,n){C.push(arguments)}function v(e){function t(){++r;var c=C[r];if(c){var l=c[0],d=c[1];if(!T){var m=void 0===c[2]?!0:c[2];m?s?u.message(l):u.progress(r+1,a,i+l):u.message(l)}d(function(){++o,o===D?(o=0,n=window.requestAnimationFrame(t)):t()})}else window.cancelAnimationFrame&&window.cancelAnimationFrame(n),p(function(){e(!0)})}var n,o=0,r=-1,a=C.length,i="변경된 내용 추출 ",s=3*D>a;T?t():(u.open({message:"저장할 데이터 개수 : "+O+" 개",delay:500}),p(function(){t()},100*m.animate.duration))}function g(e,t){for(var n in e){var o="(추가) "+n;f(o,h(e,t,n))}}function h(e,n,o){var r=e[o];return function(e){n.uid=o,n.data=r,n.type="json",t.saveData(n,e,e)}}function _(e,t){var n=e.getDeleteQueue();for(var o in n){var r="(제거) "+o;f(r,$(e,t,o))}}function $(e,n,o){function r(t){return e.$$removeDeleteQueue(o),t}return function(e){n.uid=o,n.type="json",t.saveData(n,r(e),r(e))}}function E(e){var o=e.project,r=o.replace(n.PROJECT,e.category);f(r,function(n){var o=a.get(),i=o.tooldata();e.uid=r,e.data=i,e.type="json",t.saveData(e,n,n)})}function y(e,t){for(var n in e){var o=e[n].path,r="(File Copy) "+n;f(r,P(o,t,n))}}function P(e,n,o){return function(o){n.file=e,t.saveFiles(n,o,o)}}function w(e,t){for(var n in e){var o=e[n].path,r="(File Delete) "+n;f(r,b(o,t,n))}}function b(e,n,o){function r(e){return c.$$removeDeleteQueue(o),e}return function(o){n.file=e,t.saveFiles(n,r(o),r(o))}}var C=[],O=0,T=!1,D=5,R=e.extend("SaveProjectCommand",{_run:function(e,p,h){function $(e){var n={onProcess:function(e,t,n){T||(1===arguments.length?u.message(arguments[0]):3*D>t?u.message("데이터를 저장 중입니다."):u.progress(e,t,"데이터 저장 "+n))},oneTimeLimit:D,archiveDesc:"저장하기 압축",project:R,title:A,path:b};S&&(n.legacy=S),t.saveZip(n,e,e)}var P=this._process.params;console.log("	# param : ",P);var b=P.getParam("path");if(!b)throw new Error("저장할 대상(경로)이 지정되지 않았습니다.");u.message("프로젝트 저장...");var R=P.getParam("project"),x=a.get(R);b=b.replace(/\\/g,"/"),x.value("savePath",b),console.log("# save path 정보 : ",b),x.$$_restoreOpenFlag(!1);var A=x.value("subject"),S=P.getParam("legacy");C=[];var M=P.getParam("saveAll")||!1;T=!1,d.project(R);var I=r.get(),N=I?I.needToSave():!1,j=o.saveApplication(T,M),L=o.saveProject(T),U=o.saveDocuments(T),k=o.saveElements(T),F=o.saveSelects(R,T,M),B=o.saveGroups(R,T,M),V=o.saveAssets(R,T,M);O=j.length+L.length+U.length+k.length+F.length+B.length+V.length+V.filesCounter,console.log("# 총 데이터 파일 개수 : ",M,O),f("thumbnailCaptureClose",function(e){return l.isRunning()?(u.message("썸네일 이미지 확인중..."),void l.finishImmediately(function(){e()})):e()}),f("meta",function(e){t.setMetaData({project:R},e,e)}),g(j.data,{project:R,path:b,category:n.APPLICATION}),g(L.data,{project:R,path:b,category:n.PROJECT}),g(U.data,{project:R,path:b,category:n.DOCUMENT,task:"add"}),_(i,{project:R,path:b,category:n.DOCUMENT,task:"delete"}),g(k.data,{project:R,path:b,category:n.ELEMENT,task:"add"}),_(s,{project:R,path:b,category:n.DOCUMENT,task:"delete"}),g(F.data,{project:R,path:b,category:n.SELECT}),g(B.data,{project:R,path:b,category:n.GROUP}),g(V.data,{project:R,path:b,category:n.ASSET}),E({project:R,category:"tool"}),console.log("폴더 (파일) 저장/ 삭제 : ",V.files),y(V.files,{project:R,path:b,task:"add"}),w(c.getDeleteQueue(),{project:R,path:b,task:"delete"});var G=this;v(function(){$(function(t){console.log("파일 저장 결과 : ",t),P.setResponse({project:R,path:b,changed:N,result:t}),G._success(P,e,p),T||(u.message("잠시만 기다려 주세요."),u.close(m.busyDelayTime))})})}});return R}var t=MODULE.core.instance;t.factory("SaveProjectCommand",e),e.$inject=["CommandBase","$externalAPI","UIDType","$extractSaveData","$applications","$projects","$documents","$elements","$assets","$busy","$capture","$verification","$timeout","Default"]}(),function(){function e(e,t,n,o,r,a,i){var s=e.extend("EditableGroupCommand",{_run:function(e,t){var n=this._process.params,o=n.getParam("document"),s=n.getParam("group"),c=r.get(o),u=!1;return n.isHistoryProcess&&"undo"==this._process.callStep&&(u=!0),u?void function(r){var u=n.getParam("oldData"),l={inGroup:c.value("inGroup"),select:c.get()},d=u.select,p=u.inGroup;c.clear(),c.value("inGroup",p),c.select(d),i.unselect(l.select),i.select(d);var m=a.isMaskElement(d);c.value("currentGroup",m),n.setResponse({document:o,group:s,oldData:l}),console.log("# 그룹 편집 상태 수정 (undo) : ",n),r._success(n,e,t)}(this):void function(r){function u(e){var t=function(e){console.log("# 편집 그룹내 이동 : ",e);for(var t=[];e;){t.push(e);var n=a.get(e),o=n.value("owner"),r=i.get(o);e=r.parentGroup()}return t}(e);c.editInGroup(t),c.clear();var n=[];return c.select(n),c.value("currentGroup",""),n}function l(e){c.clear();var t=""===e;c.editOutGroup(t);var n=[];return c.select(n),c.value("currentGroup",""),n}var d={inGroup:c.value("inGroup"),select:c.get()};console.log("* 변경되기 이전값 기록 (Data) : ",d,s);var p;p=s?u(s):l(s),i.unselect(d.select),i.select(p),n.setResponse({document:o,group:s,oldData:d}),console.log("# 그룹 편집 상태 수정 : ",n),r._success(n,e,t)}(this)},_getRedoCommand:function(){var e=o.define(t.GROUP_EDITABLE,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(t.GROUP_EDITABLE,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=new n({document:o,group:t.group,oldData:t.oldData});return r}});return s}var t=MODULE.core.instance;t.factory("EditableGroupCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$selects","$groups","$elements"]}(),function(){function e(e,t,n,o,r,a,i,s,c){function u(e){return e?i.get(e):a.get()}function l(e){return s.get(e[0]).parentGroup()}var d=e.extend("indexedPositionCommand",{_run:function(e,t){function n(e){var t=l(e),n=u(t),o=n.indexes(),r=e.map(function(e){return o.indexOf(e)});r.sort(function(e,t){return e-t});var a=r.map(function(e){var t=o[e];return t});return a}function o(e,t,n){var o=l(e),r=u(o),a=r.indexes(),i=a.filter(function(t){return e.indexOf(t)<0}),s=o===n;if(s){var c=t;e.forEach(function(e){var n=a.indexOf(e);t>n&&c--});var d=[c,0].concat(e);i.splice.apply(i,d)}if(r.value("indexes",i),!s){var p=u(n),m=p.indexes(),d=[t,0].concat(e);m.splice.apply(m,d),p.value("indexes",m)}}function a(e,t,n){function o(e,t){for(;e;){var n=i.get(e),o=n.value("owner");if(t&&!t(e,o))break;var r=s.get(o);e=r.parentGroup()}}function a(t){var n=!1;return o(t,function(t,o){return e.indexOf(o)>-1?(n=!0,!1):!0}),n}function c(t,n){var r=[];return o(t,function(t,n){return r.push(t),e.indexOf(n)>-1?!1:!0}),o(n,function(e,t){return r.push(e),!0}),r}var u=r.get(d),p=l(e);if(p===n)return void console.log("# 그룹내 이동 : 선택 목록 유지");console.log("# 그룹간 이동");var m=a(t);if(m){console.log("	- 그룹 체인 변경 (inGroup 변경) : 선택 목록 유지");var f=c(t,n);return void(f&&u.editInGroup(f))}var v=e.every(function(e){var t=s.get(e),n=t.value("selected");return n});return v?(console.log("	- 선택 항목 이동 : 선택 목록 해지"),u.clear(),u.value("currentGroup",""),void s.unselect(e)):void console.log("	- 비선택 항목 이동 : 선택 목록, 편집 그룹 관련 없음")}var c=this._process.params,d=c.getParam("document"),p=c.getParam("selects"),m=c.getParam("group"),f=c.getParam("index"),v=!1;if(c.isHistoryProcess&&"undo"==this._process.callStep&&(v=!0),v){var g=c.getParam("oldData");return function(e){function t(e,t){var n=u(e);n.value("indexes",t)}t(e.oldGroup,e.oldIndexes),t(e.uid,e.indexes)}(g.group),function(e){var t=r.get(d);t.clear(),t.select(e.selects),t.value("currentGroup",e.currentGroup),s.unselect(t.get()),s.select(e.selects),t.editInGroup(e.inGroup)}(g.select),function(e,t){e.forEach(function(e){var n=s.get(e);n.parentGroup(t||"")})}(p,g.group.oldGroup),void function(n){c.setResponse({document:d,selects:p,group:m,index:f}),console.log("# Layer 이동 (undo) : ",c),n._success(c,e,t)}(this)}var g=function(){if(!c.isHistoryProcess){var e=l(p),t=u(e),n=u(m),o=r.get(),a={group:{oldGroup:e,oldIndexes:t.indexes(),uid:m,indexes:n.indexes()},select:{selects:o.get(),inGroup:o.value("inGroup"),currentGroup:o.value("currentGroup")}};return console.log("undo를 위해 상태 기록 : ",a),a}}();p=n(p),o(p,f,m);var h=r.get(d),_=h.currentEditGroup();a(p,_,m),p.forEach(function(e){var t=s.get(e);t.parentGroup(m||"")}),function(n){c.setResponse({document:d,selects:p,group:m,index:f,oldData:g}),console.log("# Layer 이동 : ",c),n._success(c,e,t)}(this)},_getRedoCommand:function(){var e=o.define(t.INDEXED_POSITION,this._redoParam);return e},_getUndoCommand:function(){var e=o.define(t.INDEXED_POSITION,this._undoParam);return e},_setUndoParam:function(e){var t=e.getResponse(),o=t.document,r=new n({document:o,selects:t.selects,group:t.group,index:t.index,oldData:t.oldData});return r}});return d}var t=MODULE.core.instance;t.factory("indexedPositionCommand",e),e.$inject=["HistoryCommandBase","CommandName","CommandParam","$command","$selects","$documents","$groups","$elements","$arrange"]}(),function(){function e(e,t,n,o,r,a){var i=e.extend("DeleteTemplateCommand",{_run:function(e,i){var s=this._process.params,c=s.getParam("template"),u=t.get(c);if(!u)return i();var l=[],d=u.capture().original;l.push(function(e){t.remove(c),e()}),l.push(function(e){var t=n.USER_DATA_TEMPLATE_MARKER+"/asset-"+c,r=n.USER_DATA_TEMPLATE_MARKER+"/"+c,i={assetFolder:t,dataFile:r,thumbnail:d},s=n.pathMarkerInfo(),u={pathInfo:s,remover:[{dataName:"template",folder:s.virtual.template,files:i}]};o.template(u,function(t,n){t&&console.error("# 템플릿 Delete 에러 : ",t),a(function(){e()})})}),l.push(function(e){r.remove(c),e()});var p=this;async.waterfall(l,function(t){s.setResponse({template:c}),p._success(s,e,i)})}});return i}var t=MODULE.core.instance;t.factory("DeleteTemplateCommand",e),e.$inject=["CommandBase","$templates","FileSystem","$externalAPI","$contentTemplateSetting","$timeout"]}(),function(){function e(e,t,n,o,r,a,i,s,c){var u=e.extend("ExportTemplateCommand",{_run:function(e,o){var u=this._process.params,l=u.getParam("document"),d=u.getParam("path");if(!d)throw new Error("저장할 경로가 지정되지 않았습니다.");var p,m=[],f=this,v=t.uid();m.push(function(e){s.message("템플릿 내보내는 중..."),c.document(l),n.get(v,l,function(t){t.name=r.parsePath(d).fileName,p=t,e()})});var g=r.USER_DATA_TEMPLATE_MARKER;m.push(function(e){var t={path:g+"/_temp"};console.debug("# 임시 폴더 제거 : ",t.destFolder),a.remove(t,null,function(t){e()})}),m.push(function(e){var t=p.document,n=t.uid,o=p.uid,a=i.getParameter(n,o),s=r.EXT_THUMBNAIL,c={ext:s,destFolder:g+"/_temp",tasks:[a]};i.create(c,function(){var t=g+"/"+o+s;p.capture={original:t},console.log("# exportData : ",p),e()})}),m.push(function(e){var t=p,n=r.pathMarkerInfo(),o={pathInfo:n,exporter:[{dataName:"template",folder:n.virtual.template+"/_temp",content:t,compress:d}]};a.template(o,function(t,n){t&&console.error("# 템플릿 Export 에러 : ",t);var o=n.exporter;console.log("# 템플릿 데이터 (== exportData) : ",o[0].content),p=o[0].content,e()})}),async.waterfall(m,function(t){u.setResponse({data:p}),console.log("# Export 응답 : ",p),f._success(u,e,o)})}});return u}var t=MODULE.core.instance;t.factory("ExportTemplateCommand",e),e.$inject=["CommandBase","$projects","$exportTemplateData","Process","FileSystem","$externalAPI","$thumbnail","$busy","$verification"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){var d=e.extend("ImportTemplateCommand",{_run:function(e,t){var r=this._process.params,d=r.getParam("path");if(!d)throw new Error("불러올 대상(경로)이 지정되지 않았습니다.");var p,m=[],f=this,v=!1;m.push(function(e){var t=a.pathMarkerInfo(),n={pathInfo:t,importer:[{dataName:"template",folder:t.virtual.template,decompress:d,content:void 0}]};i.template(n,function(t,n){t&&console.error("# 템플릿 Import 에러 : ",t);var o=n.importer,r=o[0].content;console.debug("# 템플릿 import 데이터 : ",r),e(null,r)})}),m.push(function(o,r){var a;return o&&o.uid?n.get(o.uid)&&(a='" '+o.name+'" 템플릿은 이미 등록되어 있습니다.<br>삭제 후 다시 등록하시기 바랍니다.'):a="템플릿을 불러올 수 없습니다.<br>데이터가 없거나 잘못된 형식입니다.",a?void f._error({error:a},e,t):(s.message("템플릿 불러오는 중..."),void c(function(){p=o,r()},l.busyDelayTime))}),m.push(function(e){var t=p.document.version;u.upgradabilityMessage(t,function(t){return t?void e():(s.message("작업을 취소합니다."),v=!0,void e())})}),m.push(function(e){if(!v)return void e();var t=p.uid,n=a.USER_DATA_TEMPLATE_MARKER+"/asset-"+t,o=a.USER_DATA_TEMPLATE_MARKER+"/"+t,r=p.capture.original,s={assetFolder:n,dataFile:o,thumbnail:r},u=a.pathMarkerInfo(),l={pathInfo:u,remover:[{dataName:"template",folder:u.virtual.template,files:s}]};i.template(l,function(t,n){t&&console.error("# 템플릿 Delete 에러 : ",t),c(function(){e()})})}),m.push(function(e){if(v)return void e();var t=p.uid,r=n.add(t,p);console.log("# 템플릿 데이터 : ",r.$$_original),o.add(t),e()}),async.waterfall(m,function(n){r.setResponse({template:p?p.uid:void 0}),f._success(r,e,t)})}});return d}var t=MODULE.core.instance;t.factory("ImportTemplateCommand",e),e.$inject=["CommandBase","$importTemplateData","$templates","$contentTemplateSetting","Process","FileSystem","$externalAPI","$busy","$timeout","$openParser","Default"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f,v,g,h,_){var $=e.extend("InsertTemplateCommand",{_run:function(e,$){var E,y,P=this._process.params,w=P.getParam("template"),b=P.getParam("position"),C=this,O=[];O.push(function(e){var t=o.get(w);r.get(t,function(t){console.debug("# 변환된 템플릿 데이터 : ",t),E=t,y=E.document.uid,e()})}),O.push(function(e){var t=E.document.version;h.upgradabilityMessage(t,function(t){return t?void e():(s.message("작업을 취소합니다."),void e("작업을 취소합니다."))})}),O.push(function(e){function t(t,n){return t?console.log("결과 에러 : ",t):(console.log("# 결과 : ",n),void(1===n?(r=r.concat(a),e(null,r)):$()))}var n=l.get().value("fileMap"),o=E.project.fileMap,r=[],a=[],s=E.name;for(var c in o)if(c in n){var u=f.get(c),d=u.value("property").template;s!==d&&a.push({uid:c,oldTemplate:d,newTemplate:s,label:o[c]})}else r.push({uid:c,newTemplate:s});return a.length<1?e(null,r):void i.open({template:'<div jj-insert-template-check popup-dialog config="config">',pauseCommandTimer:!0,newTemplate:s,overlapFiles:a},t)}),O.push(function(e,t){s.message("템플릿 페이지 추가..."),function(){var e=E.project.fileMap,t=!0;for(var n in e){t=!1;break}t||(console.log("# FileMap 추가 : ",e),l.modify(l.uid(),{fileMap:e}))}(),console.log("# files 목록 : ",e),function(){var t=E.assets;e.forEach(function(e){var n=e.uid,o=e.newTemplate;t[n].property.template=o,console.log("* 추가 asset : ",t[n])})}(),t(null,e)}),O.push(function(e,t){for(var n in E.assets){var o=E.assets[n],r=f.get(n);r?(o.property&&(r=f.modify(n,{property:o.property})),r.counter(o._counter)):(r=f.add(n,o),e.forEach(function(e){var t=e.uid;n==t&&r.counter(1)}))}t()}),O.push(function(e){for(var t in E.groups){var n=E.groups[t];v.add(t,n)}e()}),O.push(function(e){for(var t in E.elements){var n=E.elements[t];g.add(t,n)}c(function(){e()},_.busyDelayTime)}),O.push(function(o){s.message("템플릿 파일 복사...");var r=t.USER_DATA_TEMPLATE_MARKER+"/asset-"+w,a=t.WORK_OPS_FOLDER;console.log("# 파일 원본(asset) : ",r),console.log("# 파일 복사(asset) : ",a),n.copy(r,a,function(t){return t?C._error(t,e,$):void c(function(){o()},_.busyDelayTime)})}),O.push(function(e){s.message("새로운 문서 생성..."),console.log("# 새로운 documentUID : ",y);var t=y,n=E.document;m.add(t,n),m.select(t),u.add(t),u.select(t),d.add(t),d.select(t),l.get().addDocument(t,b),c(function(){e()},_.busyDelayTime)}),O.push(function(e){s.message("layout 데이터 갱신...");var t=E.document;console.log("# layout 데이터 갱신 : ",t.indexes),p.refresh(t.indexes),c(function(){e()},_.busyDelayTime)}),O.push(function(e){s.message("썸네일 생성...");var t=P.getParam("ignoreCapture");t||a.update(y),c(function(){a.finishImmediately(function(){e()})},_.busyDelayTime)}),async.waterfall(O,function(t){return t?(console.log("# Insert 응답 : ",t),void C._error(null,e,$)):(P.setResponse({template:w,document:y}),console.log("# Insert 응답 : ",E),void C._success(P,e,$))})}});return $}var t=MODULE.core.instance;t.factory("InsertTemplateCommand",e),e.$inject=["CommandBase","FileSystem","$externalAPI","$templates","$insertTemplateData","$capture","$import","$busy","$timeout","$selects","$projects","$history","$layout","$documents","$assets","$groups","$elements","$openParser","Default"]}(),function(){function e(e,t,n,o,r,a,i){var s=e.extend("InstallTemplateCommand",{_run:function(e,s){function c(e){var t=r.pathMarkerInfo(),n={pathInfo:t,reader:[{dataName:"template",folder:t.virtual.template}]};a.template(n,function(t,n){if(t)return console.error("# 템플릿 Install 에러 : ",t),e(t);var o=n.reader;console.debug("# 템플릿 Install 데이터 : ",o[0].content),e(null,o[0].content)})}var u,l=this._process.params,d=this,p=new o;p.add("load",function(e,t){c(function(o,r){return o?(console.error("# 템플릿 로드 에러 : ",o),t()):void n(function(){e(r)},1e3)})}),p.add("install",function(e,n,o){u=o;for(var r in u){var a=u[r];t.add(r,a),i.add(r)}t.installed(!0),e()}),p.execute(function(){d._success(l,e,s)})}});return s}var t=MODULE.core.instance;t.factory("InstallTemplateCommand",e),e.$inject=["CommandBase","$templates","$timeout","Process","FileSystem","$externalAPI","$contentTemplateSetting"]}(),function(){function e(e){var t=e.extend("ModifyTemplateCommand",{_run:function(e,t){function n(n){console.log("# 등록 응답 : ",n),r._success(o,e,t)}var o=this._process.params;alert("ModifyTemplateCommand 구현되지 않았습니다.");var r=this;n({})}});return t}var t=MODULE.core.instance;t.factory("ModifyTemplateCommand",e),e.$inject=["CommandBase"]}(),function(){function e(e,t,n){function o(){return r}function r(o,r,a){function i(e){n.power=e}i(!1),o.close=function(e){i(!0),r.remove(),o.callback()},o.$on("$destroy",function(){o.config=null}),o.loadComplete=!1,e(function(){o.loadComplete=!0},0);var s=r.find("iframe");s.load(function(){var e=s[0].contentWindow;window.nw&&(e.$$_nw=window.nw),window.gui&&(e.$$_gui=window.gui)}),o.previewPath=t.trustAsResourceUrl(o.config.path)}return{restrict:"EA",templateUrl:"preview/jj-preview-viewer.html",replace:!0,scope:!0,compile:o}}var t=MODULE.core.instance;t.directive("jjPreviewViewer",e),e.$inject=["$timeout","$sce","$applications"]}(),function(){function e(e,t,n,o,r,a){return{preventDefault:function(){this._defaultPrevented=!0},defaultPrevented:function(){return this._defaultPrevented},isSuccess:!1,send:function(i,s,c){function u(t,n,o){return e.close(),200==n?t!=f.code&&(p="프로그램 사용이 허가되지 않았습니다. 프로그램 구입처에 확인하여 주십시오."):p="인증 정보를 확인할 수 없습니다. 프로그램 구입처에 확인하여 주십시오.<br>(status : "+n+")",p?void d(p,c,!1):(m.isSuccess=!0,void c(m.isSuccess))}function l(t,n,o){e.close(),p=-1==n?"인터넷 연결이 원활하지 않습니다. 확인 후 다시 시도하여 주십시오.":"인증 정보를 확인할 수 없습니다. 확인 후 다시 시도하여 주십시오.<br>(status : "+n+")",d(p,c,!1)}function d(e,t,n){m.isSuccess=n,n||(e+="<br>프로그램을 종료합니다."),o.open({isTop:!0,templateUrl:"popup/alert.html",controller:["$scope","$notice",function(t,n){t.close=function(e){console.log("	# 팝업창 저장하기 선택 결과 : ",e),n.close(e)},t.config={modal:!0,title:"사용자 인증",yes:"확인",content:r.trustAsHtml(e)},t.$on("$destroy",function(){t.config=null})}]}).then(function(e){t(m.isSuccess)},function(){t(m.isSuccess)})}var p,m=this;if(!s||window.VERSION&&window.VERSION.development)return console.warn("# Auth 인증 : 테스트 모드 - ",i),this.isSuccess=!0,c(!0);if(!i||!i.com||!i.code)return console.error("# Auth 인증 : 인증 정보 없음 - ",i),p="인증 정보를 확인할 수 없습니다. 프로그램 구입처에 확인하여 주십시오.",void d(p,c,!1);var f={code:i.com+"-"+i.code,version:a.version()};console.debug("	* 인증 [",i.com,"] : ",f.code);var v={method:"POST",url:s,timeout:1e4,data:f};v.data=t(v.data),e.open({delay:10}),n(v).then(function(e){u(e.data,e.status,e.headers)},function(e){l(e.data,e.status,e.headers)})}}}var t=MODULE.core.instance;t.service("$auth",e),e.$inject=["$busy","$httpParamSerializer","$http","$notice","$sce","$version"]}(),function(){function e(e,t,n,o,r,a){return{preventDefault:function(){this._defaultPrevented=!0},defaultPrevented:function(){return this._defaultPrevented},isSuccess:!1,send:function(a,i,s){function c(e){var t=e.message;switch(e.code){case"40":t="인증에 필요한 정보가 충분하지 않습니다.<br>("+t+")";break;case"50":t="전송 데이터 형식이 잘못되었습니다.<br>("+t+")";break;case"56":t="발급되지 않은 라이센스 번호이거나 등록되지 않은 디바이스입니다.";break;case"61":t="사용 정지된 라이센스 번호를 사용하였습니다.";break;case"62":t="만료된 라이센스 번호를 사용하였습니다.";break;case"63":t="허용된 설치 디바이스 개수를 초과하였습니다."}return t}function u(t,n,o){console.warn("	* 응답 [",n,"] : ",t),e.close();var r=c(t);return 200==n?t&&"00"==t.code||(p="프로그램 사용이 허가되지 않았습니다. 프로그램 구입처에 확인하여 주십시오.",r&&(p=p+'<p style="color:red;">내용 : '+r+"</p>")):(p="인증 정보를 확인할 수 없습니다. 프로그램 구입처에 확인하여 주십시오.<br>(status : "+n+")",r&&(p=p+'<p style="color:red;">'+r+"</p>")),p?void d(p,s,!1):(m.isSuccess=!0,void s(m.isSuccess))}function l(t,n,o){console.error("	* 응답 에러 [",n,"] : ",t),e.close(),p=-1==n?"인터넷 연결이 원활하지 않습니다. 확인 후 다시 시도하여 주십시오.":"인증 정보를 확인할 수 없습니다. 확인 후 다시 시도하여 주십시오.<br>(status : "+n+")",d(p,s,!1)}function d(e,t,n){m.isSuccess=n,n||(e+="<br><br>프로그램을 종료합니다."),o.open({isTop:!0,templateUrl:"popup/alert.html",controller:["$scope","$notice",function(t,n){t.close=function(e){console.log("	# 팝업창 저장하기 선택 결과 : ",e),n.close(e)},t.config={modal:!0,title:"사용자 인증",yes:"확인",content:r.trustAsHtml(e)},t.$on("$destroy",function(){t.config=null})}]}).then(function(e){t(m.isSuccess)},function(){t(m.isSuccess)})}var p,m=this;if(window.VERSION&&window.VERSION.development){if(!i)return console.warn("# Auth2 인증 : 테스트 모드 - ",a),this.isSuccess=!0,s(!0);a.com||(a=angular.extend({},a,{com:"demo"}))}if(!a||!a.address||!a.licensekey)return console.error("# Auth2 인증 : 인증 정보 없음 - ",a),p="인증 정보를 확인할 수 없습니다.<br>문제가 계속되면 프로그램 구입처에 확인하여 주십시오.",void d(p,s,!1);var f={code:a.licensekey,mac:a.address};console.warn("	* 라이센스 인증 [",a.com,"] : ",f.code);var v={method:"POST",url:i,timeout:1e4,data:f};v.data=t(v.data),e.open({delay:10}),n(v).then(function(e){u(e.data,e.status,e.headers)},function(e){l(e.data,e.status,e.headers)})}}}var t=MODULE.core.instance;t.service("$auth2",e),e.$inject=["$busy","$httpParamSerializer","$http","$notice","$sce","$version"]}(),function(){function e(){function e(){}var t=function(){};return e.prototype={_currentPattern:void 0,_onSuccess:void 0,_onFail:void 0,setPattern:function(e,n,o){this._currentPattern=e,this._onSuccess=n,this._onFail=o,t(this.hasPattern?"패턴검사 가능":"패턴이 정의되지 않았습니다.")},hasPattern:function(){return this._currentPattern&&this._currentPattern.length>1},resetPattern:function(e,t){e=e||this.target,t=t||this._currentPattern,this.clear(),this.deletePattern(),this.createPattern(e),this.setPattern(t)},destroy:function(){this.clear(),this.deletePattern&&this.deletePattern(),this._currentPattern=null,this._onSuccess=null,this._onFail=null},target:void 0,deletePattern:void 0,createPattern:function(e){function t(){r||(r=event.type.indexOf("touchstart")>-1,o.startGesture())}function n(){setTimeout(function(){r=!1},50),r&&event.type.indexOf("touch")<0||o.endGesture()}if(e){var o=this,r=!1;this.deletePattern=function(){o.target&&($(e).off("mousedown touchstart",t),$(e).off("mouseup touchend",n),o.target=null)},$(e).on("mousedown touchstart",t),$(e).on("mouseup touchend",n),this.target=e}},MIN_SHORT:10,MAX_SHORT:220,MIN_LONG:220,MAX_LONG:900,MIN_VARY_LONG:900,MAX_VARY_LONG:2500,MAX_INTERVAL:2500,RETRY_INTERVAL:100,_sTime:0,_eTime:0,getTimer:function(){return(new Date).getTime()},startGesture:function(){this.clearNextInterval(),this._sTime=this.getTimer()},endGesture:function(){this._eTime=this.getTimer(),this.checkProgress()},getGestureDuration:function(){return this._eTime-this._sTime},_gestureIndex:-1,checkProgress:function(){if(!this.hasPattern)return void t("패턴이 정의되지 않았습니다.");this._gestureIndex<0&&t("패턴 비교 시작"),++this._gestureIndex;var e,n,o=this._currentPattern[this._gestureIndex];switch(o){case 0:e=this.MIN_SHORT,n=this.MAX_SHORT;break;case 1:e=this.MIN_LONG,n=this.MAX_LONG;break;case 2:e=this.MIN_VARY_LONG,n=this.MAX_VARY_LONG}var r=this.getGestureDuration();return t("delay : ",r),e>r||r>n?void this.patternFailed():this._gestureIndex==this._currentPattern.length-1?void this.patternComplete():void this.nextPattern()},patternComplete:function(){this.clear(),this.dispatchEvent("success"),t("성공")},patternFailed:function(){this.clear(),this.dispatchEvent("fail"),this.setRetryInterval(),t("실패")},dispatchEvent:function(e){"success"==e?this._onSuccess&&this._onSuccess():"fail"==e&&this._onFail&&this._onFail()},clear:function(){this.clearNextInterval(),this._gestureIndex=-1,this._sTime=this._eTime=-1},nextPattern:function(){this.setNextInterval()},_nextIntervalID:-1,setNextInterval:function(){function e(){t.clearNextInterval(),t.patternFailed()}var t=this;this.clearNextInterval(),this._nextIntervalID=setInterval(e,this.MAX_INTERVAL)},clearNextInterval:function(){-1!=this._nextIntervalID&&clearInterval(this._nextIntervalID),this._nextIntervalID=-1},_retryIntervalID:-1,setRetryInterval:function(){function e(){n.clearRetryInterval(),n.createPattern(o),t("재검사 대기")}var n=this,o=this.target;this.clearRetryInterval(),this._retryIntervalID=setInterval(e,this.RETRY_INTERVAL),this.deletePattern()},clearRetryInterval:function(){this._retryIntervalID&&clearInterval(this._retryIntervalID),this._retryIntervalID=-1}},e}var t=MODULE.core.instance;t.factory("BeatPattern",e)}(),function(){function e(e,t){var n=window.$$__nodeAPI,o=0==window.location.protocol.indexOf("http");console.debug("\n"),console.debug("######################################"),console.debug(n?"# node API를 사용합니다.":o?"# Server API를 사용합니다.":"# Native API를 사용합니다."),console.debug("######################################"),console.debug("\n");var r=e.extend("Call",{_callAPI:function(e){if(n)return n(e),e;if(o){var r=t.callServer(e);return r}return window.location.assign(e),e}});return new r}var t=MODULE.core.instance;t.service("$communication",e),e.$inject=["Communication","$server"]}(),function(){function e(e,t,n){var o=window.$$__nodeAPI,r=0==window.location.protocol.indexOf("http");if(r){var a=e.extend("NativeServer",n);return new a}if(!o){var i=e.extend("Native",{});return new i}var s=e.extend("NativeNode",t);return new s}var t=MODULE.core.instance;t.service("$nativeInterface",e),e.$inject=["NativeInterface","NativeInterface_node","NativeInterface_server"]}(),function(){function e(e,t,n,o){function r(r,a){document.activeElement.blur(),n.pause();var r=r||{},i=angular.element('<div jj-file-dialog-box config="config">');r.isDirectory&&(r.directoryDesc=r.directoryDesc||"Select Folder",r.workingDir=o.pathToActual(r.workingDir||o.APP_ROOT_MARKER));var s=e.$new(!0);s.config=angular.copy(r),s.config.show=!0,s.config.autoRemove=!0,s.callback=function(e){n.resume();var t=e?r.multiple?e:e.path:"";a&&a(t)},t(i)(s),angular.element("body").append(i)}var a={dialog:{getOpenInformation:function(e,t){r(e,function(e){var n={path:e};t(n)})},getSaveAsInformation:function(e,t){r(e,function(e){var n={path:e};t(n)})},getPublishInformation:function(e,t){r(e,function(e){var n={path:e};t(n)})}}};return a}var t=MODULE.core.instance;t.service("NativeInterface_node",e),e.$inject=["$rootScope","$compile","$key","FileSystem"]}(),function(){function e(e){function t(e){console.debug("# 서버 요청 : "+e+"은(는) 사용되지 않습니다.")}var n={api:{configuration:e.prototype.configuration,setTitle:function(e,n){t("setTitle"),n&&n(null,{})},exit:function(){t("exit")}}};return n}var t=MODULE.core.instance;t.service("NativeInterface_server",e),e.$inject=["NativeInterface"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f,v,g,h,_,$,E,y){return{_versions:[],getVersions:function(){return this._versions},_selectVersion:null,_lastestVersion:null,_hideUpdateAlarm:!1,_ignoreAlert:!1,_isAutoRun:!1,_installedPath:void 0,_auth:void 0,_hasDownloadFile:!1,hasDownloadFile:function(){return this._hasDownloadFile},_requestError:null,getRrequestError:function(){return this._requestError},_setScreenProtect:function(e){o.protect=e},request:function(e,t,n){if(window.VERSION&&window.VERSION.development?(this._auth={com:"demo"},console.warn("# 업데이트 : 테스트 모드 - ",this._auth)):e.com&&(this._auth={com:e.com}),!t||!this._auth||!this._auth.com)return console.warn("# Updater  : 인증 정보 없음"),void(n&&n());this._isAutoRun=!0;var o=[];this._requestError=null,this._selectVersion=null,o.push(this._requestHttp(t)),o.push(this._versionCheck()),o.push(this._getUpdateAlarm()),this._hasDownloadFile=!1,o.push(this._downloadCheck()),this._ignoreAlert=!1,o.push(this._firstRunAlert()),o.push(this._firstRunToast()),this._update(o,n)},update:function(e,t,n){this._requestError?this.request(e,t,n):this._update(null,n)},_isSelectRun:!1,updateVersion:function(e,t){if(e&&!this._requestError){var n=[],o=angular.copy(e);this._selectVersion=o,n.push(this._versionCheck()),this._isSelectRun=!0,this._hasDownloadFile=!1,n.push(this._downloadCheck());var r=this;this._update(n,function(e){t&&t(e),r._selectVersion=r._versions[r._versions.length-1]})}},_update:function(e,t){e=e||[],this._downloadProcess(e),this._installProcess(e),this._run(e,function(e){t&&t(e)})},_downloadProcess:function(e){e=e||[],this._isAutoRun||(this._ignoreAlert=!1,this._hasDownloadFile=!1,e.push(this._downloadCheck())),e.push(this._downloadCompleteCheck()),e.push(this._download()),e.push(this._downloadCompleteCheck())},_installProcess:function(e){e.push(this._install()),this._isRestart=!1,e.push(this._installComplete()),e.push(this._startNewVersion()),e.push(this._exit())},_run:function(t,n){function o(){async.waterfall(t,function(t){r._isAutoRun=!1,r._isSelectRun=!1,e.close(),s(function(){var e="업데이트 작업이 완료되었습니다.";t?t.message?g.setMessage(t.message,h.ALERT,_.NORMAL):t.error?g.setMessage(t.error,h.WARN,_.FAIL):console.log("# 업데이트 결과 : ",t):(console.log("# 업데이트 성공"),g.setMessage(e,h.ALERT,_.NORMAL)),r._setScreenProtect(!1),n&&n(t)},500)})}var r=this;s(function(){o()},100)},_requestHttp:function(e){var o=this;return function(r){function a(e,t,n){console.warn("	* 업데이트 응답 [",t,"]");var a;200===t?e||(a="(Status "+t+") 업데이트 서버로부터 받은 정보가 없습니다."):a="(Status "+t+") 업데이트 서버에서 정상적인 응답을 받지 못하였습니다.",o._requestResult(a,e,r)}function i(e,t,n){console.error("	* 업데이트 응답 에러 [",t,"]");var a;a=-1==t?"인터넷 연결이 원활하지 않습니다. 확인 후 다시 시도하여 주십시오.":"(Status "+t+") 업데이트 서버에서 정상적인 응답을 받지 못하였습니다.",o._requestResult(a,e,r)}var s={method:"GET",url:e,data:{},timeout:1e4};s.data=t(s.data),n(s).then(function(e){a(e.data,e.status,e.headers)},function(e){i(e.data,e.status,e.headers)})}},_requestFile:function(e){var t=this;return function(n){
d.readFile(e,null,function(e,o){t._requestResult(e,o,n)})}},_requestResult:function(e,t,n){if(e)return this._requestError=e,n(e);if(!t)return void n({message:"응답받은 업데이트 데이터가 없습니다."});try{"string"==typeof t&&(t=JSON.parse(t)),console.warn("# 업데이트 정보 : ",t)}catch(o){return void n(o)}var r=this._auth.com;if(!t||!t[r]||!Array.isArray(t[r]))return void n({message:"최신 버전에 대한 정보가 없습니다. ("+r+")"});var a=t[r];this._versions=a||[],this._lastestVersion=a[a.length-1],this._selectVersion=this._lastestVersion;var i=0;this._selectVersion.size&&(i=this._selectVersion.size.replace(/,/g,""),i=Math.ceil(parseInt(i,10)/1024)),this._selectVersion.size=i,n(e)},_isLastestVersionInstalled:!1,_selectIsLastestVersion:!0,_currentIsLastestVersion:!0,isUpdatable:function(){return this._currentIsLastestVersion||this._isLastestVersionInstalled},_versionCheck:function(){var e=this;return function(t){var n=i.version(),o=i.versionName()+" "+e._lastestVersion.version,r=e._selectVersion,a=i.versionName()+" "+r.version;r._currentVersion=n,r._newVersion=a,e._currentIsLastestVersion=i.getLast(o,n)<1,e._selectIsLastestVersion=i.getLast(o,a)<1,console.log("	* Current Version Is Lastest : ",e._currentIsLastestVersion),console.log("	* Install Version Is Lastest : ",e._currentIsLastestVersion);var s=i.getLast(a,n);e._selectIsCurrentVersion=Boolean(0===s||-2===s),t()}},_getDownloadedFile:function(){var e=l.TEMP_ROOT_MARKER+l.workspacePrefix+l.UPDATER,t=l.parsePath(this._selectVersion.file);return e+"/"+t.file},_getVersionExecuteFile:function(){return this._installedPath+"/"+l._platform+"/"+l.executeFile},_downloadCheck:function(){var e=this;return function(t){var n=e._currentIsLastestVersion||e._isLastestVersionInstalled,o="최신 버전입니다.",a="설치할 버전은 현재 버전과 같습니다.";if(e._isSelectRun){if(e._selectIsCurrentVersion){var s=a+'<br>현재 실행중인 버전은 설치할수 없습니다.<p class="markBlock" style="font-weight: bold; margin-bottom:0;">설치 버전 : '+i.versionName()+" "+e._selectVersion.version+"</p>";return void r.alert({content:s,title:"실행중인 버전",ok:"확인",isTop:!0}).then(function(){t({message:a})})}}else{if(e._selectIsCurrentVersion)return t(a);if(n)return t(o)}var c=e._getDownloadedFile();d.exist(c,function(n){console.log("# 다운로드 파일 체크 : ",n,c),e._hasDownloadFile=n,t()})}},_firstRunAlert:function(){var e=this;return function(t){function n(t,n){return void 0===n||0>=n?void t({message:"다음에 업데이트합니다."}):(2===n&&(e._hasDownloadFile=!1),e._ignoreAlert=!0,void t())}if(!e._isAutoRun)return t();if(e._hideUpdateAlarm)return t();var o=e._isAutoRun;e._isAutoRun=!1;var s,c,u,l=e._hasDownloadFile;l?(s="업데이트 알림",c="다운로드된 최신 업데이트 버전이 있습니다. 설치 하시겠습니까?",u="설치"):(s="다운로드 알림",c="최신 업데이트 버전을 다운로드할 수 있습니다. 다운로드 하시겠습니까?",u="다운로드");var d={versionName:i.versionName(),version:e._selectVersion,hideUpdateAlarm:e._hideUpdateAlarm};r.open({isTop:!0,templateUrl:"updater/updateAlarm.html",controller:["$scope","$notice",function(e,t){e.close=function(e){t.close(e)},e.config={content:a.trustAsHtml(c),title:s,no:o?"취소":"다음에 알림",ok:u,redownload:l?"다시 다운로드":null,showHideOption:o},e.info=d,e.link_api=function(e){p.weblink(e)},e.$on("$destroy",function(){e.config=null})}]}).then(function(o){if(d.hideUpdateAlarm===e._hideUpdateAlarm)return void n(t,o);var r=e._setUpdateAlarm(d.hideUpdateAlarm);r(function(){n(t,o)})},function(){t("업데이트 알림창 취소")})}},_firstRunToast:function(){var e=this;return function(t){if(!e._isAutoRun)return t();if(e._ignoreAlert)return t();e._isAutoRun=!1;var n,o=e._selectVersion._newVersion;n=e._hasDownloadFile?"<b>"+o+"</b> 다운로드 완료.<br>지금 업데이트할 수 있습니다.":"<b>"+o+"</b> 업데이트.<br>지금 다운로드할 수 있습니다.",c.open(n,{hasBackdrop:!0,clickBackdropToClose:!0,className:"updateAlarm",delay:c.SHORT,position:"bottom left"}),t("사용자 액션 기다림")}},_downloadCompleteCheck:function(){var e=this;return function(t){if(e._ignoreAlert)return t();var n,o=e._hasDownloadFile,r=e._selectVersion._newVersion;n=o?"<h3>"+r+" 설치</h3><p>다운로드된 최신 업데이트 버전이 있습니다<br>설치하시겠습니까?</p>":"<h3>"+r+" 업데이트</h3><p>업데이트 버전을 다운로드할 수 있습니다.<br>다운로드 후 설치 하시겠습니까?</p>",c.open(n,{template:"updater/toast-download.html",delay:0,position:"bottom left",hasBackdrop:!0,clickBackdropToClose:!0,redownload:o?"다시 다운로드":null,ok:"예",no:"아니오",link_api:function(){var t=e._selectVersion.note.release;p.weblink(t)}}).then(function(n){n>0?(2===n&&(e._hasDownloadFile=!1),e._ignoreAlert=!0,t()):t({message:"다음에 업데이트합니다."})})}},_download:function(){var t=this;return function(n){function o(t,n,o){var r=Math.ceil(t/1024),a=Math.ceil(n/1024),i=t===n?"다운로드가 완료되었습니다.":"업데이트 파일을 다운로드합니다.";e.progress(r,a,{unit:" Kb",cancel:function(){d.updateDownloadCancel()},message:i})}function r(t,n,o){var r=Math.ceil(t/1024),a=Math.ceil(n/1024);e.progress(r,a,{unit:" Kb",cancel:function(){},message:"다운로드를 취소합니다."}),s(function(){e.progress(0,a,{unit:" Kb",cancel:function(){},message:"업데이트를 취소합니다."})},1e3)}function a(o){delete window[i],delete window[c],t._hasDownloadFile=o?!1:!Boolean(o),s(function(){e.close(),n(o)},1e3)}if(t._setScreenProtect(!0),t._hasDownloadFile)return n();e.open({message:"다운로드를 시작합니다."}),g.setMessage("업데이트 파일을 다운로드 중입니다.",h.WARN,_.NORMAL);var i="_updateDownloadProcess",c="_updateDownloadCancel";window[i]=o,window[c]=r;var u={onProgress:i,onCancel:c,src:t._selectVersion.file,dest:t._getDownloadedFile()};d.updateDownload(u,function(e,t){a(t.isCancel?{message:"다운로드를 취소하였습니다."}:e?{error:e}:null)})}},_install:function(){var t=this;return function(n){function o(e){var t=e||"업데이트 작업이 취소되었습니다.";c.message(t,{delay:c.SHORTEST})}function r(e){void 0!==e&&g.setMessage(e,h.ALERT,_.NORMAL)}function a(){t._selectIsLastestVersion&&(t._isLastestVersionInstalled=!0),n()}function i(e){o(e),n({message:"업데이트 작업이 취소되었습니다."})}var s=t._selectVersion._newVersion;g.setMessage("업데이트( "+s+" ) 버전을 설치합니다.",h.WARN,_.PROCESS);var u=new f({versionName:t._selectVersion._newVersion,installFile:t._getDownloadedFile()});m._allowStatus=!0;var l=v.getProcess(u);m.execute(l,function(n){if(m._allowStatus=!1,e.close(),console.log("# 업데이트 결과 : ",n),n){var o=n.installedVersionCheckProcess,s=n.installProcess;if(o){if(void 0!==o.error)return void i(o.error)}else{if(!s)return void i();if(s.getResponse){var c=s.getResponse();t._installedPath=c.pathString}else if(r(s.message),void 0!==s.error)return void i(s.error)}}return t._installedPath?void a():void i("업데이트 설치 작업을 종료합니다.")})}},_installComplete:function(){var e=this;return function(t){var n=e._selectVersion._newVersion,o='다음 위치에 새 버전이 설치되었습니다.<p class="markBlock"><b>'+e._installedPath+"</b></p>프로그램 종료 후 새 버전을 시작합니다."+(E.get()?"<br>저장하지 않은 데이터는 삭제됩니다.":"")+"<br>계속하시겠습니까?";r.confirm({content:o,title:n+" 설치 완료",cancel:"설치 종료",ok:"새 버전 시작",closeButton:!1}).then(function(n){e._isRestart=n>0,t()},function(e){t("다시 시작 취소 : "+e)})}},_startNewVersion:function(){var e=this;return function(t){if(!e._isRestart)return t();var n=e._getVersionExecuteFile(),o={args:[],command:n};console.log("# 재시작 하여 업데이트를 마무리 하시기 바랍니다. : "),d.exec(o,function(e,n){console.log("# 재시작 : ",n),t()})}},_exit:function(){var e=this;return function(t){return e._isRestart?(y.exit({_ignoreSave:!0}),void t()):t()}},_getUpdateAlarm:function(){var e=this;return function(t){var n=$.data("updater");e._hideUpdateAlarm=void 0===n?!1:n.hideUpdateAlarm,t()}},_setUpdateAlarm:function(e){var t=this;return function(n){t._hideUpdateAlarm=e,$.data("updater","hideUpdateAlarm",e),$.save(function(){n()})}}}}var t=MODULE.core.instance;t.service("$updater",e),e.$inject=["$busy","$httpParamSerializer","$http","$applications","$notice","$sce","$version","$timeout","$toast","$mdToast","FileSystem","$externalAPI","$util","$command","CommandParam","$updateApplicationMacro","$status","MessageType","StatusIcon","$store","$documents","$commandController"]}(),function(){function e(e){var t=e.extend("ServerNote",{getRequestURI:function(e,t){var n="/jikji/"+t+"/"+e+".do";return n}});return new t}var t=MODULE.core.instance;t.service("$server",e),e.$inject=["Server"]}(),function(){function e(e,t,n,o,r,a,i){var s=e.create("Server",{_parse:function(e){var t=e.replace(/noteProtocol:\/\/.+\?data=/g,"");return t=decodeURIComponent(t),JSON.parse(t)},getRequestURI:function(e,t){throw new Error("서버 호출 URI 정의 함수를 오버라이딩 하지 않았습니다.")},callServer:function(e){function t(e){console.debug("	* 응답 [",typeof e,"] : ",e);var t=JSON.stringify(e.result);r(t)}function n(e){console.debug("	* 응답 에러 [",typeof e,"] : ",e);var t=JSON.stringify(e.result);r(t)}var o=this._parse(e);console.debug("call : ",o);var r=window[o.callBack]||function(){},a=o.api,i=o.parameters._pobj,s=this.getRequestURI(a,i),c={request:{data:o,method:"POST",url:s}};return this.request(c).then(angular.bind(this,t),angular.bind(this,n)),c},request:function(e){function s(n,o,a){console.log("	* success : [",o,"] ",n),u.resolve({uid:e.uid,success:o,message:t[o],result:n}),console.debug("# 서버 호출 완료 : ",e.request.url),r.close(1e3)}function c(n,o,i){n=n||{};var s;if(n.error?(s=n.error.message||n.error||s,console.debug("	* http : [",o,"] ",s),n.error.stack&&console.error(n.error.stack)):(s=n.message||t[o],console.debug("	* http : [",o,"] ",n)),u.reject({uid:e.uid,error:o,message:s,result:n}),0>o)a.message("서버 응답이 없습니다.");else{var c=s?" <br> "+s:"";a.message("서버 요청 실패"+c)}console.debug("# 서버 요청 실패 : ",e.request.url),r.close(1e3)}var u=e.defer||o.defer();return console.log("\n\n--------------------------------"),console.debug("# 서버 요청 : [",e.request.method,"] ",e.request.url),console.debug("	* request : ",e.request),e.request.url&&e.request.method?(e.request.timeout=e.request.timeout||6e4,r.open({delay:1e3}),e.request.data=i(e.request.data),n(request).then(function(e){s(e.data,e.status,e.headers)})["catch"](function(e){c(e.data,e.status,e.headers)}),u.promise):void a.message("서버 요청을 할 수 없습니다.")}});return s}var t=MODULE.core.instance;t.factory("Server",e),e.$inject=["$superClass","StatusCode","$http","$q","$busy","$toast","$httpParamSerializer"]}(),function(){var e=MODULE.core.instance;e.constant("StatusCode",{100:"Continue",101:"Switching protocols",200:"OK, 전송 성공",201:"Created, POST 명령 실행 및 성공",202:"Accepted, 서버가 클라이언트 명령을 받음",203:"Non-authoritative information, 서버가 클라이언트 요구 중 일부만 전송",204:"No content, 클라언트 요구을 처리했으나 전송할 데이터가 없음",205:"Reset content",206:"Partial content",300:"Multiple choices, 최근에 옮겨진 데이터를 요청",301:"Moved permanently, 요구한 데이터를 변경된 임시 URL에서 찾았음",302:"Moved temporarily, 요구한 데이터가 변경된 URL에 있음을 명시",303:"See other, 요구한 데이터를 변경하지 않았기 때문에 문제가 있음",304:"Not modified 웹페이지에서 요청만하고 자신의 브라우저의 캐쉬를 사용하는 경우",305:"Use proxy",400:"Bad request, 클라이언트의 잘못된 요청으로 처리할 수 없음",401:"Unauthorized, 클라이언트의 인증 실패",402:"Payment required, 예약됨",403:"Forbidden, 접근이 거부된 문서를 요청함",404:"Not found, 요청에 응답할 문서를 찾을 수 없음",405:"Method not allowed, 리소스를 허용안함",406:"Not acceptable, 허용할 수 없음",407:"Proxy authentication required, 프록시 인증 필요",408:"Request timeout, 요청시간이 지남",409:"Conflict",410:"Gone, 영구적으로 사용할 수 없음",411:"Length required",412:"Precondition failed, 전체조건 실패",413:"Request entity too large,",414:"Request-URI too long, URL이 너무 김",415:"Unsupported media type",500:"Internal server error, 내부서버 오류(잘못된 스크립트 실행시)",501:"Not implemented, 클라이언트에서 서버가 수행할 수 없는 행동을 요구함",502:"Bad gateway, 서버의 과부하 상태",503:"Service unavailable, 외부 서비스가 죽었거나 현재 멈춤 상태",504:"Gateway timeout",505:"HTTP version not supported"})}(),function(){function e(e,t,n,o,r,a,i,s,c){var u=e.extend("ExitApplicationMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,i){var s=r.get();if(s){var c=new n({project:s.uid()}),u=a.getProcess(c);i.add("process_close",u)}return o.define(t.APPLICATION_EXIT,e,i,"exitApplication"),i.add("exit",function(e,t,n){console.warn("[ExitApplicationCommand] 프로세스 종료.",n),e()}),i},onExit:function(e,t){if(this._hackMessage)return void c.message(this._hackMessage);if(t&&t._ignoreSave)return void s(function(){i.exit()},300);var r=this.getProcess(new n(t||{}));o.execute(r,function(e){console.log("* Exit 종료 : ",r.status,e),r.status>0&&s(function(){i.exit()},300)},null,{content:"실행 중인 작업을 종료하신 후 다시 시도해 보십시오."})},_hackMessage:"",exitHack:function(e){this._hackMessage=e}});return new u}var t=MODULE.core.instance;t.service("$exitApplicationMacro",e),e.$inject=["MacroBase","CommandName","CommandParam","$command","$projects","$closeProjectMacro","$externalAPI","$timeout","$toast"]}(),function(){function e(e,t,n,o){var r=e.extend("$ModifyApplicationMacro",{$$getCommandParam:function(e){var t=e.getParam("data");if(!t)throw new Error("data가 지정되지 않았습니다.");return e},$$getProcess:function(e,r){return o.get()?r=n.define(t.APPLICATION_MODIFY,e,r,"modifyApplication").getProcess():null}});return new r}var t=MODULE.core.instance;t.service("$modifyApplicationMacro",e),e.$inject=["MacroBase","CommandName","$command","$applications"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){var d=e.extend("NewApplicationMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,o){if(t.define(n.APPLICATION_NEW,e,o,"newApplication"),!e)return o;var d=e.getParam("useExitProcess"),p=e.getParam("registExitHandler"),m=e.getParam("useConfiguration");m&&o.add("configuration",function(e,t){var n={};d&&(p=s.getCallbackMethod(function(e,t,n){c.onExit(e,t)},"registExitHandler")),p&&(n.registExitHandler=p),r.configuration(n,function(t){e(t)})}),m&&o.add("userConfiguration",function(e,t){u.ready(function(t){var n=u.data("application");l.modify(n,function(){e()})})});var f;return o.add("check_workspace",function(e,t,n){f=a.TEMP_ROOT_MARKER+a.WORK_SPACE_MARKER;var o=f+"/"+a.saveManifestFile;r.exist(o,function(t){t?i.confirm({modal:!0,content:"이전 작업시 정리되지 않은 프로젝트가 있습니다. 복구하시겠습니까?",title:"프로젝트 복구",ok:"예",cancel:"아니오",isTop:!0,closeButton:!1}).then(function(t){e(1===t?!0:!1)},function(t){console.error("confirm err : ",t),e(!1)}):e(!1)})}),o.add("workspace",function(e,t,n){return n?void e({open:!0}):void r.remove({path:f},null,function(t,n){console.warn("# 이전 작업 폴더를 제거 하였습니다."),e({open:!1})})}),o}});return new d}var t=MODULE.core.instance;t.factory("$newApplicationMacro",e),e.$inject=["MacroBase","$command","CommandName","$components","$externalAPI","FileSystem","$notice","$communication","$exitApplicationMacro","$store","$applications"]}(),function(){function e(e,t,n,o,r,a,i,s,c){var u=e.extend("UpdateApplicationMacro",{$$getCommandParam:function(e){if(!e)throw new Error("parameter가 전달되지 않았습니다.");var t=e.getParam("installFile");if(!t)throw new Error("installFile 경로가 지정되지 않았습니다.");return e},$$getProcess:function(e,t){return t.add("installedVersionCheckProcess",function(t,n){function o(){var o='해당 버전은 이미 설치되어 있습니다.<br>재설치 버튼을 선택하면 설치된 버전을 삭제 후 다시 설치합니다.<p class="markBlock"><b>버전 : '+r+"</b></p>재설치 하시겠습니까?";c.confirm({isTop:!0,content:o,title:r+" 재설치",cancel:"취소",ok:"재설치",closeButton:!1}).then(function(o){1===o?(e.setParam("uninstallFolder",f),t()):n({error:"업데이트(재설치) 작업을 취소합니다."})},function(e){console.error("[err] : "+e);var t="업데이트 작업을 취소합니다.";n({error:t})})}var r=e.getParam("versionName"),u=r.match(/[\d\.]+/);if(!u||!u[0])return console.error("* ",r," : 버전 이름에 버전 넘버가 포함되어 있지 않습니다."),t();u=u[0];var l=i.pathToActual(i.USER_DATA_ROOT_MARKER),d=s.resolve(l,"../../../"),p=s.parse(d).base,m=p.replace(/v[\d\.]+/,"v"+u),f=s.resolve(d,"../"+m+"/FirstRun");f=i.normalize(f),a.exist(f,function(e){return console.log("# 중복 설치(재설치) 버전 체크 : ",e,f),e?void o():t()})}),r.define(n.APPLICATION_UPDATE,e,t,"installProcess"),t}});return new u}var t=MODULE.core.instance;t.service("$updateApplicationMacro",e),e.$inject=["MacroBase","Process","CommandName","CommandParam","$command","$externalAPI","FileSystem","$node_path","$notice"]}(),function(){function e(e,t,n,o,r){var a=e.extend("ModifyAssetMacro",{$$getCommandParam:function(e){var t=e.getParam("assets");if(!t||t.length<1)throw new Error("assets uid가 지정되지 않았습니다.");return e},$$getProcess:function(e,a){console.log("commandParam : ",e);var i=e.getParam("project"),s=e.getParam("document");if(!i&&!s)throw new Error("document (또는 project) uid가 지정되지 않았습니다.");var c=e.getParam("assets");if(!c||c.length<1)throw new Error("assets uid가 지정되지 않았습니다.");for(var u=0;u<c.length;++u){var l=c[u],d=l.asset,p=l.data,m=l._ignoreAssetCounter||!1,f=l._replaceAssetFile||!1;if(d){var v=r.get(d);if(v)if(p&&!p.original){var g=new n({asset:d,data:p,_ignoreAssetCounter:m,_replaceAssetFile:f}),h=o.define(t.ASSET_MODIFY,g).getProcess();a.add("process_"+u,h)}else{var _={asset:d,_ignoreAssetCounter:m,_replaceAssetFile:f};i&&(_.project=i),s&&(_.document=s);var $=o.define(t.ASSET_REMOVE,new n(_)).getProcess();a.add("process_"+u,$)}}if(p&&p.original){var E={asset:d,data:p,_ignoreAssetCounter:m,_replaceAssetFile:f};i&&(E.project=i),s&&(E.document=s),console.log("process_"+u," : ",p);var h=o.define(t.ASSET_ADD,new n(E)).getProcess();a.add("process_"+u,h)}}return a}});return new a}var t=MODULE.core.instance;t.service("$modifyAssetMacro",e),e.$inject=["MacroBase","CommandName","CommandParam","$command","$assets"]}(),function(){function e(e,t,n){var o=e.extend("CreateComponentMacro",{$$getCommandParam:function(e){var t=e.getParam("name");if(!t)throw new Error("컴포넌트 이름이 지정되지 않았습니다.");var n=e.getParam("elements");if(!n||n.length<1)throw new Error("컴포넌트 등록 대상이 지정되지 않았습니다.");return e},$$getProcess:function(e,o){return o=n.define(t.COMPONENT_CREATE,e,o,"createComponent").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$createComponentMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n,o,r){var a=e.extend("DeleteComponentMacro",{$$getCommandParam:function(e){var t=e.getParam("remove");if(!t||t.length<1||!t[0])throw new Error("컴포넌트 제거 대상이 지정되지 않았습니다.");return e},$$getProcess:function(e,o){return n.define(t.COMPONENT_DELETE,e,o,"deleteComponent"),o}});return new a}var t=MODULE.core.instance;t.service("$deleteComponentMacro",e),e.$inject=["MacroBase","CommandName","$command","$components","$notice"]}(),function(){function e(e,t,n,o,r){var a=e.extend("ExportComponentMacro",{$$getCommandParam:function(e){var t=e.getParam("components");if(!t||t.length<1)throw new Error("컴포넌트가 지정되지 않았습니다.");return e},$$getProcess:function(e,a){var i=e.getParam("path");return i||a.add("processPath",function(t,n,a){function i(o){return o?(e.setParam("path",o),void t()):(console.log("# 경로가 지정되지 않았습니다."),void n())}r._getFileExplorer({saveMode:!0,accept:o.ext_component},i)}),a=n.define(t.COMPONENT_EXPORT,e,a,"exportComponent").getProcess()}});return new a}var t=MODULE.core.instance;t.service("$exportComponentMacro",e),e.$inject=["MacroBase","CommandName","$command","FileSystem","$externalAPI"]}(),function(){function e(e,t,n,o,r){var a=e.extend("ImportComponentMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,a){var i=e.getParam("path");return i||a.add("processPath",function(t,n,a){function i(o){return o?(e.setParam("path",o),void t()):(console.log("# 경로가 지정되지 않았습니다."),void n())}r._getFileExplorer({saveMode:!1,accept:o.ext_component},i)}),a=n.define(t.COMPONENT_IMPORT,e,a,"importComponent").getProcess()}});return new a}var t=MODULE.core.instance;t.service("$importComponentMacro",e),e.$inject=["MacroBase","CommandName","$command","FileSystem","$externalAPI"]}(),function(){function e(e,t,n){var o=e.extend("InsertComponentMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("Document가 지정되지 않았습니다.");var n=e.getParam("component");if(!n)throw new Error("Component가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,o){return o=n.define(t.COMPONENT_INSERT,e,o,"insertComponent").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$insertComponentMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n){var o=e.extend("InstallComponentMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,o){return o=n.define(t.COMPONENT_INSTALL,e,o,"installComponent").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$installComponentMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n){var o=e.extend("ModifyComponentMacro",{$$getCommandParam:function(e){var t=e.getParam("edit"),n=e.getParam("move");if(!t&&!n)throw new Error("수정할 컴포넌트 내용이 지정되지 않았습니다.");return e},$$getProcess:function(e,o){return o=n.define(t.COMPONENT_MODIFY,e,o,"modifyComponent").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$modifyComponentMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n){var o=e.extend("CopyElementMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("Document가 지정되지 않았습니다.");var n=e.getParam("elements");if(!n||n.length<1)throw new Error("복사 대상이 지정되지 않았습니다.");return e},$$getProcess:function(e,o){return o=n.define(t.ELEMENT_COPY,e,o,"copyElement").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$copyElementMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n){var o=e.extend("CutElementMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("Document가 지정되지 않았습니다.");var n=e.getParam("elements");if(!n||n.length<1)throw new Error("잘라내기 대상이 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,o){return o=n.define(t.ELEMENT_CUT,e,o,"cutElement").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$cutElementMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n,o){var r=e.extend("PasteElementMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("Document가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,o){return o=n.define(t.ELEMENT_PASTE,e,o,"pasteElement").getProcess()}});return new r}var t=MODULE.core.instance;t.service("$pasteElementMacro",e),e.$inject=["MacroBase","CommandName","$command","$projects"]}(),function(){function e(e,t,n,o,r){var a=e.extend("AddDocumentMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,t){r.define(n.DOCUMENT_ADD,e,t,"addDocument");var o=e.getParam("importAsset");if(o){var a=r.define(n.ASSET_ADD,o).getProcess();t.add("addAsset",a)}var i=e.getParam("thumbnailAsset");if(i){var s=r.define(n.ASSET_ADD,i).getProcess();t.add("addAssetThumbnail",s)}return t}});return new a}var t=MODULE.core.instance;t.service("$addDocumentMacro",e),e.$inject=["MacroBase","Process","CommandName","CommandParam","$command"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){function d(e,t,o){console.log("# 페이지 추가 (index) : ",t);var a=e.uid,i=r.DOCUMENT+"-"+a,s=r.ASSET+"-"+a,u=m(i,s,e);console.log("$asset (master)등록 : ",u);var l=e.thumbnail;l||alert("thumbnail 데이터가 지정되지 않았습니다.");var d=r.ASSET+"-"+l.uid;l.original||(l.original=l.src),l.path||(l.path=l.src);var p=m(i,d,l);console.log("$asset (thumbnail)등록 : ",p);var f={master:s,thumbnail:d};void 0!==e.search&&(f.search=e.search);var v=new n({document:i,position:t,data:f,importAsset:new n(u),thumbnailAsset:new n(p)}),g=c.getProcess(v);o.add("addMacro-"+a,g)}function p(e,t,o){console.log("# 페이지 교체 (index) : ",t);var i=e.uid,s=a.get().getDocument(t);if(!s)return void console.error("교체할 문서가 없습니다. 잘못된 문서 UID를 참조합니다.");var c=r.ASSET+"-"+i,l=m(s,c,e),d=e.thumbnail;d||alert("thumbnail 데이터가 지정되지 않았습니다.");var p=r.ASSET+"-"+d.uid;d.original||(d.original=d.src),d.path||(d.path=d.src);var v=m(s,p,d);console.log("$asset (thumbnail)등록 : ",v);var g=f(s),h={master:c,thumbnail:p};void 0!==e.search&&(h.search=e.search);var _=new n({document:s,data:h,importAsset:new n(l),thumbnailAsset:new n(v),asset:{add:void 0,remove:g}}),$=u.getProcess(_);o.add("modifyMacro-"+i,$)}function m(e,t,n){var o={document:e,asset:t,needToCopy:n.needToCopy,data:{type:n.type,path:n.path,original:n.original,property:{width:n.width,height:n.height}}};return o}function f(e){var t={document:e,assets:[]},n=i.get(e),o=n.value("master");o&&t.assets.push({asset:o,data:void 0});var r=n.value("thumbnail");return r&&t.assets.push({asset:r,data:void 0}),t.assets.length<1?void 0:t}var v=e.extend("ImportDocumentMacro",{$$getCommandParam:function(e){var t=e.getParam("pages");if(!t)throw new Error("pages 속성이 지정되지 않았습니다.");return e},$$getProcess:function(e,t){var n=e.getParam("pages"),o=e.getParam("paper")||{};if(n.length<1)throw new Error("Import할 문서가 없습니다.");o.change&&(a.setPaper(o.width,o.height),s.paperSizeChange());var r=!1;n.sort(function(e,t){return isNaN(e.page)?1:isNaN(t.page)?-1:(e.page===t.page&&(r=!0),e.page-t.page)}),r&&t.add("notice",function(e,t){l.confirm({modal:!0,content:"중복된 페이지가 있습니다. 계속 진행하시겠습니까?",title:"페이지 중복",ok:"예",cancel:"아니오",isTop:!0,closeButton:!1}).then(function(n){n>0?e():t()},function(e){console.error("[err] : "+e)})});var i=a.get().documents().length;return n.forEach(function(e,n){var o;isNaN(e.page)?(console.warn("페이지 번호가 지정되지 않았습니다."),o=i,e.replace=!1):o=e.page-1,i=o+1,e.replace?p(e.item,o,t):d(e.item,o,t)}),t}});return new v}var t=MODULE.core.instance;t.service("$importDocumentMacro",e),e.$inject=["MacroBase","CommandName","CommandParam","$command","UIDType","$projects","$documents","$layout","$addDocumentMacro","$modifyDocumentMacro","$notice"]}(),function(){function e(e,t,n){var o=e.extend("IndexDocumentMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");var n=e.getParam("position");if(isNaN(n))throw new Error("position이 지정되지 않았습니다.");return e},$$getProcess:function(e,o){return n.define(t.DOCUMENT_INDEX,e,o,"indexDocument"),o}});return new o}var t=MODULE.core.instance;t.service("$indexDocumentMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n,o){var r=e.extend("ModifyDocumentMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");var n=e.getParam("data");if(!n)throw new Error("data가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,r){var a=e.getParam("document");if(!o.get(a))return null;r=n.define(t.DOCUMENT_MODIFY,e,r,"modifyDocument").getProcess();var i=e.getParam("importAsset");if(i){var s=n.define(t.ASSET_ADD,i).getProcess();r.add("addAsset",s)}var c=e.getParam("thumbnailAsset");if(c){var u=n.define(t.ASSET_ADD,c).getProcess();r.add("addAssetThumbnail",u)}return r}});return new r}var t=MODULE.core.instance;t.service("$modifyDocumentMacro",e),e.$inject=["MacroBase","CommandName","$command","$documents"]}(),function(){function e(e,t,n,o,r,a,i,s){var c=e.extend("RemoveDocumentMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");return e},$$getProcess:function(e,i){var c,u=e.getParam("document"),l=a.get(u);if(l){var d=l.assets();for(var p in d){var m=new n({document:u,asset:p,_counter:d[p]}),f=o.define(t.ASSET_REMOVE,m).getProcess();c||(c=new s),c.add("removeAssetProcess-"+p,f)}c&&i.add("assetProcess",c),o.define(t.DOCUMENT_REMOVE,e,i,"removeDocument");var v=r.get(),g=v.getSelectDocument();if(g&&g==u){var h=v.getIndex(u);if(0>h)throw new Error("예상치 못한 경우가 발생하여 선택할 문서의 index를 찾을 수 없습니다.");var _=v.documents().length-1;if(0==_);else{var $;$=h===_?h-1:h+1;var E=v.getDocument($),m=new n({document:E}),y=o.define(t.DOCUMENT_SELECT,m).getProcess();i.add("selectDocument",y)}}return i}}});return new c}var t=MODULE.core.instance;t.service("$removeDocumentMacro",e),e.$inject=["MacroBase","CommandName","CommandParam","$command","$projects","$documents","$elements","Process"]}(),function(){function e(e,t,n,o,r){var a=e.extend("SelectDocumentMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,o){var r=n.define(t.DOCUMENT_SELECT,e).getProcess();return o.add("selectDocument",r),o}});return new a}var t=MODULE.core.instance;t.service("$selectDocumentMacro",e),e.$inject=["MacroBase","CommandName","$command","$autoBackup","$documents"]}(),function(){function e(e,t,n){var o=e.extend("AddGroupMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,o){return o=n.define(t.GROUP_ADD,e,o,"addGroup").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$addGroupMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n,o){var r=e.extend("ModifyGroupMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("document uid가 지정되지 않았습니다.");var n=e.getParam("groups");if(!n||n.length<1)throw new Error("group uid가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,r){for(var a=e.getParam("groups"),i=a.length-1,s=i;s>=0;--s){var c=a[s],u=c.group,l=o.get(u),d=l.compare(c.data);d&&a.splice(s,1)}return 0==a.length?(console.log("# 수정할 데이터 없음(같음)"),null):r=n.define(t.GROUP_MODIFY,e,r,"modifyGroup").getProcess()}});return new r}var t=MODULE.core.instance;t.service("$modifyGroupMacro",e),e.$inject=["MacroBase","CommandName","$command","$groups"]}(),function(){function e(e,t,n,o,r){var a=e.extend("RemoveGroupMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("document uid가 지정되지 않았습니다.");var n=e.getParam("group");if(!n)throw new Error("group uid가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,a){var i=e.getParam("group"),s=o.get(i).getNoneCopyValue("capsule");return s.schemaLock?void r.alert({modal:!0,title:"그룹 해지 잠금",content:"그룹 해지 잠금 상태로 배포된 그룹입니다.<br>그룹을 해지할수 없습니다.",ok:"확인"}):a=n.define(t.GROUP_REMOVE,e,a,"removeGroup").getProcess()}});return new a}var t=MODULE.core.instance;t.service("$removeGroupMacro",e),e.$inject=["MacroBase","CommandName","$command","$groups","$notice"]}(),function(){function e(e,t,n){var o=e.extend("AddElementMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,o){return o=n.define(t.ELEMENT_ADD,e,o,"addElement").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$addElementMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n,o,r,a,i,s,c){var u=e.extend("ElementEditableMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,u){var l=e.getParam("document"),d=e.getParam("element"),p=a.get(l),m=p.value("editingUID");if(m==d)return null;var f=!0,v={};if(d){console.log("# 편집 상태 지정 : ",d),v.editingUID=d,v.editingData="";var g=new n({ignoreHistory:f,document:l,data:v});return u=o.define(t.ELEMENT_SELECT,g,u,"selectElement").getProcess()}var h=new r;h.useCommandStackCheck=!1;var _=p.value("editingData");if(m&&_){var $=i.get(m).value("currentState"),E={};E[$]=_;var y={document:l,elements:[{element:m,data:{currentState:$,state:E}}]};h.add("modify",function(e,t,r){var a=s.getProcess(new n(y));a?o.execute(a,function(t){console.log("# 편집중인 데이터 적용됨 : ",t),e()}):e()})}h.add("closeEdit",function(e,t,n){console.log("# 편집 상태 해지 : ",_),v.editingUID="",v.editingData="",e()});var g=new n({ignoreHistory:f,document:l,data:v});return h.add("select",function(e,t,n){var r=c.getProcess(g);r?o.execute(r,function(t){console.log("	# 선택 완료 : ",t),e()}):e()}),h}});return new u}var t=MODULE.core.instance;t.service("$elementEditableMacro",e),e.$inject=["MacroBase","CommandName","CommandParam","$command","Process","$selects","$elements","$modifyElementMacro","$selectElementMacro"]}(),function(){function e(e,t,n){var o=e.extend("IndexElementMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");var n=e.getParam("position");if(void 0===n)throw new Error("position이 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,o){return o=n.define(t.ELEMENT_INDEX,e,o,"indexElement").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$indexElementMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n,o){function r(e,t){var n=e.getNoneCopyValue("state"),o=n.normal.css;

return 0===t.left&&0===t.top&&t.width===o.width&&t.height===o.height?!1:!0}var a=e.extend("MaskElementBoundaryMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");var n=e.getParam("masks");if(void 0===n||n.length<1)throw new Error("mask element가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,a){for(var i=e.getParam("masks"),s=i.length-1,c=s;c>=0;--c){var u=i[c],l=o.get(u.element),d=r(l,u.boundary);if(d)break;i.splice(c,1)}return i.length<1?(console.log("# MASK 수정할 데이터 없음 (같음)"),null):a=n.define(t.ELEMENT_BOUNDARY_MASK,e,a,"maskElementBoundary").getProcess()}});return new a}var t=MODULE.core.instance;t.service("$maskElementBoundaryMacro",e),e.$inject=["MacroBase","CommandName","$command","$elements"]}(),function(){function e(e,t,n,o,r,a,i,s){var c=e.extend("ModifyElementMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("document uid가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,r){var a=e.getParam("elements");if(a)for(var i=a.length-1,s=i;s>=0;--s){var c=a[s],u=c.element,l=c.asset,d=!1;l&&(l.add&&l.add.assets&&l.add.assets.length>0||l.remove&&l.remove.assets&&l.remove.assets.length>0)&&(d=!0);var p=o.get(u),m=!0;for(var f in c.data){var v=p.isReplaceOnly(f);if(m=v?angular.equals(p.value(f),c.data[f]):p.compare(c.data),!m)break}m&&!d&&a.splice(s,1)}var g=a&&a.length>0;return g&&(r=n.define(t.ELEMENT_MODIFY,e,r,"modifyElement").getProcess()),r||console.log("# 수정할 데이터 없음(같음)"),r}});return new c}var t=MODULE.core.instance;t.service("$modifyElementMacro",e),e.$inject=["MacroBase","CommandName","$command","$elements","$selects","$selectElementMacro","CommandParam","Process"]}(),function(){function e(e,t,n){var o=e.extend("RemoveElementMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("document uid가 지정되지 않았습니다.");var n=e.getParam("elements");if(!n)throw new Error("element uid가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,o){return o=n.define(t.ELEMENT_REMOVE,e,o,"removeElement").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$removeElementMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n,o){var r=e.extend("SelectElementMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,r){var a=e.getParam("document"),i=e.getParam("selects"),s=e.getParam("data");if(i&&s)return console.error("# selects(선택 상태 변경)와 data는 동시에 수정할 수 없습니다."),null;var c=o.get(a),u=c.value("editingUID");if(u){if(console.log("# 편집중인 Element 있음 : ",u),i){if(0!==i.length)return i.indexOf(u)>-1?null:(console.error("# 편집 상태인 경우 선택 객체를 변경할 수 없습니다."),null);e.setParam("selects",null,!0)}s||(s={}),s.editingUID="",s.editingData="",e.setParam("data",s),console.log("# 편집 종료")}else{var l=c.compare(i);if(l)return console.log("# 선택 목록 데이터 같음"),null}return r=n.define(t.ELEMENT_SELECT,e,r,"selectElement").getProcess()}});return new r}var t=MODULE.core.instance;t.service("$selectElementMacro",e),e.$inject=["MacroBase","CommandName","$command","$selects"]}(),function(){function e(e,t,n,o){var r=e.extend("BackupProjectMacro",{$$getCommandParam:function(e){if(!e)throw new Error("parameter가 전달되지 않았습니다.");var t=e.getParam("project");if(!t)throw new Error("uid가 전달되지 않았습니다.");return e},$$getProcess:function(e,o){return n.define(t.PROJECT_BACKUP,e,o,"backupProject").getProcess(),o}});return new r}var t=MODULE.core.instance;t.service("$backupProjectMacro",e),e.$inject=["MacroBase","CommandName","$command","$projects"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l){function d(e,t,n){c.open({modal:!0,isTop:!0,templateUrl:"popup/checkSave.html",controller:["$scope","$notice",function(e,t){e.close=function(e){console.log("	# 팝업창 저장하기 선택 결과 : ",e),t.close(e)};var n="저장이 취소되었습니다. <br>계속 진행할 경우 문서가 닫히고 저장되지 않은 데이터는 사라집니다.<br>문서를 닫으시겠습니까?";e.config={title:"저장하기 취소",yes:"예",no:"아니오",content:a.trustAsHtml(n)},e.$on("$destroy",function(){e.config=null})}]}).then(function(o){1==o?t(e):n(),s.close()},function(){n(-1),s.close()})}var p=e.extend("CloseProjectMacro",{$$getCommandParam:function(e){var t=e.getParam("project");if(!t)throw new Error("uid가 지정되지 않았습니다.");return e},$$getProcess:function(e,t){var r=i.get().needToSave();return r&&(t.add("isSave",function(e,t,n){c.open({modal:!0,isTop:!0,templateUrl:"popup/checkSave.html",controller:["$scope","$notice",function(e,t){e.close=function(e){console.log("	# 팝업창 저장하기 선택 결과 : ",e),t.close(e)},e.config={modal:!0,isTop:!0,title:"저장하기",yes:"저장하기",no:"아니오",content:a.trustAsHtml("저장하지 않은 내용이 있습니다. <br>저장 하시겠습니까?")},e.$on("$destroy",function(){e.config=null})}]}).then(function(t){e(t)},function(){t(-1)})}),t.add("save",function(t,n,o){if(1===o){console.log("	# 저장 하기");var r=u.getProcess(e);r.execute(function(o){if(console.log("	# process status : ",r.status),console.log("	# 저장 완료 : ",o.processPath),o.saveProject){var a=o.saveProject.getResponse();if(a&&a.saveProject){var i=a.saveProject.getParam("project");i&&e.setParam("saveAsProject",i)}}return r.status>0?void t(o):void d(o,t,n)})}else if(0===o)console.log("	# 저장 안함"),t();else{if(-1!==o)throw new Error("Process 반환값이 없습니다.");console.log("	# 저장 취소"),n(-1),l.message("작업이 취소되었습니다."),s.close()}})),n.define(o.PROJECT_CLOSE,e,t,"closeProject"),t}});return new p}var t=MODULE.core.instance;t.service("$closeProjectMacro",e),e.$inject=["MacroBase","Process","$command","CommandName","CommandParam","$sce","$applications","$busy","$notice","$saveProjectMacro","$toast"]}(),function(){function e(e,t,n){var o=e.extend("ModifyProjectMacro",{$$getCommandParam:function(e){var t=e.getParam("project");if(!t)throw new Error("uid가 지정되지 않았습니다.");var n=e.getParam("data");if(!n)throw new Error("data가 지정되지 않았습니다.");return e},$$getProcess:function(e,o){return n.define(t.PROJECT_MODIFY,e,o,"modifyProject"),o}});return new o}var t=MODULE.core.instance;t.service("$modifyProjectMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n,o,r,a,i,s,c){var u=e.extend("NewProjectMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,u){var l=a.get();if(l){var d=new n({project:l.uid()}),p=r.getProcess(d);u.add(u._ignoreID,p)}else u.add("process_close",function(e,t){i.closeData(function(){e()})});o.define(t.PROJECT_NEW,e,u,"newProject");var m=o.define(t.DOCUMENT_ADD,e).getProcess();return u.add("newDocument",m),u.add("scrollPosition",function(e,t){console.debug("# 스크롤 위치 초기화");var n=angular.element("[screen-container]").controller();n&&n.applyNewFocusScroll&&n.applyNewFocusScroll(),e(),s.execute({ignoreCapture:!0},0,function(){c.projectIsOpen(!0)})}),u}});return new u}var t=MODULE.core.instance;t.service("$newProjectMacro",e),e.$inject=["MacroBase","CommandName","CommandParam","$command","$closeProjectMacro","$projects","$externalAPI","$autoBackup","$applications"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u){var l=e.extend("OpenProjectMacro",{$$getCommandParam:function(e){if(!e)throw new Error("["+this.className+"] parameter가 전달되지 않았습니다.");return e},$$getProcess:function(e,t){var u=e.getParam("path");u||t.add("processPath",function(t,n,o){function r(o){if(!o)return console.log("# 경로가 지정되지 않았습니다."),void n();var r=a.get();return!r||o!=r.value("savePath")&&o!=r.uid()?(e.setParam("path",o),void t(o)):(console.log("# 현재 열려져 있는 프로젝트 입니다."),void n())}s.getOpenInformation({task:"openProject"},r)});var l=a.get();if(l){var d=new o({project:l.uid()}),p=i.getProcess(d);t.add(t._ignoreID,p)}return r.define(n.PROJECT_OPEN,e,t,"openProject"),t.add("scrollPosition",function(e,t){console.debug("# 스크롤 위치 초기화");var n=angular.element("[screen-container]").controller();n&&n.applyLastFocusScroll&&n.applyLastFocusScroll(),e(),c.execute({ignoreCapture:!0},0,function(){})}),t}});return new l}var t=MODULE.core.instance;t.service("$openProjectMacro",e),e.$inject=["MacroBase","Process","CommandName","CommandParam","$command","$projects","$closeProjectMacro","$externalAPI","$autoBackup","$applications"]}(),function(){function e(e,t,n,o,r,a){var i=e.extend("PreviewProjectMacro",{$$getCommandParam:function(e){if(!e)throw new Error("parameter가 전달되지 않았습니다.");var t=e.getParam("project");if(!t)throw new Error("uid가 전달되지 않았습니다.");return e},$$getProcess:function(e,o){var r="call://preview";e.setParam("path",r);var a=n.define(t.PROJECT_PREVIEW,e).getProcess();return a.useTimeCheck=!1,o.add("preview",a),o}});return new i}var t=MODULE.core.instance;t.service("$previewProjectMacro",e),e.$inject=["MacroBase","CommandName","$command","$projects","$externalAPI","FileSystem"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p){function m(e,t){var n=p.companyLimit();return n?t({epub:!0}):void c.open({templateUrl:"popup/publish-option.html",controller:["$scope","$notice",function(t,n){t.close=function(e){if("publishSetting"===e)return void n.close(e);if(e>0){var o;for(var r in t.config.publishType){var a=t.config.publishType[r];a&&(o||(o={}),o[r]=!0)}if(!o)return void u.message("출판 옵션을 선택하지 않았습니다.");v(t.config,function(e){e&&n.close(o)})}else n.close()},t.config={title:"출판 옵션",yes:"출판",no:"취소",publishType:{epub:!1,web:!1,binder:!1,binder_web:!1},publish:e},t.$on("$destroy",function(){t.config=null}),t.config.available={appID:d.pattern.appid.test(e.appID),appName:d.pattern.appname.test(e.appName)}}]}).then(function(e){e||console.log("	# 취소"),t(e)},function(){t()})}function f(e){var t=0;for(var n in e)e[n]&&++t;if(!(1>t)){var o="",r="";return 1===t?(e.epub&&(r=a.publishExt),e.web&&(r=a.compressExt),e.binder&&(r=a.compressExt),e.binder_web&&(r=a.compressExt),o=r):(e.epub&&(o=(o?o+",":"")+"application/epub+zip"),(e.web||e.binder||e.binder_web)&&(o=(o?o+",":"")+"application/zip")),{accept:o,ext:r}}}function v(e,t){if(!e.publishType.binder)return t(!0);var n=e.available;if(n.appID&&n.appName)return t(!0);var o="Jik-ji Binder App 설정 : \n\n";n.appID||(o+="App ID"),n.appID||n.appName||(o+=", "),n.appName||(o+="App Name"),o+=" 형식이 잘못되었습니다.\n출판된 Jik-ji Binder를 실행할때 오류가 발생할 수 있습니다.\n\n출판을 계속 진행 하시겠습니까?",t(window.confirm(o))}var g=e.extend("PublishProjectMacro",{$$getCommandParam:function(e){if(!e)throw new Error("parameter가 전달되지 않았습니다.");var t=e.getParam("project");if(!t)throw new Error("uid가 전달되지 않았습니다.");return e},$$getProcess:function(e,t){var o=e.getParam("project"),a=e.getParam("path"),c=s.get(o),u=e.getParam("publishType");if(!u){var p={bookid:o,domain:c.value("domain"),appID:c.value("appID")||o,appName:c.value("appName")||o};t.add("publishType",function(t,n){m(p,function(o){return"publishSetting"===o?(e.setParam("publishType",o),void n()):o?(u=o,void t(u)):void n()},n)})}return a||t.add("publishPath",function(t,n){function r(o){if(!o)return console.log("# 경로가 지정되지 않았습니다."),void n();o=o.replace(/\\/g,"/");var r=l.path.parse(o);r.name=r.name.replace(d.pattern.pubName,""),o=r.dir+"/"+r.name+r.ext,e.setParam("pathObj",r),e.setParam("publishType",u),t(o)}var a=c.value("publishPath")||"",s=f(u);i.getPublishInformation({accept:s.accept,ext:s.ext,old:a,project:o},r)}),r.define(n.PROJECT_PUBLISH,e,t,"publish"),t.useTimeCheck=!1,t}});return new g}var t=MODULE.core.instance;t.service("$publishProjectMacro",e),e.$inject=["MacroBase","Process","CommandName","CommandParam","$command","FileSystem","$externalAPI","$projects","$notice","$toast","$nativeInterface","$util","$version"]}(),function(){function e(e,t,n,o,r,a,i){var s=e.extend("RestoreProjectMacro",{$$getCommandParam:function(e){if(!e)throw new Error("["+this.className+"] parameter가 전달되지 않았습니다.");return e},$$getProcess:function(e,t){return r.define(n.PROJECT_RESTORE,e,t,"restoreProject"),t.add("scrollPosition",function(e,t){console.debug("# 스크롤 위치 초기화");var n=angular.element("[screen-container]").controller();n&&n.applyLastFocusScroll&&n.applyLastFocusScroll(),e(),a.execute({ignoreCapture:!0},0,function(){})}),t}});return new s}var t=MODULE.core.instance;t.service("$restoreProjectMacro",e),e.$inject=["MacroBase","Process","CommandName","CommandParam","$command","$autoBackup","$applications"]}(),function(){function e(e,t,n,o,r,a,i){var s=e.extend("SaveAsProjectMacro",{$$getCommandParam:function(e){if(!e)throw new Error("parameter가 전달되지 않았습니다.");var t=e.getParam("project");if(!t)throw new Error("uid가 전달되지 않았습니다.");return e},$$getProcess:function(e,t){var o=e.getParam("project"),s=i.get(o);return t.add("processPath",function(t,n,r){function i(o){return o?(e.setParam("path",o),void t(o)):(console.log("# 경로가 지정되지 않았습니다."),void n())}var c=s.value("savePath")||"";a.getSaveAsInformation({old:c,project:o},i)}),r.define(n.PROJECT_SAVEAS,e,t,"saveProject"),t}});return new s}var t=MODULE.core.instance;t.service("$saveAsProjectMacro",e),e.$inject=["MacroBase","Process","CommandName","CommandParam","$command","$externalAPI","$projects"]}(),function(){function e(e,t,n,o,r){var a=e.extend("SaveProjectMacro",{$$getCommandParam:function(e){if(!e)throw new Error("parameter가 전달되지 않았습니다.");var t=e.getParam("project");if(!t)throw new Error("uid가 전달되지 않았습니다.");return e},$$getProcess:function(e,a){var i=e.getParam("project"),s=e.getParam("path"),c=!1,u=o.get(i);return u&&(s=s||u.value("savePath"),c=u.$$_restoreOpenFlag()),s&&!c?(e.setParam("path",s),n.define(t.PROJECT_SAVE,e,a,"saveProject").getProcess()):r.getProcess(e,a),a}});return new a}var t=MODULE.core.instance;t.service("$saveProjectMacro",e),e.$inject=["MacroBase","CommandName","$command","$projects","$saveAsProjectMacro"]}(),function(){function e(e,t,n,o){var r=e.extend("ModifySelectMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("document가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,r){var a=e.getParam("document"),i=e.getParam("group"),s=o.get(a);if(!i){var c=s.currentEditGroup();if(!c)return null}var u=s.currentEditGroup();return i===u?null:r=n.define(t.GROUP_EDITABLE,e,r,"groupEditable").getProcess()}});return new r}var t=MODULE.core.instance;t.service("$groupEditableMacro",e),e.$inject=["MacroBase","CommandName","$command","$selects"]}(),function(){function e(e,t,n,o){var r=e.extend("IndexedPositionMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("document가 지정되지 않았습니다.");var n=e.getParam("index");if(void 0===n)throw new Error("index가 지정되지 않았습니다.");var o=e.getParam("selects");if(!o||o.length<1)throw new Error("selects가 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,r){var a,i=e.getParam("selects"),s=i.every(function(e){var t=o.get(e),n=t.parentGroup();return void 0===a&&(a=n),a==n});return s?r=n.define(t.INDEXED_POSITION,e,r,"indexedPosition").getProcess():null}});return new r}var t=MODULE.core.instance;t.service("$indexedPositionMacro",e),e.$inject=["MacroBase","CommandName","$command","$elements"]}(),function(){function e(e,t,n,o){var r=e.extend("ModifySelectMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("document가 지정되지 않았습니다.");var n=e.getParam("group");if(!n)throw new Error("group이 지정되지 않았습니다.");return e},$$createProcess:function(e){return null},$$getProcess:function(e,r){function a(e,t){var n=!0;for(var o in e){var r=e[o],i=t[o];if(n=angular.isArray(i)||angular.isObject(i)?a(r,i):angular.equals(r,i),!n)return!1}return!0}var i=e.getParam("document"),s=e.getParam("data"),c=o.get(i),u=!0;for(var l in c){if("map"===l||"length"===l||"currentGroup"===l)return console.log("# 임의로 수정할수 없는 데이터 입니다. (",l,")"),null;var d=c.isReplaceOnly(l);if(u=d?angular.equals(c.value(l),s[l]):a(s,c.$$_original),!u)break}return u?(console.log("# 수정할 데이터 없음(같음)"),null):r=n.define(t.SELECT_MODIFY,e,r,"modifySelect").getProcess()}});return new r}var t=MODULE.core.instance;t.service("__$modifySelectMacro",e),e.$inject=["MacroBase","CommandName","$command","$selects"]}(),function(){function e(e,t,n,o,r){var a=e.extend("DeleteTemplateMacro",{$$getCommandParam:function(e){var t=e.getParam("template");if(!t)throw new Error("template uid 가 지정되지 않았습니다.");return e},$$getProcess:function(e,a){var i=e.getParam("template");return a.add("confirm",function(e,t,n){var a=o.get(i),s=a.name();r.confirm({content:'"'+s+'" 템플릿을 삭제 하시겠습니까?',title:"템플릿 삭제",ok:"예",cancel:"아니오",isTop:!0,closeButton:!1}).then(function(n){1===n?e():t()},function(e){console.error("[err] : "+e)})}),n.define(t.TEMPLATE_DELETE,e,a,"deleteTemplate"),a}});return new a}var t=MODULE.core.instance;t.service("$deleteTemplateMacro",e),e.$inject=["MacroBase","CommandName","$command","$templates","$notice"]}(),function(){function e(e,t,n,o,r){var a=e.extend("ExportTemplateMacro",{$$getCommandParam:function(e){var t=e.getParam("document");if(!t)throw new Error("uid가 지정되지 않았습니다.");return e},$$getProcess:function(e,a){var i=e.getParam("path");return i||a.add("processPath",function(t,n,a){function i(o){return o?(e.setParam("path",o),void t()):(console.log("# 경로가 지정되지 않았습니다."),void n())}r._getFileExplorer({saveMode:!0,accept:o.ext_template},i)}),a=n.define(t.TEMPLATE_EXPORT,e,a,"exportTemplate").getProcess()}});return new a}var t=MODULE.core.instance;t.service("$exportTemplateMacro",e),e.$inject=["MacroBase","CommandName","$command","FileSystem","$externalAPI"]}(),function(){function e(e,t,n,o,r){var a=e.extend("ImportTemplateMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,a){var i=e.getParam("path");return i||a.add("processPath",function(t,n,a){function i(o){return o?(e.setParam("path",o),void t()):(console.log("# 경로가 지정되지 않았습니다."),void n())}r._getFileExplorer({saveMode:!1,accept:o.ext_template},i)}),a=n.define(t.TEMPLATE_IMPORT,e,a,"importTemplate").getProcess()}});return new a}var t=MODULE.core.instance;t.service("$importTemplateMacro",e),e.$inject=["MacroBase","CommandName","$command","FileSystem","$externalAPI"]}(),function(){function e(e,t,n,o,r){var a=e.extend("InsertTemplateMacro",{$$getCommandParam:function(e){var t=e.getParam("template");if(!t)throw new Error("uid가 지정되지 않았습니다.");return e},$$getProcess:function(e,r){var a=e.getParam("position");if(null==a){var i=o.get(),s=i.getSelectDocument();a=s?i.getIndex(s)+1:i.getNoneCopyValue("documents").length,e.setParam("position",a)}return r=n.define(t.TEMPLATE_INSERT,e,r,"insertTemplate").getProcess()}});return new a}var t=MODULE.core.instance;t.service("$insertTemplateMacro",e),e.$inject=["MacroBase","CommandName","$command","$projects","$documents"]}(),function(){function e(e,t,n){var o=e.extend("InstallTemplateMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,o){return o=n.define(t.TEMPLATE_INSTALL,e,o,"installTemplate").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$installTemplateMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(e,t,n){var o=e.extend("ModifyTemplateMacro",{$$getCommandParam:function(e){return e},$$getProcess:function(e,o){return o=n.define(t.TEMPLATE_MODIFY,e,o,"modifyTemplate").getProcess()}});return new o}var t=MODULE.core.instance;t.service("$modifyTemplateMacro",e),e.$inject=["MacroBase","CommandName","$command"]}(),function(){function e(){var e={$get:["DataService","ApplicationData","CommandName","State","UIDType","$store",function(e,t,n,o,r,a){var i=e.extend("ApplicationService",{type:r.APPLICATION,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());var n=new t(e);return n.setDataService(this),n},power:!0,protect:!1,_projectIsOpen:!1,projectIsOpen:function(e){return arguments.length<1?this._projectIsOpen:void(this._projectIsOpen=e)},_safeWatch:!0,freeze:function(){console.debug("\n\n<FREEZE--------------------------------------------"),this._safeWatch=!1},flush:function(){console.debug("--------------------------------------------FLUSH>\n\n"),this._safeWatch=!0},safety:function(){return this._safeWatch},_isBusy:!1,isBusy:function(){return arguments.length<1?this._isBusy:void(this._isBusy=Boolean(arguments[0]))},refresh:function(){var e=this.get();e.refresh(),this.$$_saveQueue=[],this.$$_deleteQueue={},this.$$_backupQueue=[],this.$$_deleteBackupQueue={}},create:function(e,t){if(1==this.getLength())throw new Error("Application 데이터는 하나 이상 생성할 수 없습니다.");e=e||this.createUID();var n=this.$$get(e);if(void 0===t)return n;var o=a.data("application");t=angular.merge({},o,t);for(var r in t)n.value(r,t[r],!0);return this.get()},close:function(e){if(!e)throw new Error("uid 인자를 지정하지 않았습니다.");this.$$destroy(e)},get:function(){if(arguments.length>0)throw new Error("uid 인자를 허용하지 않습니다.");return this.$$get()},modify:function(e,t){if(void 0===e)throw new Error("수정할 내용이 전달되지 않았습니다.");var n=this.get();for(var o in e){var r=e[o];n.value(o,r),a.data("application",o,r)}return a.save(t),this.get()},$$addDeleteQueue:function(e){},$$removeDeleteQueue:function(e){},getDeleteQueue:function(){},uid:function(){return this.$$_current},setState:function(e,t){var r=this.get();if(r){if(t)return void r.state(o.ERROR);var a="";switch(e){case n.PROJECT_BACKUP:return;case n.PROJECT_NEW:case n.PROJECT_OPEN:a=o.READY;break;case n.PROJECT_SAVE:case n.PROJECT_SAVEAS:a=o.SAVED;break;case n.APPLICATION_NEW:case n.PROJECT_CLOSE:a=o.CLOSED;break;default:a=o.EDITED}r.state(a)}}});return new i}]};return e}var t=MODULE.core.instance;t.provider("$applications",e)}(),function(){function e(e,t,n,o,r,a,i,s,c,u){var l=e.extend("ApplicationData",{$$_state:void 0,state:function(){return arguments.length<1?this.$$_state:void(this.$$_state=arguments[0])},needToSave:function(){var e=this.isChanged(),s=t.getSaveQueue().length>0,c=n.getSaveQueue().length>0,u=o.getSaveQueue().length>0,l=r.getSaveQueue().length>0,d=a.getSaveQueue().length>0,p=i.getSaveQueue().length>0;return e||s||c||u||l||d||p},$$_resetChangedFlag:function(){function e(e){for(var t,n=e.getSaveQueue();t=n[0];){var o=e.get(t,!0);o.saved()}e.$$_saveQueue=[],e.$$_backupQueue=[]}this.isChanged(!1),e(t),e(n),e(o),e(r),e(a),e(i),this.$$_resetBackupChangedFlag()},needToBackup:function(){var e=this.isChanged(),s=t.getSaveQueue(!0).length>0,c=n.getSaveQueue(!0).length>0,u=o.getSaveQueue(!0).length>0,l=r.getSaveQueue(!0).length>0,d=a.getSaveQueue(!0).length>0,p=i.getSaveQueue(!0).length>0;return e||s||c||u||l||d||p},$$_resetBackupChangedFlag:function(){function e(e){e.$$_backupQueue=[]}e(t),e(n),e(o),e(r),e(a),e(i)},$$_temp:void 0,temp:function(){return this.$$_temp||(this.$$_temp={}),this.$$_temp},$$_dataTransfer:void 0,dataTransfer:function(){return arguments.length<1?this.$$_dataTransfer:void(this.$$_dataTransfer=arguments[0])},$$define:function(){return{description:"",alignOption:void 0,slider:{basic:!0,border:!1,padding:!1,font:!1,paragraph:!1,column:!1,background:!0,text:!0,video:!0,audio:!0,button:!0,input:!0,mask:!0,html:!0,web:!0,configuration:!0,group:!0,component:!0,document:!0,master:!0,searchText:!0,project:!0,masterAll:!0,publish:!0,contentEditor:!0,fileEditor:!0,capsule:!0},showHttpAdressBox:{image:!1,video:!1,audio:!1},colorTheme:"blue",language:"ko",screen:void 0,selector:void 0,element:void 0,panel:void 0,showLabel:!1,outline:!0,htmlEditorMode:void 0,componentListViewMode:void 0,assetListViewMode:void 0}},$$setDefault:function(e){this.value("screen",{padding:c.screenPadding,$width:void 0,$height:void 0}),this.value("selector",{positionLimit:!0,offset:{x:c.screenPadding,y:c.screenPadding},overlapMinSize:-1*c.screenPadding,anchor:5}),this.value("panel",{left:u.ITEM,right:u.PROPERTY}),this.value("alignOption",{sortByPage:"element",sortByPage_virtualGroup:!1}),this.value("htmlEditorMode","vertical"),this.value("componentListViewMode","box")},refresh:function(){this.$$_original.version=s.version(),this.$$_original.versionRecord=[]}});return l}var t=MODULE.core.instance;t.factory("ApplicationData",e),e.$inject=["DataBase","$projects","$documents","$elements","$selects","$assets","$groups","$version","Default","ContentViewName"]}(),function(){function e(){var e={$get:["DataService","AssetData","UIDType","$util",function(e,t,n,o){var r=e.extend("AssetService",{type:n.ASSET,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());var n=new t(e);return n.setDataService(this,!0),n},add:function(e,t){e=e||this.createUID();var n=this.$$get(e);if(this.$$_current=null,n.counter(1),void 0===t)return n;for(var o in t)"path"==o?n.path(t[o]):n.value(o,t[o],!0);return this.$$_data[e]},remove:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");var t=this.$$get(e),n=t.counter(-1);1>n&&this.$$destroy(e)},get:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");return this.$$_data[e]},modify:function(e,t,n){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");if(void 0===t)throw new Error("수정할 내용이 전달되지 않았습니다.");var o=this.get(e);for(var r in t)o.value(r,t[r],n);return this.$$_data[e]},isURL:function(e){var t=o.pattern.source;return t.test(e)}});return new r}]};return e}var t=MODULE.core.instance;t.provider("$assets",e)}(),function(){function e(e,t,n,o){var r=e.extend("AssetData",{$$define:function(){return{description:"",type:void 0,path:void 0,original:void 0,property:void 0,_counter:0,error:void 0}},$$setDefault:function(){this.value("type",""),this.value("path",""),this.value("original",""),this.value("error",""),this.value("property",{})},$$_checkName:function(){var e=this.$$_original;e.name||(e.name=window.$$_createNameCounter(o.ASSET))},$$_setter:function(e,t,n){return this._super(e,t,n)},publish:function(){return this.copy()},counter:function(e){return void 0===e?this.$$_original._counter:(this.$$_original._counter=this.$$_original._counter+e,0!==e&&this.isChanged(!0),this.$$_original._counter)},isURL:function(e){var n=t.pattern.source;return n.test(e)},path:function(e){if(e)return void(this.isURL(e)?this.value("path",e):(e=n.pathToVirtual(e),this.value("path",e)));var t=this.$$_original.path;return t&&!this.isURL(t)&&(t=n.pathToActual(t,!0),t=n.getAvailablePath(t)),t},type:function(e){return void 0===e?this.value("type"):void this.value("type",e)},error:function(e){return void 0===e?this.value("error"):void this.value("error",e)}});return r}var t=MODULE.core.instance;t.factory("AssetData",e),e.$inject=["DataBase","$util","FileSystem","UIDType"]}(),function(){function e(){var e={$get:["DataService","ComponentData","UIDType","$elements",function(e,t,n,o){var r=e.extend("ComponentService",{type:n.COMPONENT,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());var n=new t(e);return n.setDataService(this,!0),n},dataChanged:function(e){},$$addSaveQueue:function(e){},$$removeSaveQueue:function(e){},getSaveQueue:function(){},$$addDeleteQueue:function(e){},$$removeDeleteQueue:function(e){},getDeleteQueue:function(){},add:function(e,t){if(e=e||this.createUID(),this.$$_data[e])throw new Error("같은 uid의 객체가 이미 존재합니다. 추가할 수 없습니다.");var n=this.$$get(e);if(this.$$_current=null,void 0===t)return n;for(var o in t)n.value(o,t[o],!0);return this.$$_data[e]},remove:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");this.$$destroy(e)},get:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");return this.$$_data[e]},modify:function(e,t,n){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");if(void 0===t)throw new Error("수정할 내용이 전달되지 않았습니다.");var o=this.get(e);for(var r in t)o.value(r,t[r],n);return this.$$_data[e]}});return new r}]};return e}var t=MODULE.core.instance;t.provider("$components",e)}(),function(){function e(e,t){var n=e.extend("ComponentData",{$$define:function(){return{description:"",type:t.COMPONENT,indexes:void 0,elements:void 0,assets:void 0,groups:void 0,boundary:void 0,name:void 0,userVersion:void 0,creator:void 0}},$$setDefault:function(){},elements:function(e){if(arguments.length<1)return this.value("elements");if(!e||!e.element)throw new Error("component 데이터 형식이 맞지 않습니다.");this.value("elements",e)}});return n}var t=MODULE.core.instance;t.factory("ComponentData",e),e.$inject=["DataBase","UIDType"]}(),function(){function e(){var e={$get:["DataService","DocumentData","UIDType","$projects","Default",function(e,t,n,o,r){var a=e.extend("DocumentService",{type:n.DOCUMENT,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());var n=new t(e);return n.setDataService(this,!0),n},add:function(e,t){if(e=e||this.createUID(),this.$$_data[e])throw new Error("같은 uid의 객체가 이미 존재합니다. 추가할 수 없습니다.");var n=this.$$_current,o=this.$$get(e);if(this.$$_current=n,void 0===t)return o;for(var r in t)o.value(r,t[r],o);return this.$$_data[e]},remove:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");this.$$destroy(e)},select:function(e){return o.get().value("currentDocument",e),e?(this.$$_current=e,this.$$_data[e]):void(this.$$_current=null)},get:function(e){return e?this.$$_data[e]:this.$$_current?this.$$_data[this.$$_current]:null},modify:function(e,t){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");if(void 0===t)throw new Error("수정할 내용이 전달되지 않았습니다.");var n=this.$$get(e,!0);for(var o in t)n.value(o,t[o]);return this.$$_data[e]},uid:function(){return this.$$_current}});return new a}]};return e}var t=MODULE.core.instance;t.provider("$documents",e)}(),function(){function e(e,t){var n=e.extend("DocumentData",{init:function(e){this.$$addReplaceOnly("events"),this._super(e)},$$define:function(){return{subject:"",description:"",backgroundColor:void 0,master:void 0,useCacheImage:void 0,insertSVG:void 0,thumbnail:void 0,search:void 0,elements:void 0,indexes:void 0,groups:void 0,assets:void 0,files:void 0,events:void 0,guide:void 0}},$$setDefault:function(){this.value("backgroundColor",""),this.value("master",""),this.value("useCacheImage",!0),this.value("insertSVG","inline"),this.value("thumbnail",""),this.value("search",""),this.value("elements",[]),this.value("indexes",[]),this.value("groups",[]),this.value("assets",{}),this.value("files",[]),this.value("events",{}),this.value("guide",{})},events:function(){return this.getNoneCopyValue("events")},elements:function(){return this.value("elements")},indexes:function(){return this.value("indexes")},addElement:function(e,t,n){var o=this.$$_original.elements;o.indexOf(e)<0&&(o.push(e),this.isChanged(!0)),n||this._moveElement(e,t)},removeElement:function(e){var t=this.$$_original.elements,n=t.indexOf(e);n>-1&&(t.splice(n,1),this.isChanged(!0));var o=this.$$_original.indexes,r=this.getIndex(e);0>r||(o.splice(r,1),this.isChanged(!0))},groups:function(){return this.value("groups")},addGroup:function(e){var t=this.$$_original.groups;!e&&t.indexOf(e)>-1||(t.push(e),this.isChanged(!0))},removeGroup:function(e){var t=this.$$_original.groups,n=t.indexOf(e);!e&&n>-1||(t.splice(n,1),this.isChanged(!0))},assets:function(){return this.value("assets")},addAsset:function(e){var t=this.$$_original.assets;t[e]=t[e]?t[e]+1:1,this.isChanged(!0)},removeAsset:function(e){var t=this.$$_original.assets;t[e]&&(t[e]=t[e]-1),t[e]<1&&(t[e]=null,delete t[e]),this.isChanged(!0)},files:function(){return this.value("files")},$removeFile:function(e){var t=this.$$_original.files,n=t.indexOf(e);0>n||(t.splice(n,1),this.removeAsset(e))},getIndex:function(e){var t=this.$$_original.indexes;return t.indexOf(e)},getElement:function(e){var t=this.$$_original.indexes;return t[e]},_moveElement:function(e,t){var n=this.$$_original.indexes,o=this.getIndex(e);if((void 0===t||null===t)&&(t=-1),("number"==typeof t||(t=parseInt(t,10),!isNaN(t)))&&(0>t&&(t=n.length),n[t]!=e)){if(0>o)n.splice(t,0,e);else if(t>o)n.splice(o,1),n.splice(t,0,e);else{if(!(o>t))return;n.splice(o,1),n.splice(t,0,e)}this.isChanged(!0)}},guide:function(){}});return n}var t=MODULE.core.instance;t.factory("DocumentData",e),e.$inject=["DataBase","UIDType"]}(),function(){function e(){var e={$get:["DataService","ElementData","UIDType",function(e,t,n){var o=e.extend("ElementService",{type:n.ELEMENT,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());

var n=new t(e);return n.setDataService(this,!0),n},add:function(e,t){if(e=e||this.createUID(),this.$$_data[e])throw new Error("같은 uid의 객체가 이미 존재합니다. 추가할 수 없습니다.");var n=this.$$get(e);if(this.$$_current=null,void 0===t)return n;for(var o in t)n.value(o,t[o],!0);return this.$$_data[e]},remove:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");this.$$destroy(e)},get:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");return this.$$_data[e]},modify:function(e,t,n){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");if(void 0===t)throw new Error("수정할 내용이 전달되지 않았습니다.");var o=this.get(e);for(var r in t){var a=t[r];o.value(r,a,n)}return this.$$_data[e]},unselect:function(e){var t=!1;for(var n in e){var o=this.get(e[n]);o.value("selected",t);var r=o.value("currentState");"normal"!=r&&(console.log("# unselect 항목은 state를 초기화 한다. : ",r),o.value("currentState","normal"))}},select:function(e){var t=!0;for(var n in e){var o=this.get(e[n]);o&&o.value("selected",t)}},getRotatedPoints:function(e,t,n){var o=!isNaN(t)&&0!=t;if(!o)return{p1:{x:e.left,y:e.top},p2:{x:e.left+e.width,y:e.top},p3:{x:e.left+e.width,y:e.top+e.height},p4:{x:e.left,y:e.top+e.height}};n||(n={x:e.left+e.width/2,y:e.top+e.height/2});var r=e.left-n.x,a=e.top-n.y,i={p1:{x:r,y:a},p2:{x:r+e.width,y:a},p3:{x:r+e.width,y:a+e.height},p4:{x:r,y:a+e.height}},s=t*Math.PI/180;return i.p1=this.rotatePoint(i.p1,s,n),i.p2=this.rotatePoint(i.p2,s,n),i.p3=this.rotatePoint(i.p3,s,n),i.p4=this.rotatePoint(i.p4,s,n),i},rotatePoint:function(e,t,n){var o=e.x*Math.cos(t)-e.y*Math.sin(t)+n.x,r=e.x*Math.sin(t)+e.y*Math.cos(t)+n.y;return{x:o,y:r}},getScale:function(e){if(!e)return 0;var t=e.replace(/\bscale\(([\+ \- \. 0-9]+)\)/g,"$1");return Number(t)||1},getAngle:function(e){if(!e)return 0;var t=e.replace(/\brotateZ?\(([\+ \- \. 0-9]+)deg\)/g,"$1");return Number(t)||0},getTransformString:function(e){if(!e)return"";var t=e,n="";return void 0!==t.scale&&(n=n+(n?" ":"")+"scale("+t.scale+")"),void 0!==t.angle&&(n=n+(n?" ":"")+"rotateZ("+t.angle+"deg)"),n},mergeCSS:function(e,t,n){function o(e,t,n){var r=n[e];if(angular.isArray(r)){t[e]||(t[e]=[]);for(var a in r)o(a,t[e],r)}else if(t&&angular.isObject(r)){t[e]||(t[e]={});for(var i in r)o(i,t[e],r)}else(null===t[e]||void 0===t[e])&&(t[e]=r)}for(var r in n)o(r,e,n);return e}});return new o}]};return e}var t=MODULE.core.instance;t.provider("$elements",e)}(),function(){function e(e,t,n){var o=e.extend("ElementData",{init:function(e){this.$$addReplaceOnly("events"),this._super(e)},$$define:function(){return{description:"",type:"",id:"",selected:!1,assets:void 0,state:void 0,overStateEnabled:!1,downStateEnabled:!1,currentState:"normal",group:void 0,childGroup:"",layer:void 0,events:void 0,property:void 0}},$$setDefault:function(){this.value("state",{normal:{css:{transform:{scale:1,angle:0}},style:{},option:{layout:angular.copy(n.layout)}},over:{css:{},style:{},option:{layout:angular.copy(n.layout)}},down:{css:{},style:{},option:{layout:angular.copy(n.layout)}}}),this.value("assets",[]),this.value("group",""),this.value("events",{}),this.value("property",{}),this.value("layer",{isFold:!0,isLock:!1,isHide:!1}),this.$$_temp={scrollRefresh:!1,scale:void 0,angle:void 0}},$$_checkName:function(){var e=this.$$_original;if(!e.name&&e.type){var n=e.type===t.MASK?"group":e.type;e.name=window.$$_createNameCounter(n)}},layout:function(e){var t=this.option(e);return t.layout},__getData:function(e,t){function n(e,t,o){var r=o[e];if(angular.isArray(r)){t[e]||(t[e]=[]);for(var a in r)n(a,t[e],r)}else if(t&&angular.isObject(r)){t[e]||(t[e]={});for(var i in r)n(i,t[e],r)}else(null===t[e]||void 0===t[e])&&(t[e]=r)}if(!this.$$_original)return null;e=e||"normal";var o=this.getNoneCopyValue("state"),r=angular.copy(o.normal[t]);if("normal"===e)return r;var a=angular.copy(o[e][t]);for(var i in r)n(i,a,r);return a},css:function(e){return e=e||this.value("currentState"),this.__getData(e,"css")},style:function(e){return e=e||this.value("currentState"),this.__getData(e,"style")},option:function(e){return e=e||this.value("currentState"),this.__getData(e,"option")},isFlexibleSize:function(){var e=this.getNoneCopyValue("state"),t=angular.copy(e.normal.option);return t._$$flexibleSize},isEditable:function(){var e=this.getNoneCopyValue("state"),t=angular.copy(e.normal.option);return t._$$editable},type:function(e){return arguments.length<1?this.value("type"):void this.value("type",e)},assets:function(e){return arguments.length<1?this.value("assets"):void this.value("assets",e)},events:function(){return this.getNoneCopyValue("events")},parentGroup:function(e){return arguments.length<1?this.getNoneCopyValue("group"):void this.value("group",e)},isGroupContainer:function(){var e=this.getNoneCopyValue("childGroup");return e},layer:function(e,t){var n=this.$$_original.layer;return arguments.length<1?n:1==arguments.length?n[e]:(n[e]=t,void this.isChanged(!0))},compare:function(e,t){var n=!0;t=t||this.$$_original;for(var o in e)if("string"!=typeof o||0!==o.indexOf("$$")){var r=e[o],a=t[o];if(angular.isArray(r)||angular.isArray(a)){if(!r||!a)return!1;if(r.length!==a.length)return!1;n=this.compare(r,a)}else n=angular.isObject(a)?this.compare(r,a):angular.equals(r,a);if(!n)return!1}return!0},$$_temp:void 0,tempdata:function(e,t){var n=this.$$_temp;if(arguments.length<1)return n;if(1==arguments.length){var o=n[e];return o}n[e]=t},getRotatedPoints:function(e){e=e||this.value("currentState");var t=this.getNoneCopyValue("state"),n=t[e].css,o=n.transform.angle||0;return this.$$_dataService.getRotatedPoints(n,o)},value:function(e,t,n){function o(e,t){var n=t.normal.css;if(n&&e in n&&void 0!==i.normal.css[e]){var o=n[e]-i.normal.css[e];return o}return 0}function r(e,t,n){if(e){for(var o in e.css)break;void 0!==o&&(0!==t&&(e.css.left=e.css.left+t),0!==n&&(e.css.top=e.css.top+n))}}if(1==arguments.length)return this._super.apply(this,arguments);var a="state"==e&&t.normal&&t.normal.css;if(!a)return this._super.apply(this,arguments);var i=this.getNoneCopyValue("state"),s=o("left",t),c=o("top",t);this._super.apply(this,arguments),(0!=s||0!=c)&&(i=this.getNoneCopyValue("state"),r(i.over,s,c),r(i.down,s,c))}});return o}var t=MODULE.core.instance;t.factory("ElementData",e),e.$inject=["DataBase","ElementType","Default"]}(),function(){function e(){var e={$get:["DataService","GroupData","UIDType","$elements","$selects","ElementType",function(e,t,n,o,r,a){var i=e.extend("GroupService",{type:n.GROUP,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());var n=new t(e);return n.setDataService(this,!0),n},add:function(e,t){if(e=e||this.createUID(),this.$$_data[e])throw new Error("같은 uid의 객체가 이미 존재합니다. 추가할 수 없습니다.");var n=this.$$get(e);if(this.$$_current=null,void 0===t)return n;for(var o in t)n.value(o,t[o],!0);return this.$$_data[e]},remove:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");this.$$destroy(e)},get:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");return this.$$_data[e]},modify:function(e,t,n){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");if(void 0===t)throw new Error("수정할 내용이 전달되지 않았습니다.");var o=this.get(e);for(var r in t)o.value(r,t[r],n);return this.$$_data[e]},isMaskElement:function(e){var t=Array.isArray(e);if(t&&e.length>1)return"";if(t&&e.length<1)return"";var n=t?e[0]:e,r=o.get(n);if(!r)return"";if(r.type()!==a.MASK)return"";var i=r.getNoneCopyValue("childGroup");return i}});return new i}]};return e}var t=MODULE.core.instance;t.provider("$groups",e)}(),function(){function e(e,t){var n=e.extend("GroupData",{$$define:function(){return{description:"",type:t.GROUP,indexes:void 0,owner:"",capsule:void 0}},$$setDefault:function(){this.value("indexes",[]),this.value("capsule",{schema:[],values:{},schemaLock:!1,groupLock:!1})},$$_checkName:function(){var e=this.$$_original;e.name||(e.name=window.$$_createNameCounter(t.GROUP))},indexes:function(){return this.value("indexes")},addElement:function(e,t){var n=this.getNoneCopyValue("indexes");n.indexOf(e)>-1||(console.log("* element를 그룹에 추가 : ",e,"(",this.uid(),")"),this._moveElement(e,t),this.isChanged(!0))},removeElement:function(e){var t=this.getNoneCopyValue("indexes"),n=t.indexOf(e);0>n||(console.log("* element를 그룹에 삭제 : ",e,"(",this.uid(),")"),t.splice(n,1),this.isChanged(!0))},getIndex:function(e){var t=this.$$_original.indexes;return t.indexOf(e)},_moveElement:function(e,t){var n=this.$$_original.indexes,o=this.getIndex(e);if((void 0===t||null===t)&&(t=-1),("number"==typeof t||(t=parseInt(t,10),!isNaN(t)))&&(0>t&&(t=n.length),n[t]!=e)){if(0>o)n.splice(t,0,e);else if(t>o)n.splice(o,1),n.splice(t,0,e);else{if(!(o>t))return;n.splice(o,1),n.splice(t,0,e)}this.isChanged(!0)}},compare:function(e,t){var n=!0;t=t||this.$$_original;for(var o in e)if("string"!=typeof o||0!==o.indexOf("$$")){var r=e[o],a=t[o];if(angular.isArray(r)||angular.isArray(a)){if(!r||!a)return!1;if(r.length!==a.length)return!1;n=this.compare(r,a)}else n=angular.isObject(a)?this.compare(r,a):angular.equals(r,a);if(!n)return!1}return!0},isSameElements:function(e){var t=this.$$_original.indexes,n=!1;return t.length===e.length&&(n=e.every(function(e){return t.indexOf(e)>-1})),n},merge:function(e,t){void 0===t&&(t=!0),e=t?e?angular.copy(e):[]:e||[];for(var n=this.$$_original.indexes,o=0;o<n.length;++o){var r=n[o];e.indexOf(r)<0&&e.push(r)}return e},hasCapsule:function(){return this.$$_original.capsule.schema.length>0},isSchemaLock:function(){return this.$$_original.capsule.schemaLock},isGroupLock:function(){return this.$$_original.capsule.groupLock}});return n}var t=MODULE.core.instance;t.factory("GroupData",e),e.$inject=["DataBase","UIDType"]}(),function(){function e(){var e=50,t={max:function(t){return void 0===t?e:void(e=t)},$get:["DataService","HistoryData","UIDType",function(t,n,o){var r=t.extend("HistoryService",{type:o.HISTORY,createUID:function(){return this.$$createUID(this.type)},$$new:function(t){t||(t=this.createUID());var o=new n(t,e);return o},add:function(e){if(e=e||this.createUID(),this.$$_data[e])throw new Error("같은 uid의 객체가 이미 존재합니다. 추가할 수 없습니다.");var t=this.$$_current,n=this.$$get(e);return this.$$_current=t,n},remove:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");this.$$destroy(e)},select:function(e){return e?(this.$$_current=e,this.$$_data[e]):void(this.$$_current=null)},get:function(e){return e?this.$$_data[e]:this.$$_current?this.$$_data[this.$$_current]:null},dataChanged:function(e){},$$addSaveQueue:function(e){},$$removeSaveQueue:function(e){},getSaveQueue:function(){},$$addDeleteQueue:function(e){},$$removeDeleteQueue:function(e){},getDeleteQueue:function(){},reset:function(){for(var e in this.$$_data){var t=this.$$_data[e];t.init()}},uid:function(){return this.$$_current}});return new r}]};return t}var t=MODULE.core.instance;t.provider("$history",e)}(),function(){function e(e,t){function n(e,t){this.$$_uid=e,this.$$_max=t,this.init()}return n.INIT="init",n.FIRST="first",n.MIDDLE="middle",n.LAST="last",n.prototype={$$_max:void 0,$$_map:void 0,$$_caret:-1,uid:function(){return this.$$_uid},getState:function(){var e,t=this.$$_map.length-1;if(0>t)e=n.INIT;else switch(this.$$_caret){case-1:e=n.FIRST;break;case t:e=n.LAST;break;default:e=n.MIDDLE}return e},init:function(){this.$_clear(),this.$$_map=[]},$_clear:function(){this.$$_caret=-1,this.$$_map=null},destroy:function(){this.$_clear()},add:function(t){var n=t instanceof e;if(!n)throw new Error("$history에 등록할 process는 HistoryProcess의 인스턴스여야 합니다.");var o=t.callStep;"call"===o?(++this.$$_caret,this.$$_map[this.$$_caret]=t,this.$$_updateList()):"undo"==o?--this.$$_caret:"redo"==o&&++this.$$_caret,console.log("**History 목록 업데이트 [",this.$$_caret,"] ",this.$$_map)},$$_updateList:function(){var e=this.$$_max-1,t=this.$$_map.length-1;if(this.$$_caret<0)this.$$_map=[];else if(this.$$_caret==t)this.$$_caret>e&&this.$$_map.shift();else for(var n=this.$$_map.length-1;n>this.$$_caret;)this.$$_map.pop(),n=this.$$_map.length-1;this.$$_caret=this.$$_map.length-1},undo:function(){if(t.isBusy()||!t.safety())return null;var e=this.$$_caret;if(0>e)return null;var n=this.$$_map[e],o=n.command.getUndoProcess();return o.callStep="undo",console.debug("# UNDO Process : ",n.commandName,o),o},redo:function(){if(t.isBusy()||!t.safety())return null;var e=this.$$_caret+1;if(e>this.$$_map.length-1)return null;var n=this.$$_map[e],o=n.command.getRedoProcess();return o.callStep="redo",console.debug("# REDO Process : ",n.commandName,o),o}},n}var t=MODULE.core.instance;t.factory("HistoryData",e),e.$inject=["HistoryProcess","$applications"]}(),function(){function e(){var e={$get:["DataService","ProjectData","UIDType","Default",function(e,t,n,o){var r=e.extend("ProjectService",{type:n.PROJECT,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());var n=new t(e);return n.setDataService(this,!0),n},create:function(e,t){if(1==this.getLength())throw new Error("Project 데이터는 하나 이상 생성할 수 없습니다.");e=e||this.createUID();var n=this.$$get(e);if(this.setPaper(o.paperWidth,o.paperHeight),void 0===t)return n;for(var r in t)n.value(r,t[r],!0);return this.get()},close:function(e){if(!e)throw new Error("uid 가 지정되지 않았습니다.");if(!this.$$_data[e])throw new Error("해당 데티터가 없습니다. : "+e);this.$$destroy(e)},get:function(e){return e?this.$$get(e,!0):this.$$get()},modify:function(e,t,n){if(void 0===e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");if(void 0===t)throw new Error("수정할 내용이 전달되지 않았습니다.");var o=this.$$get(e,!0);for(var r in t)if("paper"==r){var a=this.get().getNoneCopyValue("paper"),i=isNaN(t[r].width)?a.width:t[r].width,s=isNaN(t[r].height)?a.height:t[r].height;this.setPaper(i,s)}else o.value(r,t[r],n);return this.$$_data[e]},$$addDeleteQueue:function(e){},$$removeDeleteQueue:function(e){},getDeleteQueue:function(){},uid:function(){return this.$$_current},setPaper:function(e,t){e=e||o.paperWidth,t=t||o.paperHeight,this.get().value("paper",{width:e,height:t});var n=this.$$checkThumbnailRatio(e,t);this.get().value("thumbnail",{width:n.width,height:n.height})},$$checkThumbnailRatio:function(e,t,n,r){var a=n||o.thumbnailLimitWidth,i=r||o.thumbnailLimitHeight,s=e,c=t,u=a/s,l=i/c,d=Math.min(u,l),p=Math.ceil(s*d),m=Math.ceil(c*d);return{width:p,height:m,scale:d}},$$checkThumbnail_paper:function(e){var t,n=this.get(),r=n.getNoneCopyValue("paper");if(e){var a=o.thumbnailSizeRange;t=this.$$checkThumbnailRatio(r.width,r.height,a,a)}else t=this.$$checkThumbnailRatio(r.width,r.height);var i={width:t.width,height:t.height};return i},$$checkThumbnail_capture:function(e,t,n,o){var r=this.get();if(!r)return null;var a,i=r.getNoneCopyValue("paper"),s=this.$$checkThumbnail_paper(o),c={x:s.width/i.width,y:s.height/i.height},u={width:e||s.width,height:t||s.height},l=r.tooldata("capture");if(l&&l[n]){var d=l[n];a={width:d.originalWidth,height:d.originalHeight}}else a={width:i.width,height:i.height};var p={x:u.width/a.width,y:u.height/a.height},m={x:c.x,y:c.y};return{C:a,CT:u,Cs:p,CTs:m}},$$checkThumbnail_master:function(e,t,n){var o=this.get(),r=o.getNoneCopyValue("paper"),a=this.$$checkThumbnail_paper(n),i={x:a.width/r.width,y:a.height/r.height};e||(e={width:r.width,height:r.height}),t||(t={width:a.width,height:a.height,url:""});var s={x:t.width/e.width,y:t.height/e.height},c={x:i.x,y:i.y};return{M:e,MT:t,Ms:s,MTs:c}}});return new r}]};return e}var t=MODULE.core.instance;t.provider("$projects",e)}(),function(){function e(e,t,n){var o=e.extend("ProjectData",{$$_createName:function(e){e=e||"instance",this.$$_original._nameCounter++;var t=e+"_"+this.$$_original._nameCounter;return this.isChanged(!0),t},init:function(){window.$$_createNameCounter=null,this._super.apply(this,arguments);var e=this;window.$$_createNameCounter=function(){return e.$$_createName.apply(e,arguments)}},destroy:function(){this._super.apply(this,arguments),window.$$_createNameCounter=null},$$define:function(){return{_nameCounter:0,domain:"",appID:"",appName:"",subject:"",description:"",language:"ko-KR",creator:"",publisher:"",contributor:"",cover:"",assets:void 0,fileMap:void 0,files:void 0,savePath:void 0,publishPath:void 0,currentDocument:void 0,documents:void 0,paper:void 0,thumbnail:void 0,navigation:void 0,app:void 0}},$$setDefault:function(){this.value("domain","jikji.binder.cdbook"),this.value("appID",""),this.value("appName",""),this.value("savePath",""),this.value("publishPath",""),this.value("currentDocument",""),this.value("documents",[]),this.value("assets",{}),this.value("fileMap",{}),this.value("files",[]),this.value("navigation",[]),this.value("paper",{width:n.paperWidth,height:n.paperHeight}),this.value("thumbnail",{});var e=1,t=this.defaultScrollPosition(e);this.value("app",{scale:1,scrollX:t.x,scrollY:t.y})},defaultScrollPosition:function(e){return e=e||1,{x:(n.screenPadding-100)*e,y:(n.screenPadding-100)*e}},_restoreOpenFlag:"",$$_restoreOpenFlag:function(e){return arguments.length<1?this._restoreOpenFlag:void(this._restoreOpenFlag=e)},$$_checkName:function(){var e=this.$$_original;e.name||(e.name=e.uid)},publish:function(){return this.copy()},assets:function(){return this.value("assets")},addAsset:function(e){var t=this.$$_original.assets;t[e]=t[e]?t[e]+1:1,this.isChanged(!0)},removeAsset:function(e){var t=this.$$_original.assets;t[e]&&(t[e]=t[e]-1),t[e]<1&&(t[e]=null,delete t[e]),this.isChanged(!0)},files:function(){return this.value("files")},documents:function(){return this.value("documents")},addDocument:function(e,t){this.moveDocument(e,t)},removeDocument:function(e){var t=this.$$_original.documents,n=this.getIndex(e);0>n||(t.splice(n,1),this.value("currentDocument",""),this.isChanged(!0))},moveDocument:function(e,t){function n(e,t,n){if(e[n]==t)return!1;var o=this.getIndex(t);if(0>o)e.splice(n,0,t);else if(n>o)e.splice(n,0,t),e.splice(o,1);else{if(!(o>n))return!1;e.splice(o,1),e.splice(n,0,t)}return!0}function o(e,t,n){if(0>n)return void console.error("index가 0 보다 작을 수 없습니다.");var o=e.slice(0,n),r=e.slice(n);return t.forEach(function(e){var t=o.indexOf(e);t>-1&&o.splice(t,1);var n=r.indexOf(e);n>-1&&r.splice(n,1)}),this.$$_original.documents=o.concat(t).concat(r),!0}var r=this.$$_original.documents;if((void 0===t||null===t)&&(t=-1),"number"==typeof t||(t=parseInt(t,10),!isNaN(t))){if(0>t){var a=this.getSelectDocument();t=a?this.getIndex(a)+1:r.length}var i=!1;i=Array.isArray(e)?o.apply(this,[r,e,t]):n.apply(this,[r,e,t]),this.isChanged(i)}},getIndex:function(e){var t=this.$$_original.documents;return t.indexOf(e)},getDocument:function(e){var t=this.$$_original.documents;return t[e]},getSelectDocument:function(){var e=t.uid();return e},$$_copy:void 0,copyPasteData:function(){return arguments.length<1?this.$$_copy:(this.$$_copy=arguments[0],void this.pasteCounter())},$$_pasteCounter:0,$$_pasteOffset:10,getPasteOffset:function(){return this.$$_pasteOffset*this.$$_pasteCounter},pasteCounter:function(e){return e?void(this.$$_pasteCounter=this.$$_pasteCounter+e):void(this.$$_pasteCounter=0)},$$_tooldata:{capture:void 0},tooldata:function(e,t){var n=this.$$_tooldata;if(arguments.length<1)return n;if(1==arguments.length){var o=n[e];return o}n[e]=t}});return o}var t=MODULE.core.instance;t.factory("ProjectData",e),e.$inject=["DataBase","$selects","Default"]}(),function(){function e(){var e={$get:["DataService","SelectData","UIDType",function(e,t,n){var o=e.extend("SelectService",{type:n.SELECT,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());var n=new t(e);return n.setDataService(this,!0),n},add:function(e){if(e=e||this.createUID(),this.$$_data[e])throw new Error("같은 uid의 객체가 이미 존재합니다. 추가할 수 없습니다.");var t=this.$$_current,n=this.$$get(e);return this.$$_current=t,n},remove:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");this.$$destroy(e)},select:function(e){return e?(this.$$_current=e,this.$$_data[e]):void(this.$$_current=null)},get:function(e){return e?this.$$_data[e]:this.$$_current?this.$$_data[this.$$_current]:null},modify:function(e,t,n){if(void 0===e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");if(void 0===t)throw new Error("수정할 내용이 전달되지 않았습니다.");var o=this.$$get(e,!0);for(var r in t){if("inGroup"==r)throw new Error("inGroup 속성은 modify로 수정할 수 없습니다");o.value(r,t[r],n)}return this.$$_data[e]},uid:function(){return this.$$_current}});return new o}]};return e}var t=MODULE.core.instance;t.provider("$selects",e)}(),function(){function e(e){var t=e.extend("SelectData",{$$define:function(){return{description:"",editingUID:void 0,editingData:void 0,select:void 0,_length:0,currentGroup:void 0,inGroup:void 0}},$$setDefault:function(){this.value("editingUID",""),this.value("editingData",""),this.value("currentGroup",""),this.value("select",{}),this.value("_length",0),this.value("inGroup",[])},_selectProvider:function(){return this.$$_original},editInGroup:function(e){if(Array.isArray(e))this.$$_original.inGroup=e;else{var t=this.$$_original.inGroup;t.unshift(e)}this.isChanged(!0)},editOutGroup:function(e){var t="",n=this.$$_original.inGroup;return e?this.$$_original.inGroup=[]:t=n.shift(),this.isChanged(!0),t},currentEditGroup:function(){var e=this.$$_original.inGroup;return e[0]||""},getLength:function(){var e=this._selectProvider();return e._length},clear:function(){var e=this._selectProvider(),t=!(0===e._length&&e.select);e.select=null,e._length=0,e.select={},t&&this.isChanged(!0)},destroy:function(){var e=this._selectProvider();e.select=null,e._length=0,this._super()},get:function(){var e=[],t=this._selectProvider();for(var n in t.select){var o=t.select[n];e.push(o)}return e},isSelected:function(e){var t=this._selectProvider();return Boolean(t.select[e])},isSingleSelected:function(){var e=this._selectProvider();if(1!==e._length)return!1;var t;for(var n in e.select)t=e.select[n];return t},select:function(e){if(e){var t=!1,n=this._selectProvider();e instanceof Array?e.forEach(function(e,o){n.select[e]||(n._length++,t=!0),n.select[e]=e}):(n.select[e]||(n._length++,t=!0),n.select[e]=e),t&&this.isChanged(!0)}},unselect:function(e){if(e){var t=!1,n=this._selectProvider();e instanceof Array?e.forEach(function(e,o){n.select[e]&&(n._length--,t=!0),delete n.select[e]}):(n.select[e]&&(n._length--,t=!0),delete n.select[e]),t&&this.isChanged(!0)}},update:function(e,t){if(!e)return void this.clear();t&&this.clear();for(var n in e){var o=e[n];o?this.select(n):this.unselect(n)}},compare:function(e){var t=this.get();if((!t||t.length<1)&&(!e||e.length<1))return!0;if(!t||t.length<1)return!1;if(!e||e.length<1)return!1;if(e.length!=t.length)return!1;for(var n in t)if(e.indexOf(t[n])<0)return!1;return!0}});return t}var t=MODULE.core.instance;t.factory("SelectData",e),e.$inject=["DataBase"]}(),function(){function e(){var e=!1,t={$get:["DataService","TemplateData","UIDType",function(t,n,o){var r=t.extend("TemplateService",{type:o.TEMPLATE,createUID:function(){return this.$$createUID(this.type)},$$new:function(e){e||(e=this.createUID());var t=new n(e);return t.setDataService(this,!0),t},installed:function(t){return void 0===t?e:void(e=t)},dataChanged:function(e){},$$addSaveQueue:function(e){},$$removeSaveQueue:function(e){},getSaveQueue:function(){},$$addDeleteQueue:function(e){},$$removeDeleteQueue:function(e){},getDeleteQueue:function(){},add:function(e,t){if(e=e||this.createUID(),this.$$_data[e])throw new Error("같은 uid의 객체가 이미 존재합니다. 추가할 수 없습니다.");var n=this.$$get(e);if(this.$$_current=null,void 0===t)return n;for(var o in t)n.value(o,t[o],!0);return t.document&&t.document.version&&(n.$$_original.version=t.document.version),this.$$_data[e]},remove:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");this.$$destroy(e)},get:function(e){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");return this.$$_data[e]},modify:function(e,t,n){if(!e)throw new Error("uid가 지정되지 않았습니다. 데이터를 찾을수 없습니다.");if(void 0===t)throw new Error("수정할 내용이 전달되지 않았습니다.");var o=this.get(e);for(var r in t)o.value(r,t[r],n);return this.$$_data[e]}});return new r}]};return t}var t=MODULE.core.instance;t.provider("$templates",e)}(),function(){function e(e,t,n){var o=e.extend("TemplateData",{$$define:function(){return{description:"",type:t.TEMPLATE,elements:void 0,assets:void 0,groups:void 0,project:void 0,document:void 0,capture:void 0}},$$setDefault:function(){this.value("elements",{}),this.value("assets",{}),this.value("groups",{}),this.value("project",{}),this.value("document",{}),this.value("capture",{})},elements:function(){return this.value("elements")},assets:function(){return this.value("assets")},groups:function(){return this.value("groups")},project:function(){return this.value("project")},document:function(){return this.value("document")},capture:function(){return this.value("capture")},boundary:function(){var e=this.$$_original.project;if(e)return{width:e.paper.width,height:e.paper.height}},thumbnail:function(){var e=this.$$_original.project;if(e){var t=this.$$_original.capture.original,n=this.$$_original.document.backgroundColor||"#FFFFFF";return{source:t,backgroundColor:n,width:e.thumbnail.width,height:e.thumbnail.height}}}});return o}var t=MODULE.core.instance;t.factory("TemplateData",e),e.$inject=["DataBase","UIDType","FileSystem"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d){function p(){}function m(e,t,n){try{if(n.read&&n.read.length>0)for(var o in n.read){var r=n.read[o];if(r.dataName===e){var a=r.content;f(a,t,v)}}}catch(i){console.error("(컴포넌트 로드)",i.message),console.error(i.stack),alert(i)}}function f(e,t,n){function o(e,t){if(e&&e.children){var n=e.categoryPath||"",r=l.getCategoryName(e.categoryPath)||"",a=e.children,i=[];for(var s in a){var c=a[s];if("string"==typeof c)i.push({isBundle:t,categoryPath:n,categoryName:r,uid:s,data:c});else{var u=o(c,t);u&&(i=i.concat(u))}}return i}}var r=o(e,t);if(r)return n&&r.forEach(function(e){n(e)}),r}function v(e){var t=e.categoryPath,n=e.categoryName,r=e.data,a=e.uid,i=e.isBundle;i&&(r=r.replace(new RegExp(s.USER_DATA_COMPONENT_MARKER,"img"),s.BUNDLE_COMPONENT_MARKER+"/"+n));var c=o.get(a);c&&(console.log("# 생성한 컴포넌트 먼저 삭제 : ",a),o.remove(a)),c=o.add(a),d.convert(JSON.parse(r),c.$$_original),c.isChanged(!0),console.debug("# ",i?"Bundle":"User"," 컴포넌트 세팅 : ",n,a,c),console.warn("[컴포넌트 데이터 주의 사항] $contentComponentSetting 데이터중 asset 데이터에는 categoryPath가 적용되지 않은 USER_DATA_COMPONENT_MARKER 경로로된 path를 가지고 있음.\n- 따라서 컴포넌트를 insert, modify, remove 할때 categoryPath 를 별도로 적용해 줘야함.\n- import, export, modify 할때 $contentComponentSetting 데이터를 수정하지 않게 하기 위함임.\n"),l.add(a,{bundle:i,categoryPath:t})}var g={user:!1,bundle:!1};return p.prototype={installed:function(e,t){return void 0===t?g:(g[e]=t,void(this._installComplete=g.user&&g.bundle))},_installComplete:!1,installComplete:function(){return this._installComplete},user:function(e){var t=s.pathMarkerInfo(),n="userComponent",o={pathInfo:t,read:[{dataName:n,folder:s.USER_DATA_COMPONENT_MARKER}]};r.component(o,function(t,o){return t?(console.error("# User 컴포넌트 읽기 에러 : ",t),void e()):(m(n,!1,o),void e())})},userImport:function(e){return f(e,!1)},setComponent:v,bundle:function(e){var t=s.pathMarkerInfo(),n="bundleComponent",o={pathInfo:t,read:[{dataName:n,folder:s.BUNDLE_COMPONENT_MARKER,bundle:!0}]};r.component(o,function(t,o){return t?(console.error("# Bundle 컴포넌트 읽기 에러 : ",t),void e()):(m(n,!0,o),void e())})}},new p}var t=MODULE.core.instance;t.service("$componentLoader",e),e.$inject=["MacroBase","$command","CommandName","$components","$externalAPI","$exitApplicationMacro","$communication","FileSystem","$notice","$toast","$contentComponentSetting","$subversion_component"]}(),function(){function e(e,t,n,o){function r(e,t){var n=e.category,o=t.category,r=e.label,a=t.label;if(n&&o){if(a>r)return-1;if(r>a)return 1}else{if(n)return-1;if(o)return 1;if(a>r)return-1;if(r>a)return 1}return 0}var a={},i={user:{categoryPath:""},bundle:{categoryPath:""}},s={getSetting:function(e){return e?a[e]:a},parseVersionString:function(e){var t=o.parse(e);return t=t.major+"."+t.minor+"."+t.build},getCategoryName:function(e){return e?e.substring(e.lastIndexOf("/")+1):""},add:function(o,r){r=r||{};var i=t.get(o),s=i.name()||"이름 지정 안됨",c=i.value("boundary"),u=this.parseVersionString(i.version()),l=i.value("userVersion"),d={version:u,userVersion:l,label:s,type:e.COMPONENT,component:o,css:{width:c.width,height:c.height},option:{_$$flexibleSize:!1,_$$editable:!1,layout:angular.copy(n.layout)},bundle:!1,categoryPath:""},p=angular.extend({},d,r);a[o]=p},remove:function(e){t.remove(e),delete a[e]},modify:function(e,t){var n=a[e];return n?t?void(void 0!==t.name&&(n.label=t.name||"이름 지정 안됨")):void console.error("수정할 컴포넌트 데이터가 없습니다."):void console.error("컴포넌트 목록이 일치하지 않습니다.")},newTreeItem:function(e){var t={type:"",uid:"",category:"",label:"",depth:0};return angular.merge(t,e)},getTree:function(e,t){if(!t)return i[e];var n=i[e];return t.split("/").forEach(function(e){if(n&&e){var t=n.children;t&&(n=t[e])}}),n},setTree:function(e,t){function n(e,t){var n=e;return t.categoryPath.split("/").forEach(function(e){if(e){var t=n.categoryPath;n.children||(n.children={});var o=n.children;o[e]||(o[e]={categoryPath:t+"/"+e}),n=o[e]}}),n}var o={categoryPath:""};return t?(t.forEach(function(e){var t=n(o,e),r=e.component;t.children||(t.children={}),t.children[r]=e}),i[e]=o):i[e]=o},sortBy_folder_file:r,compareCategory:function(e,t){if(e===t)return 0;var n=new RegExp("^("+e+")(/|/.+)?$");return n.test(t)?1:-1}};return window.debugMode&&window.$data&&(window.$data.componentMap=a,window.$data.componentTree=i),s}var t=MODULE.core.instance;t.service("$contentComponentSetting",e),e.$inject=["ElementType","$components","Default","$version"]}(),function(){function e(e,t,n,o,r,a,i,s){function c(){}function u(a,i){function c(e){var n={minX:void 0,minY:void 0,maxX:void 0,maxY:void 0};e.forEach(function(e){var o=t.get(e);if(!o)return void _.elements.push(e);var r=o.getNoneCopyValue("state"),a=r.normal.css;n.minX=void 0===n.minX?a.left:Math.min(a.left,n.minX),n.minY=void 0===n.minY?a.top:Math.min(a.top,n.minY),n.maxX=void 0===n.maxX?a.left+a.width:Math.max(a.left+a.width,n.maxX),n.maxY=void 0===n.maxY?a.top+a.height:Math.max(a.top+a.height,n.maxY)});var o={x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY};return o}function u(e,r){e.forEach(function(e){var a=t.get(e);if(!a)return void _.elements.push(e);var i=a.copy();i.currentState="normal",r&&(i.group=""),l(i);var s=i.assets;s.forEach(function(e){var t=n.get(e);d(t.copy(),m)});var c=a.isGroupContainer();if(c){var f=o.get(c);p(f.copy());var v=f.indexes();u(v)}})}function l(e){v[e.uid]={uid:t.createUID(),data:e}}function d(e,t){var o=e.uid;if(!h[o]){var r=t?n.createUID():o;h[o]={uid:r,data:e}}}function p(e){g[e.uid]={uid:o.createUID(),data:e}}var m=Boolean(i),f=[];!function(){var t=r.get(),n=t.currentEditGroup(),i=n?o.get(n):e.get(),s=i.indexes();a.sort(function(e,t){var n=s.indexOf(e.element),o=s.indexOf(t.element);if(0>n||0>o)throw new Error("다른 parent를 가진 element는 정렬할 수 없습니다.");return n-o}),a.forEach(function(e){var t=e.element;f.push(t)})}();var v={},g={},h={},_={elements:[],groups:[],assets:[]};u(f,!0),(_.elements.length>0||_.groups.length>0||_.assets.length>0)&&s.correctData(e.uid(),_);var $=c(f),E={indexes:f,elements:v,groups:g,assets:h,boundary:$};return E}function l(e){function t(e,t){["normal","over","down"].forEach(function(n){var o=e.state[n],r=o.css;void 0!==r.left&&(r.left=r.left-t.x),void 0!==r.top&&(r.top=r.top-t.y)})}var n=e.elements;!function(){var o=e.indexes;for(var r in n){var a=n[r].data;o.indexOf(r)>-1&&t(a,e.boundary),n[r].data=m(a,e)}}(),e.elements=n}function d(e){var t=e.groups;for(var n in t){var o=t[n].data;t[n].data=m(o,e)}e.groups=t}function p(e,t){function n(e){var t=i.pattern.source;return t.test(e)}function o(e,t){e.original=e.path;var n=a.USER_DATA_COMPONENT_MARKER+"/asset-"+t,o=e.path.replace(/\/component\/asset-component-([\w\d-])+\//gim,"/");o=o.replace(s,n),e.path=o}var r=e.assets,s=a.WORK_FOLDER+a.OPS;for(var c in r){var u=r[c].data;n(u.path)||o(u,t);var l=u.original;r[c].data=m(u,e),r[c].data.original=l;

}e.assets=r}function m(e,t){var n,o=JSON.stringify(e),r=t.elements,a=t.groups,i=t.assets;for(n in i)o=o.replace(new RegExp(n,"img"),i[n].uid);for(n in a)o=o.replace(new RegExp(n,"img"),a[n].uid);for(n in r)o=o.replace(new RegExp(n,"img"),r[n].uid);return JSON.parse(o)}return c.prototype={get:function(e,t){var n=u(e,t);return l(n),d(n),t&&p(n,t),function(){function e(e){for(var t in e){var n=e[t].uid;e[n]=e[t].data,n!==t&&delete e[t]}return e}n.indexes=function(){var e=[];return n.indexes.forEach(function(t){var o=n.elements[t].uid;e.push(o)}),e}(),n.elements=e(n.elements),n.assets=e(n.assets),n.groups=e(n.groups)}(),console.log("# maps : ",n),n}},new c}var t=MODULE.core.instance;t.service("$copyData",e),e.$inject=["$documents","$elements","$assets","$groups","$selects","FileSystem","$util","$verification"]}(),function(){function e(e,t,n,o){function r(){}function a(t){function o(e){e.forEach(function(e){var t=angular.copy(c[e]);r(t);var n=t.assets;n.forEach(function(e){var t=angular.copy(l[e]);a(t)});var s=t.childGroup;if(s){var d=angular.copy(u[s]);i(d);var p=d.indexes;o(p)}})}function r(t){p[t.uid]={uid:e.createUID(),data:t}}function a(e){var t=e.uid;d[t]||(d[t]={uid:t,data:e})}function i(e){m[e.uid]={uid:n.createUID(),data:e}}var s=t.indexes,c=t.elements,u=t.groups,l=t.assets,d={},p={},m={};o(s);var f={indexes:s,elements:p,groups:m,assets:d};return f}function i(e){var t=e.elements;for(var n in t){var o=t[n].data;t[n].data=u(o,e)}e.elements=t}function s(e){var t=e.groups;for(var n in t){var o=t[n].data;t[n].data=u(o,e)}e.groups=t}function c(e){}function u(e,t){var n,o=JSON.stringify(e),r=t.elements,a=t.groups;for(n in a)o=o.replace(new RegExp(n,"img"),a[n].uid);for(n in r)o=o.replace(new RegExp(n,"img"),r[n].uid);return JSON.parse(o)}function l(e,t){function n(e,i){e.forEach(function(e){var f=c[e];console.debug("# element : ",f.uid);var v=d(f.assets,s,a),g=m(f,a);i&&t&&o(g,t);var h={element:e,data:g,asset:{add:{document:r,assets:v}}};l.push(h);var _=f.childGroup;if(_){var $=u[_];p[_]=$;var E=$.indexes;n(E)}})}function o(e,t){var n=t.left,o=t.top;["normal","over","down"].forEach(function(r,a){var i=e.state[r],s=i.css,c=function(){var t=i.option.layout||{},n=e.state.normal;if(!n)return t;var o=n.option.layout;for(var r in o)(null===t[r]||void 0===t[r])&&(t[r]=o[r]);return t}(),u=c.width&&(c.left||c.right)?t.offsetX||0:0;void 0!==s.left&&(s.left=s.left+n+u);var l=c.height&&(c.top||c.bottom)?t.offsetY||0:0;void 0!==s.top&&(s.top=s.top+o+l)})}var r=e.document;if(!r)return console.error("maps 객체에 document UID 값을 넘겨주지 않았습니다."),null;var a=Boolean(e.component),i=e.indexes,s=e.assets,c=e.elements,u=e.groups,l=[],p={};n(i,!0);var f={document:r,elements:l,groups:p};return f}function d(e,t,n){var o=[];return e.forEach(function(e){var r=t[e];console.debug("	- asset : ",r.uid),delete r._counter;var a=p(e,r,n),i={asset:e,needToCopy:!0,data:a};o.push(i)}),o}function p(e,n,r){var a,i,s=n.path,c=t.isURL(s),u=angular.extend({},n,{uid:e,name:e});if(c)a=s;else{var l=t.get(e);if(r)if(l)a=l.value("path");else{i=s,a=s;var d="(\\/.*)?\\/asset-component-([\\w\\d-])+\\/",p=new RegExp(o.USER_DATA_COMPONENT_MARKER+d,"img");a=a.replace(p,o.WORK_OPS_FOLDER+"/");var m=new RegExp(o.BUNDLE_COMPONENT_MARKER+d,"img");a=a.replace(m,o.WORK_OPS_FOLDER+"/")}else{var f=!Boolean(l);f&&(s=s.replace(o.WORK_FOLDER,o.TEMP_FOLDER)),a=0===s.indexOf(o.TEMP_FOLDER)?s.replace(o.TEMP_FOLDER,o.WORK_FOLDER):s}}return i&&(u.original=i),a&&(u.path=a),u}function m(e,t){return e.assets=[],e.selected=!1,delete e.uid,t||delete e.name,e}return r.prototype={get:function(e){var t=a(e);return t.document=e.document,i(t),s(t),c(t),function(){function e(e){for(var t in e){var n=e[t].uid;e[n]=e[t].data,n!==t&&delete e[t]}return e}t.indexes=function(){var e=[];return t.indexes.forEach(function(n){var o=t.elements[n].uid;e.push(o)}),e}(),t.elements=e(t.elements),t.assets=e(t.assets),t.groups=e(t.groups)}(),console.debug("# maps : ",t),t},getElementParams:function(e,t){var n=l(e,t);return console.debug("# Add Element Param : ",n),n}},new r}var t=MODULE.core.instance;t.service("$pasteData",e),e.$inject=["$elements","$assets","$groups","FileSystem"]}(),function(){function e(e,t,n,o,r,a,i){function s(){}return s.prototype={_disable:!1,enable:function(){this._disable=!1},disable:function(){this._disable=!0},_delayTime:a.backupDelayTime,_project_uid:null,activate:function(e){console.debug("* 자동 백업 활성화 : ",e),this._project_uid=e},deactivate:function(e){console.debug("* 자동 백업 비활성화 : ",e),this._project_uid=null},_isRunning:!1,_backupID:null,_saveAll:!1,execute:function(e,t,n){if(this._disable||!this._project_uid)return void(n&&n(!1));this._backupID&&(clearTimeout(this._backupID),this._backupID=null),void 0===t&&(t=this._delayTime),console.debug("# 백업 대기 : ",t/1e3,"sec",e);var o=this;this._backupID=setTimeout(function(){o._run(e,n)},t)},commandAfter:function(t,n){var o=this._delayTime;switch(t){case e.APPLICATION_NEW:case e.APPLICATION_EXIT:case e.PROJECT_CLOSE:case e.PROJECT_BACKUP:return;case e.PROJECT_SAVE:case e.PROJECT_SAVEAS:case e.PROJECT_PUBLISH:case e.PROJECT_PREVIEW:case e.ELEMENT_COPY:case e.ELEMENT_CUT:return;case e.PROJECT_OPEN:case e.PROJECT_RESTORE:case e.PROJECT_NEW:this._saveAll=!0;break;case e.DOCUMENT_SELECT:}this.execute(n,o)},_run:function(e,a){if(!this._disable){if(a||(a=function(){}),!this._project_uid||this._isRunning)return a(!1);if(!o.isBusy()){var s=o.get().needToBackup();if(!this._saveAll&&!s)return a(!1);this._isRunning=!0;var c={project:this._project_uid,saveAll:this._saveAll};e&&(c=angular.extend(c,e));var u=new t(c),l=r.getProcess(u),d=this;l.useSafetyCheck=!1,n.execute(l,function(e){console.log("# 백업 종료 : ",e),d._isRunning=!1,d._saveAll=!1,a(!0),i.gc()})}}}},new s}var t=MODULE.core.instance;t.service("$autoBackup",e),e.$inject=["CommandName","CommandParam","$command","$applications","$backupProjectMacro","Default","$externalAPI"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u){function l(e){return e.replace(/\$/g,"$$$$")}function d(){}var p,m,f,v,g,h="\r\n",_="    ",$={VERSION:/#_VERSION_#/g,WIDTH:/#_WIDTH_#/g,HEIGHT:/#_HEIGHT_#/g,TITLE:/#_TITLE_#/g,DESCRIPTION:/#_DESCRIPTION_#/g,JS_PATH:/#_JS_PATH_#/g,JS_DATA:/#_JS_DATA_#/g,BOOK_ID:/#_BOOK_ID_#/g,LANGUAGE:/#_LANGUAGE_#/g,CREATER:/#_CREATER_#/g,DATE:/#_DATE_#/g,PUBLISHER:/#_PUBLISHER_#/g,GENERATOR:/#_GENERATOR_#/g,MANIFEST_LIST:/#_MANIFEST_LIST_#/g,SPINE_LIST:/#_SPINE_LIST_#/g,NAV_MAP:/#_NAV_MAP_#/g,PRINT_MAP:/#_PRINT_MAP_#/g,SEARCH_CONTENT:/#_SEARCH_CONTENT_#/g};return d.prototype={_clear:function(e){console.log("# 출판 (임시) EPUB 폴더 초기화 : ",n.EPUB_FOLDER),o.remove({path:n.EPUB_FOLDER},null,function(t){return t?e(t):void e()})},build:function(e){this._clear(function(t){return t?e(t):void o.copy(n.BUNDLE_EPUB,n.EPUB_FOLDER,function(t){return console.log("# EPUB 샘플 폴더 복사"),t?e(t):void e()})})},resourceCopy:function(e){function t(){o.copy(n.WORK_OPS_FOLDER,n.EPUB_OPS_FOLDER,function(t){console.log("# EPUB 리소스 파일 복사"),e()})}o.exist(n.WORK_OPS_FOLDER,function(e){if(e)t();else{var r={path:n.WORK_OPS_FOLDER};o.createFolder(r,function(e){e&&console.error(e),t()})}})},delete_thumbnail:function(e,t){o.remove({path:e},null,function(e){return e?t(e):void t()})},cerateOPF:function(e,t){function r(){var r=a.getOPF(e),i=n.EPUB_OPS_FOLDER+"/"+n.content_opf,s={encoding:"utf8"};o.outputFile(i,r,s,function(e){console.log("# OPF 생성 결과 : ",i),e?t(e):t()})}console.log("# OPF 생성",e,"\n");var a=this;return p?void r():void o.readFile(n.OPF_SAMPLE,{encoding:"utf8"},function(e,t){p=t,r()})},getOPF:function(e){var t=this._getMetadata(e.metadata),n=this._getManifest(e.manifest,t.cover),o=this._getSpine(e.spine,t.cover),r=p;return r=r.replace($.BOOK_ID,l(t.uid)),r=r.replace($.TITLE,l(t.title)),r=r.replace($.LANGUAGE,l(t.language)),r=r.replace($.CREATER,l(t.creator)),r=r.replace($.DATE,l(t.date)),r=r.replace($.PUBLISHER,l(t.publisher)),r=r.replace($.DESCRIPTION,l(t.description)),r=r.replace($.GENERATOR,l(t.generator)),r=r.replace($.MANIFEST_LIST,l(n)),r=r.replace($.SPINE_LIST,l(o))},_getMetadata:function(n,o){var r={},a=n.uid;a.indexOf("urn:uuid")<0&&(a="urn:uuid:"+a),r.uid=a,r.creator=n.creator||"";var i=n.date||new Date;return r.date=e("date")(i,"yyyy-MM-ddTHH:mm:ss")+"Z",r.title=n.title||"",r.language=n.language||"en-US",r.publisher=n.publisher||"",r.description=n.description||"",r.generator=t.version(),r.cover=n.cover||"",r},_getManifest:function(e,t){var o=e.length,r=h,a=_+_;if(t){var i=c.get(t),s=i.value("path"),u=i.value("type");"jpg"===u.toLowerCase()&&(u="jpeg"),s=n.getRelativePath(s),r+=a+'<item id="cover" href="'+s+'" media-type="image/'+u+'"></item>'+h,r+=h}for(var l=0;o>l;++l){var d=e[l];r+=a+'<item id="'+d.id+'" href="'+d.href+'" media-type="'+d.mediaType+'"></item>'+h}return r},_getSpine:function(e,t){for(var n=e.length,o=h,r=_+_,a=0;n>a;++a){var i=e[a];o+=r+'<itemref idref="'+i.id+'"></itemref>'+h}return o},createHTML:function(e,t){function r(){var r=a._getPageHTML(e),i=e.path,s=n.EPUB_OPS_FOLDER+"/"+i,c={encoding:"utf8"};o.outputFile(s,r,c,function(e){console.log("# Page HTML 생성 결과 : ",s),e?t(e):t(null,i)})}console.log("# Page HTML 생성",e.documentUID,"\n");var a=this;return m?void r():void o.readFile(n.PAGE_SAMPLE,{encoding:"utf8"},function(e,t){m=t,r()})},_getPageHTML:function(e){var n=t.version(),o=a.get(e.projectUID),r=i.get(e.documentUID),s=o.getNoneCopyValue("paper"),c=s.width,u=s.height,d=r.getNoneCopyValue("subject");""==d&&(d=o.getNoneCopyValue("subject")||"");var p=r.getNoneCopyValue("description"),f=r.getNoneCopyValue("search");void 0===d&&(d=""),void 0===p&&(p=""),void 0===f&&(f="");var v=m;v=v.replace($.VERSION,l(n)),v=v.replace($.WIDTH,c),v=v.replace($.HEIGHT,u),v=v.replace($.TITLE,l(d)),v=v.replace($.DESCRIPTION,l(p)),v=v.replace($.SEARCH_CONTENT,l(f));var g=e.jsName;return v=v.replace($.JS_PATH,l(g))},createJS:function(e,t){function r(){var r=a._getPageJS(e),i=a._getInsertCode(e.pageNum,r),s=e.jsName,c=n.JS_FOLDER+"/"+s,u={encoding:"utf8"};o.outputFile(c,i,u,function(e){console.log("# Page JS 생성 결과 : ",c),e?t(e):t(null,s)})}console.log("# Page JS 파일 생성 : ",e.documentUID);var a=this;return f?void r():void o.readFile(n.JS_SAMPLE,{encoding:"utf8"},function(e,t){f=t,r()})},_getPageJS:function(e){var t={},o=a.get(e.projectUID,!0),l=o.uid(),d={};d[l]=o.publish(),d[l].currentDocument=e.documentUID;var p=i.get(e.documentUID,!0),m=p.uid(),f={};f[m]=p.publish();for(var v=p.elements(),g={},h=0;h<v.length;++h){var _=v[h],$=s.get(_,!0);$?g[_]=$.publish():console.error("	* 누락된 데이터 : ",_)}for(var E=p.groups(),y={},P=0;P<E.length;++P){var w=E[P],b=u.get(w,!0);y[w]=b.publish()}var C=l.replace(/project/,r.GROUP),O={};O[C]=y;var T=angular.extend({},p.assets(),o.assets()),D={};for(var R in T){var x=c.get(R,!0);D[R]=x.publish();var A=D[R].path;A=n.getRelativePath(A),D[R].path=A}var S=l.replace(/project/,r.ASSET),M={};return M[S]=D,t[r.PROJECT]=d,t[r.DOCUMENT]=f,t[r.ELEMENT]=g,t[r.ASSET]=M,t[r.GROUP]=O,console.log("# 페이지 데이터 (출판) : ",t),t},_getInsertCode:function(e,t){var n=angular.toJson(t),o=f;return o=o.replace($.JS_DATA,l(n))},createNCX:function(e,t){function r(){var r=a._getNCX(e),i=n.EPUB_OPS_FOLDER+"/"+n.toc_ncx,s={encoding:"utf8"};o.outputFile(i,r,s,function(e){console.log("# NCX 생성 결과 : ",i),e?t(e):t()})}console.log("NCX 생성 : ",e,"\n");var a=this;return v?void r():void o.readFile(n.NCX_SAMPLE,{encoding:"utf8"},function(e,t){v=t,r()})},_getNCX:function(e){for(var t=e.metadata,n=e.navigation,o=n.length,r=_+_,a=h,i=h,s=0;o>s;++s){var c=n[s],u=s+1,d=c.path,p="nav-"+c.pageNum,m=c.pageName;a+=r+'<navPoint id="'+p+'" playOrder="'+u+'">'+h,a+=r+_+"<navLabel><text>"+m+"</text></navLabel>"+h,a+=r+_+'<content src="'+d+'"/>'+h,a+=r+"</navPoint>"+h;var f="print-"+c.pageNum,g="page."+u;i+=r+'<pageTarget id="'+f+'" type="normal" value="'+u+'">'+h,i+=r+_+"<navLabel><text>"+g+"</text></navLabel>"+h,i+=r+_+'<content src="'+d+'"/>'+h,i+=r+"</pageTarget>"+h}var E=t.uid;E.indexOf("urn:uuid")<0&&(E="urn:uuid:"+E);var y=t.title||"",P=v;return P=P.replace($.BOOK_ID,l(E)),P=P.replace($.TITLE,l(y)),P=P.replace($.NAV_MAP,l(a)),P=P.replace($.PRINT_MAP,l(i))},createNAV:function(e,t){function r(){var r=a._getNAV(e),i=n.EPUB_OPS_FOLDER+"/"+n.nav_xhtml,s={encoding:"utf8"};o.outputFile(i,r,s,function(e){console.log("# NAV 생성 결과 : ",i),e?t(e):t()})}console.log("NAV 생성 : ",e,"\n");var a=this;return g?void r():void o.readFile(n.NAV_SAMPLE,{encoding:"utf8"},function(e,t){g=t,r()})},_getNAV:function(e){function t(e,n,o){if(!e||e.length<1)return n;var r=e.length;n+=h+d+"<ol>"+h;for(var a=0;r>a;++a){var i=e[a],s=isNaN(i.pageNum)||null===i.pageNum?"":i.pageNum,u=void 0===i.title?i.pageNum:i.title,l="";s&&c[i.pageNum-1]&&(l=c[i.pageNum-1].path),n+=d+_+'<li page="'+s+'"><a href="'+l+'">'+u+"</a>",n=t(i.children,n,o+1),n+="</li>"+h}return n+=d+"</ol>"+h}function n(e,n,o){if(!e||e.length<1)return n;var r=e.length;n+=h+"<ol>"+h;for(var a=0;r>a;++a){var i=e[a],s=a+1,c=i.path?i.path:"";n+=d+'<li><a href="'+c+'">'+s+"</a>",n=t(i.children,n,o+1),n+="</li>"+h}return n+="</ol>"+h}function o(e,t,n){var o=g;return o=o.replace($.TITLE,l(e)),o=o.replace($.NAV_MAP,l(t)),o=o.replace($.PRINT_MAP,l(n))}var r,a,i=e.metadata,s=e.navigation,c=e.pageHTML,u=i.title||"",d=_+_+_;return r=t(s||[],"",0),a=n(c,"",0),o(u,r,a)},createMasterList:function(e,t){console.log("Master 리스트 생성 : ",e,"\n");for(var r,a=e.pageHTML,s=a.length,u=0;s>u;++u){var l=a[u],d=isNaN(l.pageNum)||null===l.pageNum?"":l.pageNum,p=i.get(l.documentUID,!0),m=p.value("master");if(m){var f=c.get(m),v=f.value("path");v=n.getRelativePath(v)}else v="";r||(r=[]),r.push({page:d,master:v})}var g=r?JSON.stringify(r,null,4):"",h=n.EPUB_OPS_FOLDER+"/"+n.info_json,_={encoding:"utf8"};o.outputFile(h,g,_,function(e){console.log("# Master 리스트 생성 결과 : ",h),e?t(e):t()})}},new d}var t=MODULE.core.instance;t.service("$epub",e),e.$inject=["$filter","$version","FileSystem","$externalAPI","UIDType","$projects","$documents","$elements","$assets","$groups"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f,v){var g={saveApplication:function(e,n){var o={},r=t.get(),a=r.$$_original,i=a.uid;if(e?t.$$removeBackupQueue(i):r.saved(),e){if(!n)return r.isChanged()?(o[i]=a,{data:o,length:1}):{data:null,length:0}}else u.updateVersion(a);return o[i]=a,{data:o,length:1}},saveProject:function(e){var t={},o=n.getSaveQueue(e),r=0;console.log("# SAVE Project : ",o);for(var a;a=o[0];){console.log("UID : ",a);var i=n.get(a,!0);if(i.isChanged()){var s=i.$$_original;l.updateVersion(s),t[a]=s,r++}e?n.$$removeBackupQueue(a):i.saved()}return{data:t,length:r}},saveDocuments:function(e){for(var t,n={},r=o.getSaveQueue(e),a=0;t=r[0];){var i=o.get(t,!0);if(i.isChanged()){console.log("* save  document uid : ",t);var s=i.$$_original;d.updateVersion(s),n[t]=s,a++}e?o.$$removeBackupQueue(t):i.saved()}return{data:n,length:a}},saveElements:function(e){var t={},n=r.getSaveQueue(e),o=0;console.log("# SAVE Elements : ",n);for(var a;a=n[0];){var i=r.get(a,!0);if(i.isChanged()){var s=i.$$_original;p.updateVersion(s),t[a]=s,o++}e?r.$$removeBackupQueue(a):i.saved()}return{data:t,length:o}},saveSelects:function(t,n,o){var r=!1;if(n){var a=s.getDeleteQueue(!0);for(var i in a)r=!0,s.$$removeDeleteBackupQueue(i);var c=s.getSaveQueue(!0);c.length>0&&(r=!0)}else{var u=s.getDeleteQueue();for(var i in u)r=!0,s.$$removeDeleteQueue(i)}var l=s.getDatas(),d={};for(var p in l){var f=l[p],v=f.$$_original;n||(f.isChanged()&&(r=!0),m.updateVersion(v)),d[p]=v,n?s.$$removeBackupQueue(p):f.saved()}if(!o&&!r)return{data:null,length:0};var g={},h=0;if(d){var _=t.replace(/project/,e.SELECT);g[_]=d,h=1}return{data:g,length:h}},saveAssets:function(t,n,o){var r=!1;if(n){var i=a.getDeleteQueue(!0);for(var s in i){r=!0;break}var c=a.getSaveQueue(!0);c.length>0&&(r=!0)}else{var u=a.getDeleteQueue();for(var s in u){r=!0;break}}var l,d=a.getDatas(),p={},m=0;for(var v in d){var g=d[v],h=g.$$_original;n||(g.isChanged()&&(r=!0),f.updateVersion(h)),p[v]=h;var g=a.get(v,!0);g.isChanged()&&(l||(l={}),l[v]=h,m++),n?a.$$removeBackupQueue(v):g.saved()}if(!o&&!r)return{data:null,length:0,files:{},filesCounter:0};var _={},$=0;if(p){var E=t.replace(/project/,e.ASSET);_[E]=p,$=1}return{data:_,length:$,files:l,filesCounter:m}},saveGroups:function(t,n,o){var r=!1;if(n){var a=c.getDeleteQueue(!0);for(var i in a)r=!0,c.$$removeDeleteBackupQueue(i);var s=c.getSaveQueue(!0);s.length>0&&(r=!0)}else{var u=c.getDeleteQueue();for(var i in u)r=!0,c.$$removeDeleteQueue(i)}var l=c.getDatas(),d={};for(var p in l){var m=l[p],f=m.$$_original;n||(m.isChanged()&&(r=!0),v.updateVersion(f)),d[p]=f,n?c.$$removeBackupQueue(p):m.saved()}if(!o&&!r)return{data:null,length:0};var g={},h=0;if(d){var _=t.replace(/project/,e.GROUP);g[_]=d,h=1}return{data:g,length:h}}};return g}var t=MODULE.core.instance;t.service("$extractSaveData",e),e.$inject=["UIDType","$applications","$projects","$documents","$elements","$assets","$history","$selects","$groups","$subversion_application","$subversion_project","$subversion_document","$subversion_element","$subversion_select","$subversion_asset","$subversion_group"]}(),function(){function e(e,t){function n(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files[0];if(t){if(!r)return e.dataTransfer.dropEffect="none",!1;e.dataTransfer.dropEffect="link"}else if(e.dataTransfer.dropEffect="none",!r)return!0;return!1}function o(n){var o=n.dataTransfer.files[0];if(!o)return r?!1:!0;if(n.preventDefault(),!r)return!1;console.debug("* file drop : ",o.path);var i=e.parsePath(o.path),s=e.ext.substring(1);switch(i.ext){case s:a.openProject&&a.openProject(o.path);break;default:t.message("지원되지 않는 파일 형식 입니다.")}return!1}var r=!1,a={};return{set:function(e){if(window.ondragover=n,window.ondrop=o,e)for(var t in e)a[t]=e[t]},enable:function(){r=!0},disable:function(){r=!1}}}var t=MODULE.core.instance;t.service("$fileDrop",e),e.$inject=["FileSystem","$toast"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f,v,g,h,_,$,E,y,P,w){function b(){}function C(e,t,n,o,r){function a(){++d;var r=c[d];m?o(r||""):o(d,p,r||""),r?t(r,e,function(){++s,s===i?(s=0,l=window.requestAnimationFrame(a)):a()}):(window.cancelAnimationFrame&&window.cancelAnimationFrame(l),y(function(){n()},100*P.animate.duration))}var i=20,s=0,c=[];for(var u in e)c.push(u);var l,d=-1,p=c.length,m=3*i>p;m?o(r||""):o(0,p,r||""),y(function(){a()},100*P.animate.duration)}function O(e,t,n,o){if(!t){var r=o?n.get(o,!0):n.get();r.saved()}}b.prototype={run:function(t,n,o){var r=!1;console.log("datas : ",t);var a=[],i=this;a.push(function(n){var a=t[e.APPLICATION];i.setApplication(a,function(e){e&&(r=!0),n()},function(e,t,n){o&&o(e,t,"[ 1/8 ] Application 데이터 "+n)})}),a.push(function(n){var a=t[e.PROJECT];i.setProject(a,function(e){e&&(r=!0),n()},function(e,t,n){o&&o(e,t,"[ 2/8 ] Project 데이터 "+n)})}),a.push(function(n){var a=t[e.ASSET];i.setAsset(a,function(e){e&&(r=!0),n()},function(e,t,n){o&&o(e,t,"[ 3/8 ] Assets 데이터 "+n)})}),a.push(function(n){var a=t[e.ELEMENT];i.setElement(a,function(e){e&&(r=!0),n()},function(e,t,n){o&&o(e,t,"[ 4/8 ] Element 데이터 "+n)})}),a.push(function(n){var a=t[e.DOCUMENT];i.setDocuments(a,function(e){e&&(r=!0),n()},function(e,t,n){o&&o(e,t,"[ 5/8 ] Document 데이터 "+n)})}),a.push(function(n){var a=t[e.GROUP];i.setGroup(a,function(e){e&&(r=!0),n()},function(e,t,n){o&&o(e,t,"[ 6/8 ] Group 데이터 "+n)})}),a.push(function(n){var a=t[e.SELECT];i.setSelect(a,function(e){e&&(r=!0),n()},function(e,t,n){o&&o(e,t,"[ 7/8 ] Select 데이터 "+n)})}),a.push(function(n){var a=t[e.TOOL];i.setTool(a,function(e){e&&(r=!0),n()},function(e,t,n){o&&o(e,t,"[ 8/8 ] Tool 데이터 "+n)})}),async.waterfall(a,function(e){e&&console.error(e),n(r)})},setApplication:function(e,t,n){function o(e,t,n){var o=t[e],a=w.data("application");o=angular.merge({},o,a),i.close(i.uid()),o&&f.isSubversion(o.version)?(i.create(e),r=f.convert(o,i.get().$$_original)):i.create(e,o);var s=f.forceUpdate(o,i.get().$$_original);s&&(r=!0),O("$applications",r,i),n()}console.log("# Aplication 데이터 설정");var r=!1;return e?void C(e,o,function(){t(r)},n,"Aplication 데이터 설정"):t(r)},setProject:function(e,t,n){function o(e,t,n){var o=t[e];o&&v.isSubversion(o.version)?(s.create(e),r=v.convert(o,s.get(e).$$_original)):s.create(e,o);var a=v.forceUpdate(o,s.get(e).$$_original);a&&(r=!0),O("$projects",r,s,e),n()}console.log("# Project 데이터 설정");var r=!1;return e?void C(e,o,function(){t(r)},n,"Project 데이터 설정"):t(r)},setDocuments:function(e,t,n){function o(e,t,n){var o=t[e];o&&g.isSubversion(o.version)?(c.add(e),r=g.convert(o,c.get(e).$$_original)):c.add(e,o);var a=g.forceUpdate(o,c.get(e).$$_original);a&&(r=!0),d.add(e),O("$documents",r,c,e),n()}console.log("# Document 데이터 설정");var r=!1;return e?void C(e,o,function(){t(r)},n,"Document 데이터 설정"):t(r)},setElement:function(e,t,n){function o(e,t,n){var o=t[e];o&&h.isSubversion(o.version)?(u.add(e),r=h.convert(o,u.get(e).$$_original)):u.add(e,o);var a=h.forceUpdate(o,u.get(e).$$_original);a&&(r=!0),O("$elements",r,u,e),n()}console.log("# Element 데이터 설정");var r=!1;return e?void C(e,o,function(){t(r)},n):t(r)},setSelect:function(e,t,n){function o(e,t,n){p.add(e);var o=t[e];o&&_.isSubversion(o.version)?r=_.convert(o,p.get(e).$$_original):p.get(e).$$_original=o;var a=_.forceUpdate(o,p.get(e).$$_original);a&&(r=!0),O("$selects",r,p,e),n()}console.log("# Select 데이터 설정");var r=!1;if(!e)return t(r);var a;for(a in e)break;var i=e[a];C(i,o,function(){t(r)},n,"Select 데이터 설정")},setGroup:function(e,t,n){function o(e,t,n){m.add(e);var o=t[e];if(o&&E.isSubversion(o.version)?r=E.convert(o,m.get(e).$$_original):m.get(e).$$_original=o,"delete"==o._correct)return m.remove(e),void n();var a=E.forceUpdate(o,m.get(e).$$_original);a&&(r=!0),O("$groups",r,m,e),n()}console.log("# Group 데이터 설정");var r=!1;if(!e)return t(r);var a;for(a in e)break;var i=e[a];C(i,o,function(){t(r)},n,"Group 데이터 설정")},setAsset:function(e,t,n){function o(e,t,n){l.add(e);var o=t[e];o&&$.isSubversion(o.version)?r=$.convert(o,l.get(e).$$_original):l.get(e).$$_original=o;var a=$.forceUpdate(o,l.get(e).$$_original);a&&(r=!0),O("$assets",r,l,e),n()}console.log("# Asset 데이터 설정");var r=!1;if(!e)return t(r);var a;for(a in e)break;var i=e[a];C(i,o,function(){t(r)},n,"Asset 데이터 설정")},setTool:function(e,t,n){function o(e,t,n){var o=t[e],a=s.get();a.$$_tooldata=o,console.log("#TOOL : ",a.tooldata("capture")),O("$projects",r,s),n()}console.log("# Tool 데이터 설정");var r=!1;return e?void C(e,o,function(){t(r)},n,"Tool 데이터 설정"):t(r)},selectDocument:function(e){var t=s.get();if(!t)return void e();var a=s.get().value("currentDocument");if(!a){var i=s.get().documents();i&&i.length>0&&(a=i[0])}if(!a)return void e();var c=new o({document:a}),u=r.define(n.DOCUMENT_SELECT,c).getProcess();u.execute(function(){e()})}};var T;return{run:function(e,t,n){T||(T=new b),T.run(e,t,n)},selectDocument:function(e){return T?(T.selectDocument(e),void(T=null)):void(e&&e())},upgradabilityMessage:function(e,n){function o(){n(!1)}var r=f.hasUpperVersion(e);if(!r)return void n(!0);var i=t.version(),s="현재 버전보다 최신(상위) 버전에서 작성된 데이터를 열려고 합니다.<br>기능이 정상적으로 동작하지 않거나 일부 데이터가 소실될 수도 있습니다.<ul><li><b>현재 버전 : "+i+"</b></li><li><b>데이터 버전 : "+e+"</b></li></ul>안전한 작업을 위해 <b>"+e+"버전</b> 이상에서 작업하시기 바랍니다.<br>작업을 계속 하시겠습니까?";a.confirm({modal:!0,content:s,title:"버전 호환성 알림",ok:"예",cancel:"아니오",isTop:!0,closeButton:!1}).then(function(e){1===e?n(!0):o()},function(e){console.error("confirm err : ",e),o()})}}}var t=MODULE.core.instance;t.service("$openParser",e),e.$inject=["UIDType","$version","CommandName","CommandParam","$command","$notice","$applications","$projects","$documents","$elements","$assets","$history","$selects","$groups","$subversion_application","$subversion_project","$subversion_document","$subversion_element","$subversion_select","$subversion_asset","$subversion_group","$timeout","Default","$store"]}(),function(){function e(e,t,n,o,r){function a(){}return a.prototype={clear:function(t){o.remove({path:e.PREVIEW_FOLDER},null,function(e){return console.log("# 출판 (임시) PREVIEW 폴더 초기화 : ",e||""),e?t(e):void t()})},build:function(e,t){this.clear(function(n){return n?t(n):void o.copy(e.src,e.dest,function(e){return console.log("# PREVIEW 샘플 폴더 복사 : ",e||""),e?t(e):void t()})})},contentCopy:function(e,t){o.move([{src:e.src,dest:e.dest}],function(e){return console.log("# PREVIEW 리소스 파일 복사 : ",e||""),e?t(e):void t()})},_isOpened:!1,isOpened:function(){return this._isOpened},parentSelector:void 0,_getParent:function(e){this.parentSelector=this.parentSelector||document.body;var t=e.parent||angular.element(this.parentSelector);return t},open:function(o,a){console.log("미리보기 창 띄우기");var o=o||{},i=r.get(),s=i.getSelectDocument(),c=i.getIndex(s),u=e.PREVIEW_FOLDER+"/"+e.index_html;u=u+"?page="+(c+1)+"&jjpreviewer=jikji-editor",o.path=e.pathToActual(u,!0),o.title=i.getNoneCopyValue("subject");var l=t.$new(!0);l.config=angular.copy(o),l.callback=function(){console.log("미리보기 창 닫기"),a&&a()};var d=angular.element('<div jj-preview-viewer config="config">');n(d)(l);var p=this._getParent(o);angular.element(p).append(d)}},new a}var t=MODULE.core.instance;t.service("$preview",e),e.$inject=["FileSystem","$rootScope","$compile","$externalAPI","$projects"]}(),function(){function e(e,t,n,o,r,a,i,s){function c(){}function u(e,t){e.push(function(e){console.log("\n\n\n=========================="),console.log("#epub 출판하기 (*.epub) : epub 압축 파일"),console.log("==========================\n"),t.base=h,o.saveEpub(t,function(n,o){n&&console.error("# saveEpub : ",n),g.epub=t.savePath,e()})})}function l(e,t){e.push(function(e){console.log("\n\n\n=========================="),console.log("# Binder 출판하기 * (binder_web).zip : Jik-ji Binder + epub 컨텐츠"),console.log("==========================\n");var r=n.BUNDLE_BINDER_WEB_SOURCE;t.base=r;var a=n.BUNDLE_VIEWER_EBOOK,s=n.BUNDLE_BINDER_WEB_EBOOK;t.archive={epub:{isFolder:!0,name:n.BINDER_WEB_EPUB,origin:n.pathToActual(h)},binder_web:{isFolder:!0,name:r,origin:n.pathToActual(r)},binder_ebook_viewer:{isFolder:!0,name:s,origin:n.pathToActual(a),ignore:["index.html"]}},t.epubRoot=h,t.binderWebInfo={index:{name:s+"/index.html",origin:n.pathToActual(a+"/index.html"),replace:{epubSetting:n.binder_ebook_viewer_epub_setting}}},o.savePackaging(t,function(n,o){i.message("Jik-ji Binder (web) 패키징 완료 : ",t.savePath),g.binder_web=t.savePath,e()})})}function d(e,t){e.push(function(e){console.log("\n\n\n=========================="),console.log("# Binder 출판하기 * (binder).zip : Jik-ji Binder + epub 컨텐츠"),console.log("==========================\n");var r=n.BUNDLE_BINDER_SOURCE;t.base=r,t.archive={epub:{isFolder:!0,name:n.BINDER_EPUB,origin:n.pathToActual(h)},binder:{isFolder:!0,name:r,origin:n.pathToActual(r),ignore:[n.binder_modify_package,n.binder_modify_inject_start,n.binder_modify_inject_end,n.binder_modify_ebook_viewer_index]}},t.epubRoot=h,t.binderInfo={domain:t.domain,appID:t.appID||t.project,appName:t.appName||t.project,"package":{name:n.binder_modify_package,origin:t.archive.binder.origin+"/"+n.binder_modify_package},injectStart:{name:n.binder_modify_inject_start,origin:t.archive.binder.origin+"/"+n.binder_modify_inject_start},injectEnd:{name:n.binder_modify_inject_end,origin:t.archive.binder.origin+"/"+n.binder_modify_inject_end},index:{name:n.binder_modify_ebook_viewer_index,origin:n.pathToActual(n.BUNDLE_VIEWER_EBOOK+"/index.html"),replace:{epubSetting:n.binder_ebook_viewer_epub_setting}}},o.savePackaging(t,function(n,o){g.binder=t.savePath,e()})})}function p(e,o){e.push(function(e){console.log("# 뷰어 설치"),i.message("Epub 뷰어 설정..."),t.build({src:n.BUNDLE_VIEWER_EBOOK,dest:n.PREVIEW_FOLDER},function(){e()})}),e.push(function(e){t.contentCopy({src:h,dest:n.PREVIEW_EPUB_FOLDER},function(t){t&&console.error(t),h=n.PREVIEW_EPUB_FOLDER,e()})})}function m(e,t){e.push(function(e){console.log("\n\n\n=========================="),console.log("# web 출판하기 (*_web.zip) : epub 컨텐츠 + epub 뷰어"),console.log("==========================\n"),o.saveEpub(t,function(n,o){n&&console.error("# saveEpub : ",n),g.web=t.savePath,e()})})}function f(e,r){t._isOpened=!0;var a=n.ebook_viewer_epub_setting,s=n.PREVIEW_FOLDER+"/index.html";e.push(function(e){var t=n.BUNDLE_BINDER+"/"+a,r=n.PREVIEW_FOLDER+"/epub/"+a,i="."+n.PREVIEW_EPUB;o.readFile(t,{encoding:"utf8"},function(t,n){n=n.replace(/##__EPUB_FOLDER_PATH__##/gim,i),o.outputFile(r,n,{encoding:"utf8"},function(t){e()})})}),e.push(function(e){o.readFile(s,{encoding:"utf8"},function(t,n){var r='<script src="./epub/'+a+'"></script>';n=n.replace(/<!--##__BINDER_PUBLISH_SETTING_SCRIPT__##-->/gim,r),o.outputFile(s,n,{encoding:"utf8"},function(t){e()})})}),e.push(function(e){i.message("미리보기 뷰어를 실행합니다."),i.close(1e3);var n={};t.open(n,function(){e(),console.clear()})}),e.push(function(e){t._isOpened=!1,e()})}function v(n,o){n.push(g.web||g.preview?function(e){console.log("# PREVIEW 폴더 초기화"),t.clear(function(){e()})}:function(t){console.log("# EPUB 폴더 초기화"),e._clear(function(){t()})}),g.binder}var g,h,_={onProcess:function(e,t,n){1===arguments.length?i.message(arguments[0]):i.progress(e,t,n)}};return c.prototype={run:function(e,t){var o=e.getParam("project"),r=a.get(o);if(g=e.getParam("publishType"),!g)throw new Error("출판 유형이 지정되지 않았습니다.");console.log("# 출판 옵션 : ",g);var c,$=e.getParam("pathObj");if($){var E=$.dir+"/"+$.name;c=E+$.ext}else{if(c=e.getParam("path"),!c)throw new Error("출판할 대상(경로)이 지정되지 않았습니다.");c=c.replace(/\\/g,"/")}"call://preview"!==c&&(r.value("publishPath",c),console.warn("# publish path 정보 : ",c),i.message("출판 기준 경로 : ",c));var y=[];h=n.EPUB_FOLDER;var P=0,w=0;!function(){for(var e in g)"preview"!==e&&++w}(),g.epub&&(++P,u(y,angular.extend({archiveDesc:"[ 작업 "+P+" of "+w+" ] Epub 패키징",publishType:"epub",project:o,savePath:E+n.publishExt,title:r.value("subject")},_))),g.binder&&(++P,d(y,angular.extend({archiveDesc:"[ 작업 "+P+" of "+w+" ] Jik-ji Binder (exe) 패키징",publishType:"binder",domain:r.value("domain"),appName:r.value("appName"),appID:r.value("appID"),project:o,savePath:E+" (binder)"+n.compressExt},_))),g.binder_web&&(++P,l(y,angular.extend({archiveDesc:"[ 작업 "+P+" of "+w+" ] Jik-ji Binder (web) 패키징",publishType:"binder_web",project:o,savePath:E+" (binder_web)"+n.compressExt},_)));var b=g.web||g.preview;b&&p(y),g.web&&(++P,m(y,angular.extend({archiveDesc:"[ 작업 "+P+" of "+w+" ] Web 패키징",publishType:"web",base:n.PREVIEW_FOLDER,savePath:E+" (web)"+n.compressExt},_))),g.preview&&f(y),v(y),async.waterfall(y,function(e){i.message("작업을 완료합니다."),s(function(){t(g)},500)})}},new c}var t=MODULE.core.instance;t.service("$publish",e),e.$inject=["$epub","$preview","FileSystem","$externalAPI","$nativeInterface","$projects","$busy","$timeout"]}(),function(){function e(e,t,n,o,r,a,i){return{add:function(r,a){a.type=e.MASK;var i=n.createUID(),s=o.createUID();a.childGroup=i;var c={};c[i]={owner:s};var u={document:r,elements:[{element:s,data:a}],groups:c};t.addElement(u)},getEditGroupOffset:function(){var e=r.get(),t=e?e.currentEditGroup():"",n=this.getGroupOffset(t);return n},getGroupOffset:function(e,t){function r(e,a){if(a=a||[],!e)return a;var i=n.get(e);if(!i)return a;var s=i.value("owner");if(a.unshift({group:e,mask:s}),c++,c===t)return a;var u=o.get(s),l=u.parentGroup();return r.apply(this,[l,a])}function a(e){for(var t={scaleOffset:{left:0,top:0},axisX:0,axisY:0,left:0,top:0,angle:0,scale:1},n=e.length,o=0;n>o;++o){var r=e[o],a=r.group,i=r.mask;s.apply(this,[a,i,t])}return t}function s(e,t,n){function r(e,t){var n=i.get().getNoneCopyValue("paper"),o=n.width/2,r=n.height/2,a=e*Math.PI/180,s=t.x-o,c=t.y-r,u=s*Math.cos(a)-c*Math.sin(a),l=s*Math.sin(a)+c*Math.cos(a);return{x:u+o,y:l+r}}var a=o.get(t),s=a.getNoneCopyValue("state"),c=s.normal.css,u=c.transform?c.transform.angle||0:0,l=c.transform?c.transform.scale||1:1,d=n,p=this.getBoundary([t]),m={left:p.left*d.scale,top:p.top*d.scale,width:p.width*d.scale,height:p.height*d.scale};m.left=m.left+d.axisX,m.top=m.top+d.axisY,m=function(e,t){var n=(1-t)*e.width/2,o=(1-t)*e.height/2,r={left:e.left+n,top:e.top+o,width:e.width*t,height:e.height*t};return r}(m,l);var f=o.getRotatedPoints(m,u).p1,v=r(n.angle,{x:m.left,y:m.top}),g=r(n.angle,f),h=-1*(n.angle+u),_=v,$=r(h,g);n.left=_.x,n.top=_.y,n.axisX=$.x,n.axisY=$.y,
n.angle=n.angle+u,n.scale=n.scale*l}var c=0;(null===t||isNaN(t))&&(t=1e4);var u=r.apply(this,[e]),l=a.apply(this,[u]);return l},getGroupOffsetTransform:function(e,t){function r(e){if(e){var s=n.get(e);if(s){var c=s.value("owner"),u=o.get(c).css(),l=u.transform?u.transform.angle||0:0,d=u.transform?u.transform.scale||1:1;if(i.angle=i.angle+l,i.scale=i.scale*d,a++,a!==t){var p=o.get(c),m=p.parentGroup();r(m)}}}}var a=0;(null===t||isNaN(t))&&(t=1e4);var i={angle:0,scale:1};return r(e),i},getBoundary:function(e){if(!e||e.length<1)return null;var t,n,r,a;for(var i in e){var s=e[i],c=o.get(s);if(c){var u=c.css();t=void 0===t?u.left:Math.min(t,u.left),n=void 0===n?u.top:Math.min(n,u.top);var l=u.left+u.width;r=void 0===r?l:Math.max(r,l);var d=u.top+u.height;a=void 0===a?d:Math.max(a,d)}}var p={left:t,top:n,width:r-t,height:a-n};return p},getRotatedBoundary:function(e,t){if(void 0===t&&(t=!0),!e||e.length<1)return null;var n,r,a,i;for(var s in e){var c=e[s],u=o.get(c);if(u){var l=u.getRotatedPoints(),d=this._getOutlineFromPoint(l);if(t){var p=u.getNoneCopyValue("state"),m=p.normal.css,f=m.transform.scale||1;if(1!==f){var v=(f-1)*(d.right-d.left),g=(f-1)*(d.bottom-d.top);d.left=d.left-v/2,d.top=d.top-g/2,d.right=d.right+v/2,d.bottom=d.bottom+g/2}}n=void 0===n?d.left:Math.min(n,d.left),r=void 0===r?d.top:Math.min(r,d.top),a=void 0===a?d.right:Math.max(a,d.right),i=void 0===i?d.bottom:Math.max(i,d.bottom)}}var h={left:n,top:r,width:a-n,height:i-r};return h},_getOutlineFromPoint:function(e){var t=Math.min(e.p1.x,e.p2.x,e.p3.x,e.p4.x),n=Math.max(e.p1.x,e.p2.x,e.p3.x,e.p4.x),o=Math.min(e.p1.y,e.p2.y,e.p3.y,e.p4.y),r=Math.max(e.p1.y,e.p2.y,e.p3.y,e.p4.y),a={left:t,top:o,right:n,bottom:r};return a},sort:function(e,t){arguments.length<2&&(t=r.get().currentEditGroup());var o=t?n.get(t):a.get(),i=o.getNoneCopyValue("indexes");return e.sort(function(e,t){var n=i.indexOf(e),o=i.indexOf(t);if(0>n||0>o)throw new Error("다른 parent를 가진 element는 정렬할 수 없습니다.");return n-o}),e},getChildElements:function(e){var t=r.get();if(!t)return null;var o=t.currentEditGroup(),i=o?n.get(o):a.get();if(!i)return null;var s=e?i.getNoneCopyValue("indexes"):i.indexes();return s},isSelectableElement:function(e){var t=this.getChildElements();return t?t.indexOf(e)>-1:!1},getEditGroupChain:function(e){function t(e){var r=o.get(e),a=r.parentGroup();if(!a)return"other";var i=l.indexOf(a);if(0===i)return"child";if(i>0)return"other";var s=n.get(a).value("owner");return t(s)}var a=this.isSelectableElement(e),i=r.get(),s=i?i.currentEditGroup():"";if(!s)return a?"currentChild":"child";if(a)return"currentChild";var c=o.get(e),u=c.isGroupContainer();if(u){var l=i.getNoneCopyValue("inGroup"),d=l.indexOf(u);if(0===d)return"currentGroup";if(d>0){var p=l.length-1;return d===p?"editRootGroup":"parentGroup"}}var m=c.parentGroup();if(s===m)return"currentChild";var l=i.getNoneCopyValue("inGroup");return t(e)},toIndexes:function(e){var t=[];if(!e||e.length<1)return t;var r=o.get(e[0]),i=r.parentGroup(),s=e.every(function(e){var t=o.get(e).parentGroup();return i===t});if(!s)return console.error("전달받은 배열중 같은 group 요소가 아닌 uid가 있습니다."),t;var c=i?n.get(i):a.get();if(!c)return t;for(var u=0;u<e.length;++u)t[u]=c.getIndex(e[u]);return t}}}var t=MODULE.core.instance;t.service("$mask",e),e.$inject=["ElementType","$commandController","$groups","$elements","$selects","$documents","$projects"]}(),function(){function e(e,t,n,o){var r={};return{getSetting:function(e){return e?r[e]:r},add:function(a,i){i=i||{};var s=t.get(a),c=s.name()||"이름 지정 안됨",u=s.thumbnail();u.source=n.pathToActual(u.source);var l=o.parse(s.version());l=l.major+"."+l.minor+"."+l.build;var d={version:l,label:c,type:e.TEMPLATE,template:a,thumbnail:u},p=i?angular.merge({},d,i):d;r[a]=p},remove:function(e){delete r[e]}}}var t=MODULE.core.instance;t.service("$contentTemplateSetting",e),e.$inject=["ElementType","$templates","FileSystem","$version"]}(),function(){function e(e,t,n,o,r,a,i,s){function c(){}function u(e,t,n){h(e,t);var o={assets:e.assets,files:e.files,fileMap:e.fileMap,paper:e.paper,thumbnail:e.thumbnail};n.project=o;var r=e.assets;p(r,n)}function l(e,t,n){_(t),n.document=t;var o=t.elements;d(o,n);var r=t.groups;m(r,n);var a=t.assets;p(a,n)}function d(e,t){for(var o=t.elements,r=e.length,a=0;r>a;++a){var i=e[a];if(!(i in o)){var s=n.get(i).copy();$(s),o[i]=s;var c=s.assets;p(c,t)}}}function p(e,t){function n(e){var t=o.get(e),n=t.copy();return n}var r=t.assets;if(angular.isArray(e))for(var a=e.length,i=0;a>i;++i){var s=e[i];s in r||(r[s]=n(s))}else for(var c in e)c in r||(r[c]=n(c))}function m(e,t){for(var n=t.groups,o=e.length,a=0;o>a;++a){var i=e[a];if(!(i in n)){var s=r.get(i).copy();E(s),n[i]=s}}}function f(e,t){function n(e){var t=r[e];return delete t.versionRecord,e in o?(t._counter=o[e],delete t.property.template):console.error("# export에 포함하지 말아야함 : ",e),t}var o=e.document.assets,r=e.assets;for(var a in r)n(a)}function v(e){var t=s.pattern.source;return t.test(e)}function g(e){function t(e,t,n){function o(e){var t=e.match(s);return t?{uid:t[0],type:t[1],num:t[2]}:null}var r,i,s=/([a-z\-]+)(-.{8}-.{4}-4.{3}-.{4}-.{12})/;e.path.indexOf(e.uid)<0?(r=e.path,i=function(e,t){var n=o(t).num,r=e.replace(s,function(e,t,o,r,a){return t+n});return r}(e.path,e.uid)):(r=e.path.replace(e.uid,t),i=e.path),e.original=r,e._original=i,e.path=function(e){var t=a.USER_DATA_TEMPLATE_MARKER+"/_temp/asset-"+n,o=a.WORK_FOLDER+a.OPS;return e=e.replace(o,t)}(i)}var n=e.assets,r=JSON.stringify(e),i={};for(var s in n){var c=o.createUID();i[c]=s,r=r.replace(new RegExp(s,"img"),c)}e=JSON.parse(r),n=e.assets;for(var u in i){var l=n[u];v(l.path)||t(l,i[u],e.uid)}return e}function h(e,t){for(var n in e.fileMap){var o=n in e.assets||n in t.assets;o||delete e.fileMap[n]}}function _(e){delete e.versionRecord}function $(e){e.currentState="normal",e.selected=!1,delete e.versionRecord}function E(e){delete e.versionRecord}return c.prototype={get:function(n,o,r){var a=i.createUID(),s={uid:a,project:void 0,document:void 0,elements:{},groups:{},assets:{},capture:void 0},c=e.get(n).copy(),d=t.get(o).copy();u(c,d,s),l(c,d,s),f(s),s=g(s),r&&r(s)}},new c}var t=MODULE.core.instance;t.service("$exportTemplateData",e),e.$inject=["$projects","$documents","$elements","$assets","$groups","FileSystem","$templates","$util"]}(),function(){function e(e,t,n,o,r,a){function i(){}return i.prototype={modify:function(e,t){t&&t(e)}},new i}var t=MODULE.core.instance;t.service("$importTemplateData",e),e.$inject=["$projects","$documents","$elements","$assets","$groups","FileSystem"]}(),function(){function e(e,t,n,o,r,a,i,s,c,u,l,d,p,m,f,v){function g(){}function h(e,t){}function _(e){delete e.thumbnail,delete e.paper}function $(e){delete e.versionRecord}function E(e){e.currentState="normal",e.selected=!1,delete e.versionRecord}function y(e){delete e.versionRecord}function P(e){e.document=function(e){var t=e;if(p.isSubversion(t.version)){var n=new s(t.uid);return p.convert(t,n.$$_original),n.$$_original}return t}(e.document),function(e){for(var t in e){var n=e[t];if(m.isSubversion(n.version)){var o=new c(t);m.convert(n,o.$$_original),e[t]=o.$$_original}}}(e.elements),function(e){for(var t in e){var n=e[t];if(f.isSubversion(n.version)){var o=new u(t);if(f.convert(n,o.$$_original),"delete"==n._correct){delete e[t];continue}e[t]=o.$$_original}}}(e.groups),function(e){for(var t in e){var n=e[t];if(v.isSubversion(n.version)){var o=new l(t);v.convert(n,o.$$_original),e[t]=o.$$_original}}}(e.assets),console.debug("	* 데이터 버전 업데이트 : ",e,"\n")}return g.prototype={_uids:void 0,_map:void 0,get:function(e,t){this._uids={};var n=e.$$_original;this._map={uid:n.uid,name:n.name,assets:angular.copy(n.assets),groups:angular.copy(n.groups),elements:angular.copy(n.elements),document:angular.copy(n.document),project:angular.copy(n.project)},console.debug("\n\n# 템플릿 데이터 버전 호환성 체크.\n"),P(this._map),this._createDataMap(),console.log("_map : ",this._map);var o=this._changeUID();this._uids=null,this._map=null,t&&t(o)},_createDataMap:function(){this._transAsset(this._map,this._map.uid),this._transGroup(this._map.groups),this._transElement(this._map.elements),this._transDocument(this._map.document),this._transProject(this._map.project,this._map.document)},_transAsset:function(e,t){var n=e.assets;for(var o in n){var r=n[o];h(r,e),this._changeAssetPath(r,t)}return n},_changeAssetPath:function(e,t){var n=e.path;e.path=e.original.replace(a.TEMP_FOLDER,a.WORK_FOLDER),e.original=n},_transGroup:function(e){for(var t in e){var n=r.createUID();this._uids[t]=n,y(e[t])}return e},_transElement:function(e){for(var t in e){var o=n.createUID();this._uids[t]=o,E(e[t])}return e},_transDocument:function(e){var n=t.createUID();return this._uids[e.uid]=n,$(e),e},_transProject:function(e,t){return function(){for(var n in e.assets){var o=e.files.indexOf(n);0>o||(t.files.indexOf(n)<0&&t.files.push(n),n in t.assets||(t.assets[n]=e.assets[n]),delete e.assets[n])}delete e.files}(),_(e),e},_changeUID:function(){var e=this._map.assets;delete this._map.assets;var t=JSON.stringify(this._map);return console.log("# 새로운 UID로 변경"),function(e,n){for(var o in n){var r=n[o],a=new RegExp(o,"img");t=t.replace(a,r),console.log("* uids : ",o,"-->",r)}}(this._map,this._uids),this._map=JSON.parse(t),this._map.assets=e,this._map}},new g}var t=MODULE.core.instance;t.service("$insertTemplateData",e),e.$inject=["$projects","$documents","$elements","$assets","$groups","FileSystem","ProjectData","DocumentData","ElementData","GroupData","AssetData","$subversion_project","$subversion_document","$subversion_element","$subversion_group","$subversion_asset"]}(),function(){function e(e,t){var n=e.extend("SupportApplication",{_convert:function(e,n){var o=!1;return this.isSubversion(e.version,"0.2.0")&&(e.selector=n.selector,o=!0),this.isSubversion(e.version,"0.2.229")&&(e.screen.padding=n.screen.padding,o=!0),this.isSubversion(e.version,"0.4.16")&&(e.panel&&"Operation"!==e.panel.right||(e.panel||(e.panel={left:t.ITEM}),e.panel.right=t.PROPERTY,o=!0)),this.isSubversion(e.version,"0.5.7")&&void 0===e.slider.searchText&&(e.slider.searchText=!0,o=!0),this.isSubversion(e.version,"0.6.6")&&(void 0===e.slider.html&&(e.slider.html=!0,o=!0),void 0===e.slider.web&&(e.slider.web=!0,o=!0)),o}});return new n}var t=MODULE.core.instance;t.service("$subversion_application",e),e.$inject=["SupportBase","ContentViewName"]}(),function(){function e(e,t,n){var o=e.extend("SupportAsset",{_convert:function(e,t){var n=(e.uid,!1);if(this.isSubversion(e.version,"0.1.513")){var o=e._counter;void 0===o&&(o=1e4,e._counter=o,n=!0)}return n}});return new o}var t=MODULE.core.instance;t.service("$subversion_asset",e),e.$inject=["SupportBase","$externalAPI","$assets"]}(),function(){function e(e){var t=e.extend("SupportComponent",{_convert:function(e,t){var n=(e.uid,!1);return this.isSubversion(e.version,"0.7.22")&&(e.userVersion="0.0.0",e.creator="",n=!0),n}});return new t}var t=MODULE.core.instance;t.service("$subversion_component",e),e.$inject=["SupportBase"]}(),function(){function e(e){var t=e.extend("SupportDocument",{_convert:function(e,t){var n=(e.uid,!1);if(this.isSubversion(e.version,"0.1.513")){var o=e.assets;if(o)for(var r in o){var a=o[r];0!==a&&(null===a||void 0===a||""===a||isNaN(a))&&(a=1e4,o[r]=a,n=!0)}}return this.isSubversion(e.version,"0.2.230")&&((void 0===e.indexes||e.indexes.length<1)&&(e.indexes=angular.copy(e.elements)),e.groups=[],n=!0),this.isSubversion(e.version,"0.10.0")&&void 0===e.useCacheImage&&(e.useCacheImage=!0,n=!0),this.isSubversion(e.version,"0.12.2")&&void 0===e.insertSVG&&(e.insertSVG="inline",n=!0),n}});return new t}var t=MODULE.core.instance;t.service("$subversion_document",e),e.$inject=["SupportBase"]}(),function(){function e(e,t,n,o){var r=e.extend("SupportElement",{_convert:function(e,r){var a=(e.uid,!1);if(this.isSubversion(e.version,"0.2.2")){var i=e.state,s=i.normal.css;["over","down"].forEach(function(e,t){var n=i[e].css;if(void 0!==n.left||void 0!==n.top&&void 0===n.width){if(n.left===s.left&&n.top===s.top)i[e].css={};else for(var o in s)"left"!==o&&"top"!==o&&(i[e].css[o]=s[o]);a=!0}}),e.name&&e.name!==e.uid||e.type&&(e.name=window.$$_createNameCounter(e.type)+"_temp",a=!0)}if(this.isSubversion(e.version,"0.2.230")&&(e.group="",a=!0),this.isSubversion(e.version,"0.3.5")){var c=e.state;if(c){c.normal.css.transform||(c.normal.css.transform={scale:1,angle:0});var u=["normal","over","down"];u.forEach(function(e){var n=c[e];if(n&&n.css&&n.css.transform){var o=n.css.transform;if("string"==typeof o){var r={angle:t.getAngle(o),scale:t.getScale(o)};n.css.transform=r,a=!0}}}),u.forEach(function(e){if("normal"===e){var t=c[e];t&&t.option&&!t.option.layout&&(t.option.layout=angular.copy(n.layout),a=!0)}})}}if(this.isSubversion(e.version,"0.7.26")){var c=e.state;c&&e.type===o.AUDIO&&(c.normal.option._$$flexibleSize=!1,a=!0)}if(this.isSubversion(e.version,"0.10.0")){var c=e.state;c&&e.type===o.IMAGE&&void 0===c.normal.option.useCacheImage&&(c.normal.option.useCacheImage=!0,a=!0)}if(this.isSubversion(e.version,"0.10.4")){var c=e.state;if(c&&e.type===o.TEXT){var l="0px",d=c.normal.style;void 0===d.paddingTop&&(d.paddingTop=l,a=!0),void 0===d.paddingRight&&(d.paddingRight=l,a=!0),void 0===d.paddingBottom&&(d.paddingBottom=l,a=!0),void 0===d.paddingLeft&&(d.paddingLeft=l,a=!0)}}if(this.isSubversion(e.version,"0.10.6")){var c=e.state;c&&e.type===o.TEXT&&void 0===c.normal.option.useAutolink&&(c.normal.option.useAutolink=!0,a=!0)}return a}});return new r}var t=MODULE.core.instance;t.service("$subversion_element",e),e.$inject=["SupportBase","$elements","Default","ElementType"]}(),function(){function e(e){var t=e.extend("SupportGroup",{_convert:function(e,t){var n=(e.uid,!1);if(this.isSubversion(e.version,"0.2.230")&&(e._correct="delete",n=!0),this.isSubversion(e.version,"0.7.23")){if(e.capsule){var o=e.capsule;void 0===o.schema&&(o.schema=[]),void 0===o.values&&(o.values={}),void 0===o.schemaLock&&(o.schemaLock=!1),void 0===o.groupLock&&(o.groupLock=!1)}else e.capsule={schema:[],values:{},schemaLock:!1,groupLock:!1};n=!0}return n}});return new t}var t=MODULE.core.instance;t.service("$subversion_group",e),e.$inject=["SupportBase"]}(),function(){function e(e,t){var n=e.extend("SupportProject",{_convert:function(e,t){var n=!1;return n}});return new n}var t=MODULE.core.instance;t.service("$subversion_project",e),e.$inject=["SupportBase","Default"]}(),function(){function e(e){var t=e.extend("SupportSelect",{_convert:function(e,t){var n=(e.uid,!1);return this.isSubversion(e.version,"0.2.59")&&(void 0===e.inGroup&&(e.inGroup=[]),void 0!==e.map&&(e.select=angular.copy(e.map),delete e.map,n=!0),void 0!==e.length&&(e._length=e.length,delete e.length,n=!0)),this.isSubversion(e.version,"0.2.230")&&(e.inGroup&&(e.inGroup=[],n=!0),e.currentGroup&&(e.currentGroup="",n=!0)),n}});return new t}var t=MODULE.core.instance;t.service("$subversion_select",e),e.$inject=["SupportBase"]}(),function(){function e(e,t,n,o,r){function a(){}return a.prototype={project:function(t){var n,o=e.get(t),r=o.getNoneCopyValue("documents"),a=this;return r.forEach(function(e){var t=a.document(e);t&&(n||(n={}),n[e]=t)}),n},document:function(e){var n={elements:[],groups:[],assets:[]},o=t.get(e);return this._getGroupBugs(o,n),this._getElementBugs(o,n),this._getAssetBugs(o,n),n.elements.length<1&&n.groups.length<1&&n.assets.length<1?void 0:(this.correctData(e,n),n)},_getGroupBugs:function(e,t){var n=e.getNoneCopyValue("groups");n.forEach(function(e){var n=r.get(e);n||t.groups.push(e)})},_getElementBugs:function(e,t){var o=e.getNoneCopyValue("elements"),r=this;o.forEach(function(e){var o=n.get(e);return o?void r._getAssetBugs(o,t):void t.elements.push(e)})},_getAssetBugs:function(e,t){var n=e.getNoneCopyValue("assets"),r=angular.isArray(n);for(var a in n){var i=r?n[a]:a,s=o.get(i);s||t.assets.push(i)}},correctData:function(e,o){var a=t.get(e);console.error("# 잘못된 데이터 발견됨 : ",o),o.groups.forEach(function(e){console.error("* 잘못된 데이터 보정함 : ",e),a.removeGroup(e)}),o.elements.forEach(function(e){console.error("* 잘못된 데이터 보정함 : ",e),a.removeElement(e);var t=a.getNoneCopyValue("groups");t.map(function(t){var n=r.get(t);n.removeElement(e)})}),o.assets.forEach(function(e){console.error("* 잘못된 데이터 보정함 : ",e),a.removeAsset(e)});var i=a.getNoneCopyValue("elements");i.forEach(function(e){var t=n.get(e),r=t.parentGroup();o.groups.indexOf(r)>-1&&(console.error("* 잘못된 데이터 보정함 (parentGroup) : ",r),t.parentGroup(""));var a=t.isGroupContainer();o.groups.indexOf(a)>-1&&(console.error("* 잘못된 데이터 보정함 (childGroup) : ",a),t.value("childGroup",""));var i=t.getNoneCopyValue("assets");o.assets.forEach(function(e){var t=i.indexOf(e);t>-1&&i.splice(t,1)}),t.assets(i)})}},new a}var t=MODULE.core.instance;t.service("$verification",e),e.$inject=["$projects","$documents","$elements","$assets","$groups"]}(),function(){function e(e,t){var n=!1,o=e.create("SupportBase",{init:function(){},_getVersion:function(){return t.version()},isDevelopVersion:function(e){return t.isDevelopVersion(e)},isLagacyDevelopVersion:function(e){return e=e||t.version(),e.indexOf("_VERSION_")>-1},getCompareVersion:function(e,n){n=n?t.versionName()+" "+n:t.version();var o=t.getLast(e,n);return o},isSubversion:function(e,t){if(!e)throw new Error("버전 정보가 없습니다.");if(!window.$$__isEditTool)return!1;if(this.isLagacyDevelopVersion(e))return n?console.error("개발 버전에서 작성된 문서입니다. : "+e):(alert("개발 버전에서 작성된 문서입니다. \n실제 버전 넘버로 업데이트해야 합니다.\n\n"+e),n=!0),!0;var o,r=this.getCompareVersion(e,t);switch(r){case 1:o="상위 버전에서 작성됨";break;case 0:o="같은 버전임";break;case-1:o="하위 버전에서 작성됨";break;case-2:o="하위 버전에서 작성된 것으로 처리(Dev)";break;default:o="비교 안됨"}return 0>r},updateVersion:function(e,t){1===arguments.length&&(t=e);var n=this._getVersion();if(e.version!==n){var o=t.versionRecord.indexOf(e.version);if(0>o)t.versionRecord.push(e.version);else{var r=t.versionRecord.length-1,a=t.versionRecord[r];e.version!=a&&t.versionRecord.push(e.version)}var i=3;t.versionRecord.length>i&&t.versionRecord.splice(0,t.versionRecord.length-i)}if("version"in t){var s=this.isSubversion(e.version,n);s&&(t.version=n)}},convert:function(e,t){if(!window.$$__isEditTool)return!1;var n=!1,o=this._convert(e,t);return o&&(n=!0),angular.equals(t,e)||(t=angular.merge(t,e)),this.updateVersion(e,t),n},_convert:function(e,t){var n=!1;return n},forceUpdate:function(e,t){var n=!1;return n},hasUpperVersion:function(e){var t=this.getCompareVersion(e);return t>0}});return o}var t=MODULE.core.instance;t.factory("SupportBase",e),e.$inject=["$superClass","$version"]}(),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("jj-busy-indicator.html",'<div layout="column" layout-align="center center" class="busy" ng-class="{on:isOpened, off:!isOpened}"><div layout="column" layout-align="center center" ng-if="!progress" class="bg message"><div indicator-circular=""></div><div class="messageText" ng-bind-html="message" ng-show="message||message!=\'\'"></div></div><div layout="raw" layout-align="center center" ng-if="progress" class="progress" ng-style="{padding: (progress.cancel)?\'30px\':null}"><div flex="" layout="column" layout-align="center center"><div layout="raw" flex="" layout-align="center center" style="width:100%"><md-progress-linear flex="" md-mode="determinate" value="{{ percent }}"></md-progress-linear></div><div layout="raw" layout-align="start center" class="messageBox"><div class="messageText" ng-bind-html="progress.message"></div><div flex=""></div><div class="percentText">({{ progress.current }}/{{ progress.total }}{{progress.unit}}) {{ percent }}%</div></div></div><div ng-if="progress.cancel"><md-button ng-click="cancel()" class="md-raised md-warn" style="margin: 0 0 0 20px;">{{ progress.cancel }}</md-button></div></div></div>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("toast-code-editor-keymap-info.html",'<md-toast layout="column" layout-align="start start" ng-class="config.className"><div layout="raw" style="width: 100%; padding: 0 0 0 25px;"><h3 flex="">편집기 단축키 사용</h3><span flex=""></span><md-button class="md-icon-button" ng-click="close()"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="close"></md-icon></md-button></div><div class="contentContainer" flex="" layout="raw" layout-align="start center"><div flex="" class="content"><div>편집기에서 다음 단축기를 사용할 수 있습니다.</div><ul><li><span class="markBlock">Ctrl-F</span> Start searching</li><li><span class="markBlock">Ctrl-G</span> Find next</li><li><span class="markBlock">Ctrl-Shift-G</span> Find previous</li><li><span class="markBlock">Ctrl-Shift-F</span> Replace</li><li><span class="markBlock">Ctrl-Shift-R</span> Replace all</li><li><span class="markBlock">Alt-F</span> Persistent search</li><li><span class="markBlock">Alt-G</span> Jump to line</li><li><span class="markBlock">Ctrl-B</span> Switch UID string to button</li><li><span class="markBlock">Ctrl-Tab</span> Autoformat selected range</li></ul><p>* Persistent search : Search dialog doesn\'t autoclose, enter to find next, Shift-Enter to find previous</p></div></div></md-toast>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("toast-custom.html",'<md-toast layout="raw" layout-align="start start" ng-class="config.className"><div class="contentContainer" flex="" layout="raw" layout-align="start center"><div flex="" class="content" ng-bind-html="content"></div></div><md-button class="md-icon-button" ng-click="close()"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="close"></md-icon></md-button></md-toast>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("toast-simple.html",'<md-toast ng-class="config.className"><div class="contentContainer" flex="" layout="raw" layout-align="start center"><div flex="" class="content" ng-bind-html="content"></div></div></md-toast>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("external/jj-file-dialog-box.html",'<input type="file" id="{{ config.id }}" ng-style="{display: \'none\'}" ng-click="onClick($event)">')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("popup/alert.html",'<md-dialog aria-label="{{ config.title }}" modal="{{ config.modal }}" ng-class="config.popupClass"><form><md-toolbar><div class="md-toolbar-tools"><h2>{{ config.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="close(-1)" ng-if="config.closeButton"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div ng-bind-html="config.content"></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="close(1)" class="md-accent">{{ config.yes }}</md-button></div></form></md-dialog>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("popup/checkSave.html",'<md-dialog aria-label="{{ config.title }}" modal="{{ config.modal }}"><form><md-toolbar><div class="md-toolbar-tools"><h2>{{ config.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="close(-1)"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div ng-bind-html="config.content"></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="close(1)" style="display: none;">default</md-button><md-button ng-click="close(0)" class="md-primary">{{ config.no }}</md-button><md-button ng-click="close(1)" class="md-accent">{{ config.yes }}</md-button></div></form></md-dialog>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("popup/componentConflict.html",'<md-dialog componentconflictpopup="" middlesize="" aria-label="{{ config.title }}" modal="{{ config.modal }}"><form><md-toolbar><div class="md-toolbar-tools"><h2>{{ config.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="close(-1)" ng-if="config.closeButton"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="selectableText"><p ng-bind-html="config.description"></p><div ng-repeat="info in config.content" style="border-top: 1px dashed #e0e0e0;"><div style="margin-left: 0px;"><ul style="margin-top: 10px;"><li conflict-list="" layout="raw"><div tag="">uid</div><div content="">{{info.item.uid}}</div></li><li conflict-list="" layout="raw"><div tag="">installed</div><div content-path="" flex="">{{info.oldData.path}}/{{info.oldData.name}}</div><div content="">(created {{info.oldData.version}})</div></li><li conflict-list="" layout="raw"><div tag="">import</div><div content-path="" flex="">{{info.newData.path}}/{{info.newData.name}}</div><div content="">(created {{info.newData.version}})</div></li><li conflict-list="" layout="raw" ng-if="info.oldData.path !== info.newData.path"><div tag="" style="background-color: transparent;"></div><div content-warn="">카테고리가 변경됩니다.</div></li></ul></div></div></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="close(-1)">{{ config.cancel }}</md-button><md-button ng-click="close(0)" class="md-primary">{{ config.no }}</md-button><md-button ng-click="close(1)" class="md-accent">{{ config.yes }}</md-button></div></form></md-dialog>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("popup/confirm.html",'<md-dialog aria-label="{{ config.title }}" modal="{{ config.modal }}" ng-class="config.popupClass"><form><md-toolbar><div class="md-toolbar-tools"><h2>{{ config.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="close(-1)" ng-if="config.closeButton"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div ng-bind-html="config.content"></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="close(1)" style="display: none;">default</md-button><md-button ng-click="close(0)" class="md-primary">{{ config.no }}</md-button><md-button ng-click="close(2)" class="md-primary" ng-if="config.optionButton">{{ config.optionButton }}</md-button><md-button ng-click="close(1)" class="md-accent">{{ config.yes }}</md-button></div></form></md-dialog>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("popup/iframe.html",'<md-dialog aria-label="{{ config.title }}" bigsize=""><md-toolbar style="background-color: #FFFFFF; color: rgba(0, 0, 0, 0.8); border-bottom: 1px solid rgb(232, 232, 232);"><div class="md-toolbar-tools"><h2 style="font-weight: bold;">{{ config.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="close(-1)" ng-if="config.closeButton"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog" style="color: rgba(0, 0, 0, 0.8);"></md-icon></md-button></div></md-toolbar><iframe width="100%" height="100%" seamless="" frameborder="0" nwdisable="" nwfaketop="" allowfullscreen="true" ng-src="{{ config.source }}" ng-style="config.style"><p>This website does not supports IFrame</p></iframe></md-dialog>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("popup/verificationResult.html",'<md-dialog middlesize="" aria-label="{{ config.title }}" modal="{{ config.modal }}"><form><md-toolbar><div class="md-toolbar-tools"><h2>{{ config.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="close(-1)" ng-if="config.closeButton"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="selectableText"><p>이 기능은 실행 에러로 인해 데이터가 잘못 저장 되었거나,<br>Jik-ji 버전간 호환성을 유지하기 위해 실행되었을 수 있습니다.<br>해당 데이터를 찾을 수 없어 삭제된 UID 목록입니다.</p><div ng-repeat="(documentUID, document) in config.content" style="border-top: 1px dashed #e0e0e0;"><h2 style="margin-bottom: 0px; display: inline-block;">{{$index + 1}} page :</h2><span style="margin-left: 10px;">{{documentUID}}</span><div ng-repeat="(name, list) in document" style="margin-left: 30px;"><h3 ng-if="(list && list.length>0)" style="margin-bottom: 0;">{{name}} Data</h3><ul style="margin-top: 0;"><li ng-repeat="uid in list">{{uid}}</li></ul></div></div></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="close(1)" class="md-accent">{{ config.ok }}</md-button></div></form></md-dialog>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("preview/jj-preview-viewer.html",'<div layout="column" class="background-protect" ng-class="{off:!loadComplete, on:loadComplete}"><div popup-window-header="" layout="raw" layout-align="start center"><div sub-icon-field="close" layout="" layout-align="center center" title="닫기" ng-click="close();"></div><div ng-style="{fontStyle: (config.title)?\'normal\':\'italic\'}">{{ config.title || \'제목 없음\' }}</div><span flex=""></span><md-button class="md-icon-button" ng-click="close()"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div><iframe width="100%" height="100%" seamless="" frameborder="0" nwdisable="" nwfaketop="" allowfullscreen="true" ng-src="{{ previewPath }}" style="background-color: #2B2B2B;"><p>This website does not supports IFrame</p></iframe></div>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("updater/path-confirm.html",'<md-dialog aria-label="{{ uiSet.title }}" modal="{{ uiSet.modal }}"><md-toolbar><div class="md-toolbar-tools"><h2>{{ uiSet.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="close(-1)" ng-if="uiSet.closeButton"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div ng-bind-html="uiSet.content1"></div><p class="markBlock"><b>{{uiSet.pathString}}</b></p><div ng-bind-html="uiSet.content2"></div></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="close(-1)" class="md-primary">{{ uiSet.cancel }}</md-button><md-button ng-click="getFolder()" class="md-accent" ng-if="uiSet.pathButton">{{ uiSet.pathButton }}</md-button><md-button ng-click="close(1)" class="md-accent" ng-if="uiSet.ok">{{ uiSet.ok }}</md-button></div></md-dialog>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("updater/toast-download.html",'<md-toast layout="column" updater-download-toast=""><div flex="" layout="raw" layout-align="start start" style="width: 100%; z-index: 1;"><div class="contentContainer" flex="" layout="column" layout-align="start center" style="padding: 10px 24px;"><div flex="" ng-bind-html="content" style="color: #000;width: 100%;"></div><div style="color: #000;width: 100%;">업데이트 내용은 <span class="link" style="padding:0;" ng-click="config.link_api();">Release Note</span> 를 참고하세요.</div></div></div><div class="md-actions" layout="row" style="padding: 0 8px 8px; width: 100%;"><div flex=""></div><md-button ng-click="close(0)" class="">{{ config.no }}</md-button><md-button ng-click="close(2)" ng-if="config.redownload">{{ config.redownload }}</md-button><md-button ng-click="close(1)" class="">{{ config.ok }}</md-button></div></md-toast>')}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("updater/updateAlarm.html",'<md-dialog middlesize="" aria-label="{{ config.title }}" modal="{{ config.modal }}"><md-toolbar><div class="md-toolbar-tools"><h2>{{ config.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="close(-1)" ng-if="config.closeButton"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="selectableText"><div ng-bind-html="config.content"></div><div style="display: inline-block;"></div><div style="margin: 10px 0; border-top: 1px dashed #e0e0e0;border-bottom: 1px dashed #e0e0e0;"><div style="margin: 0 30px;"><h3 style="display: inline-block;">{{info.version._newVersion}} is now available!</h3><ul style="margin-top: 0;"><li><div style="display: inline-block; min-width: 100px;">Current Version</div>: {{info.version._currentVersion}}</li><li><div style="display: inline-block; min-width: 100px;">New Version</div>: {{info.version._newVersion}}</li><li><div style="display: inline-block; min-width: 100px;">size</div>: {{info.version.size}} Kbyte</li></ul><div>For more details, please see the <span class="link" style="padding:0;" ng-click="link_api(info.version.note.release);">Release Note</span></div></div><div style="height: 15px;"></div></div></div></md-dialog-content><div class="md-actions" layout="row"><div style="margin-left: 16px;" ng-if="config.showHideOption"><md-checkbox class="md-primary" style="margin: 0;padding: 0 30px;" ng-model="info.hideUpdateAlarm">이 알림창을 다시 표시하지 않음.</md-checkbox></div><div flex=""></div><md-button ng-click="close(0)" class="md-primary">{{ config.no }}</md-button><md-button ng-click="close(2)" class="md-accent" ng-if="config.redownload">{{ config.redownload }}</md-button><md-button ng-click="close(1)" class="md-accent">{{ config.ok }}</md-button></div></md-dialog>');

}]),angular.module("vulcan.jikji.core").run(["$templateCache",function(e){e.put("external/web/jj-open-project-list.html",'<div layout="column" layout-align="center center"><div container="" layout="column"><md-toolbar><div class="md-toolbar-tools"><h2>{{ config.title }}</h2><span flex=""></span><md-button class="md-icon-button" ng-click="cancel()"><md-icon md-svg-src="./image/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><div content="" layout="column" flex=""><div flex="" class="listBox"><div class="listContainer"><div ng-repeat="project in list.items" ng-click="onItemSelected(project)" class="item" ng-class="{selected:(list.selected == project.uid)}"><div layout="raw" layout-align="center center" class="thumbnail"><img ng-src="{{ project.image }}"></div><div layout="raw" layout-align="center center" class="checker"><div icon="check"></div></div><div layout="raw" layout-align="center center" class="label">{{ project.data.subject }}</div></div></div></div></div><div class="md-actions" layout="row" layout-align="end center"><md-button ng-click="close()" style="display: none;">default</md-button><md-button ng-click="cancel()" class="md-primary">{{ config.cancel }}</md-button><md-button ng-click="close()" class="md-accent">{{ config.ok }}</md-button></div></div></div>')}]);