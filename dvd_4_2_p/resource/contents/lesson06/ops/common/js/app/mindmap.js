!function(t){"use strict";function e(e,i){return this.each(function(){var n=t(this),a=n.data("ui.mindMap"),o=t.extend({},s.DEFAULT,"object"==typeof e&&e);a||n.data("ui.mindMap",a=new s(n,o)),"string"==typeof e&&a[e](i),n.data("instance",a)})}var s=s||function(){function e(){p.left=this.element.position().left,p.top=this.element.position().top+60+30,p.width=this.element.width(),p.height=this.element.height()-60-30-60,this.element.find(".map").each(function(e){var s=t(this),i=s.attr("data-idx")?parseInt(s.attr("data-idx")):s.index();s.data("idx",i),s.data("left",parseInt(s.css("left").replace("px"))),s.data("top",parseInt(s.css("top").replace("px"))),s.css("left",0),s.css("top",0),s.hasClass("title")?TweenLite.set(s,{x:s.data("left"),y:s.data("top"),scale:r}):TweenLite.set(s,{x:s.data("left"),y:s.data("top"),scale:c}),s.data("width",s.find(".obj").width()),s.data("height",s.find(".obj").height());var n=s.find(".btn-zoom");if(n.length>0){var a=s.data("width")*n.data("btn-pos")[0],h=s.data("height")*n.data("btn-pos")[1],l={left:0,top:0};l.left=parseInt(a)-parseInt(n.width()/2),l.top=parseInt(h)-parseInt(n.height()/2),n.css("left",l.left),n.css("top",l.top),n.css("transform","scale("+d+")"),setTimeout(function(){n.css("transition","0.4s ease-in-out")},100)}if(setTimeout(function(){s.css("transition","0.4s ease-in-out")},100),!s.hasClass("title")){var u=o.element.find(".lines"),p=t(document.createElementNS("http://www.w3.org/2000/svg","path"));u.append(p)}}),o.updateTimer=setInterval(t.proxy(n,o),1e3/60),this.element.find(".map .btn-zoom").on("click",function(){var e=t(this).parents(".map");t(this).hasClass("active")?i.call(o):s.call(o,e)}),this.element.find(".btn-print").on("click",function(){a.call(o)}),this.element.addClass("loaded")}function s(e){if(null==h||e.data("idx")!=h.data("idx")){null!=h&&(h.css("left",h.data("left")).css("top",h.data("top")),h.removeClass("zoom"),h.find(".btn-zoom").removeClass("active"),h.find(".btn-zoom").css("transform","scale("+d+")"),this.element.find(".lines > path").eq(h.data("idx")).removeClass("zoom")),h=e;var s=parseInt((p.width-h.width())/2),i=p.top+parseInt((p.height-h.height())/2);TweenLite.set(h,{x:s,y:i,scale:r}),h.addClass("zoom"),h.find(".btn-zoom").addClass("active"),h.find(".btn-zoom").css("transform","scale("+u+")"),this.element.find(".lines > path").eq(h.data("idx")).addClass("zoom");var n=h.data("idx"),a=h.data("zoom-pos");this.element.find(".map").each(function(e){if(t(this).data("idx")!=n){var s=t(this),i=s.data("left")+a[0],o=s.data("top")+a[1];s.hasClass("title")?TweenLite.set(s,{x:i,y:o,scale:r}):TweenLite.set(s,{x:i,y:o,scale:c})}})}}function i(){null!=h&&(h.removeClass("zoom"),h.find(".btn-zoom").removeClass("active"),h.find(".btn-zoom").css("transform","scale("+d+")"),this.element.find(".lines > path").eq(h.data("idx")).removeClass("zoom")),this.element.find(".map").each(function(e){var s=t(this),i=s.data("left"),n=s.data("top");s.hasClass("title")?TweenLite.set(s,{x:i,y:n,scale:r}):TweenLite.set(s,{x:i,y:n,scale:c})}),h=null}function n(){f=viewport?viewport.scale:1;var e=o.element.find(".map.title");this.element.find(".map").each(function(s){var i=t(this);if(!i.hasClass("title")){var n={x:0,y:0},a={x:0,y:0},h=s,l=i.find(".btn-zoom"),r=o.element.find(".lines > path").eq(h);n.x=((i.position().left+l.position().left)/f+l.width()/2*c).toFixed(2),n.y=((i.position().top+l.position().top)/f+l.height()/2*c).toFixed(2),a.x=(e.position().left/f+e.width()/2).toFixed(2),a.y=(e.position().top/f+e.height()/2).toFixed(2);var d="M "+n.x+" "+n.y+" L "+a.x+" "+a.y;r.attr("d",d)}})}function a(){var e=h?h:this.element.parent();window.onbeforeprint=function(){t("body").addClass("print"),e.hasClass("map")&&t("body").addClass("map")},window.onafterprint=function(){t("body").removeClass("print map")},window.print()}var o,h,l=.35,c=.35,r=1,d=1,u=.35,p={},f=1;return Class.extend({init:function(s,i){this.element=s,this.options=i,c=this.options.minScale,d=l/c,u=l*d,console.log(c,l),console.log(d),this.updateTimer=null,o=this,t(window).on("load",function(){e.call(o)})}})}();s.DEFAULT={minScale:.35},t.fn.mindMap=e,t.fn.mindMap.Constructor=s}(jQuery);