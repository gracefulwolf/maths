!function(t){"use strict";function e(e,i){return this.each(function(){var a=t(this),n=a.data("ui.angleTool"),o=t.extend({},s.DEFAULT,"object"==typeof e&&e);n||a.data("ui.angleTool",n=new s(a,o)),"string"==typeof e&&n[e](i),a.data("instance",n)})}var s=s||function(){function e(){function e(t){return"hide"==t?void s.element.removeClass("open"):void(s.element.hasClass("open")?s.element.removeClass("open"):s.element.addClass("open"))}var s=this;this.element.find(".test-point").hide(),this.element.find(".btn-open").on("click",function(t){GlobalAudio.play("button"),e(),t.preventDefault(),t.stopPropagation()}),t(".quiz-content").on("QUIZ_CHECK_ANSWER_ALL",function(){e("hide")}),t(".quiz-content").on("QUIZ_SHOW_ANSWER",function(){e("hide")}),t(".quiz-content").on("QUIZ_RESET_ANSWER",function(){}),this.options.autoStart&&this.start()}function s(){var e=this;a.call(this),this.element.find(".not-obj").on(touchstart,function(t){"lineDraw"!=e.touchMode&&e.unselectObj()}),this.element.on(touchstart,function(t){"lineDraw"==e.touchMode&&n.call(e,t)}),t(window).on(touchmove,t.proxy(h,this)),t(window).on(touchend,t.proxy(l,this)),this.element.on("pointerup",function(t){t.stopPropagation()}),t(window).on("resize",t.proxy(i,this)),i.call(this)}function i(e){var s=t(".content-container");s.length<1||(this.resizeLeft=s.offset().left,this.resizeTop=0,this.resizeScale=viewport.scale)}function a(){var e=this;this.element.find(".select-btn").each(function(s){t(this).on(touchstart,function(s){var i=t(this).index();t(this).hasClass("btn-del")?e.deleteObj():e.setTool(i),s.preventDefault(),s.stopPropagation()})})}function n(e){if(this.element.hasClass("open")&&"lineDraw"==this.touchMode){console.log("line draw start"),this.touchTarget=t(e.currentTarget);var s=e.pageX,i=e.pageY;e.originalEvent.changedTouches&&(s=e.originalEvent.changedTouches[0].clientX,i=e.originalEvent.changedTouches[0].clientY),this.startX=(s-this.element.offset().left)/viewport.scale,this.startY=(i-d)/viewport.scale+d,this.targetPath=r.call(this)}}function o(e){if(this.element.hasClass("open")&&"lineDraw"!=this.touchMode){var s=t(e.currentTarget);this.touchMode=s.data("touch-mode"),this.touchTarget=t(e.currentTarget).parents(".obj"),"line"==this.touchMode&&(this.touchTarget=s.data("paper"));var i=e.pageX,a=e.pageY;e.originalEvent.changedTouches&&(i=e.originalEvent.changedTouches[0].clientX,a=e.originalEvent.changedTouches[0].clientY),this.startX=(i-this.element.offset().left)/viewport.scale,this.startY=(a-d)/viewport.scale+d,this.startBound=this.touchTarget[0].getBoundingClientRect(),this.startRadian=null,this.startPosition=null,this.startScale=null;var n=this.touchTarget.data("objData"),o=this.touchTarget.data("transform");o||this.touchTarget.data("transform",{radian:0,angle:0});var h=this.touchTarget.data("position");if(!h){var l=(this.touchTarget.offset().left-this.element.offset().left)/viewport.scale,r=(this.touchTarget.offset().top-d)/viewport.scale+d;this.touchTarget.data("position",{left:l,top:r})}var c=this.touchTarget.data("scale");c||this.touchTarget.data("scale",{width:n.width,height:n.height})}}function h(e){if(this.touchTarget){console.log(this.touchMode);var s=e.pageX,i=e.pageY;e.originalEvent.changedTouches&&(s=e.originalEvent.changedTouches[0].clientX,i=e.originalEvent.changedTouches[0].clientY);var a=(s-this.element.offset().left)/viewport.scale,n=(i-d)/viewport.scale+d;a=parseInt(a),n=parseInt(n);var o=(this.startBound.left+this.startBound.width/2)/viewport.scale;o-=this.element.offset().left/viewport.scale;var h=(this.startBound.top+this.startBound.height/2)/viewport.scale,l=this.touchTarget.data("objData"),r=this.touchTarget.data("scale"),c=this.touchTarget.data("transform"),u=this.touchTarget.data("position");if("move"==this.touchMode||"line"==this.touchMode){TweenLite.set(t(".test-point.p-01"),{x:this.startX,y:this.startY}),TweenLite.set(t(".test-point.p-02"),{x:a,y:n}),null==this.startPosition&&(this.startPosition=u);var p=this.startPosition.left+(a-this.startX),g=this.startPosition.top+(n-this.startY);TweenLite.set(this.touchTarget,{x:p,y:g}),this.touchTarget.data("position",{left:p,top:g})}if("scale"==this.touchMode){TweenLite.set(t(".test-point.p-01"),{x:o,y:h}),TweenLite.set(t(".test-point.p-02"),{x:a,y:n});var v=a-o,f=n-h,m=Math.sqrt(Math.pow(v,2)+Math.pow(f,2));this.startScale=r;var w=2*Math.sqrt(Math.pow(m,2)-Math.pow(this.startScale.height/2,2)),b=w/l.width;isNaN(w)&&(b=.5),.5>b&&(b=.5),b>1.5&&(b=1.5),w=l.width*b;var T=l.height*b;TweenLite.set(this.touchTarget,{scale:b}),this.touchTarget.data("scale",{width:w,height:T}),TweenLite.set(this.touchTarget.find(".scale"),{scale:1/b}),TweenLite.set(this.touchTarget.find(".rotate"),{scale:1/b})}if("rotate"==this.touchMode){TweenLite.set(t(".test-point.p-01"),{x:o,y:h}),TweenLite.set(t(".test-point.p-02"),{x:a,y:n});var j=Math.atan2(n-h,a-o);null==this.startRadian&&(this.startRadian=j-c.radian);var C=j-this.startRadian,M=180*C/Math.PI;TweenLite.set(this.touchTarget,{rotation:M}),this.touchTarget.data("transform",{radian:C,angle:M})}"lineDraw"==this.touchMode&&null!=this.targetPath&&null!=this.paper&&(TweenLite.set(t(".test-point.p-01"),{x:this.startX,y:this.startY}),TweenLite.set(t(".test-point.p-02"),{x:a,y:n}),this.endX=a,this.endY=n,null!=this.targetPath&&this.targetPath.attr("d","M "+this.startX+" "+this.startY+" L "+this.endX+" "+this.endY)),this.isDrag=!0,e.preventDefault(),e.stopPropagation()}}function l(e){var s=this,i=Math.sqrt(Math.pow(this.startX-this.endX,2)+Math.pow(this.startY-this.endY,2)),a=Math.min(this.startX,this.endX),n=Math.min(this.startY,this.endY);if("lineDraw"==this.touchMode&&null!=this.targetPath&&null!=this.paper){if(console.log(i),i>30){var h=t(document.createElementNS("http://www.w3.org/2000/svg","rect"));h.attr("class","rect"),h.attr("x",a-4),h.attr("y",n-4),h.attr("width",Math.abs(this.endX-this.startX)+8),h.attr("height",Math.abs(this.endY-this.startY)+8),h.attr("stroke","#000").attr("stroke-width",1),h.attr("fill-opacity",0),h.data("paper",this.paper),h.data("touch-mode","line"),this.unselectObj(),this.paper.data("objData",{width:1280,height:660}),this.paper.append(h),h.on(touchstart,function(e){if("lineDraw"!=s.touchMode){var i=t(this).data("paper");s.selectObj(i),o.call(s,e)}})}else this.paper.remove();e.preventDefault(),e.stopPropagation()}this.paper=null,this.targetPath=null,this.touchTarget=null,this.isDrag=!1}function r(){var e=this;this.paper=t('<svg class="lines" xmlns="http://www.w3.org/2000/svg" style="position:absolute;top:0;left:0;width:100%;height:100%"></svg>'),this.objectContainer.append(this.paper);var s=t(document.createElementNS("http://www.w3.org/2000/svg","path"));return s.attr("class","line"),s.attr("stroke","#000").attr("stroke-width",e.options.thickness),this.paper.append(s),s}var c,d=60,u=[{key:"protractor",width:620,height:337,source:'<img src="../../../common/images/app_angle_tool/obj_protractor.svg" alt="">'},{key:"ruler",width:906,height:161,source:'<img src="../../../common/images/app_angle_tool/obj_ruler.svg" alt="">'},{key:"triangle",width:522,height:308,source:'<img src="../../../common/images/app_angle_tool/obj_triangle.svg" alt="">'}];return Class.extend({init:function(s,i){this.element=s,this.options=i,c=this,this.element.append(t(angleInner)),this.touchTarget=null,this.touchMode="move",this.startX=0,this.startY=0,this.selectIndex=0,this.thickness=this.options.thickness,this.startBound={},this.startRadian=null,this.startPosition=null,this.startScale=null,this.objectContainer=this.element.find(".drawing-cont"),this.paper=null,this.targetPath=null,this.isDrag=!1,this.resizeLeft=0,this.resizeTop=0,this.resizeScale=1,e.call(this)},start:function(){s.call(this)},setTool:function(t){var e=this;this.selectIndex=0,t>-1&&(this.selectIndex=t,1==this.selectIndex||2==this.selectIndex||3==this.selectIndex?(console.log("오브젝트 추가",this.selectIndex),this.element.find(".select-btn").removeClass("active"),this.element.find(".select-btn").eq(t).addClass("active"),this.addObj()):0==t&&(console.log("라인 그리기 툴",this.selectIndex),this.element.find(".select-btn").eq(t).hasClass("active")?(this.element.find(".select-btn").eq(t).removeClass("active"),this.touchMode=null):(e.unselectObj(),this.element.find(".select-btn").eq(t).addClass("active"),this.touchMode="lineDraw")))},addObj:function(){var e=this,s=u[this.selectIndex-1],i=t('<div class="obj"></div>'),a=t(s.source),n=t('<div class="btn- rect" data-touch-mode="move"></div>'),h=t('<div class="btn- scale" data-touch-mode="scale"></div>'),l=t('<div class="btn- rotate" data-touch-mode="rotate"></div>');i.append(a),i.append(n),i.append(h),i.append(l),i.addClass(s.key),this.objectContainer.append(i),i.data("objData",s),i.find(".btn-").on(touchstart,function(s){if("lineDraw"!=e.touchMode){var i=t(this).parents(".obj");e.element.find(".obj").removeClass("select"),e.selectObj(i),o.call(e,s)}}),e.selectObj(i)},selectObj:function(t){this.unselectObj(),t.addClass("select"),this.objectContainer.append(t),this.touchMode=null},unselectObj:function(){this.objectContainer.find(".obj").removeClass("select"),this.objectContainer.find(".lines").removeClass("select"),this.element.find(".select-btn").eq(0).removeClass("active"),this.touchMode=null},deleteObj:function(){this.objectContainer.find(".obj.select").remove(),this.objectContainer.find(".lines.select").remove()},deleteAllObj:function(){this.objectContainer.find(".obj").remove(),this.objectContainer.find(".lines").remove()},dispose:function(){this.selectIndex=0,this.element.find(".select-btn").removeClass("active"),this.element.find(".select-btn").off("mouseup touchend"),this.canvas.off("mousedown touchstart"),t(window).off("mousemove touchmove mouseup touchend")},reset:function(){this.element.removeClass("open"),this.element.find(".select-btn").removeClass("active")}})}();s.DEFAULT={autoStart:!0,thickness:2},window.AngleTool=s,t.fn.angleTool=e,t.fn.angleTool.Constructor=s}(jQuery);var angleInner='<div class="test-point p-01"></div><div class="test-point p-02"></div><div class="drawing-content">	<div class="drawing-cont">		<div class="not-obj"></div>	</div>	<div class="tool-container">		<div class="ico-info btn-open">			<span>그려 보세요</span>			<span class="ico-arr"></span>		</div>		<div class="tool-box">			<ul class="list">				<li class="btn- select-btn"></li>				<li class="btn- select-btn"></li>				<li class="btn- select-btn"></li>				<li class="btn- select-btn"></li>				<li class="btn- select-btn btn-del"></li>			</ul>		</div>	</div></div>';