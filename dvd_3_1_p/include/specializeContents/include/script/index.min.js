"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(function(){function e(e){var t=document.createElement(e.tag?e.tag:"div");return e.classname&&t.classList.add(e.classname),e.html&&(t.innerHTML=e.html),e.parent.appendChild(t),e.callback&&e.callback(t),t}function t(e){e.addEventListener("mouseover",function(t){e.classList.add("hover")}),e.addEventListener("mouseout",function(t){e.classList.remove("hover")})}function n(e,t){t.load(),window.$efSound[e]=function(){return $ts.createAudio.interval(t.duration,function(){a(),t.play()}),t}}function a(e){for(var t in o)o[t].pause(),o[t].currentTime&&(o[t].currentTime=0)}var s="complete",i="on",r=function(){function n(t){var a=t.data,s=t.container;t.gameFrame,t.lessonIndex;_classCallCheck(this,n),this.binding(),this.DATA=a,this.starArray=[],this.container=s,this.gameFrame=e({tag:"iframe",parent:this.container}),this.header=s.querySelector("header"),this.currentLessonIndex=null,this.currentGameIndex=0,this.setHeader(this.header)}return _createClass(n,[{key:"currentLessonIndex",get:function(){return this._currentLessonIndex},set:function(e){this._currentLessonIndex=e}},{key:"lessonData",get:function(){return this.currentLessonIndex?this.DATA[this.currentLessonIndex-1]:null}},{key:"currentGame",get:function(){return this.lessonData.games[this.currentGameIndex]}},{key:"gameLength",get:function(){return this.lessonData.games.length}},{key:"gameName",get:function(){return this.currentGame.name}},{key:"question",get:function(){return this.currentGame.question}},{key:"answer",get:function(){return this.currentGame.answer}},{key:"stars",get:function(){return this.starArray}},{key:"completedLength",get:function(){return this.stars.filter(function(e){return e.classList.contains(s)})}},{key:"setHeader",value:function(n){var a=this;this.title=e({tag:"h2",parent:n}),this.quizLengthContainer=e({classname:"quizLengthContainer",parent:n,callback:function(t){e({tag:"span",parent:t,html:"λ¬Έν•­"}),a.EL_completeLength=e({tag:"span",parent:t}),e({tag:"span",parent:t,html:"/"}),a.EL_totalGameLength=e({tag:"span",classname:"totalLength",parent:t})}}),this.starContainer=e({classname:"starContainer",parent:n}),this.closeButton=e({classname:"closeButton",parent:n,callback:function(e){t(e),e.addEventListener("click",a.close),e.addEventListener("click",window.$efSound.click)}})}},{key:"setGame",value:function(e){this.currentLessonIndex=e,this.setTitle(this.lessonData.title),this.setQuizLength(),this.setStars(this.gameLength)}},{key:"setQuizLength",value:function(){this.EL_completeLength.innerHTML=this.completedLength.length,this.EL_totalGameLength.innerHTML=this.gameLength}},{key:"setTitle",value:function(e){this.title.innerHTML="".concat(this.currentLessonIndex,". ").concat(e)}},{key:"setStars",value:function(n){for(var a=this,s=function(n){e({classname:"star",parent:a.starContainer,callback:function(e){a.starArray.push(e),t(e),e.addEventListener("click",window.$efSound.hover),e.addEventListener("click",function(){a.selectedGame(n)})}})},i=0;i<n;i++)s(i)}},{key:"filledStar",value:function(e){this.stars[e].classList.add(s)}},{key:"offStar",value:function(){this.stars.forEach(function(e){e.classList.remove(i)})}},{key:"selectedGame",value:function(e){this.offStar(),this.currentGameIndex=e,this.startGame()}},{key:"startGame",value:function(){window.$ANSWER=this.answer,window.$QUESTION=this.question;var e="./games/".concat(this.gameName,"/").concat(this.gameName,".html");this.stars[this.currentGameIndex].classList.add(i),this.setQuizLength(),this.gameFrame.src=e}},{key:"clearGame",value:function(){this.filledStar(this.currentGameIndex),this.offStar(),this.stars[this.currentGameIndex+1]&&this.stars[this.currentGameIndex+1].classList.contains(s)||(this.currentGameIndex===this.gameLength-1?this.endGame():(this.currentGameIndex+=1,this.startGame()))}},{key:"resetGame",value:function(){this.offStar(),this.title.innerHTML="",this.starContainer.innerHTML="",this.currentGameIndex=0,this.starArray=[]}},{key:"endGame",value:function(){this.setQuizLength(),setTimeout(function(){},1e3)}},{key:"open",value:function(e){this.setGame(e),this.container.classList.add(i),this.startGame()}},{key:"close",value:function(){this.container.classList.remove(i),this.resetGame()}},{key:"binding",value:function(){this.setGame=this.setGame.bind(this),this.startGame=this.startGame.bind(this),this.resetGame=this.resetGame.bind(this),this.open=this.open.bind(this),this.close=this.close.bind(this)}}]),n}(),c=function(){function n(e){_classCallCheck(this,n),this.binding(),this.DATA=$SPECIALIZECONTENTS.lesson,this.header=e.header,this.main=e.main,this.GAME=new r({data:this.DATA,container:e.gameContaier,gameFrame:e.gameFrame}),this.selectedLessonIndex=null,this.createObjInHeader(this.header),this.createTitle(this.main)}return _createClass(n,[{key:"createObjInHeader",value:function(t){e({classname:"title",html:$SPECIALIZECONTENTS.title,parent:t}),e({classname:"grade",html:$SPECIALIZECONTENTS.grade,parent:t}),e({classname:"subject",html:$SPECIALIZECONTENTS.subject,parent:t})}},{key:"createTitle",value:function(n){var a=this;this.DATA.forEach(function(s,i){var r=e({tag:"section",classname:"lesson_".concat(i+1),html:"<h1>".concat(s.title,"</h1><h5>").concat(s.subTitle,"</h5>"),parent:n});e({classname:"cloud",parent:r});for(var c=0;c<5;c++){var o=e({classname:"starCircle",parent:r});o.classList.add("star_".concat(c+1))}for(var u=0;u<7;u++){var l=e({classname:"shootingStar",parent:r});l.classList.add("star_".concat(u+1))}e({classname:"sectionChar",parent:r}),r.addEventListener("click",a.openGame.bind(a,i)),t(r)})}},{key:"openGame",value:function(e){var t=this;this.selectedLessonIndex=e,setTimeout(function(){window.$efSound.open(),t.GAME.open(t.selectedLessonIndex+1)},100)}},{key:"closeGame",value:function(){this.selectedLessonIndex=null,this.GAME.close()}},{key:"clearGame",value:function(){this.GAME.clearGame()}},{key:"binding",value:function(){this.openGame=this.openGame.bind(this),this.closeGame=this.closeGame.bind(this)}}]),n}();window.$efSound={};var o={click:$ts.createAudio.set("../include/media/click2.mp3"),open:$ts.createAudio.set("../include/media/open2.mp3"),hover:$ts.createAudio.set("../include/media/hover.mp3")};for(var u in o)n(u,o[u]);window.$efSound.stop=a,window.$efSound.muted=function(e){for(var t in o)o[t].muted=e},window.addEventListener("load",function(){var e=document.querySelector("#wrap"),t=document.querySelector("#wrap > header"),n=document.querySelector("main"),a=document.querySelector("section.game");new window.$cale({target:e}),window.$SpecializeContents=new c({header:t,main:n,gameContaier:a})})})();