"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}(function(){var e="dragObjComplete",t="data-drag-obj-answer",a="data-drop-area-answer",n="data-complete-count",o=function(){function o(e){_classCallCheck(this,o),this.QUIZ=e,this.TOTAL_COUNT=0}return _createClass(o,[{key:"checkAnswers",value:function(e,n){if(!n)return!1;var o=e.element.getAttribute(t)||"",i=switchStringNumListToArray(o,","),r=n.element.getAttribute(a)||"",l=switchStringNumListToArray(r,",");return i.some(function(e){return l.some(function(t){return e===t})})}},{key:"init",value:function(){this.initGame(),this.initPopupOpenCallback(),this.initSliderMoveCallback()}},{key:"initGame",value:function(){var e=this,t=this.QUIZ.container,a=t.querySelectorAll(".js-dropArea"),n=t.querySelectorAll(".js-dragObj");this.game=initDragDrop({elements:{container:t,areas:a,objs:n},callbacks:{end:o.endCallback,movedOut:o.movedOutCallback,getZoomRate:function(){return e.getZoomRate()}},movedOutCorrPx:20}),this.game.quiz=this,this.game.init(),t.addEventListener("pointerup",function(e){e.stopPropagation()})}},{key:"initPopupOpenCallback",value:function(){var e=this;window.$popupCallBack||(window.$popupCallBack={}),window.$popupCallBack.open=function(t){"pageChange"===t.Mode&&e.popupOpenCallback()}}},{key:"initSliderMoveCallback",value:function(){var e=this;window.$callBack.sliderMove||(window.$callBack.sliderMove=function(){e.sliderMoveCallback()})}},{key:"sliderMoveCallback",value:function(){var e=this.game;this.reset(),e.initDragObjsCoords(),e.setZoomRate()}},{key:"endCorrect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.game.movingObj,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.game.droppedArea;this.TOTAL_COUNT++;var a=this.QUIZ.option.copy;a||(e.disable(!0),o.dragObjCompleteClass(e,!0)),this.copyObj(),o.completeArea(t),this.checkTotalComplete()}},{key:"endWrong",value:function(){this.game.movingObj.resetPosition()}},{key:"copyObj",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.game.movingObj,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.game.droppedArea;e.resetPosition();var a=e.element.cloneNode(!0);o.dragObjCompleteClass(a,!0),t.element.appendChild(a)}},{key:"showAnswer",value:function(){var e=this,t=this.game.dragObjs,a=this.game.dropAreas;t.forEach(function(t){a.forEach(function(a){var n=e.checkAnswers(t,a);if(n){var i=o.dropAreaHasCopied(t,a);i||(e.copyObj(t,a),o.dragObjCompleteClass(t,!0))}a.disable(!0)}),t.disable(!0)})}},{key:"reset",value:function(){this.game.initDragObjsCoords(),this.game.setZoomRate();var e=this.QUIZ.answerBtn,t=e&&e.dataset.option&&e.dataset.option.indexOf("resetOnly")>-1;t&&e.classList.add("reset"),this.resetAreas(),this.resetObjs(),this.TOTAL_COUNT=0}},{key:"resetObjs",value:function(){this.game.dragObjs.forEach(function(e){e.disable(!1),o.dragObjCompleteClass(e,!1)})}},{key:"resetAreas",value:function(){this.game.dropAreas.forEach(function(t){for(var a,n=t.element.querySelectorAll(".".concat(e)),o=0,i=n.length;o<i;o++)a=n[o],t.element.removeChild(a);t.disable(!1)})}},{key:"popupOpenCallback",value:function(){var e=this.game;this.reset(),e.initDragObjsCoords(),e.setZoomRate()}},{key:"getZoomRate",value:function(){var e=this.game.container.element;return{x:e.getBoundingClientRect().width/e.offsetWidth,y:e.getBoundingClientRect().height/e.offsetHeight}}},{key:"checkTotalComplete",value:function(){console.log("checkTotalComplete ".concat(this.TOTAL_COUNT," : ").concat(this.TOTAL_COMPLETE_COUNT));var e=this.TOTAL_COUNT===this.TOTAL_COMPLETE_COUNT;e&&(console.log("끝!"),this.QUIZ.toggleAnswerBtn())}},{key:"TOTAL_COMPLETE_COUNT",get:function(){this.game.container;var e=this.game.container.element.hasAttribute("data-total-complete-count")&&this.game.container.element.getAttribute("data-total-complete-count");return e=parseInt(e),e=isNaN(e)?0:e,e}}],[{key:"endCallback",value:function(e){var t=e.movingObj,a=e.droppedArea,n=e.quiz,o=!n.QUIZ.option.answer||n.checkAnswers(t,a);a&&o?(n.endCorrect(),window.$callBack&&window.$callBack.dragCorrect&&window.$callBack.dragCorrect(e)):(n.endWrong(),window.$callBack&&window.$callBack.dragIncorrect&&window.$callBack.dragIncorrect(e))}},{key:"movedOutCallback",value:function(e){}},{key:"completeArea",value:function(e){var t=e,a=t.element.dataset.option||"",n=a.indexOf("complete")>-1,i=o.getCompleteCnt(t.element),r=t.element.querySelectorAll(".js-dragObj")&&t.element.querySelectorAll(".js-dragObj").length||0,l=i===r;n&&l&&t.disable(!0)}},{key:"getCompleteCnt",value:function(e){return parseInt(e.getAttribute(n))||1}},{key:"convertScaleStringToArray",value:function(e){var t=e.split(","),a=t[0].split("(")[1],n=t[1].trim().split(")")[0];return[a,n].map(function(e){return parseFloat(e.trim())})}},{key:"dragObjCompleteClass",value:function(t,a){var n=t instanceof DragObj?t.element:t;a?n.classList.add(e):n.classList.remove(e)}},{key:"dropAreaHasCopied",value:function(e,t){for(var a,n=t.element.children,o=0,i=n.length;o<i;o++)if(a=n[o],e.element.className===a.className)return!0;return!1}}]),o}();window.$dragDrop=o})();