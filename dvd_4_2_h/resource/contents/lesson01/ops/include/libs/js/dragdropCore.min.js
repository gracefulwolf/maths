"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function initDragDrop(e){var t=e.elements,n=e.callbacks,o=e.movedOutCorrPx,r=new DragDropCore({elements:t,callbacks:n,movedOutCorrPx:o});return n&&n.init&&n.init(r),r}var DOM=function(){function e(t){_classCallCheck(this,e),this.element=t.element,this.element.self=this,this.name=t.name||"noname",this.attrName=t.attrName||t.name||null,this.getScale=t.getScale,this.DISABLED=!1}return _createClass(e,[{key:"hasClass",value:function(e){return this.element.classList.contains(e)}},{key:"addClass",value:function(e){return this.element.classList.add(e)}},{key:"removeClass",value:function(e){return this.element.classList.remove(e)}},{key:"hasAttr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attrName;return this.element.hasAttribute(e)}},{key:"getAttr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attrName;return this.element.getAttribute(e)}},{key:"setAttr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attrName,t=arguments.length>1?arguments[1]:void 0;this.element.setAttribute(e,t)}},{key:"setStyles",value:function(e){if(e.constructor===Object)for(var t,n=Object.getOwnPropertyNames(e),o=0,r=n.length;o<r;o++)t=n[o],this.element.style[t]=e[t]}},{key:"pointerOff",value:function(){this.setStyles({cursor:"default",pointerEvents:"none"})}},{key:"pointerOn",value:function(){this.setStyles({cursor:"pointer",pointerEvents:"auto"})}},{key:"show",value:function(){this.setStyles({opacity:"1",visibility:"visible"})}},{key:"hide",value:function(){this.setStyles({opacity:"0",visibility:"hidden"})}},{key:"addEvent",value:function(e,t){switch(e){case"down":this.element.addEventListener("mousedown",t),this.element.addEventListener("touchstart",t);break;case"move":this.element.addEventListener("mousemove",t),this.element.addEventListener("touchmove",t);break;case"up":this.element.addEventListener("mouseup",t),this.element.addEventListener("touchend",t);break;default:this.element.addEventListener(e,t)}}},{key:"removeEvent",value:function(e,t){switch(e){case"down":this.element.removeEventListener("mousedown",t),this.element.removeEventListener("touchstart",t);break;case"move":this.element.removeEventListener("mousemove",t),this.element.removeEventListener("touchmove",t);break;case"up":this.element.removeEventListener("mouseup",t),this.element.removeEventListener("touchend",t);break;default:this.element.removeEventListener(e,t)}}},{key:"eventIsOn",value:function(e,t){var n=this.sizes,o=n.left,r=n.top,s=n.width,i=n.height,a=t||0,l=e.x>o-a,c=e.y>r-a,u=e.x<o+s+a,d=e.y<r+i+a,v=this.DISABLED;return l&&c&&u&&d&&!v}},{key:"disable",value:function(e){this.DISABLED=e}},{key:"sizes",get:function(){return this.element.getBoundingClientRect()}},{key:"styles",get:function(){return window.getComputedStyle(this.element)}},{key:"scale",get:function(){return this.getScale?this.getScale():1}},{key:"offsets",get:function(){var e=this.element,t=e.offsetTop,n=e.offsetLeft,o=e.offsetWidth,r=e.offsetHeight;return{y:t,x:n,width:o,height:r}}}],[{key:"eventMaster",value:function(e){function t(e,t){return e.indexOf(t)>-1}var n,o=e.type;return t(o,"mouse")?n=e:t(o,"touch")&&(n=t(o,"touchend")?e.changedTouches[0]:e.touches[0]),n.coords={x:n.clientX,y:n.clientY},n}}]),e}(),Container=function(e){function t(e){var n;return _classCallCheck(this,t),n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)),n.dragDrop=e.dragDrop,n}return _inherits(t,e),_createClass(t,[{key:"init",value:function(){this.addEvents()}},{key:"addEvents",value:function(){this.addEvent("down",t.downEventCallback)}},{key:"movedOut",value:function(e){var t=e.x,n=e.y,o=this.sizes.x,r=this.sizes.y,s=o+this.sizes.width,i=r+this.sizes.height,a=window.innerWidth,l=window.innerHeight,c=this.dragDrop.movedOutCorrPx,u=t<=o+c||t<=c,d=t>=s-c||t>=a-c,v=n<=r+c||n<=c,h=n>=i-c||n>=l-c;return u||d||v||h}}],[{key:"downEventCallback",value:function(e){var n;for(n=e.target;(n.self&&n.self.constructor)!==t;)n=n.parentNode;var o=n.self,r=o.dragDrop,s=r.container;if(r.movingObj=r.objOnEvent(e),r.movingObj){s.addEvent("move",t.moveEventCallback),s.addEvent("up",t.upEventCallback);var i=r.movingObj,a=i.name;window.dragStartCallbacks&&window.dragStartCallbacks[a]&&"noname"!==a&&window.dragStartCallbacks[a](i)}r.callbacks&&r.callbacks.start&&r.callbacks.start(r)}},{key:"moveEventCallback",value:function(e){for(var n=e.target;(n&&n.self&&n.self.constructor)!==t;)n=n.parentNode;var o=n.self,r=o.dragDrop,s=r.movingObj,i=r.container,a=DOM.eventMaster(e),l=a.coords,c=i.movedOut(l),u=s.name;c?r.movedOut():(s.MOVED_COORDS=l,s.move(),r.callbacks&&r.callbacks.move&&r.callbacks.move(r),window.dragMoveCallbacks&&window.dragMoveCallbacks[u]&&"noname"!==u&&window.dragMoveCallbacks[u](s))}},{key:"upEventCallback",value:function(e){for(var n=e.target;(n.self&&n.self.constructor)!==t;)n=n.parentNode;var o=n.self,r=o.dragDrop,s=r.movingObj,i=r.droppedArea,a=s.name,l=i&&i.name;r.droppedArea=r.areaOnEvent(e),s.element.classList.remove("isDragging"),r.callbacks&&r.callbacks.end&&r.callbacks.end(r),window.dragDropCallbacks&&(window.dragDropCallbacks[a]&&"noname"!==a&&window.dragDropCallbacks[a](r),window.dragDropCallbacks[l]&&"noname"!==l&&window.dragDropCallbacks[l](r)),o.removeEvent("move",t.moveEventCallback),o.removeEvent("up",t.upEventCallback)}}]),t}(DOM),DragObj=function(e){function t(e){var n;return _classCallCheck(this,t),n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)),n.dragDrop=e.dragDrop,n.DISABLED=!1,n}return _inherits(t,e),_createClass(t,[{key:"init",value:function(){this.initCoords(),this.addEvents()}},{key:"initCoords",value:function(){var e=this.offsets,t=e.x,n=e.y;this.NON_SCALED_COORDS={x:t,y:n}}},{key:"addEvents",value:function(){this.addEvent("down",t.downEventHandler)}},{key:"move",value:function(e){var t=this.dragDrop,n=t.ZOOM_RATE,o=this.MOVED_COORDS,r=o.x/n.x,s=o.y/n.y,i=this.NON_SCALED_COORDS,a=i.x,l=i.y,c=e?a+e.x:a+r,u=e?l+e.y:l+s,d="absolute",v="".concat(u,"px"),h="".concat(c,"px");this.setStyles({position:d,top:v,left:h})}},{key:"resetPosition",value:function(){this.setStyles({position:"",top:"",left:""})}},{key:"getScaledCoords",value:function(){var e=this.dragDrop.container,t=this.sizes,n=e.sizes,o=t.left-n.left,r=t.top-n.top;return{x:o,y:r}}},{key:"NON_SCALED_COORDS",get:function(){return this._nonScaledCoords||{x:0,y:0}},set:function(e){this._nonScaledCoords=e}},{key:"STARTED_COORDS",get:function(){return this._startedCoords||{x:0,y:0}},set:function(e){this._startedCoords=e}},{key:"MOVED_COORDS",get:function(){return this._movedCoords||{x:0,y:0}},set:function(e){this._movedCoords||(this._movedCoords={}),this._movedCoords.x=e.x-this.STARTED_COORDS.x,this._movedCoords.y=e.y-this.STARTED_COORDS.y}}],[{key:"downEventHandler",value:function(e){for(var n=e.target;(n.self&&n.self.constructor)!==t;)n=n.parentElement;n.classList.add("isDragging");var o=n.self,r=o.dragDrop;o.NON_SCALED_COORDS,o.getScaledCoords();r.setZoomRate()}}]),t}(DOM),DropArea=function(e){function t(e){var n;return _classCallCheck(this,t),n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)),n.dragDrop=e.dragDrop,n}return _inherits(t,e),_createClass(t,[{key:"init",value:function(){}}]),t}(DOM),DragDropCore=function(){function e(t){_classCallCheck(this,e),this.elements=t.elements,this.callbacks=t.callbacks,this._container=null,this._dragObjs=[],this._dropAreas=[],this.getZoomRate=t.callbacks.getZoomRate,this.movedOutCorrPx=t.movedOutCorrPx||10}return _createClass(e,[{key:"init",value:function(){this.initContainer(),this.initDragObjs(),this.initDropAreas(),this.addEvents()}},{key:"initContainer",value:function(){var e=this.elements.container,t=e.dataset.name||null;e&&(this.container=new Container({element:e,name:t,dragDrop:this}),this.container.init())}},{key:"initDragObjs",value:function(){for(var e,t,n,o=this.elements.objs,r=0,s=o.length;r<s;r++)e=o[r],t=e.dataset.name||null,n=new DragObj({element:e,name:t,dragDrop:this}),n.init(),this.dragObjs=n}},{key:"initDropAreas",value:function(){for(var e,t,n,o=this.elements.areas,r=0,s=o.length;r<s;r++)e=o[r],t=e.dataset.name||null,n=new DropArea({element:e,name:t,dragDrop:this}),n.init(),this.dropAreas=n}},{key:"addEvents",value:function(){}},{key:"objOnEvent",value:function(e){for(var t,n,o=DOM.eventMaster(e),r=o.coords,s=e.type,i="mousedown"===s||"touchstart"===s,a=this.dragObjs,l=0,c=a.length;l<c;l++)if(t=a[l],n=t.eventIsOn(r),n)return i&&(t.STARTED_COORDS=r),t}},{key:"areaOnEvent",value:function(e){for(var t,n,o=DOM.eventMaster(e),r=o.coords,s=this.dropAreas,i=0,a=s.length;i<a;i++)if(t=s[i],n=t.eventIsOn(r),n)return t}},{key:"setZoomRate",value:function(){this.ZOOM_RATE=this.getZoomRate()||1}},{key:"disableObjs",value:function(e){this.dragObjs.forEach(function(t){t.disable(e)})}},{key:"disableAreas",value:function(e){this.dropAreas.forEach(function(t){t.disable(e)})}},{key:"initDragObjsCoords",value:function(){this.dragObjs.forEach(function(e){e.initCoords()})}},{key:"movedOut",value:function(){var e=this.container;this.movingObj.resetPosition(),this.movingObj=null,e.removeEvent("move",Container.moveEventCallback),e.removeEvent("up",Container.upEventCallback),this.callbacks&&this.callbacks.movedOut&&this.callbacks.movedOut(this)}},{key:"container",get:function(){return this._container},set:function(e){this._container=e}},{key:"dragObjs",get:function(){return this._dragObjs},set:function(e){this.dragObjs.push(e)}},{key:"dropAreas",get:function(){return this._dropAreas},set:function(e){this._dropAreas.push(e)}},{key:"ZOOM_RATE",get:function(){return this._zoomRate||{x:1,y:1}},set:function(e){this._zoomRate=e}},{key:"movingObj",get:function(){return this._movingObj},set:function(e){this._movingObj=e}},{key:"droppedArea",get:function(){return this._droppedArea},set:function(e){this._droppedArea=e}}]),e}();