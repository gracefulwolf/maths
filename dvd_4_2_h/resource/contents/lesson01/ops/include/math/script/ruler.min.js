"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}(function(){function t(t){var e=t.offsetWidth,i=t.getBoundingClientRect().width;return i/e}function e(t){var e=t.type.indexOf("touch")>-1,i=e?t.changedTouches[0]:t;return{x:i.clientX,y:i.clientY}}function i(t){return document.elementFromPoint(e(t).x,e(t).y)}var s="isDragging",n=function(){function t(e){_classCallCheck(this,t),this.dom=e,this.scaleValue=1,this.style={width:e.offsetWidth,height:e.offsetHeight,x:e.offsetLeft,y:e.offsetTop,centerX:e.offsetWidth/2,centerY:e.offsetHeight/2},this.move=this.move.bind(this),this.reset=this.reset.bind(this)}return _createClass(t,[{key:"move",value:function(t){var e=t.x,i=t.y;this.dom.style.left=e+"px",this.dom.style.top=i+"px"}},{key:"dragging",value:function(){this.dom.classList.add(s)}},{key:"reset",value:function(){this.isDragging=!1,this.dom.classList.remove(s),this.dom.style.top="",this.dom.style.left="",this.dom.style.webkitTransform="",this.dom.style.mozTransform="",this.dom.style.msTransform="",this.dom.style.transform="",this.scaleValue=1}},{key:"setScale",value:function(t){var e="scale(".concat(t,")");this.dom.style.webkitTransform=e,this.dom.style.mozTransform=e,this.dom.style.msTransform=e,this.dom.style.transform=e,this.scaleValue=t}},{key:"rotate",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var e="scale(".concat(this.scaleValue,") rotate(").concat(t,"deg)");this.dom.style.webkitTransform=e,this.dom.style.mozTransform=e,this.dom.style.msTransform=e,this.dom.style.transform=e}},{key:"normalize",value:function(){this.dom.children[0].style.pointerEvents=""}},{key:"off",value:function(){this.dom.children[0].style.pointerEvents="none"}},{key:"x",get:function(){return this.dom.offsetLeft}},{key:"y",get:function(){return this.dom.offsetTop}},{key:"curX",get:function(){return this.dom.getBoundingClientRect().left}},{key:"curY",get:function(){return this.dom.getBoundingClientRect().top}}]),t}(),o=function(){function s(t){var e=t.container,i=t.obj,o=t.callback;_classCallCheck(this,s),this.obj=new n(i),this.container=e,this.callback=o,this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.out=this.out.bind(this),this.obj.dom.addEventListener("mousedown",this.start),this.obj.dom.addEventListener("touchstart",this.start),this.container.addEventListener("pointerup",function(t){t.stopPropagation()})}return _createClass(s,[{key:"getIsCallback",value:function(t){return this.callback&&this.callback[t]}},{key:"getIsChild",value:function(t){return this.container.contains(t)}},{key:"addEvent",value:function(){this.container.addEventListener("mousemove",this.move),this.container.addEventListener("touchmove",this.move),this.container.addEventListener("mouseup",this.end),this.container.addEventListener("touchend",this.end),this.container.addEventListener("mouseout",this.out)}},{key:"removeEvent",value:function(){this.container.removeEventListener("mousemove",this.move),this.container.removeEventListener("touchmove",this.move),this.container.removeEventListener("mouseup",this.end),this.container.removeEventListener("touchend",this.end),this.container.removeEventListener("mouseout",this.out)}},{key:"cloneObj",value:function(t){var e=t.cloneNode(!0);return t.parentElement.appendChild(e),new n(e)}},{key:"start",value:function(t){t.preventDefault(),t.stopPropagation(),this.startData=e(t),this.startObjPosition={x:this.obj.x,y:this.obj.y},this.obj.dragging(),this.addEvent(),this.getIsCallback("start")&&this.callback.start(this)}},{key:"move",value:function(t){t.preventDefault(),t.stopPropagation(),this.moveData=e(t),this.obj.move(this.movedData),this.obj.off(),this.getIsCallback("move")&&this.callback.move(this),this.getIsChild(i(t))||this.out()}},{key:"end",value:function(t){this.removeEvent(),i(t)==this.obj.dom.parentElement&&(this.obj.reset(),this.isReset=!0),this.obj.normalize(),this.getIsCallback("end")&&this.callback.end(this)}},{key:"out",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&this.getIsChild(i(t))||(this.removeEvent(),this.getIsCallback("out")&&this.callback.out(this))}},{key:"reset",value:function(){this.obj.reset()}},{key:"zoomRate",get:function(){return t(this.container)}},{key:"movedData",get:function(){return{x:(this.moveData.x-this.startData.x)/this.zoomRate+this.startObjPosition.x,y:(this.moveData.y-this.startData.y)/this.zoomRate+this.startObjPosition.y}}}]),s}(),a=function(){function e(t){_classCallCheck(this,e),this.OPTS=t,this.obj=t.target,this.container=t.container,this.rotateRightButton=new n(t.rotateRightButton),this.rotateLeftButton=new n(t.rotateLeftButton),this.scale=t.scale,this.deg=t.degree||15,this.callback=t.callback,this.binding(),this.setRotateEvent(),this.setTransformOrigin([this.obj]),this.DRAGDROP=new o({container:this.container,obj:this.obj,scale:this.scale,callback:{start:this.start,move:this.move,end:this.end,out:this.out}}),this.degree=0}return _createClass(e,[{key:"getIsCallback",value:function(t){return this.callback&&this.callback[t]}},{key:"getPosition",value:function(t){return{x:t.offsetLeft,y:t.offsetTop}}},{key:"getCurrentPosition",value:function(t){var e=t.getBoundingClientRect();return{x:e.x,y:e.y}}},{key:"setTransformOrigin",value:function(t){var e=this,i=function(t){t.style.webkitTransformOrigin=e.transformOriginValue,t.style.mozTransformOrigin=e.transformOriginValue,t.style.msTransformOrigin=e.transformOriginValue,t.style.transformOrigin=e.transformOriginValue};t.forEach(i)}},{key:"start",value:function(t){t.obj.isDragging||(t.obj.setScale(this.scale),t.obj.isDragging=!0,this.rotateRightButton.dragging(),this.rotateLeftButton.dragging(),this.rotateRightButton.setScale(this.scale),this.rotateLeftButton.setScale(this.scale)),this.startPointer_right={x:this.rotateRightButton.x,y:this.rotateRightButton.y},this.startPointer_left={x:this.rotateLeftButton.x,y:this.rotateLeftButton.y},this.getIsCallback("start")&&this.callback.start(this)}},{key:"move",value:function(t){var e={x:(t.moveData.x-t.startData.x)/t.zoomRate,y:(t.moveData.y-t.startData.y)/t.zoomRate};this.moveRotateButtons(e),this.getIsCallback("move")&&this.callback.move(this)}},{key:"end",value:function(t){this.stopRotate(),t.isReset&&(this.rotateRightButton.reset(),this.rotateLeftButton.reset(),t.isReset=!1),this.getIsCallback("end")&&this.callback.end(this)}},{key:"out",value:function(t){this.stopRotate(),this.getIsCallback("out")&&this.callback.out(this)}},{key:"reset",value:function(){this.DRAGDROP.reset(),this.rotateRightButton.reset(),this.rotateLeftButton.reset(),this.setTransformOrigin([this.obj])}},{key:"moveRotateButtons",value:function(t){this.rotateLeftButton.move({x:t.x+this.startPointer_left.x,y:t.y+this.startPointer_left.y}),this.rotateRightButton.move({x:t.x+this.startPointer_right.x,y:t.y+this.startPointer_right.y})}},{key:"startRotate",value:function(t){var e=this;this.stopRotate();var i=function(){var i="center";"right"===t?e.degree+=e.deg:e.degree-=e.deg,e.DRAGDROP.obj.rotate(e.degree,i)};i()}},{key:"stopRotate",value:function(){}},{key:"binding",value:function(){this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.out=this.out.bind(this),this.stopRotate=this.stopRotate.bind(this),this.reset=this.reset.bind(this)}},{key:"setRotateEvent",value:function(){this.rotateRightButton.dom.addEventListener("mousedown",this.startRotate.bind(this,"right")),this.rotateRightButton.dom.addEventListener("touchstart",this.startRotate.bind(this,"right")),this.rotateLeftButton.dom.addEventListener("mousedown",this.startRotate.bind(this,"left")),this.rotateLeftButton.dom.addEventListener("touchstart",this.startRotate.bind(this,"left")),this.container.addEventListener("mouseup",this.stopRotate),this.container.addEventListener("touchend",this.stopRotate),this.container.addEventListener("mouseup",this.stopRotate),this.container.addEventListener("touchend",this.stopRotate)}},{key:"transformOriginValue",get:function(){return"".concat(.3*this.obj.offsetWidth,"px ").concat(.7*this.obj.offsetHeight,"px")}},{key:"zoomRate",get:function(){return t(this.container)}}]),e}();window.$Ruler=a})();