"use strict";function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}(function(){function e(e){var t=r({tag:"div",className:"INDEX",parent:e}),n=r({tag:"div",className:"lessonContainer",parent:t}),s=r({tag:"div",className:"cornerContainer",parent:t}),i=r({tag:"div",className:"stepContainer",parent:t});r({tag:"div",className:"cornerChar",parent:s});return{indexContainer:t,lessonContainer:n,cornerContainer:s,stepContainer:i}}function t(e){for(var t=0;t<3;t++){var n=document.createElement("div");e.appendChild(n)}}function n(e){var n=document.createElement("div");return n.classList.add("indexButton"),t(n),e.appendChild(n),n}function s(e){var t="../pageInfo.json",n=new XMLHttpRequest("newJSON");n.open("GET",t),n.responseType="json",n.onload=function(){var t;t=_instanceof(this.response,Object)?this.response:JSON.parse(this.response),e(t)},n.send()}function r(e){var t=document.createElement(e.tag||"div");return e.className&&e.className.replace(/ /g,"").split(",").forEach(function(e){return t.classList.add(e)}),(e.parent||document.body).appendChild(t),t}function i(e){var t=r(e),n=!e.html||""===e.html,s=1==e.hidden;return n&&t.classList.add("noTitle"),s&&t.classList.add("hidden"),e.index&&t.setAttribute("index",e.index),n||(t.innerHTML="<span>".concat(e.html,"</span>")),e.type&&t.setAttribute("type",e.type),e.callback&&e.callback(t),t}function o(e,t,n,s,r){return i({className:t,parent:n,html:e.title,index:e.index||s,type:e.type,callback:r})}function a(e){return e.lessons.map(function(e){var t=[],n=0;return e.chapters.forEach(function(e){e.corners.forEach(function(e){e.steps.forEach(function(e){e.htmls.forEach(function(e){t.push({html:e,index:n}),n++})})})}),t})}function c(e,t){return e.filter(function(e){return e.html.name===t})[0].index}var u=function(){function e(t){var n=t.dom,s=t.data,r=t.index;_classCallCheck(this,e),this.dom=n,this.info=s,this.index=s.index||r}return _createClass(e,[{key:"open",value:function(){this.dom.classList.add("on")}},{key:"close",value:function(){this.dom.classList.remove("on"),this.dom.classList.remove("active")}},{key:"active",value:function(){this.dom.classList.add("active")}}]),e}(),h=function(){function e(t){var n=t.pageInfo,s=t.indexContainer,i=t.lessonContainer,o=t.cornerContainer,c=t.stepContainer,u=t.button;_classCallCheck(this,e),this.PAGEINFO=n,this.indexContainer=s,this.lessonContainer=i,this.cornerContainer=o,this.stepContainer=c,this.indexButton=u,this.closeButton=r({className:"indexCloseButton",parent:this.indexContainer}),this.isChapter=!1,this.isStep=!1,this.isViewer=!1,this.isSubContents=window.location.pathname.indexOf("sub")>-1,this.currentIndex={lesson:1,chapter:0,corner:0,step:0,html:0,index:1},this.HTMLS=a(this.PAGEINFO.contents),this.binding(),this.create(),this.getCurrentIndexFromUrl(),this.setCurrentIndex(),this.addOpenEvent(),this.addCloseEvent()}return _createClass(e,[{key:"addOpenEvent",value:function(){this.indexButton&&this.indexButton.addEventListener("click",this.openIndexContainer)}},{key:"addCloseEvent",value:function(){var e=this;this.closeButton.addEventListener("click",this.closeIndexContainer),this.closeButton.addEventListener("mouseover",function(t){return e.closeButton.classList.add("hover")}),this.closeButton.addEventListener("mouseout",function(t){return e.closeButton.classList.remove("hover")})}},{key:"resetIndex",value:function(e){var t=this,n=["Lesson","Chapter","Corner","Step","Html"],s=n.map(function(e){return e.toLowerCase()}).indexOf(e)||0;n.forEach(function(e,n){n>s&&(t["cur".concat(e)]=0)})}},{key:"getCurrentHtml",value:function(e,t){var n,s,r=function(e,t){e.steps?e.steps.forEach(function(e){e.htmls.forEach(function(e){i(e,t)})}):e.htmls.forEach(function(e){i(e,t)})},i=function(e,r){e.info.name===t&&(s=r,n=e)};return e.chapters?e.chapters.forEach(function(e){e.corners.forEach(r)}):e.corners.forEach(r),{html:n,cornerIndex:s}}},{key:"getCurrentIndexFromUrl",value:function(){console.log("filename:",this.URL.filename);var e=this.URL.filename.split("_"),t=e[0]-1,n=(this.isChapter&&e[1],this.isChapter?e[2]:e[1],e[e.length-1]-1);this.curLesson=t,this.curHtml=n;var s=this.getCurrentHtml(this.DATA[t],this.URL.filename);s&&(this.curCorner=s.cornerIndex,this.currnetHtml=s.html)}},{key:"setAttrToContainer",value:function(){this.lessonContainer.setAttribute("lesson",this.curLesson+1),this.lessonContainer.setAttribute("chapter",this.curChapter+1),this.lessonContainer.setAttribute("corner",this.curCorner+1),this.lessonContainer.setAttribute("step",this.curStep+1),this.lessonContainer.setAttribute("html",this.curHtml+1)}},{key:"setCurrentIndex",value:function(){this.setAttrToContainer(),this.closeAllList(),this.openCurrentList()}},{key:"closeAllList",value:function(){var e=function e(t){t.close(),t.corners&&t.corners.forEach(e),t.steps&&t.steps.forEach(e),t.htmls&&t.htmls.forEach(e)};this.DATA.forEach(function(t){t.chapters.forEach(e)})}},{key:"openCurrentList",value:function(){var e=this,t=function(t){t.open();var s=t.index-1===e.curChapter;s&&(t.active(),t.corners.forEach(n))},n=function(t){t.open();var n=t.index-1===e.curCorner;n&&(t.active(),t.steps?t.steps.forEach(s):t.htmls.forEach(r))},s=function(e){e.open(),e.htmls.forEach(r)},r=function(t){t.open(),e.currnetHtml&&e.currnetHtml.active()};this.DATA.forEach(function(s){s.close(),s.open();var r=s.index-1===e.curLesson;r&&(s.active(),s.chapters?s.chapters.forEach(t):s.corners.forEach(n))})}},{key:"create",value:function(){var e,t,n=this,s=function(e){var t=e.data,n=e.className,s=e.parent,i=e.index,a=e.callback,c=o(t,n,s,i,a),h=new u({dom:c,data:t,index:i});return t.chapters&&(h.chapters=r(t.chapters,"chapter")),t.corners&&(h.corners=r(t.corners,"corner")),t.steps&&(h.steps=r(t.steps,"step")),t.htmls&&(h.htmls=r(t.htmls,"html")),h},r=function(r,i){var o="chapter"===i,a="corner"===i,c="step"===i,u="html"===i,h=u||c?n.stepContainer:a?n.cornerContainer:n.lessonContainer,l=i.split("");return l[0]=i.toUpperCase().split("")[0],c&&(t=0,e=0),r.map(function(r,a){return u&&t++,c&&(e++,""!==r.title&&void 0!==r.title&&(n.isStep=!0)),o&&""!==r.title&&void 0!==r.title&&(n.isChapter=!0),s({index:u?t:r.index-1||a,data:r,className:i,parent:h,callback:function(t){u&&t.setAttribute("step-index",e),t.addEventListener("click",function(e){n.changeLesson(t,l.join(""))}),t.addEventListener("mouseover",function(e){return t.classList.add("hover")}),t.addEventListener("mouseout",function(e){return t.classList.remove("hover")}),!1===r.active&&t.classList.add("off")}})})};this.DATA=r(this.PAGEINFO.contents.lessons,"lesson")}},{key:"setIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.toLowerCase();this.resetIndex(n),this["cur".concat(e)]=t,"html"===n&&(this.curIndex=c(this.HTMLS[this.curLesson],this.curFileName))}},{key:"changeLesson",value:function(e,t){var n="Html"===t;n&&this.setIndex("Step",e.getAttribute("step-index")-1),this.setIndex(t,e.getAttribute("index")-1),this.setCurrentIndex(),this.changePage(n)}},{key:"changePage",value:function(e){var t=this.isViewer?"/viewer/contents/index.html?contentInformationURL=../../resource/".concat(this.isSubContents?"contents_sub":"contents","/lesson0").concat(this.curLesson+1,"&page=").concat(this.curIndex+1):"../index.html?page=".concat(this.curLesson+1,"_").concat(this.curCorner,"_").concat(this.curHtml+1);e&&(this.isViewer?jj.link.html(t,"_top"):window.parent.location.replace(t),this.closeIndexContainer())}},{key:"openIndexContainer",value:function(){this.getCurrentIndexFromUrl(),this.setCurrentIndex(),this.indexContainer.classList.add("on")}},{key:"closeIndexContainer",value:function(){this.indexContainer.classList.remove("on")}},{key:"binding",value:function(){this.create=this.create.bind(this),this.changeLesson=this.changeLesson.bind(this),this.openCurrentList=this.openCurrentList.bind(this),this.changePage=this.changePage.bind(this),this.openIndexContainer=this.openIndexContainer.bind(this),this.closeIndexContainer=this.closeIndexContainer.bind(this)}},{key:"URL",get:function(){this.isViewer=parent.parent.GO_PAGE_LOAD;var e={},t=window.location.pathname.split(".html")[0].split("/").filter(function(e){return""!==e});return e.host=window.location.host,e.path=this.isViewer?"".concat(window.location.pathname.split("contents")[0],"contents"):null,e.lessonIndex=t[t.length-2]-1,e.filename=t[t.length-1],this.curIndex=c(this.HTMLS[e.lessonIndex],e.filename),e}},{key:"curFileName",get:function(){var e,t=this,n=0;return this.PAGEINFO.contents.lessons[this.curLesson].chapters[this.curChapter].corners[this.curCorner].steps.forEach(function(s){s.htmls.forEach(function(s){n===t.curHtml&&(e=s.name),n++})}),e}},{key:"curLesson",set:function(e){this.currentIndex.lesson=e},get:function(){return this.currentIndex.lesson}},{key:"curChapter",set:function(e){this.currentIndex.chapter=e},get:function(){return this.currentIndex.chapter}},{key:"curCorner",set:function(e){this.currentIndex.corner=e},get:function(){return this.currentIndex.corner}},{key:"curStep",set:function(e){this.currentIndex.step=e},get:function(){return this.currentIndex.step}},{key:"curHtml",set:function(e){this.currentIndex.html=e},get:function(){return this.currentIndex.html}},{key:"curIndex",set:function(e){this.currentIndex.index=e},get:function(){return this.currentIndex.index}}]),e}();window.PAGEINFO||s(function(s){if(s){window.PAGEINFO=s;var r=e(document.querySelector("#wrap")||document.body),i=document.querySelector(".js-indexButton")||n(document.querySelector("header"));t(i),window.$INDEX=new h({pageInfo:window.PAGEINFO,indexContainer:r.indexContainer,lessonContainer:r.lessonContainer,cornerContainer:r.cornerContainer,stepContainer:r.stepContainer,button:i})}else alert("목차 정보가 없습니다!!");console.log("loaded PAGEINFO --->",s)})})();